{"meta":{"title":"è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶","subtitle":"HaloğŸ’«","description":"Spring Cloudä¸­å›½ç¤¾åŒºåˆ›å§‹äººï¼Œå…¥èŒäºé˜¿é‡Œ,æ›¾å…¥èŒäºå”¯å“ä¼šä¸­é—´ä»¶,ä¸šä½™ä¸»è¦ç ”ç©¶Spring Cloudã€‚ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä½œè€…","author":"HaloğŸ’«","url":"http://xujin.org"},"pages":[{"title":"404 Page Not Found","date":"2017-08-04T15:36:59.000Z","updated":"2019-01-09T15:56:50.499Z","comments":true,"path":"404.html","permalink":"http://xujin.org/404.html","excerpt":"","text":""},{"title":"about","date":"2017-07-28T16:50:51.000Z","updated":"2019-01-10T14:34:17.803Z","comments":true,"path":"about/index.html","permalink":"http://xujin.org/about/index.html","excerpt":"","text":"ä¸€.è‡ªæˆ‘ä»‹ç» ç±è´¯äº‘å—ï¼Œç°å±…ä¸Šæµ·ã€‚å…¥èŒäºé˜¿é‡Œï¼ŒèŠ±åç¹éœ–ã€‚è½¯ä»¶å·¥ç¨‹ä¸“ä¸šï¼Œä¸“æ³¨äºåŸºç¡€æ¶æ„å’Œå„ç§ä¸­é—´ä»¶è®¾è®¡ä¸ç ”å‘ã€‚Spring Cloudä¸­å›½ç¤¾åŒºåˆ›å§‹äººï¼Œã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä½œè€…ä¹‹ä¸€ã€‚ å½“å½“è´­ä¹°åœ°å€:http://product.dangdang.com/25348282.htmläº¬ä¸œè´­ä¹°åœ°å€:https://item.jd.com/12447280.html æ›¾å°±èŒäºé¥¿äº†ä¹ˆã€‚ æ›¾å°±èŒäºå”¯å“ä¼šå¹³å°æ¶æ„éƒ¨ï¼Œå‚ä¸å”¯å“ä¼šä¸­é—´ä»¶(æœåŠ¡ç½‘å…³,åº”ç”¨æ¡†æ¶ï¼Œä»£ç ç”Ÿæˆå™¨ç­‰)ç›¸å…³çš„ç ”å‘å·¥ä½œã€‚ æ›¾å‚ä¸å”¯å“ä¼šäº’è”ç½‘é‡‘èå¹³å°çš„è®¾è®¡ä¸å¼€å‘(https://jinrong.vip.com/)ï¼Œ æ›¾å‚ä¸åŸºäºäº‘è®¡ç®—Iaasçš„å¹³å®‰ç§‘æŠ€äº‘å¹³å°(www.pinganyun.com)å’Œå›½æ³°å›å®‰è¯å·äº‘å¹³å°çš„å¼€å‘ï¼Œ æ›¾å‚ä¸åŸºäºäº‘è®¡ç®—Saaså¹³å°çš„äº‘é”€å”®ç®¡ç†ç³»ç»Ÿçš„å¼€å‘ç­‰ã€‚å¼€å‘çš„ç§æœ‰äº‘äº§å“åº”ç”¨äºå¤ªå¹³äººå¯¿ï¼Œä¸œäºšé“¶è¡Œï¼Œå¤©ç¿¼è§†è®¯ï¼Œä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€,å›½æ³°å›å®‰ç­‰ã€‚ ç†Ÿç»ƒè¿ç”¨å„ç§æµè¡Œçš„JavaEEæŠ€æœ¯è¿›è¡Œç»„åˆå¼æ¶æ„è®¾è®¡ä¸å¼€å‘ã€‚ä¸šä½™æ—¶é—´ç ”ç©¶å¹¶å‘ç¼–ç¨‹ï¼Œä¸­é—´ä»¶ï¼Œå¼‚åœ°å¤šæ´»ï¼ŒSpring Cloudï¼ŒZStack(zstack.org.cn)ï¼ŒMycatç­‰å¼€æºé¡¹ç›®ï¼Œä»¥åŠè½¯ä»¶æ¶æ„è®¾è®¡ï¼Œç¨‹åºæ€§èƒ½ä¼˜åŒ–ï¼ŒJVMï¼Œé«˜å¹¶å‘ç­‰ï¼ äºŒ.åˆ†äº«ç»å† Spring Cloud Zuulä¸ç½‘å…³ä¸­é—´ä»¶ Spring Cloudä¸ä¸­é—´ä»¶åŠå›½å†…ä½¿ç”¨æƒ…å†µ Spring Cloud ä¸å¾®æœåŠ¡ç½‘å…³ Spring Cloudä¸é¢†åŸŸé©±åŠ¨æ¶æ„æ²»ç†å®æˆ˜ ä¸‰.è”ç³»æ–¹å¼ E-mail: Software_King@qq.com Github: Software_King ç½‘ç«™: http://xujin.org ç½‘ç»œID:Software_King å¾®ä¿¡:Software_King Spring Cloudä¸­å›½ç¤¾åŒº:http://springcloud.cn åº§å³é“­:è½¯ä»¶ä¸–ç•Œå°±æ˜¯æ¨¡æ‹Ÿå®¢è§‚ä¸–ç•Œï¼Œä»è€Œéœ€æ±‚åˆ†æï¼ŒæŠ€æœ¯é©±åŠ¨ï¼Œæ”¹é€ ä¸–ç•Œï¼"},{"title":"Categories","date":"2018-01-04T16:00:00.000Z","updated":"2019-01-09T15:56:50.511Z","comments":true,"path":"categories/index.html","permalink":"http://xujin.org/categories/index.html","excerpt":"","text":"title: Androiddate: 2018-01-05 00:00:00 type: â€œcategoriesâ€ title: Hexodate: 2018-01-05 00:00:00 type: â€œcategoriesâ€"},{"title":"search","date":"2018-04-01T09:52:02.000Z","updated":"2019-01-09T15:56:50.511Z","comments":true,"path":"search/index.html","permalink":"http://xujin.org/search/index.html","excerpt":"","text":""},{"title":"Tags","date":"2018-03-31T16:00:00.000Z","updated":"2019-01-09T15:56:50.512Z","comments":true,"path":"tags/index.html","permalink":"http://xujin.org/tags/index.html","excerpt":"","text":""},{"title":"Android","date":"2018-01-04T16:00:00.000Z","updated":"2019-01-09T15:56:50.510Z","comments":true,"path":"categories/Android/index.html","permalink":"http://xujin.org/categories/Android/index.html","excerpt":"","text":""},{"title":"Hexo","date":"2018-01-04T16:00:00.000Z","updated":"2019-01-09T15:56:50.511Z","comments":true,"path":"categories/Hexo/index.html","permalink":"http://xujin.org/categories/Hexo/index.html","excerpt":"","text":""}],"posts":[{"title":"Spring Cloudç¬¬äºŒä»£","slug":"sc/sc2","date":"2018-11-27T06:00:00.000Z","updated":"2019-01-13T05:49:46.955Z","comments":true,"path":"sc/sc2/","link":"","permalink":"http://xujin.org/sc/sc2/","excerpt":"æ‘˜è¦: éšç€Eurekaä¸å†ç»´æŠ¤ï¼ŒHystrixä¸å†å¼€å‘æ–°åŠŸèƒ½ï¼Œè¿›å…¥ç»´æŠ¤çŠ¶æ€ã€‚ä»¥åŠæœ€è¿‘ä¸­å›½å¼€æºå‡ºç°ä¸€äº›å¤§äº‹ï¼Œé¢„æµ‹ä¸€ä¸‹2019å¹´æœªæ¥Spring Cloudç”Ÿæ€åœˆä¸­çš„ç¬¬äºŒä»£ç»„ä»¶çš„ç»„åˆï¼Œä»…ä»£è¡¨ä¸ªäººçœ‹æ³•ã€‚ 1. Spring Cloudç¬¬ä¸€ä»£ Spring Cloudè‡ªä»æ¨å‡ºä¹‹åï¼Œç»™å¤§å®¶çš„æ„Ÿè§‰å°±æ˜¯Spring Cloudåšå®ƒæœ€æ“…é•¿çš„äº‹ï¼Œä¹Ÿå°±æ˜¯é«˜åº¦æŠ½è±¡å’Œå°è£…ï¼Œå¼ºå¼ºè”æ‰‹æ•´åˆæœ€ä¼˜ä¸œè¥¿ä¸ºæˆ‘æ‰€ç”¨ï¼Œæ¯”å¦‚Netflixå¼€æºçš„Eurekaï¼ŒHystrixï¼ŒRibbonç­‰ã€‚è€Œä¸”æä¾›å¤šç§æŠ€æœ¯é€‰å‹ï¼Œæ€åº¦ä¸­ç«‹è€Œé€‰æœ€ä¼˜ã€‚8å¤©å‰ä¹Ÿå°±æ˜¯2018å¹´11æœˆ19å·å·¦å³ï¼ŒNetflixçš„å¼€æºé¡¹ç›®Hystrixå®£å¸ƒçŠ¶æ€ï¼Œä¸å†å¼€å‘æ–°åŠŸèƒ½ï¼Œå¤„äºç»´æŠ¤çŠ¶æ€ã€‚å¼•å‘æœ‹å‹åœˆçš„ä¸€äº›æ€è€ƒã€‚","text":"æ‘˜è¦: éšç€Eurekaä¸å†ç»´æŠ¤ï¼ŒHystrixä¸å†å¼€å‘æ–°åŠŸèƒ½ï¼Œè¿›å…¥ç»´æŠ¤çŠ¶æ€ã€‚ä»¥åŠæœ€è¿‘ä¸­å›½å¼€æºå‡ºç°ä¸€äº›å¤§äº‹ï¼Œé¢„æµ‹ä¸€ä¸‹2019å¹´æœªæ¥Spring Cloudç”Ÿæ€åœˆä¸­çš„ç¬¬äºŒä»£ç»„ä»¶çš„ç»„åˆï¼Œä»…ä»£è¡¨ä¸ªäººçœ‹æ³•ã€‚ 1. Spring Cloudç¬¬ä¸€ä»£ Spring Cloudè‡ªä»æ¨å‡ºä¹‹åï¼Œç»™å¤§å®¶çš„æ„Ÿè§‰å°±æ˜¯Spring Cloudåšå®ƒæœ€æ“…é•¿çš„äº‹ï¼Œä¹Ÿå°±æ˜¯é«˜åº¦æŠ½è±¡å’Œå°è£…ï¼Œå¼ºå¼ºè”æ‰‹æ•´åˆæœ€ä¼˜ä¸œè¥¿ä¸ºæˆ‘æ‰€ç”¨ï¼Œæ¯”å¦‚Netflixå¼€æºçš„Eurekaï¼ŒHystrixï¼ŒRibbonç­‰ã€‚è€Œä¸”æä¾›å¤šç§æŠ€æœ¯é€‰å‹ï¼Œæ€åº¦ä¸­ç«‹è€Œé€‰æœ€ä¼˜ã€‚8å¤©å‰ä¹Ÿå°±æ˜¯2018å¹´11æœˆ19å·å·¦å³ï¼ŒNetflixçš„å¼€æºé¡¹ç›®Hystrixå®£å¸ƒçŠ¶æ€ï¼Œä¸å†å¼€å‘æ–°åŠŸèƒ½ï¼Œå¤„äºç»´æŠ¤çŠ¶æ€ã€‚å¼•å‘æœ‹å‹åœˆçš„ä¸€äº›æ€è€ƒã€‚ è™½ç„¶Eurekaï¼ŒHystrixç­‰ä¸å†ç»§ç»­å¼€å‘æˆ–ç»´æŠ¤ï¼Œä½†æ˜¯ç›®å‰æ¥è¯´ä¸å½±å“ä½¿ç”¨ï¼Œä¸ç®¡æ€ä¹ˆè¯´æ„Ÿè°¢å¼€æºï¼Œå‘Netflixå…¬å¸çš„å¼€æºè‡´æ•¬ã€‚ éšç€Spring Cloudç”Ÿæ€åœˆçš„å‘å±•ä¸æˆé•¿ï¼ŒSpring Cloudé™†ç»­æ¨å‡ºäº†è‡ªå·±çš„ä¸€äº›ç»„ä»¶ï¼ŒæŒ‘é€‰ä¸»è¦ç»„ä»¶è¯´æ˜å¦‚ä¸‹è¡¨æ‰€ç¤º: ç»„ä»¶ æ¥æº è¯´æ˜ Spring-cloud-openfeign åŸºäºFeignçš„å‡çº§ æœåŠ¡ä¹‹é—´è°ƒç”¨çš„å¿…å¤‡ç»„ä»¶ spring-cloud-zuul æ¥æºäºNetflix Zuul ç›®å‰è¿˜åœ¨ç»§ç»­ç»´æŠ¤ï¼Œä½†æ˜¯å·²ç»æœ‰è‡ªå·±çš„Spring Cloud Gateway,ä¸ä¹…å°†æ¥é€æ¸æ·˜æ±° spring-cloud-eureka é›†æˆäºNetflix Eureka ç›®å‰è¿˜åœ¨è·ŸéšSpring Cloudç‰ˆæœ¬å‡çº§ç»´æŠ¤ï¼Œæœ€ç»ˆä¹Ÿä¼šè¢«æ›¿ä»£ spring-cloud-config è‡ªç ” åŠŸèƒ½ä¸è¶³ï¼Œå›½å†…ä½¿ç”¨å…¶å®ƒé…ç½®ä¸­å¿ƒæ›¿ä»£ï¼Œæ¯”å¦‚æºç¨‹çš„Apollo å…¨é“¾è·¯ç›‘æ§(sleuth+zikpinæˆ–pinpont) sleuthè‡ªç ”ï¼Œå…¶å®ƒç¬¬ä¸‰æ–¹ å›½å†…ç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯skywalingç­‰ä¸Šç”Ÿäº§ spring-cloud-ribbon æ¥æºäºNetflixé›†æˆ ribbonç›®å‰è¿˜åœ¨è·ŸéšSpring Cloudç‰ˆæœ¬ç»´æŠ¤ä¸­ï¼Œç›®å‰å­µåŒ–æœªæ¥æ›¿ä»£å“spring-cloud-lb Spring-cloud-hystrix æ¥æºäºNetflixé›†æˆ ç›®å‰è¿˜åœ¨è·ŸéšSpring Cloudç‰ˆæœ¬ç»´æŠ¤ä¸­ç›®å‰å·²ç»å­µåŒ–spring-cloud-r4j 2. Spring Cloud ç¬¬äºŒä»£ Spring Cloudç¬¬ä¸€ä»£å’Œç¬¬äºŒä»£çš„ç»„ä»¶ç»„åˆæ±‡æ€»ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ Spring Cloudç¬¬ä¸€ä»£ Spring Cloudç¬¬äºŒä»£ ç½‘å…³ Spring Cloud Zuul Spring Cloud Gateway æ³¨å†Œä¸­å¿ƒ eureka(ä¸å†æ›´æ–°)ï¼ŒConsul,ZK é˜¿é‡ŒNacosï¼Œæ‹æ‹è´·radarç­‰å¯é€‰ é…ç½®ä¸­å¿ƒ spring cloud config é˜¿é‡ŒNacosï¼Œæºç¨‹Apolloï¼Œéšè¡Œä»˜Config Keeper å®¢æˆ·ç«¯è½¯è´Ÿè½½å‡è¡¡ Ribbon spring-cloud-loadbalancer ç†”æ–­å™¨ Hystrix spring-cloud-r4j(Resilience4J)ï¼Œé˜¿é‡ŒSentinel ç”±äºZuulæ€§èƒ½ä¸€èˆ¬ï¼Œzuul 2.x(ä¸€ç›´è·³ç¥¨ï¼Œè™½æœ€ç»ˆå¼€æºï¼‰ä½†æ˜¯Spring Cloudå®˜æ–¹å·²ç»æ¨å‡ºSpring Cloud gateway,Spring Cloudä¸­å›½ç¤¾åŒºå¾ˆä¹…ä¹‹å‰å·²ç»è¯å®ï¼ŒSpring Cloudå°†ä¸ä¼šé›†æˆzuul 2.xï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸å°±æœªæ¥Zuulå°†ä»Spring Cloudç”Ÿæ€åœˆä¸­é€€å‡ºã€‚ ribbonç”±äºä¸æ”¯æŒwebFluxçš„è´Ÿè½½å‡è¡¡ï¼ŒSpring Cloudå®˜æ–¹å¾ˆæ—©å°±åœ¨å­µåŒ–å™¨é¡¹ç›®ä¸­å­µåŒ–spring-cloud-loadbalancerï¼Œç›®å‰å·²ç»å°†ä»£ç åˆå¹¶åˆ°spring-cloud-commonä¸­ï¼Œé¢„è®¡åœ¨Spring Cloud Gç‰ˆå¯ä»¥ä½¿ç”¨ï¼Œé¢„è®¡2018å¹´12æœˆåº•realeseã€‚ è‡³äºHystrixï¼ŒNetflixåœ¨2018å¹´11æœˆ19å·å·¦å³ï¼ŒNetflixçš„å¼€æºé¡¹ç›®Hystrixå®£å¸ƒçŠ¶æ€ï¼Œä¸å†å¼€å‘æ–°åŠŸèƒ½ï¼Œå¤„äºç»´æŠ¤çŠ¶æ€ï¼Œå…¶å®åœ¨ä¹‹å‰Spring Cloudå®˜æ–¹å°±åœ¨å­µåŒ–spring-cloud-r4j. 3.å¼€æºé¡¹ç›®çš„é“¾æ¥æœ¬æ–‡æ‰€æåˆ°çš„å¼€æºé¡¹ç›®é“¾æ¥æ±‡æ€»å¦‚ä¸‹æ‰€ç¤ºï¼š https://github.com/alibaba/Sentinel https://github.com/spring-cloud-incubator/spring-cloud-r4j é˜¿é‡ŒNacos-https://github.com/alibaba/nacos éšè¡Œä»˜Config-keeper-https://github.com/sxfad/config-keeper spring-cloud-loadbalancer https://github.com/ctripcorp/apollo https://github.com/apache/incubator-skywalking","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"}]},{"title":"ä½¿ç”¨Nacoså®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±","slug":"sc/gw/gw10","date":"2018-11-17T06:00:00.000Z","updated":"2019-01-12T03:33:48.579Z","comments":true,"path":"sc/gw/gw10/","link":"","permalink":"http://xujin.org/sc/gw/gw10/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»é€šè¿‡Nacosä¸‹å‘è·¯ç”±é…ç½®å®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±ã€‚ 1.å‰è¨€ ç½‘å…³ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯è·¯ç”±é…ç½®å’Œè·¯ç”±è§„åˆ™ï¼Œè·¯ç”±é…ç½®æ˜¯æŒ‡é…ç½®æŸè¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŒ‡å®šçš„ç›®çš„åœ°å€ã€‚è€Œè·¯ç”±è§„åˆ™æ˜¯æŒ‡åŒ¹é…åˆ°è·¯ç”±é…ç½®ä¹‹åï¼Œå†æ ¹æ®è·¯ç”±è§„åˆ™è¿›è¡Œè½¬å‘å¤„ç†ã€‚ Spring Cloud Gatewayä½œä¸ºæ‰€æœ‰è¯·æ±‚æµé‡çš„å…¥å£ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†ä¿è¯é«˜å¯é å’Œé«˜å¯ç”¨ï¼Œå°½é‡é¿å…é‡å¯,éœ€è¦å®ç°Spring Cloud GatewayåŠ¨æ€è·¯ç”±é…ç½®ã€‚å‰é¢ç« èŠ‚ä»‹ç»äº†Spring Cloud Gatewayæä¾›çš„ä¸¤ç§æ–¹æ³•å»é…ç½®è·¯ç”±è§„åˆ™ï¼Œä½†éƒ½æ˜¯åœ¨Spring Cloud Gatewayå¯åŠ¨æ—¶å€™ï¼Œå°±å°†è·¯ç”±é…ç½®å’Œè§„åˆ™åŠ è½½åˆ°å†…å­˜é‡Œï¼Œæ— æ³•åšåˆ°ä¸é‡å¯ç½‘å…³å°±å¯ä»¥åŠ¨æ€çš„å¯¹åº”è·¯ç”±çš„é…ç½®å’Œè§„åˆ™è¿›è¡Œå¢åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ã€‚æœ¬æ–‡æ˜¯åŸºäºSpring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±å®ç°åŸºç¡€ä¹‹ä¸Šç¼–å†™ï¼Œé€šè¿‡Nacosé…ç½®æœåŠ¡ä¸‹å‘è·¯ç”±é…ç½®å®ç°åŠ¨æ€è·¯ç”±ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»é€šè¿‡Nacosä¸‹å‘è·¯ç”±é…ç½®å®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±ã€‚ 1.å‰è¨€ ç½‘å…³ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯è·¯ç”±é…ç½®å’Œè·¯ç”±è§„åˆ™ï¼Œè·¯ç”±é…ç½®æ˜¯æŒ‡é…ç½®æŸè¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŒ‡å®šçš„ç›®çš„åœ°å€ã€‚è€Œè·¯ç”±è§„åˆ™æ˜¯æŒ‡åŒ¹é…åˆ°è·¯ç”±é…ç½®ä¹‹åï¼Œå†æ ¹æ®è·¯ç”±è§„åˆ™è¿›è¡Œè½¬å‘å¤„ç†ã€‚ Spring Cloud Gatewayä½œä¸ºæ‰€æœ‰è¯·æ±‚æµé‡çš„å…¥å£ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†ä¿è¯é«˜å¯é å’Œé«˜å¯ç”¨ï¼Œå°½é‡é¿å…é‡å¯,éœ€è¦å®ç°Spring Cloud GatewayåŠ¨æ€è·¯ç”±é…ç½®ã€‚å‰é¢ç« èŠ‚ä»‹ç»äº†Spring Cloud Gatewayæä¾›çš„ä¸¤ç§æ–¹æ³•å»é…ç½®è·¯ç”±è§„åˆ™ï¼Œä½†éƒ½æ˜¯åœ¨Spring Cloud Gatewayå¯åŠ¨æ—¶å€™ï¼Œå°±å°†è·¯ç”±é…ç½®å’Œè§„åˆ™åŠ è½½åˆ°å†…å­˜é‡Œï¼Œæ— æ³•åšåˆ°ä¸é‡å¯ç½‘å…³å°±å¯ä»¥åŠ¨æ€çš„å¯¹åº”è·¯ç”±çš„é…ç½®å’Œè§„åˆ™è¿›è¡Œå¢åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ã€‚æœ¬æ–‡æ˜¯åŸºäºSpring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±å®ç°åŸºç¡€ä¹‹ä¸Šç¼–å†™ï¼Œé€šè¿‡Nacosé…ç½®æœåŠ¡ä¸‹å‘è·¯ç”±é…ç½®å®ç°åŠ¨æ€è·¯ç”±ã€‚ 2. Spring Cloud Gatewayç®€å•çš„åŠ¨æ€è·¯ç”±å®ç°Spring Cloud Gatewayçš„å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰è®²å¦‚ä½•åŠ¨æ€é…ç½®ï¼ŒæŸ¥çœ‹ Spring Cloud Gatewayçš„æºç ï¼Œå‘ç°åœ¨org.springframework.cloud.gateway.actuate.GatewayControllerEndpointç±»ä¸­æä¾›äº†åŠ¨æ€é…ç½®çš„Restæ¥å£ï¼Œä½†æ˜¯éœ€è¦å¼€å¯Gatewayçš„ç«¯ç‚¹ï¼Œè€Œä¸”æä¾›çš„åŠŸèƒ½ä¸æ˜¯å¾ˆå¼ºå¤§ã€‚é€šè¿‡å‚è€ƒå’ŒGatewayControllerEndpointç›¸å…³çš„ä»£ç ï¼Œå¯ä»¥è‡ªå·±ç¼–ç å®é™…åŠ¨æ€è·¯ç”±é…ç½®ã€‚ä¸‹é¢é€šè¿‡æ¡ˆä¾‹çš„æ–¹å¼å»è®²è§£æ€ä¹ˆé€šNacoså®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±ã€‚æ¡ˆä¾‹å·¥ç¨‹å¦‚spring-cloud-gateway-nacosæ‰€ç¤ºã€‚ ä»£ç åœ°å€:https://github.com/SpringCloud/spring-cloud-gateway-nacos 3. ç®€å•åŠ¨æ€è·¯ç”±çš„å®ç°3.1 æ–°å»ºMavenå·¥ç¨‹sc-gateway-server é…ç½®ä¸»è¦çš„æ ¸å¿ƒä¾èµ–å¦‚ä»£ç æ¸…å•æ‰€ç¤ºï¼š ä»£ç æ¸…å•: spring-cloud-gateway-nacos/sc-gateway-server/pom.xml123456789101112131415161718192021222324252627&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-client&lt;/artifactId&gt; &lt;version&gt;0.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.47&lt;/version&gt;&lt;/dependency&gt; 3.2 æ ¹æ®Spring Cloud Gatewayçš„è·¯ç”±æ¨¡å‹å®šä¹‰æ•°æ®ä¼ è¾“æ¨¡å‹ åˆ†åˆ«åˆ›å»ºGatewayRouteDefinition.java, GatewayPredicateDefinition.java, GatewayFilterDefinition.javaè¿™ä¸‰ä¸ªç±»ã€‚(1) åˆ›å»ºè·¯ç”±å®šä¹‰æ¨¡å‹ 12345678910111213public class GatewayRouteDefinition &#123; //è·¯ç”±çš„Id private String id; //è·¯ç”±æ–­è¨€é›†åˆé…ç½® private List&lt;GatewayPredicateDefinition&gt; predicates = new ArrayList&lt;&gt;(); //è·¯ç”±è¿‡æ»¤å™¨é›†åˆé…ç½® private List&lt;GatewayFilterDefinition&gt; filters = new ArrayList&lt;&gt;(); //è·¯ç”±è§„åˆ™è½¬å‘çš„ç›®æ ‡uri private String uri; //è·¯ç”±æ‰§è¡Œçš„é¡ºåº private int order = 0; //æ­¤å¤„çœç•¥getå’Œsetæ–¹æ³•&#125; (2)åˆ›å»ºè¿‡æ»¤å™¨å®šä¹‰æ¨¡å‹ 1234567public class GatewayFilterDefinition &#123; //Filter Name private String name; //å¯¹åº”çš„è·¯ç”±è§„åˆ™ private Map&lt;String, String&gt; args = new LinkedHashMap&lt;&gt;(); //æ­¤å¤„çœç•¥Getå’ŒSetæ–¹æ³•&#125; (3)åˆ›å»ºè·¯ç”±æ–­è¨€å®šä¹‰æ¨¡å‹ 1234567public class GatewayPredicateDefinition &#123; //æ–­è¨€å¯¹åº”çš„Name private String name; //é…ç½®çš„æ–­è¨€è§„åˆ™ private Map&lt;String, String&gt; args = new LinkedHashMap&lt;&gt;(); //æ­¤å¤„çœç•¥Getå’ŒSetæ–¹æ³•&#125; 3.3 ç¼–å†™åŠ¨æ€è·¯ç”±å®ç°ç±»ç¼–å†™DynamicRouteServiceImplå¹¶å®ç°ApplicationEventPublisherAwareæ¥å£ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334353637@Servicepublic class DynamicRouteServiceImpl implements ApplicationEventPublisherAware &#123; @Autowired private RouteDefinitionWriter routeDefinitionWriter; private ApplicationEventPublisher publisher; //å¢åŠ è·¯ç”± public String add(RouteDefinition definition) &#123; routeDefinitionWriter.save(Mono.just(definition)).subscribe(); this.publisher.publishEvent(new RefreshRoutesEvent(this)); return \"success\"; &#125; //æ›´æ–°è·¯ç”± public String update(RouteDefinition definition) &#123; try &#123; this.routeDefinitionWriter.delete(Mono.just(definition.getId())); &#125; catch (Exception e) &#123; return \"update fail,not find route routeId: \"+definition.getId(); &#125; try &#123; routeDefinitionWriter.save(Mono.just(definition)).subscribe(); this.publisher.publishEvent(new RefreshRoutesEvent(this)); return \"success\"; &#125; catch (Exception e) &#123; return \"update route fail\"; &#125; &#125; //åˆ é™¤è·¯ç”± public Mono&lt;ResponseEntity&lt;Object&gt;&gt; delete(String id) &#123; return this.routeDefinitionWriter.delete(Mono.just(id)) .then(Mono.defer(() -&gt; Mono.just(ResponseEntity.ok().build()))) .onErrorResume(t -&gt; t instanceof NotFoundException, t -&gt; Mono.just(ResponseEntity.notFound().build())); &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.publisher = applicationEventPublisher; &#125;&#125; 3.4 ç¼–å†™Nacosç›‘å¬æ¥æ”¶ä¸‹å‘çš„è·¯ç”±é…ç½®3.4.1 ä½¿ç”¨Nacosç›‘å¬ä¸‹å‘çš„é…ç½®ç›‘å¬Nacos Config Serverä¸‹å‘é…ç½®çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738@Componentpublic class DynamicRouteServiceImplByNacos &#123; @Autowired private DynamicRouteServiceImpl dynamicRouteService; public DynamicRouteServiceImplByNacos() &#123; dynamicRouteByNacosListener(\"sc-gateway\",\"xujin_test\"); &#125; /** * ç›‘å¬Nacos Serverä¸‹å‘çš„åŠ¨æ€è·¯ç”±é…ç½® * @param dataId * @param group */ public void dynamicRouteByNacosListener (String dataId, String group)&#123; try &#123; ConfigService configService=NacosFactory.createConfigService(\"127.0.0.1:8848\"); String content = configService.getConfig(dataId, group, 5000); System.out.println(content); configService.addListener(dataId, group, new Listener() &#123; @Override public void receiveConfigInfo(String configInfo) &#123; RouteDefinition definition= JSON.parseObject(configInfo,RouteDefinition.class); dynamicRouteService.update(definition); &#125; @Override public Executor getExecutor() &#123; return null; &#125; &#125;); &#125; catch (NacosException e) &#123; //todo æé†’:å¼‚å¸¸è‡ªè¡Œå¤„ç†æ­¤å¤„çœç•¥ &#125; &#125;&#125; 3.4.2 ä¸¤ç§æ–¹å¼åˆ›å»ºConfigServiceä½¿ç”¨ä¸¤ç§æ–¹å¼åˆ›å»ºcom.alibaba.nacos.api.config.ConfigService 1.æ„å»ºPropertiesåˆ›å»º ä½¿ç”¨createConfigService(Properties properties)ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º:1234Properties properties = new Properties(); properties.put(\"nacos.server-addr\", \"\"); properties.put(PropertyKeyConst.SERVER_ADDR, \"127.0.0.1:8848\"); ConfigService configService=NacosFactory.createConfigService(properties); æ³¨æ„:PropertyKeyConstæ˜¯com.alibaba.nacos.api.PropertyKeyConst 2.åªä¼ é€’Nacos Config Serverçš„åœ°å€ 1ConfigService configService=NacosFactory.createConfigService(\"127.0.0.1:8848\"); 4. ä½¿ç”¨Nacosä¸‹å‘é…ç½®4.1 Nacosæ¦‚è¿° Naocsç”±é˜¿é‡Œå¼€æºï¼ŒNacos è‡´åŠ›äºå¸®åŠ©æ‚¨å‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡ã€‚Nacos æä¾›äº†ä¸€ç»„ç®€å•æ˜“ç”¨çš„ç‰¹æ€§é›†ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®ç°åŠ¨æ€æœåŠ¡å‘ç°ã€æœåŠ¡é…ç½®ã€æœåŠ¡å…ƒæ•°æ®åŠæµé‡ç®¡ç†ã€‚ Nacos å¸®åŠ©æ‚¨æ›´æ•æ·å’Œå®¹æ˜“åœ°æ„å»ºã€äº¤ä»˜å’Œç®¡ç†å¾®æœåŠ¡å¹³å°ã€‚ Nacos æ˜¯æ„å»ºä»¥â€œæœåŠ¡â€ä¸ºä¸­å¿ƒçš„ç°ä»£åº”ç”¨æ¶æ„ (ä¾‹å¦‚å¾®æœåŠ¡èŒƒå¼ã€äº‘åŸç”ŸèŒƒå¼) çš„æœåŠ¡åŸºç¡€è®¾æ–½ã€‚githubåœ°å€:https://github.com/alibaba/nacos æ›´å¤šNacosçš„ä»‹ç»ï¼Œè¯·è®¿é—®å®˜æ–¹ç½‘ç«™:https://nacos.io/ 4.2 åœ¨IDEä¸­å¯åŠ¨ Nacosè®¿é—®https://github.com/alibaba/nacos ,ä½¿ç”¨Gitå…‹éš†Nacosä»£ç ï¼Œç›´æ¥å¯¼å…¥åˆ°IDEAä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºè®¾ç½®å¯åŠ¨å‚æ•°ï¼Œç›´æ¥å¯åŠ¨ã€‚ ä»IDEä¸­å¯åŠ¨Nacosæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„æ–¹å¼ï¼Œå› ä¸ºå¯ä»¥éšæ—¶Debug Nacosä»»ä½•ä»£ç ï¼Œå…¶å®ƒå¯åŠ¨æ–¹å¼è¯·å‚è€ƒå®˜ç½‘ã€‚ 5.æµ‹è¯•5.1 Nacosä¸­ä¸‹å‘Spring Cloud Gatewayçš„è·¯ç”±é…ç½® 1.æ‰“å¼€æµè§ˆå™¨è®¿é—®URL:http://localhost:8848/nacos/index.html ,Nacosçš„ç®¡æ§å¹³å°å¦‚ä¸‹æ‰€ç¤º: 2.åœ¨Nacosçš„é…ç½®åˆ—è¡¨ç‚¹å‡»+æŒ‰é’®ï¼Œä¸‹å‘Spring Cloud Gatewayçš„è·¯ç”±é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤º: ç”¨äºæµ‹è¯•çš„ç¤ºä¾‹æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º: 123456789101112&#123; \"filters\": [], \"id\": \"jd_route\", \"order\": 0, \"predicates\": [&#123; \"args\": &#123; \"pattern\": \"/jd\" &#125;, \"name\": \"Path\" &#125;], \"uri\": \"http://www.jd.com\"&#125; 5.2 å¯åŠ¨sc-gateway-server 1.Debugå¯åŠ¨sc-gateway-server,è°ƒè¯•æˆªå›¾å¦‚ä¸‹æ‰€ç¤º: 2.é€šè¿‡Spring Cloud gatewayçš„ç«¯ç‚¹ï¼ŒæŸ¥çœ‹è·¯ç”±ä¿¡æ¯ 3.é€šè¿‡è®¿é—®http://localhost:8080/jd ,å¯ä»¥è½¬å‘åˆ°äº¬ä¸œå•†åŸä¸»é¡µ 5.3 æ›´æ–°è·¯ç”±é…ç½® 1.é€šè¿‡Nacosä¸‹å‘é…ç½®ï¼Œä¿®æ”¹Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±è§„åˆ™ 2.æŸ¥çœ‹è®¿é—®Spring Cloud gatewayçš„ç«¯ç‚¹é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°åŠ¨æ€è·¯ç”±ä¿®æ”¹å¦‚ä¸‹: 3.é€šè¿‡è®¿é—®http://localhost:8080/jd ,å¯ä»¥è½¬å‘åˆ°ç™¾åº¦ç›¸å…³é¡µé¢","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±å®ç°","slug":"sc/gw/gw09","date":"2018-11-03T06:00:00.000Z","updated":"2019-01-12T03:33:39.419Z","comments":true,"path":"sc/gw/gw09/","link":"","permalink":"http://xujin.org/sc/gw/gw09/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±çš„ç®€å•å®ç°æ–¹å¼ã€‚ 1.å‰è¨€ ç½‘å…³ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯è·¯ç”±é…ç½®å’Œè·¯ç”±è§„åˆ™ï¼Œè·¯ç”±é…ç½®æ˜¯æŒ‡é…ç½®æŸè¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŒ‡å®šçš„ç›®çš„åœ°å€ã€‚è€Œè·¯ç”±è§„åˆ™æ˜¯æŒ‡åŒ¹é…åˆ°è·¯ç”±é…ç½®ä¹‹åï¼Œå†æ ¹æ®è·¯ç”±è§„åˆ™è¿›è¡Œè½¬å‘å¤„ç†ã€‚ Spring Cloud Gatewayä½œä¸ºæ‰€æœ‰è¯·æ±‚æµé‡çš„å…¥å£ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†ä¿è¯é«˜å¯é å’Œé«˜å¯ç”¨ï¼Œå°½é‡é¿å…é‡å¯,éœ€è¦å®ç°Spring Cloud GatewayåŠ¨æ€è·¯ç”±é…ç½®ã€‚å‰é¢ç« èŠ‚ä»‹ç»äº†Spring Cloud Gatewayæä¾›çš„ä¸¤ç§æ–¹æ³•å»é…ç½®è·¯ç”±è§„åˆ™ï¼Œä½†éƒ½æ˜¯åœ¨Spring Cloud Gatewayå¯åŠ¨æ—¶å€™ï¼Œå°±å°†è·¯ç”±é…ç½®å’Œè§„åˆ™åŠ è½½åˆ°å†…å­˜é‡Œï¼Œæ— æ³•åšåˆ°ä¸é‡å¯ç½‘å…³å°±å¯ä»¥åŠ¨æ€çš„å¯¹åº”è·¯ç”±çš„é…ç½®å’Œè§„åˆ™è¿›è¡Œå¢åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ã€‚æœ¬ç¯‡æ–‡ç« ç®€å•ä»‹ç»å¦‚ä½•å®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±çš„ç®€å•å®ç°æ–¹å¼ã€‚ 1.å‰è¨€ ç½‘å…³ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯è·¯ç”±é…ç½®å’Œè·¯ç”±è§„åˆ™ï¼Œè·¯ç”±é…ç½®æ˜¯æŒ‡é…ç½®æŸè¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŒ‡å®šçš„ç›®çš„åœ°å€ã€‚è€Œè·¯ç”±è§„åˆ™æ˜¯æŒ‡åŒ¹é…åˆ°è·¯ç”±é…ç½®ä¹‹åï¼Œå†æ ¹æ®è·¯ç”±è§„åˆ™è¿›è¡Œè½¬å‘å¤„ç†ã€‚ Spring Cloud Gatewayä½œä¸ºæ‰€æœ‰è¯·æ±‚æµé‡çš„å…¥å£ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†ä¿è¯é«˜å¯é å’Œé«˜å¯ç”¨ï¼Œå°½é‡é¿å…é‡å¯,éœ€è¦å®ç°Spring Cloud GatewayåŠ¨æ€è·¯ç”±é…ç½®ã€‚å‰é¢ç« èŠ‚ä»‹ç»äº†Spring Cloud Gatewayæä¾›çš„ä¸¤ç§æ–¹æ³•å»é…ç½®è·¯ç”±è§„åˆ™ï¼Œä½†éƒ½æ˜¯åœ¨Spring Cloud Gatewayå¯åŠ¨æ—¶å€™ï¼Œå°±å°†è·¯ç”±é…ç½®å’Œè§„åˆ™åŠ è½½åˆ°å†…å­˜é‡Œï¼Œæ— æ³•åšåˆ°ä¸é‡å¯ç½‘å…³å°±å¯ä»¥åŠ¨æ€çš„å¯¹åº”è·¯ç”±çš„é…ç½®å’Œè§„åˆ™è¿›è¡Œå¢åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ã€‚æœ¬ç¯‡æ–‡ç« ç®€å•ä»‹ç»å¦‚ä½•å®ç°Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±ã€‚ 2. Spring Cloud Gatewayç®€å•çš„åŠ¨æ€è·¯ç”±å®ç°Spring Cloud Gatewayçš„å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰è®²å¦‚ä½•åŠ¨æ€é…ç½®ï¼ŒæŸ¥çœ‹ Spring Cloud Gatewayçš„æºç ï¼Œå‘ç°åœ¨org.springframework.cloud.gateway.actuate.GatewayControllerEndpointç±»ä¸­æä¾›äº†åŠ¨æ€é…ç½®çš„Restæ¥å£ï¼Œä½†æ˜¯éœ€è¦å¼€å¯Gatewayçš„ç«¯ç‚¹ï¼Œè€Œä¸”æä¾›çš„åŠŸèƒ½ä¸æ˜¯å¾ˆå¼ºå¤§ã€‚é€šè¿‡å‚è€ƒå’ŒGatewayControllerEndpointç›¸å…³çš„ä»£ç ï¼Œå¯ä»¥è‡ªå·±ç¼–ç å®é™…åŠ¨æ€è·¯ç”±é…ç½®ã€‚ä¸‹é¢é€šè¿‡æ¡ˆä¾‹çš„æ–¹å¼å»è®²è§£æ€ä¹ˆå®ç°Gatewayçš„åŠ¨æ€è·¯ç”±é…ç½®ã€‚æ¡ˆä¾‹å·¥ç¨‹å¦‚ch18-7-gatewayæ‰€ç¤ºã€‚ ä»£ç åœ°å€:https://github.com/SpringCloud/spring-cloud-code/blob/master/ch18-7/ch18-7-gateway 3. ç®€å•åŠ¨æ€è·¯ç”±çš„å®ç°3.1 æ–°å»ºMavenå·¥ç¨‹ch18-7-gateway é…ç½®ä¸»è¦çš„æ ¸å¿ƒä¾èµ–å¦‚ä»£ç æ¸…å•18-33æ‰€ç¤ºï¼š ä»£ç æ¸…å•: ch18-7/ch18-7-gateway/pom.xml1234567891011121314&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 3.2 æ ¹æ®Spring Cloud Gatewayçš„è·¯ç”±æ¨¡å‹å®šä¹‰æ•°æ®ä¼ è¾“æ¨¡å‹ åˆ†åˆ«åˆ›å»ºGatewayRouteDefinition.java, GatewayPredicateDefinition.java, GatewayFilterDefinition.javaè¿™ä¸‰ä¸ªç±»ã€‚(1) åˆ›å»ºè·¯ç”±å®šä¹‰æ¨¡å‹å¦‚ä¸‹ä»£ç æ¸…å•18-34æ‰€ç¤ºï¼šä»£ç æ¸…å• 18-34: ch18-7/ch18-7-gateway/src/main/java/cn/springcloud/book/gateway/model/GatewayRouteDefinition.java 12345678910111213public class GatewayRouteDefinition &#123; //è·¯ç”±çš„Id private String id; //è·¯ç”±æ–­è¨€é›†åˆé…ç½® private List&lt;GatewayPredicateDefinition&gt; predicates = new ArrayList&lt;&gt;(); //è·¯ç”±è¿‡æ»¤å™¨é›†åˆé…ç½® private List&lt;GatewayFilterDefinition&gt; filters = new ArrayList&lt;&gt;(); //è·¯ç”±è§„åˆ™è½¬å‘çš„ç›®æ ‡uri private String uri; //è·¯ç”±æ‰§è¡Œçš„é¡ºåº private int order = 0; //æ­¤å¤„çœç•¥getå’Œsetæ–¹æ³•&#125; (2)åˆ›å»ºè¿‡æ»¤å™¨å®šä¹‰æ¨¡å‹,ä»£ç å¦‚ä»£ç æ¸…å•18-35æ‰€ç¤ºï¼šä»£ç æ¸…å•18-35: ch18-7/ch18-7-gateway/src/main/java/cn/springcloud/book/gateway/model/GatewayFilterDefinition.java 1234567public class GatewayFilterDefinition &#123; //Filter Name private String name; //å¯¹åº”çš„è·¯ç”±è§„åˆ™ private Map&lt;String, String&gt; args = new LinkedHashMap&lt;&gt;(); //æ­¤å¤„çœç•¥Getå’ŒSetæ–¹æ³•&#125; (3)è·¯ç”±æ–­è¨€å®šä¹‰æ¨¡å‹ï¼Œä»£ç å¦‚ä»£ç æ¸…å•18-36æ‰€ç¤º:ä»£ç æ¸…å•18-36: ch18-7/ch18-7-gateway/src/main/java/cn/springcloud/book/gateway/model/GatewayPredicateDefinition.java 1234567public class GatewayPredicateDefinition &#123; //æ–­è¨€å¯¹åº”çš„Name private String name; //é…ç½®çš„æ–­è¨€è§„åˆ™ private Map&lt;String, String&gt; args = new LinkedHashMap&lt;&gt;(); //æ­¤å¤„çœç•¥Getå’ŒSetæ–¹æ³•&#125; 3.3 ç¼–å†™åŠ¨æ€è·¯ç”±å®ç°ç±»ç¼–å†™DynamicRouteServiceImplå¹¶å®ç°ApplicationEventPublisherAwareæ¥å£ï¼Œä»£ç å¦‚ä»£ç æ¸…å•18-37æ‰€ç¤º: ch18-37/ch18-7-gateway/src/main/java/cn/springcloud/book/gateway/route/DynamicRouteServiceImpl.java 12345678910111213141516171819202122232425262728293031323334353637@Servicepublic class DynamicRouteServiceImpl implements ApplicationEventPublisherAware &#123; @Autowired private RouteDefinitionWriter routeDefinitionWriter; private ApplicationEventPublisher publisher; //å¢åŠ è·¯ç”± public String add(RouteDefinition definition) &#123; routeDefinitionWriter.save(Mono.just(definition)).subscribe(); this.publisher.publishEvent(new RefreshRoutesEvent(this)); return \"success\"; &#125; //æ›´æ–°è·¯ç”± public String update(RouteDefinition definition) &#123; try &#123; this.routeDefinitionWriter.delete(Mono.just(definition.getId())); &#125; catch (Exception e) &#123; return \"update fail,not find route routeId: \"+definition.getId(); &#125; try &#123; routeDefinitionWriter.save(Mono.just(definition)).subscribe(); this.publisher.publishEvent(new RefreshRoutesEvent(this)); return \"success\"; &#125; catch (Exception e) &#123; return \"update route fail\"; &#125; &#125; //åˆ é™¤è·¯ç”± public Mono&lt;ResponseEntity&lt;Object&gt;&gt; delete(String id) &#123; return this.routeDefinitionWriter.delete(Mono.just(id)) .then(Mono.defer(() -&gt; Mono.just(ResponseEntity.ok().build()))) .onErrorResume(t -&gt; t instanceof NotFoundException, t -&gt; Mono.just(ResponseEntity.notFound().build())); &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.publisher = applicationEventPublisher; &#125;&#125; 3.4 ç¼–å†™Restæ¥å£ç¼–å†™RouteControllerç±»çš„æä¾›Restæ¥å£ï¼Œç”¨äºåŠ¨æ€è·¯ç”±é…ç½®ã€‚ä»£ç å¦‚ä»£ç æ¸…å•18-38æ‰€ç¤º:ä»£ç æ¸…å• 18-38: ch18-7/ch18-7-gateway/src/main/java/cn/springcloud/book/gateway/controller/RouteController.java 1234567891011121314151617181920212223242526272829@RestController@RequestMapping(\"/route\")public class RouteController &#123; @Autowired private DynamicRouteServiceImpl dynamicRouteService; //å¢åŠ è·¯ç”± @PostMapping(\"/add\") public String add(@RequestBody GatewayRouteDefinition gwdefinition) &#123; try &#123; RouteDefinition definition = assembleRouteDefinition(gwdefinition); return this.dynamicRouteService.add(definition); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return \"succss\"; &#125; //åˆ é™¤è·¯ç”± @DeleteMapping(\"/routes/&#123;id&#125;\") public Mono&lt;ResponseEntity&lt;Object&gt;&gt; delete(@PathVariable String id) &#123; return this.dynamicRouteService.delete(id); &#125; //æ›´æ–°è·¯ç”± @PostMapping(\"/update\") public String update(@RequestBody GatewayRouteDefinition gwdefinition) &#123; RouteDefinition definition = assembleRouteDefinition(gwdefinition); return this.dynamicRouteService.update(definition); &#125;&#125; 3.5 é…ç½®application.ymlæ–‡ä»¶åœ¨application.ymlæ–‡ä»¶é…ç½®åº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å¼€å¯Spring Cloud Gatewayå¯¹å¤–æä¾›çš„ç«¯ç‚¹Restæ¥å£ã€‚ä»£ç å¦‚ä»£ç æ¸…å•18-39æ‰€ç¤º:ä»£ç æ¸…å• 18-39: ch18-7/ch18-7-gateway/src/main/resources/application.ymlé…ç½®è¾“å‡ºæ—¥å¿—å¦‚ä¸‹æ‰€ç¤º:123456789101112131415# é…ç½®è¾“å‡ºæ—¥å¿—logging: level: org.springframework.cloud.gateway: TRACE org.springframework.http.server.reactive: DEBUG org.springframework.web.reactive: DEBUG reactor.ipc.netty: DEBUG#å¼€å¯ç«¯ç‚¹management: endpoints: web: exposure: include: '*' security: enabled: false 3.6 å¯åŠ¨ch18-7-gatewayåº”ç”¨æµ‹è¯•(1) å¯åŠ¨ch18-7-gatewayåº”ç”¨ä¹‹åï¼Œç”±äºå¼€å¯äº†ç«¯ç‚¹ï¼Œé¦–å…ˆæ‰“å¼€æµè§ˆå™¨è®¿é—®ç«¯ç‚¹URL:http://localhost:8080/actuator/gateway/routes ,æŸ¥çœ‹è·¯ç”±ä¿¡æ¯è¿”å›ä¸ºç©ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: (2)æ‰“å¼€PostManï¼Œè®¿é—®http://localhost:8080/route/add, å‘èµ·Postè¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º,è¿”å›successè¯´æ˜å‘Gatewayå¢åŠ è·¯ç”±é…ç½®æˆåŠŸã€‚ ç„¶åå†æ‰“å¼€PostManè®¿é—®ç«¯ç‚¹URL:http://localhost:8080/actuator/gateway/routes , æŸ¥çœ‹è·¯ç”±ä¿¡æ¯è¿”å›å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ çš„è·¯ç”±é…ç½®ã€‚ (3) æ‰“å¼€æµè§ˆå™¨è®¿é—®http://localhost:8080/jd, å¯ä»¥æ­£å¸¸è½¬å‘https://www.jd.com/å¯¹åº”çš„äº¬ä¸œå•†åŸé¦–é¡µã€‚(4) é€šè¿‡è®¿é—®http://localhost:8080/route/update, å¯¹idä¸ºjd_routeçš„è·¯ç”±æ›´æ–°é…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç„¶åå†è®¿é—®è·¯ç”±ç«¯ç‚¹URL,å‘ç°è·¯ç”±é…ç½®å·²ç»è¢«æ›´æ–°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®http://localhost:8080/taobao ,å¯ä»¥æˆåŠŸè½¬å‘åˆ°æ·˜å®ç½‘ã€‚(5) é€šè¿‡è®¿é—®http: //localhost:8080/route/delete/jd_route,å…¶ä¸­çš„idä¸ºè·¯ç”±å¯¹åº”çš„idï¼Œåˆ é™¤è·¯ç”±ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º: 4.Spring Cloud Gatewayæ¨èæ–‡ç« Spring Cloud Gatewayä¸­çš„æƒé‡è·¯ç”±Spring Cloud Gatewayä¸­çš„GatewayFilterå’ŒGlobalFilterSpring Cloud Gatewayåªæœ‰Preå’ŒPOSTä¸¤ç§ç±»å‹çš„FilterSpring Cloud GatewayåŸºäºæœåŠ¡å‘ç°çš„é»˜è®¤è·¯ç”±è§„åˆ™Spring Cloud Gatewayçš„Beforeè·¯ç”±æ–­è¨€å·¥å‚Spring Cloud Gatewayçš„Afterè·¯ç”±æ–­è¨€å·¥å‚Spring Cloud Gatewayæ­ç§˜ä¹‹å¤„ç†è¯·æ±‚æµç¨‹Spring Cloud Gatewayå…¥é—¨æ¡ˆä¾‹ 5.ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä¸­çš„Spring Cloud Gatewayç¬¬17ç« Spring Cloud Gatewayä¸Šç¯‡39917.1 Spring Cloud Gatewayæ¦‚è¿°39917.1.1 ä»€ä¹ˆæ˜¯Spring Cloud Gateway39917.1.2 Spring Cloud Gatewayçš„æ ¸å¿ƒæ¦‚å¿µ39917.2 Spring Cloud Gatewayçš„å·¥ä½œåŸç†40017.3 Spring Cloud Gatewayå…¥é—¨æ¡ˆä¾‹40117.4 Spring Cloud Gatewayçš„è·¯ç”±æ–­è¨€40417.4.1 Afterè·¯ç”±æ–­è¨€å·¥å‚40417.4.2 Beforeè·¯ç”±æ–­è¨€å·¥å‚40617.4.3 Betweenè·¯ç”±æ–­è¨€å·¥å‚40617.4.4 Cookieè·¯ç”±æ–­è¨€å·¥å‚40717.4.5 Headerè·¯ç”±æ–­è¨€å·¥å‚40817.4.6 Hostè·¯ç”±æ–­è¨€å·¥å‚41017.4.7 Methodè·¯ç”±æ–­è¨€å·¥å‚41117.4.8 Queryè·¯ç”±æ–­è¨€å·¥å‚41117.4.9 RemoteAddrè·¯ç”±æ–­è¨€å·¥å‚41217.5 Spring Cloud Gatewayçš„å†…ç½®Filter41317.5.1 AddRequestHeaderè¿‡æ»¤å™¨å·¥å‚41317.5.2 AddRequestParameterè¿‡æ»¤å™¨41317.5.3 RewritePathè¿‡æ»¤å™¨41417.5.4 AddResponseHeaderè¿‡æ»¤å™¨41517.5.5 StripPrefixè¿‡æ»¤å™¨41617.5.6 Retryè¿‡æ»¤å™¨41717.5.7 Hystrixè¿‡æ»¤å™¨41817.6 æœ¬ç« å°ç»“420ç¬¬18ç«  Spring Cloud Gatewayä¸‹ç¯‡42118.1 GatewayåŸºäºæœåŠ¡å‘ç°çš„è·¯ç”±è§„åˆ™42118.1.1 Gatewayçš„æœåŠ¡å‘ç°è·¯ç”±æ¦‚è¿°42118.1.2 æœåŠ¡å‘ç°çš„è·¯ç”±è§„åˆ™æ¡ˆä¾‹42218.2 Gateway Filterå’ŒGlobal Filter42518.2.1 Gateway Filterå’ŒGlobal Filteræ¦‚è¿°42518.2.2 è‡ªå®šä¹‰Gateway Filteræ¡ˆä¾‹42518.2.3 è‡ªå®šä¹‰Global Filteræ¡ˆä¾‹42718.3 Spring Cloud Gatewayå®æˆ˜42818.3.1 Spring Cloud Gatewayæƒé‡è·¯ç”±42818.3.2 Spring Cloud Gatewayä¸­Httpsçš„ä½¿ç”¨æŠ€å·§43118.3.3 Spring Cloud Gatewayé›†æˆSwagger43618.3.4 Spring Cloud Gatewayé™æµ44218.3.5 Spring Cloud Gatewayçš„åŠ¨æ€è·¯ç”±45018.4 Spring Cloud Gatewayæºç ç¯‡45818.4.1 Spring Cloud Gatewayçš„å¤„ç†æµç¨‹45818.4.2 Gatewayä¸­ServerWebExchangeæ„å»ºåˆ†æ45918.4.3 DispatcherHandleræºç åˆ†æ46018.4.4 RoutePredicateHandlerMappingæºç åˆ†æ46118.4.5 FilteringWebHandleræºç åˆ†æ46218.4.6 æ‰§è¡ŒFilteræºç åˆ†æ46318.5 æœ¬ç« å°ç»“465 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273â”œâ”€â”€ ch17-1â”‚ â”œâ”€â”€ ch17-1-1-gatewayâ”‚ â”œâ”€â”€ ch17-1-2-gatewayâ”‚ â”œâ”€â”€ ch17-1.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch17-2â”‚ â”œâ”€â”€ ch17-2-1-gatewayâ”‚ â”œâ”€â”€ ch17-2-2-gatewayâ”‚ â”œâ”€â”€ ch17-2-3-gatewayâ”‚ â”œâ”€â”€ ch17-2-4-gatewayâ”‚ â”œâ”€â”€ ch17-2-5-gatewayâ”‚ â”œâ”€â”€ ch17-2-6-gatewayâ”‚ â”œâ”€â”€ ch17-2-7-gatewayâ”‚ â”œâ”€â”€ ch17-2-8-gatewayâ”‚ â”œâ”€â”€ ch17-2-9-gatewayâ”‚ â”œâ”€â”€ ch17-2-serviceâ”‚ â”œâ”€â”€ ch17-2.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch17-3â”‚ â”œâ”€â”€ ch17-3-1-gatewayâ”‚ â”œâ”€â”€ ch17-3-2-gatewayâ”‚ â”œâ”€â”€ ch17-3-3-gatewayâ”‚ â”œâ”€â”€ ch17-3-4-gatewayâ”‚ â”œâ”€â”€ ch17-3-5-gatewayâ”‚ â”œâ”€â”€ ch17-3-6-gatewayâ”‚ â”œâ”€â”€ ch17-3-7-gatewayâ”‚ â”œâ”€â”€ ch17-3-serviceâ”‚ â”œâ”€â”€ ch17-3.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch18-1â”‚ â”œâ”€â”€ ch18-1-consumerâ”‚ â”œâ”€â”€ ch18-1-eurekaâ”‚ â”œâ”€â”€ ch18-1-gatewayâ”‚ â”œâ”€â”€ ch18-1-providerâ”‚ â”œâ”€â”€ ch18-1.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch18-2â”‚ â”œâ”€â”€ ch18-2-gatewayâ”‚ â”œâ”€â”€ ch18-2-providerâ”‚ â”œâ”€â”€ ch18-2.imlâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ reademe.txtâ”œâ”€â”€ ch18-3â”‚ â”œâ”€â”€ ch18-3-gatewayâ”‚ â”œâ”€â”€ ch18-3-providerâ”‚ â”œâ”€â”€ ch18-3.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch18-4â”‚ â”œâ”€â”€ ch18-4-eurekaâ”‚ â”œâ”€â”€ ch18-4-gateway-httpsâ”‚ â”œâ”€â”€ ch18-4-service-aâ”‚ â”œâ”€â”€ ch18-4-service-bâ”‚ â”œâ”€â”€ ch18-4.imlâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ reademe.mdâ”œâ”€â”€ ch18-5â”‚ â”œâ”€â”€ ch18-5-eurekaâ”‚ â”œâ”€â”€ ch18-5-gatewayâ”‚ â”œâ”€â”€ ch18-5-serviceâ”‚ â”œâ”€â”€ ch18-5.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch18-6â”‚ â”œâ”€â”€ ch18-6-1-gatewayâ”‚ â”œâ”€â”€ ch18-6-2-gatewayâ”‚ â”œâ”€â”€ ch18-6-3-gatewayâ”‚ â”œâ”€â”€ ch18-6-providerâ”‚ â”œâ”€â”€ ch18-6.imlâ”‚ â””â”€â”€ pom.xmlâ”œâ”€â”€ ch18-7â”‚ â”œâ”€â”€ ch18-7-gatewayâ”‚ â”œâ”€â”€ ch18-7.imlâ”‚ â”œâ”€â”€ pom.xmlâ”‚ â””â”€â”€ readme.md Spring Cloud Gatewayæ‰€æœ‰ç¤ºä¾‹ä»£ç åœ°å€:https://github.com/SpringCloud/spring-cloud-code","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹","slug":"re/01","date":"2018-09-24T06:00:00.000Z","updated":"2019-01-13T05:53:02.653Z","comments":true,"path":"re/01/","link":"","permalink":"http://xujin.org/re/01/","excerpt":"æ‘˜è¦: ä»Šå¤©æ˜¯2018å¹´9æœˆ24å·ä¸­ç§‹èŠ‚ï¼Œç¥ç¦å¤§å®¶ä¸­ç§‹èŠ‚å¿«ä¹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ã€‚","text":"æ‘˜è¦: ä»Šå¤©æ˜¯2018å¹´9æœˆ24å·ä¸­ç§‹èŠ‚ï¼Œç¥ç¦å¤§å®¶ä¸­ç§‹èŠ‚å¿«ä¹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ã€‚ 1. å‰è¨€ éšç€äº’è”ç½‘çš„å¿«é€Ÿæ™®åŠï¼Œäº‘è®¡ç®—è¿‘å¹´æ¥å¾—åˆ°è“¬å‹ƒå‘å±•ï¼Œä¼ä¸šçš„ITç¯å¢ƒå’Œæ¶æ„ä½“ç³»ä¹Ÿé€æ¸å‘ç”Ÿå˜é©ï¼Œå…¶ä¸­æœ€å…¸å‹çš„å°±æ˜¯è¿‡å»çš„å•ä½“åº”ç”¨æ¶æ„å‘å±•ä¸ºå½“ä»Šæµè¡Œçš„å¾®æœåŠ¡æ¶æ„ã€‚å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå…¶ä¼˜åŠ¿æ˜¯ä¸ºè½¯ä»¶åº”ç”¨å¼€å‘å¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œè®©æ•æ·å¼€å‘å’Œå¤æ‚çš„ä¼ä¸šåº”ç”¨å¿«é€ŸæŒç»­äº¤ä»˜æˆä¸ºå¯èƒ½ã€‚éšç€å¾®æœåŠ¡æ¶æ„çš„æµè¡Œï¼Œå¾ˆå¤šä¼ä¸šçº·çº·ä½¿ç”¨å¾®æœåŠ¡æ¶æ„æ¥æ­å»ºæ–°çš„ç³»ç»Ÿæˆ–è€…å¯¹å†å²ç³»ç»Ÿè¿›è¡Œé‡æ„ï¼Œä½†æ˜¯å¾®æœåŠ¡æ¶æ„çš„å®æ–½å’Œè½åœ°ä¼šé¢ä¸´å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚è™½ç„¶å¾®æœåŠ¡æ¶æ„çš„è§£å†³æ–¹æ¡ˆå¾ˆå¤šï¼Œä½†æ˜¯å¯¹äºå¦‚ä½•çœŸæ­£è½åœ°å¾®æœåŠ¡æ¶æ„ï¼Œç›®å‰è¿˜æ²¡æœ‰å…¬è®¤çš„æŠ€æœ¯æ ‡å‡†å’Œè§„èŒƒã€‚å¹¸è¿çš„æ˜¯ï¼Œä¸šç•Œå·²ç»æœ‰ä¸€äº›å¾ˆæœ‰å½±å“åŠ›çš„å¼€æºå¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚2015å¹´å¹´åˆï¼ŒSpringå›¢é˜Ÿæ¨å‡ºçš„Spring Cloudï¼Œå…¶ç›®æ ‡æ˜¯æˆä¸ºJavaé¢†åŸŸå¾®æœåŠ¡æ¶æ„è½åœ°çš„æ ‡å‡†ã€‚Spring Cloudç»è¿‡é«˜é€Ÿè¿­ä»£å’Œå‘å±•ï¼Œè‡³ä»Šå·²ç»æˆä¸ºJavaé¢†åŸŸè½åœ°å¾®æœåŠ¡æ¶æ„çš„æ¨èè§£å†³æ–¹æ¡ˆï¼Œä¸ºä¼ä¸šITæ¶æ„å˜é©ä¿é©¾æŠ¤èˆªã€‚ Spring Cloudæ˜¯ä¸€ä¸ªä¼˜è´¨çš„å¼€æºé¡¹ç›®ï¼Œå®ƒçš„ç¨³å¥å‘å±•ç¦»ä¸å¼€ä¼—å¤šå¼€å‘äººå‘˜çš„å®è·µä¸åé¦ˆï¼Œå¼€å‘äººå‘˜é€šè¿‡ä¸€ä¸ªç¤¾åŒºåŒ–çš„å¹³å°å»äº¤æµå­¦ä¹ ä»è€Œä½¿Spring Cloudé€æ¸å®Œå–„ã€‚Spring Cloudå‘å±•åˆ°2016å¹´ï¼Œå¾—åˆ°å›½å†…è¶Šæ¥è¶Šå¤šçš„äººçš„å…³æ³¨ï¼Œä½†æ˜¯ç›¸åº”çš„å­¦ä¹ äº¤æµå¹³å°å’Œææ–™æ¯”è¾ƒåˆ†æ•£ï¼Œè¿™é˜»ç¢äº†Spring Cloudåœ¨æˆ‘å›½çš„æ™®åŠå’Œå‘å±•ã€‚å› æ­¤Spring Cloudä¸­å›½ç¤¾åŒºåº”è¿è€Œç”Ÿã€‚Spring Cloudä¸­å›½ç¤¾åŒº (http://springcloud.cn) æ˜¯å›½å†…åŸºäºSpring Cloudå¾®æœåŠ¡ä½“ç³»åˆ›å»ºçš„éç›ˆåˆ©æŠ€æœ¯ç¤¾åŒºï¼Œæ˜¯ä¸“ä¸ºSpring Bootæˆ–Spring CloudæŠ€æœ¯äººå‘˜æä¾›åˆ†äº«å’Œäº¤æµæœåŠ¡çš„å¹³å°ï¼Œç›®çš„æ˜¯æ¨åŠ¨Spring Cloudåœ¨ä¸­å›½çš„æ™®åŠå’Œåº”ç”¨ã€‚ 2.èƒŒæ™¯æ¦‚è¿° Spring Cloudä¸­å›½ç¤¾åŒº(http://springcloud.cn) æ˜¯å›½å†…åŸºäºSpring Cloudå¾®æœåŠ¡ä½“ç³»åˆ›å»ºçš„éç›ˆåˆ©æŠ€æœ¯ç¤¾åŒºã€‚è‡ª2016å¹´10æœˆä»½åˆ›å»ºä»¥æ¥ï¼Œåœ¨åŒ—äº¬ï¼Œä¸Šæµ·ï¼Œæ·±åœ³ï¼Œæˆéƒ½ç­‰åœ°ä¸¾åŠäº†å¤šæ¬¡æŠ€æœ¯æ²™é¾™ï¼Œæä¾›æŠ€æœ¯äº¤æµå¹³å°,å¸®åŠ©æ•°ä¸‡å¼€å‘è€…å¿«é€Ÿå­¦ä¹ Spring Cloudå¹¶ç”¨äºç”Ÿäº§ã€‚ä¸ºæ›´å¥½çš„æ¨åŠ¨Spring Cloudåœ¨ä¸­å›½çš„å‘å±•ï¼Œè®©æ›´å¤šçš„å¼€å‘è€…å—ç›Šã€‚ç¤¾åŒºé’ˆå¯¹Spring Cloudåœ¨å›½å†…çš„ä½¿ç”¨æƒ…å†µï¼Œç»“åˆå›½å†…ä¼ä¸šä½¿ç”¨Spring Cloudè½åœ°å¾®æœåŠ¡æ¶æ„é‡åˆ°çš„é—®é¢˜ç»™å‡ºå®æˆ˜è§£å†³æ–¹æ¡ˆï¼Œç‰¹æ¨å‡ºæ­¤ä¹¦ã€‚ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹å°é¢å¦‚ä¸‹å›¾æ‰€ç¤º: æœ¬ä¹¦åŸºäºSpring Cloudçš„Finchley.RELEASEç‰ˆç¼–å†™ï¼Œç”±7ä½ä½œè€…è‘—ï¼Œå…±25ç« ï¼Œå…±670é¡µï¼Œæˆ‘ä»¬7ä½ä½œè€…å¹¶ä¸æ˜¯Spring Cloudå¾®æœåŠ¡è½åœ°çš„æ¶æ„ä¸“å®¶ï¼Œæˆ‘ä»¬åªæ˜¯Spring Cloudå¾®æœåŠ¡æ¶æ„çš„å®è·µè€…ï¼ŒæŠŠæˆ‘ä»¬è‡ªå·±çš„å®è·µç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œå¸®åŠ©å¤§å®¶è§£å†³å­¦ä¹ å’Œå·¥ä½œä¸Šé‡åˆ°çš„é—®é¢˜ã€‚ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ï¼Œç”±äºæˆ‘ä»¬å­¦è¯†æœ‰é™ï¼Œéš¾å…ä¼šæœ‰ä¸è¶³ä¹‹å¤„ï¼Œè¿˜è¯·è¯»è€…å¤šå¤šåŒ…æ¶µï¼Œä¸€èµ·äº¤æµå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚ 3.æœ¬ä¹¦ä»‹ç»3.1 å¡«å‘è®°å½• 3.2 BATJéƒ¨åˆ†ä¹¦è¯„è¿‡å»åå‡ å¹´é‡Œï¼Œå¹¿ä¹‰çš„â€œå¾®æœåŠ¡â€æ¶æ„ä»¥å…¶å°å›¢é˜Ÿå¿«é€Ÿåˆ›å»ºå’Œè¿­ä»£æœåŠ¡å¸¦æ¥çš„æ¶æ„å¼¹æ€§ã€æ‰©å±•æ€§ã€æ•æ·æ€§ï¼Œå¤©ç„¶åŒ¹é…äº†äº’è”ç½‘ä¸šåŠ¡å¿«é€Ÿå‘å±•å’Œå˜åŒ–çš„ç‰¹ç‚¹ï¼Œåœ¨å„å¤§äº’è”ç½‘å…¬å¸å–å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚æ—¶è‡³äº‘åŸç”Ÿåº”ç”¨æ—¶ä»£ï¼Œå·²ä¸å†æ˜¯æ˜¯å¦é‡‡ç”¨å¾®æœåŠ¡æ¶æ„çš„é—®é¢˜ï¼Œè€Œæ˜¯ä½•æ—¶é‡‡ç”¨ä»¥åŠå¦‚ä½•åœ¨ç”Ÿäº§ä¸Šå®æˆ˜çš„é—®é¢˜ã€‚æœ¬ä¹¦å°†å¦‚ä½•åŸºäºSpring Cloudç”Ÿæ€ä½“ç³»è¿›è¡Œå¾®æœåŠ¡å®æˆ˜çš„æ–¹æ–¹é¢é¢çš„ç»†èŠ‚éƒ½æ¶µç›–äº†ï¼Œï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥è®²ï¼Œç¡®å®åšåˆ°äº†â€œé‡æ–°å®šä¹‰â€ã€‚ â€”â€” å¤å®‡ Nacoså¼€æºé¡¹ç›®åˆ›å§‹äºº/é˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ å¾®æœåŠ¡ä»¥æ•æ·ä¸ºç›®æ ‡ï¼Œä»¥é™ä½å¤æ‚çš„ç³»ç»Ÿç»“æ„ä¸ºåŸºç¡€ï¼Œå¸¦ç»™æˆ‘ä»¬æ›´å¥½çš„ç³»ç»Ÿå¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚Spring Cloudä½œä¸ºä¸€å¥—å®Œå–„çš„å¾®æœåŠ¡æ²»ç†çš„å…¸å‹æ¡†æ¶ï¼Œæ¶µç›–äº†å¾®æœåŠ¡æ²»ç†çš„æ–¹æ–¹é¢é¢ã€‚æœ¬ä¹¦è¯¦ç»†ä»‹ç»äº†Spring Cloudçš„æ¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œä»¥ç†è®ºä¸å®é™…ç›¸ç»“åˆçš„æ–¹å¼ï¼Œé€å½»åœ°è®²è¿°äº†Spring Cloudçš„ç²¾é«“ï¼Œæ˜¯æ¯ä¸€ä½å¥‹æˆ˜åœ¨æœåŠ¡åŒ–é¢†åŸŸä¸€çº¿çš„å·¥ç¨‹å¸ˆã€æ¶æ„å¸ˆçš„*é€‰æŠ€æœ¯ä¹¦ç±ã€‚ â€”â€”æè‰³é¹ èš‚èšé‡‘æœé«˜çº§æŠ€æœ¯ä¸“å®¶/ã€Šåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ã€‹ã€Šå¯ä¼¸ç¼©æœåŠ¡æ¶æ„ã€‹ä½œè€… æœ¬ä¹¦å¯ä»¥è¯´æ˜¯åç«¯æ¶æ„å¸ˆçš„è¿›é˜¶å®å…¸ï¼Œå…¨é¢åœ°è®²è§£äº†å¦‚ä½•æ‰“é€ ä¸€å¥—å¼ºå¤§ã€å¥å£®çš„å¾®æœåŠ¡ä½“ç³»ï¼Œæ·±å…¥åˆ†æäº†æ¶‰åŠåˆ°çš„å„ä¸ªç»„ä»¶ã€‚*éš¾å¾—çš„æ˜¯ï¼Œä¹¦ä¸­ç»“åˆäº†ä½œè€…å¤šå¹´ç§¯ç´¯çš„æ¶æ„ç»éªŒï¼Œåˆ†æäº†å„ç§ç»„ä»¶é€‚ç”¨çš„åœºæ™¯ï¼Œå¹³å®åœ°è¯´æ˜äº†å®é™…ä½¿ç”¨ä¸­çš„å„ç§è€ƒé‡å’Œç»†èŠ‚ä¼˜åŒ–ï¼Œç®€ç›´æ˜¯å¥‹æ–—åœ¨ä¸€çº¿çš„å·¥ç¨‹å¸ˆçš„å¿ƒè¡€ç»“æ™¶ã€‚ä»»ä½•æƒ³æŒæ¡å¤§å‹åç«¯æ¶æ„çš„å·¥ç¨‹å¸ˆï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ¡†æ¶ï¼Œéƒ½èƒ½ä»æœ¬ä¹¦è·ç›ŠåŒªæµ…ã€‚ â€”â€”æåŒæ¶› é¥¿äº†ä¹ˆä¸­é—´ä»¶èµ„æ·±æ¶æ„å¸ˆ Spring Cloudå·²ç„¶æˆä¸ºJavaé¢†åŸŸåº”ç”¨å¾®æœåŠ¡åŒ–çš„*é€‰æ¡†æ¶ï¼Œä½†å›½å†…ä¸€ç›´ç¼ºå°‘å…¨é¢è®ºè¿°Spring Cloudå•†ç”¨å®è·µç›¸å…³çš„ä¹¦ç±ã€‚æœ¬ä¹¦å›´ç»•Spring Cloudæ¡†æ¶ä¸­çš„æœåŠ¡æ³¨å†Œå‘ç°ã€æœåŠ¡è·¯ç”±ã€æœåŠ¡ç½‘å…³ã€åˆ†å¸ƒå¼é…ç½®ã€æœåŠ¡æ²»ç†ã€å®¹å™¨åŒ–åŠå¾®æœåŠ¡è®¾è®¡ç­‰å…³é”®é¢†åŸŸè¿›è¡Œäº†æ·±å…¥æµ…å‡ºçš„è®²è§£ï¼Œå¹¶ç»™äºˆäº†å¤§é‡çš„çœŸå®åº”ç”¨æ¡ˆä¾‹ï¼Œæ–°æ‰‹å’Œè€æ‰‹éƒ½å¯ä»¥ä»ä¸­å—ç›Šè‰¯å¤šã€‚ä½œè€…ä½œä¸ºSpring Cloudä¸­å›½çš„èµ„æ·±ä¸“å®¶ï¼Œå¯¹äºSpring CloudåŠå¾®æœåŠ¡æœ‰ç€æ·±åˆ»çš„æ¶æ„å’Œå®æˆ˜ç»éªŒï¼Œå€¼å¾—ä¿¡èµ–ã€‚ â€”â€”å•å®¶éª è…¾è®¯ä¸­é—´ä»¶é«˜çº§å·¥ç¨‹å¸ˆ åœ¨å¾®æœåŠ¡ä½“ç³»ä¸­ï¼ŒSpring Cloudæ˜¯ç›®å‰æœ€çƒ­é—¨çš„æ„å»ºå¾®æœåŠ¡ä½“ç³»çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæä¾›äº†æ„å»ºå¾®æœåŠ¡æ¶æ„çš„ä¸€äº›åŸºç¡€è®¾æ–½ã€‚æœ¬ä¹¦å†…å®¹ä¸Šè¦†ç›–äº†Spring Cloudçš„ä¸€äº›ä¸»è¦ç»„ä»¶ï¼Œä¸ä»…åœ¨å¦‚ä½•ä½¿ç”¨ä¸Šåšäº†è¯¦ç»†çš„ä»‹ç»ï¼Œä¹Ÿä»åŸç†ä¸Šæ·±å…¥æµ…å‡ºåœ°å‰–æäº†å…¶ä¸­çš„æŠ€æœ¯è¦ç‚¹ï¼ŒåŒæ—¶éƒ¨åˆ†ç»„ä»¶ä¹Ÿè·Ÿå‘¨è¾¹çš„ä¸€äº›å¼€æºé¡¹ç›®è¿›è¡Œäº†å¯¹æ¯”ï¼Œä¸”æä¾›äº†ä¸€äº›åŸç†åˆ†æå’Œç›¸å…³çš„ç¤ºä¾‹ï¼Œæ˜¯ä¸€æœ¬ä¸å¯å¤šå¾—çš„Spring Cloudå®æˆ˜ä¹¦ç±ã€‚æ–°æ‰‹å’Œæœ‰å¾®æœåŠ¡å®è·µç»éªŒçš„è¯»è€…éƒ½èƒ½ä»ä¹¦ä¸­å¾—åˆ°ä¸€äº›ä¸ä¸€æ ·çš„æ”¶è·ã€‚ â€”â€”å¼ è‰ºè¾° è…¾è®¯é«˜çº§ç ”å‘å·¥ç¨‹å¸ˆ æœ¬ä¹¦ä¸ä»…å¯¹Spring Cloudå„æ ¸å¿ƒç»„ä»¶è¿›è¡Œäº†ç»†è‡´å…¥å¾®çš„ä»‹ç»ï¼ŒåŒæ—¶ä¹Ÿè·³å‡ºäº†æ¡†æ¶æœ¬èº«ï¼Œä¸ºå¾®æœåŠ¡çš„å®æ–½å’Œåˆ†å¸ƒå¼æ¶æ„æ‰€é¢ä¸´çš„åŸºæœ¬é—®é¢˜äº¤å‡ºäº†Spring Cloudå¼ç­”å·ï¼Œæ˜¯å¼€å‘è€…å¿«é€ŸæŒæ¡Spring CloudæŠ€æœ¯æ ˆçš„ç¥å…µåˆ©å™¨ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæœ¬ä¹¦è¿˜å‡èšç€Spring Cloudä¸­å›½ç¤¾åŒºçš„æ™ºæ…§ç»“æ™¶ï¼Œè®©æˆ‘ä»¬çœ‹åˆ°äº†å›½äººåœ¨å¼€æºé¢†åŸŸçš„ç ”å‘åŠ›é‡ï¼Œ å¯å–œå¯è´ºã€‚ â€”â€”ç‹é¸¿é£ ç™¾åº¦é«˜çº§ç ”å‘å·¥ç¨‹å¸ˆ åœ¨å¾®æœåŠ¡å¦‚ç«å¦‚è¼çš„ä»Šå¤©ï¼Œå„ç§å¾®æœåŠ¡æ¡†æ¶å±‚å‡ºä¸ç©·ï¼Œè€ŒSpring Cloudæ— ç–‘æ˜¯é‚£é¢—æœ€é—ªäº®çš„æ˜Ÿã€‚ä»Spring Frameworkåˆ°Spring Bootï¼Œå†åˆ°å¦‚ä»Šçš„Spring Cloudï¼ŒSpringå…¨å®¶æ¡¶ç»™ä¼—å¤šç¨‹åºå‘˜å¸¦æ¥äº†çœŸæ­£çš„æ˜¥å¤©ã€‚ç”±äºåˆ†å¸ƒå¼å’ŒæœåŠ¡åŒ–æ˜¯æå…·æŒ‘æˆ˜çš„ä»»åŠ¡ï¼Œå› æ­¤Spring Cloudä¹Ÿä¸å¯é¿å…çš„æ„ˆåŠ å¤æ‚ã€‚Spring CLoudä¸­å›½ç¤¾åŒºä¸ºSpring Cloudçš„æ™®åŠåšå‡ºäº†å·¨å¤§çš„è´¡çŒ®ï¼Œå¹¶è¿…é€Ÿçš„é™ä½äº†è¯­è¨€é—®é¢˜æ‰€å¸¦æ¥çš„å­¦ä¹ é—¨æ§›ã€‚è¿™æœ¬ä¹¦ç”±Spring CLoudä¸­å›½ç¤¾åŒºå€¾åŠ›æ‰“é€ ï¼Œä¹¦ç±æ¶µç›–äº†Spring Cloudçš„æœåŠ¡å‘ç°ã€ç½‘å…³ã€ç†”æ–­å™¨ã€é…ç½®ã€å…¨é“¾è·¯ç›‘æ§ç­‰æœ€æ ¸å¿ƒç»„ä»¶ï¼Œå¹¶å¾ˆæ¥åœ°æ°”åœ°è¯¦è¿°äº†Dubboå‘Spring Cloudè¿ç§»ä»¥åŠSpring Cloudä¸åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³å†…å®¹ï¼Œå€¼å¾—ä¸€çœ‹ã€‚â€”â€”å¼ äº® äº¬ä¸œé‡‘èæ•°æ®ç ”å‘è´Ÿè´£äºº/åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶Sharding-Sphereè´Ÿè´£äºº Spring Cloudæä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡æŠ€æœ¯ä½“ç³»ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿåœ°å®ç°æ¶æ„å‡çº§ã€‚ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä¸€ä¹¦å®Œæ•´åœ°ä»‹ç»äº†Spring Cloudä¸­å„ä¸ªç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•å¹¶æ·±åº¦å‰–æäº†å…¶ä¸­çš„åŸç†ï¼Œæ–‡ç« æ·±å…¥æµ…å‡ºå¸®åŠ©å¼€å‘è€…å¿«é€ŸæŒæ¡å’Œç†è§£Spring Cloudã€‚â€”â€”æè‰ºæ’ è…¾è®¯ç ”å‘å·¥ç¨‹å¸ˆ 3.3 è¯»è€…åé¦ˆhttps://github.com/SpringCloud/spring-cloud-code/issues/1 3.4 æºç ç›¸å…³ä¹¦ç±ç›®å½•ï¼šhttps://github.com/SpringCloud/spring-cloud-catalog æºç åœ°å€:https://github.com/SpringCloud/spring-cloud-code 3.5 å†…å®¹ç®€ä»‹è¿™æ˜¯ä¸€æœ¬å®è·µä¸ç†è®ºå¹¶é‡ã€å¹¿åº¦ä¸æ·±åº¦å…¼é¡¾çš„Spring Cloudç”Ÿäº§å®è·µå¼€å‘æŒ‡å—ï¼Œç”±Spring Cloudä¸­å›½ç¤¾åŒºå€¾åŠ›æ‰“é€ ï¼Œä½œè€…æ¥è‡ªé˜¿é‡Œã€èš‚èšé‡‘æœã€äº¬ä¸œé‡‘èç­‰ä¼ä¸šï¼Œæœ¬ä¹¦é’ˆå¯¹Spring Cloudåœ¨å›½å†…çš„ä½¿ç”¨æƒ…å†µï¼Œç»“åˆå›½å†…ä¼ä¸šä½¿ç”¨Spring Cloudè½åœ°å¾®æœåŠ¡æ¶æ„é‡åˆ°çš„é—®é¢˜ï¼Œæå‡ºå¯è½åœ°çš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬ä¹¦å†…å®¹æœ‰3å¤§ç‰¹è‰²ï¼š è¶³å¤Ÿå¹¿ï¼šè¯¦ç»†è®²è§£äº†Spring Cloudçš„æ ¸å¿ƒå¸¸ç”¨ç»„ä»¶ä»¥åŠSpring Cloudçš„å¢å¼ºç”Ÿæ€ï¼Œé’ˆå¯¹ç”Ÿäº§å®è·µä¸­å¸¸è§é—®é¢˜ç»™å‡ºå¯è½åœ°çš„æœ€ä½³å®è·µæ–¹æ¡ˆï¼Œæ— è®ºæ‚¨æ˜¯åˆå­¦è€…è¿˜æ˜¯å¼€å‘äººå‘˜ï¼Œè¿˜æ˜¯æ¶æ„å¸ˆï¼Œéƒ½èƒ½ä»æ­¤ä¹¦è·ç›Šã€‚ æœ‰æ·±åº¦ï¼šæœ¬ä¹¦å¯¹æ¶‰åŠçš„Spring Cloudç»„ä»¶æŒ‰ç…§ä»å…¥é—¨ã€è¿›é˜¶ã€å®æˆ˜ã€æ‰©å±•å¢å¼ºçš„é¡ºåºå¾ªåºæ¸è¿›è¿›è¡Œå‰–æå’Œè®²è§£,å¸®åŠ©ä½œè€…çŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œæˆä¹‹ä»¥æ¸”ã€‚ é‡å®è·µï¼šæ³¨é‡ç”Ÿäº§å®è·µï¼Œé€šè¿‡æ¡ˆä¾‹é©±åŠ¨ï¼Œç»™å‡ºä¼˜ç§€çš„ç”Ÿäº§å®è·µæ–¹æ¡ˆå’Œä¼˜ç§€çš„ç”Ÿäº§é…ç½®ï¼Œå¸®åŠ©è¯»è€…å¿«é€Ÿè½åœ°ä¼ä¸šå¾®æœåŠ¡æ¶æ„ã€‚ å…¨ä¹¦å…±25ç« ï¼Œåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š ç¬¬ä¸€éƒ¨åˆ† æ ¸å¿ƒç»„ä»¶ç¯‡ï¼ˆç¬¬1~10ç« ï¼‰ä¸»è¦è®²è§£Spring Cloudçš„æ ¸å¿ƒç»„ä»¶ã€‚é¦–å…ˆä»åº”ç”¨æ¶æ„çš„å‘å±•å†ç¨‹è®²èµ·ï¼Œä»‹ç»äº†å¾®æœåŠ¡å‡ºç°çš„èƒŒæ™¯ï¼Œå¹¶å¯¹å¾®æœåŠ¡æ¶æ„çš„è½åœ°æå‡ºäº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼›ç„¶ååˆ†åˆ«è¯¦ç»†ä»‹ç»äº†Spring Cloudå¾®æœåŠ¡ä½“ç³»ä¸­çš„æ ¸å¿ƒå¸¸ç”¨ç»„ä»¶ï¼Œå¦‚Eurekaã€Feignã€Ribbonã€Hystrixã€Zuulç­‰ï¼›æœ€åé€šè¿‡ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹å°†å‰é¢ä»‹ç»çš„ç»„ä»¶è¿æ¥èµ·æ¥ï¼Œå¸®åŠ©å¤§å®¶èä¼šè´¯é€šã€‚ ç¬¬äºŒéƒ¨åˆ† è¿›é˜¶å®æˆ˜ç¯‡ï¼ˆç¬¬11~18ç« ï¼‰åœ¨æ ¸å¿ƒç»„ä»¶çš„åŸºç¡€ä¸Šï¼Œå¯¹Configã€Consulã€è®¤è¯å’Œé‰´æƒã€å…¨é“¾è·¯ç›‘æ§ä»¥åŠå¯¹Spring Cloudç”Ÿæ€åœˆä¸­ç¬¬äºŒä»£ç½‘å…³Spring Cloud Gatewayè¿›è¡Œäº†è¯¦ç»†é˜è¿°ï¼Œå¾ªåºæ¸è¿›ã€æ¡ˆä¾‹é©±åŠ¨ï¼Œå¸®åŠ©è¯»è€…åŠ æ·±å¯¹ç»„ä»¶çš„ç†è§£å’Œè¿ç”¨ï¼Œæ›´å¥½åœ°æŒæ¡ç›¸å…³å†…å®¹è¿ç”¨äºç”Ÿäº§å®è·µã€‚ ç¬¬ä¸‰éƒ¨åˆ† è§£å†³æ–¹æ¡ˆç¯‡ï¼ˆç¬¬19~25ç« ï¼‰ ä¸»è¦ä»è§£å†³æ–¹æ¡ˆç€æ‰‹ï¼Œå†…å®¹åŒ…æ‹¬Spring Cloudä¸gRPCçš„æ•´åˆæ–¹å¼ã€ç‰ˆæœ¬æ§åˆ¶ä¸ç°åº¦å‘å¸ƒã€Spring Cloudå®¹å™¨åŒ–ã€Dubboå‘Spring Cloudçš„è¿ç§»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é¢†åŸŸé©±åŠ¨ç­‰ç”Ÿäº§çº§å®ç”¨è§£å†³æ–¹æ¡ˆï¼Œä¸ºä¼ä¸šITæ¶æ„å¾®æœåŠ¡åŒ–å’Œå˜é©ä¿é©¾æŠ¤èˆªã€‚ 3.6 æ¨èç†ç”± æœ¬ä¹¦ç”±Spring Cloudç¤¾åŒºå®˜æ–¹æ’°å†™ï¼Œæ ¸å¿ƒæˆå‘˜æ¥è‡ªåŸé˜¿é‡Œã€èš‚èšé‡‘æœã€äº¬ä¸œé‡‘èç­‰äº’è”ç½‘ä¼ä¸šï¼Œç»éªŒä¸°å¯Œã€‚ æœ¬ä¹¦å†…å®¹æœ‰3å¤§ç‰¹è‰²ï¼šå®½åº¦è¶³å¤Ÿå¹¿ã€æ·±åº¦è¶³å¤Ÿæ·±ï¼Œè€Œä¸”ç«‹è¶³äºç”Ÿäº§å®è·µï¼Œç›´æ¥ä»ç”Ÿäº§å®è·µå‡ºå‘ï¼ŒåŒ…å«å¤§é‡ç”Ÿäº§å®è·µçš„é…ç½® æœ¬ä¹¦å¾—åˆ°äº†æ¥è‡ªé˜¿é‡Œã€è…¾è®¯ã€ç™¾åº¦ã€äº¬ä¸œç­‰å¤§å‹äº’è”ç½‘ä¼ä¸šçš„è¿‘10ä½ä¸“å®¶çš„é¼åŠ›æ¨èã€‚ 3.7 ä½œè€…ä»‹ç» è®¸è¿›:Spring Cloudä¸­å›½ç¤¾åŒºåˆ›å§‹äººï¼Œé˜¿é‡ŒåŸèµ„æ·±å·¥ç¨‹å¸ˆï¼ŒèŠ±åç¹éœ–ï¼Œä¸“æ³¨äºåŸºç¡€æ¶æ„ä¸ä¸­é—´ä»¶ç ”å‘ï¼Œæ›¾å°±èŒäºå”¯å“ä¼šå¹³å°æ¶æ„éƒ¨å’Œé¥¿äº†ä¹ˆã€‚ä¸ªäººç½‘ç«™ï¼šhttp://xujin.orgã€‚ é’Ÿå°Šå‘:Spring Cloudä¸­å›½ç¤¾åŒºè”åˆåˆ›å§‹äººï¼Œç°å°±èŒäºäº¬ä¸œé‡‘èï¼Œå¯¹å¾®æœåŠ¡æœ‰æ·±å…¥ç ”ç©¶ã€‚ å¶å¿—è¿œ:Spring Cloudä¸­å›½ç¤¾åŒºè”åˆåˆ›å§‹äººï¼Œç°å°±èŒäºèš‚èšé‡‘æœï¼ŒèŠ±åæ¢“å°§ã€‚CSDNåšå®¢ä¸“å®¶ï¼Œå¼€æºç¤¾åŒºæ´»è·ƒè€…ï¼Œå›½å†…Spring Cloudæ—©æœŸå®è·µè€… æ–¹å¿—æœ‹:Spring Cloudä¸­å›½ç¤¾åŒºè”åˆåˆ›å§‹äººï¼Œç¡•å£«å­¦å†ï¼Œã€Šæ·±å…¥ç†è§£Spring Cloudä¸å¾®æœåŠ¡æ„å»ºã€‹ä½œè€…ï¼ŒCSDNåšå®¢ä¸“å®¶ï¼ˆé˜…è¯»é‡600ä¸‡+ï¼‰ï¼Œåœ¨ç¤¾åŒºå…·æœ‰è¾ƒé«˜æ´»è·ƒåº¦ä¸å½±å“åŠ›ã€‚ è”¡æ³¢æ–¯:æ‹¥æœ‰å¤šå¹´Javaå¼€å‘ç»éªŒï¼Œæ›¾å°±èŒäºç¾å›¢ã€è…¾è®¯ã€‚å›½å†…Spring Cloudé¢†åŸŸçš„æ—©æœŸå®è·µè€…ï¼Œç°åœ¨é‡‘èè¡Œä¸šä»äº‹FinTechç›¸å…³ç ”å‘ éƒ­èŠ³ç¢§:å¤šå¹´å¾®æœåŠ¡å®è·µç»éªŒï¼Œç°ä»»èŒäºæŸäº’è”ç½‘é‡‘èå…¬å¸ä¸­é—´ä»¶éƒ¨é—¨ã€‚ æœ±å¾·æ˜:æ‹¥æœ‰10å¹´Javaå¼€å‘ç»éªŒï¼Œå¤šå¹´æŠ€æœ¯æ¶æ„å’Œè§£å†³æ–¹æ¡ˆç»éªŒï¼Œç°ä»»çµé›€äº‘å¾®æœåŠ¡æ¶æ„å¸ˆï¼Œåœ¨å¾®æœåŠ¡é¢†åŸŸæœ‰ç€ä¸°å¯Œçš„è½åœ°ç»éªŒï¼Œæ›¾ä»»æŸåˆ›ä¸šå…¬å¸æŠ€æœ¯è´Ÿè´£äººã€‚","categories":[{"name":"é‡æ–°å®šä¹‰","slug":"é‡æ–°å®šä¹‰","permalink":"http://xujin.org/categories/é‡æ–°å®šä¹‰/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"é‡æ–°å®šä¹‰","slug":"é‡æ–°å®šä¹‰","permalink":"http://xujin.org/tags/é‡æ–°å®šä¹‰/"}]},{"title":"ä¸ªäººåšå®¢-æœ‰äº‰è®®æ–‡ç« ç‰ˆæƒé—®é¢˜å¤ç›˜å£°æ˜","slug":"ex/bqsm","date":"2018-09-03T06:00:00.000Z","updated":"2019-01-13T05:17:07.943Z","comments":true,"path":"ex/bqsm/","link":"","permalink":"http://xujin.org/ex/bqsm/","excerpt":"æ‘˜è¦:å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è®¸è¿›æ²‰æ€å½•çš„åšä¸»è®¸è¿›ï¼Œæ„Ÿè°¢å¤§å®¶å¯¹æˆ‘çš„åšå®¢è¿›è¡Œé˜…è¯»ï¼Œä¹‹æ‰€ä»¥ç½‘ç«™å–åä¸ºæ²‰æ€å½•ä¸»è¦æƒ³ç”¨åšå®¢çš„æ–¹å¼è®°å½•æˆ‘äººç”Ÿæ¯ä¸ªé˜¶æ®µçš„æŠ€æœ¯æ€è€ƒå’ŒæŠ€æœ¯å­¦ä¹ å¿«ç…§ï¼Œå’Œæ„Ÿæ‚Ÿã€‚ç”±äºæœ€è¿‘æœ‰ç½‘å‹å¯¹æˆ‘åšå®¢ä¸Šçš„å†…å®¹çš„ç‰ˆæƒé—®é¢˜äº§ç”Ÿäº‰è®®ï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦å¯¹æˆ‘ä¸ªäººåšå®¢å†…å®¹çš„ç‰ˆæƒé—®é¢˜äº‰è®®è¿›è¡Œå¤ç›˜å£°æ˜ã€‚","text":"æ‘˜è¦:å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è®¸è¿›æ²‰æ€å½•çš„åšä¸»è®¸è¿›ï¼Œæ„Ÿè°¢å¤§å®¶å¯¹æˆ‘çš„åšå®¢è¿›è¡Œé˜…è¯»ï¼Œä¹‹æ‰€ä»¥ç½‘ç«™å–åä¸ºæ²‰æ€å½•ä¸»è¦æƒ³ç”¨åšå®¢çš„æ–¹å¼è®°å½•æˆ‘äººç”Ÿæ¯ä¸ªé˜¶æ®µçš„æŠ€æœ¯æ€è€ƒå’ŒæŠ€æœ¯å­¦ä¹ å¿«ç…§ï¼Œå’Œæ„Ÿæ‚Ÿã€‚ç”±äºæœ€è¿‘æœ‰ç½‘å‹å¯¹æˆ‘åšå®¢ä¸Šçš„å†…å®¹çš„ç‰ˆæƒé—®é¢˜äº§ç”Ÿäº‰è®®ï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦å¯¹æˆ‘ä¸ªäººåšå®¢å†…å®¹çš„ç‰ˆæƒé—®é¢˜äº‰è®®è¿›è¡Œå¤ç›˜å£°æ˜ã€‚ å‰è¨€è¿™ç¯‡æ–‡ç« ä¸ºä»€ä¹ˆä¼šå‡ºç°å‘¢ï¼Ÿ ç¬¬ä¸€,å› ä¸ºæœ€è¿‘å‘ç”Ÿäº†è®©æˆ‘åŒªå¤·æ‰€æ€çš„äº‹æƒ…ï¼Œè‡³äºä»€ä¹ˆäº‹æƒ…æˆ‘ä¸æƒ³åšè¿‡å¤šè§£é‡Šã€‚æˆ‘åªæƒ³åšå¥½æˆ‘è‡ªå·±ï¼Œå°Šå¸ˆé‡é“ï¼Œæœ‰åˆ™æ”¹ä¹‹ï¼Œæ— è´£åŠ å‹‰ã€‚ ç¬¬äºŒ,æœ€è¿‘æœ‰å¹¸å’Œå¦å¤–6ä½ä½œè€…å†™å®Œä¸€æœ¬åä¸ºã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹æŠ€æœ¯ä¹¦ï¼Œèµ·åˆè§„åˆ’äº†32ç« ï¼Œæœ€åå®åœ¨å†™ä¸åŠ¨äº†ï¼Œä¿ç•™äº†ç²¾åçš„25ç« ï¼Œç”±äºå·¥ä½œç‰¹åˆ«å¿™ï¼Œ7ä½ä½œè€…ç»è¿‡æ— æ•°ä¸ªå¤œæ™šç†¬å¤œï¼Œæœ€ç»ˆåˆç¨¿æ±‡æ€»ä¹‹å 1400é¡µï¼Œæˆ‘ç¬¬ä¸€æ„Ÿè§‰æˆ‘çš„å¤©å‘€ï¼Œçº¸å¼ è¿™ä¹ˆè´µã€‚è€Œä¸”æˆ‘ä»¬åœ¨å†™çš„è¿‡ç¨‹ä¸­ï¼Œç«™åœ¨è¯»è€…çš„è§’åº¦+é™ä½æˆæœ¬çš„è§’åº¦ï¼Œåšäº†å¾ˆå¤šæ€è€ƒã€‚æœ€åæˆ‘ä»¬7äººè¿›è¡Œç¼©å‡ï¼Œèƒ½ç”¨ä¸€å¥è¯è¯´æ˜ç™½çš„å°±ä¸è¦ç”¨ä¸¤å¥è¯ï¼Œç»è¿‡å¯¹æ•´æœ¬ä¹¦è¿›è¡Œè°ƒæ•´ï¼Œåœ¨ä¿æŒå†…å®¹ä¸å˜çš„æƒ…å†µä¸‹æœ€ååˆç¨¿ä¸º1187é¡µã€‚å¥½åƒè·‘é¢˜äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œæœ€è¿‘ç”µå­é²œè¯»ç‰ˆæœ¬å·²å…¬å¼€ã€‚å¥½å¤šæŠ€æœ¯æœ‹å‹çœ‹å®Œä¹‹åï¼Œæœ‰äººé—®æˆ‘:æˆ‘å¯ä»¥åœ¨æˆ‘åšå®¢ä¸Šå†™ä¸€ä¸‹å…³äºè¿™æœ¬ä¹¦çš„è¯»ä¹¦ç¬”è®°å—ï¼Ÿæˆ‘è¯´å¯ä»¥å‘€ï¼Œç„¶åä»–é—®äº†æˆ‘ç‰ˆæƒç½²åçš„é—®é¢˜ã€‚æˆ‘å›ç­”æ˜¯:æˆ‘ä¸å¤ªä»‹æ„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åšå¥½è‡ªå·±å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸ºäº†é¿å…å¼•èµ·ä¸å¿…è¦çš„éº»çƒ¦ï¼Œæˆ‘å»ºè®®ä»–å¯ä»¥å†™ä¸ºã€ŠæŸæŸæŸä¹¦çš„è¯»ä¹¦ç¬”è®°ã€‹ é’ˆå¯¹ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ï¼Œå’Œæœ€è¿‘å‘ç”Ÿçš„äº‹æƒ…ï¼ŒçœŸçš„æœ‰å¿…è¦è¿›è¡Œå¤ç›˜è¿›è¡Œå£°æ˜ã€‚ 1.åšå®¢æ¦‚è¿° æˆ‘å¼€å§‹æ¥è§¦å†™åšå®¢çš„æ—¶å€™æ˜¯ä»æ–°æµªåšå®¢å¼€å§‹ï¼Œåæ¥ç»è¿‡å¤šæ¬¡æŠ˜è…¾è¿›è¡Œè¿ç§»ã€‚åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘æƒ³ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯åšå®¢ã€‚ç™¾åº¦ç™¾ç§‘å¯¹åšå®¢çš„æè¿°å¦‚ä¸‹å›¾ç‰‡æ‰€ç¤º: ç®€å•çš„æ¥è¯´åšå®¢å°±æ˜¯å¯¹å­¦ä¹ ï¼Œç”Ÿæ´»ï¼Œæ„Ÿæ‚Ÿï¼Œæ€è€ƒçš„ä¸€ç§è®°å½•æ–¹å¼ã€‚ä»…ä»£è¡¨ä¸ªäººè§‚ç‚¹ã€‚ 2. åšå®¢ç‰ˆæƒå£°æ˜ è¿‘å‡ å¹´éšç€çŸ¥è¯†äº§æƒå’Œç‰ˆæƒæ„è¯†çš„å¢å¼ºï¼Œå¾ˆå¤šäººå¼€å§‹å¯¹è‡ªå·±åœ¨ç½‘ä¸Šå‘è¡¨çš„åšå®¢ä¿¡æ¯æˆ–ç½‘ç»œæ—¥å¿—ï¼Œæˆ–è€…æƒ³æ³•å’Œæ„Ÿæ‚Ÿå¢åŠ ç‰ˆæƒä¿¡æ¯ã€‚ 2.1 Hexoåšå®¢ç‰ˆæƒå¢åŠ ç”¨è¿‡Hexoæˆ–è€…Hugoçš„å¯ä»¥çŸ¥é“ï¼Œæœ‰æ—¶ä¸ºäº†åå¤æ·»åŠ é‡å¤å†…å®¹ï¼Œä¼šç»Ÿä¸€æ·»åŠ ç‰ˆæƒä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤º: 1234567&lt;! -- æ·»åŠ ç‰ˆæƒä¿¡æ¯ --&gt;&lt;div class=&quot;article-footer-copyright&quot;&gt;&lt;i class=&quot;fa fa-lightbulb-o&quot;&gt;&lt;/i&gt;æœ¬æ–‡ç”±&lt;b&gt;&lt;a href=&quot;&lt;%= config.root %&gt;index.html&quot; target=&quot;_blank&quot; title=&quot;&lt;%= config.author %&gt;&quot;&gt;&lt;%= config.author %&gt;&lt;/a&gt;&lt;/b&gt;åˆ›ä½œå’Œå‘è¡¨,é‡‡ç”¨&lt;a href=&quot;http://creativecommons.org/licenses/by/3.0/cn&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CC BY 3.0 CNåè®®&lt;/a&gt; è¿›è¡Œè®¸å¯ã€‚è½¬è½½è¯·æ³¨æ˜ä½œè€…åŠå‡ºå¤„,æœ¬æ–‡ä½œè€…ä¸º&lt;b&gt;&lt;a href=&quot;&lt;%= config.root %&gt;index.html&quot; target=&quot;_blank&quot; title=&quot;&lt;%= config.author %&gt;&quot;&gt;&lt;%= config.author %&gt;&lt;/a&gt;&lt;/b&gt;,æœ¬æ–‡æ ‡é¢˜ä¸º&lt;b&gt;&lt;a href=&quot;&lt;%- config.root %&gt;&lt;%- post.path %&gt;&quot; target=&quot;_blank&quot; title=&quot;&lt;%= post.title %&gt;&quot;&gt;&lt;%= post.title %&gt;&lt;/a&gt;&lt;/b&gt;æœ¬æ–‡é“¾æ¥ä¸º&lt;b&gt;&lt;a href=&quot;&lt;%- config.root %&gt;&lt;%- post.path %&gt;&quot; target=&quot;_blank&quot; title=&quot;&lt;%= post.title %&gt;&quot;&gt;&lt;%- config.url %&gt;/&lt;%- post.path %&gt;&lt;/a&gt;&lt;/b&gt;&lt;/div&gt;&lt;! -- æ·»åŠ ç‰ˆæƒä¿¡æ¯ --&gt; ä¼˜ç‚¹:ç»Ÿä¸€æ·»åŠ ç‰ˆæƒä¿¡æ¯ç¼ºç‚¹:å¦‚æœé—æ¼å®¹æ˜“äº§ç”Ÿè¯¯è§£ ç»Ÿä¸€æ·»åŠ çš„æ–¹å¼ï¼Œè™½ç„¶æ–¹ä¾¿ï¼Œå³ä¾¿ä½ æŒ‡æ˜äº†ä½œè€…æ˜¯è°ï¼Œä½†æ˜¯ä¹Ÿå®¹æ˜“å¼•èµ·è¯¯ä¼šï¼Œå¯èƒ½ä¼šç»™è‡ªå·±é€ æˆå›°æ‰°ã€‚æ¯”å¦‚ä¸‹é¢äº‰è®®çš„å‡ ç¯‡æ–‡ç« ã€‚ 3.åšå®¢ç‰ˆæƒ-äº‰è®®é—®é¢˜å¤ç›˜è¯´æ˜3.1 åšå®¢ä¸»é¢˜ç‰ˆæƒå£°æ˜ æˆ‘åšå®¢åŸºäºHexoæ„å»ºï¼Œä¸»é¢˜åŸºäºhttps://github.com/ppoffice/hexo-theme-icarusä¼˜åŒ–ç¾åŒ–è¿›è¡Œå®šåˆ¶DIYã€‚æ„Ÿè°¢åŸä½œè€…è´¡çŒ®äº†åˆ†äº«äº†è¯¥ä¸»é¢˜ã€‚ 3.2 Spring Cloud Zuulå¼‚å¸¸å¤„ç†æ–‡ç« -ç‰ˆæƒè¯´æ˜å¦‚ä¸‹å›¾æ‰€ç¤ºSpring Cloud Zuulå¼‚å¸¸å¤„ç†æ–‡ç« æ¥è‡ªäºSpring Cloudä¸­å›½ç¤¾åŒºåšå®¢æŠ•ç¨¿ï¼Œæ–‡ç¨¿ç½²åå¼ åŠ²ï¼Œä¸ºäº†è®©æ›´å¤šçš„äººå­¦ä¹ äº†è§£ã€‚æ”¾äº†ä¸€ä»½åˆ°æˆ‘åšå®¢å·²æ³¨æ˜ä½œè€…ã€‚ è·Ÿä½œè€…æ²Ÿé€šäº†è§£ä¹‹åï¼Œä½œè€…æ²¡æœ‰å‚åŠ è¿‡ä¸Šæµ·æŠ€æœ¯æ²™é¾™ä¹Ÿæ²¡çœ‹è¿‡å¯¹åº”çš„PPTï¼Œ 3.3 æ•°æ®åº“è¿æ€§æ± æ€§èƒ½æµ‹è¯•-æ–‡ç« ç‰ˆæƒå£°æ˜ æœ¬ç¯‡æ–‡ç« é“¾æ¥åœ¨æˆ‘åšå®¢ä¸Šåœ°å€æ˜¯:http://xujin.org/mw/dcp-test/ï¼Œ æ˜¯æˆ‘åœ¨å”¯å“ä¼šä¸­é—´ä»¶å›¢é˜Ÿæ—¶å­¦ä¹ ä¸­é—´ä»¶çš„è®°å½•ï¼Œæ”¶é›†æ•´ç†æˆMDæ–‡ç¨¿è€Œæ¥ã€‚ é€šè¿‡ç™¾åº¦æœç´¢ç»“æœå¦‚ä¸‹ï¼Œæœ€ä¸‹é¢çš„ä¸¤ä¸ªæˆªå›¾ç±»ä¼¼çš„æ–‡ç« ã€‚ è·ŸåŸä½œè€…æ²Ÿé€šå£°æ˜ç‰ˆæƒä¸ºå”¯å“ä¼šä¸­é—´ä»¶å›¢é˜Ÿæ²Ÿé€šç»“æœå¦‚ä¸‹: å¤„ç†ç»“æœå¦‚ä¸‹: 4.æ€»ç»“å¤„ç†æ–¹å¼åšå®¢åæœŸä¼˜åŒ–æ–¹å¼:1.ä¿®æ”¹ç»Ÿä¸€åŠ ç‰ˆæƒæ–¹å¼ä¸ºæ‰‹åŠ¨æ·»åŠ ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯¯ä¼šã€‚2.å¢åŠ åé¦ˆæœºåˆ¶ï¼Œç¬¬ä¸€æ—¶é—´åé¦ˆå¤„ç†","categories":[{"name":"æ²‰æ€å½•","slug":"æ²‰æ€å½•","permalink":"http://xujin.org/categories/æ²‰æ€å½•/"}],"tags":[{"name":"æ²‰æ€å½•","slug":"æ²‰æ€å½•","permalink":"http://xujin.org/tags/æ²‰æ€å½•/"}]},{"title":"Spring Cloud Gatewayä¸­çš„æƒé‡è·¯ç”±","slug":"sc/gw/gw08","date":"2018-06-09T06:00:00.000Z","updated":"2019-01-12T03:31:12.149Z","comments":true,"path":"sc/gw/gw08/","link":"","permalink":"http://xujin.org/sc/gw/gw08/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦é€šè¿‡è¿ç”¨Spring Cloud Gatewayçš„WeightRoutePredicateFactoryå¯¹URLè¿›è¡Œæƒé‡è·¯ç”±ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦é€šè¿‡è¿ç”¨Spring Cloud Gatewayçš„WeightRoutePredicateFactoryå¯¹URLè¿›è¡Œæƒé‡è·¯ç”±ã€‚ 1.æƒé‡è·¯ç”±1.1 æƒé‡è·¯ç”±ä½¿ç”¨åœºæ™¯åœ¨å¼€å‘æˆ–è€…æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ–è€…çº¿ä¸Šå‘å¸ƒï¼Œçº¿ä¸ŠæœåŠ¡å¤šç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œéœ€è¦å¯¹æœåŠ¡æä¾›æƒé‡è·¯ç”±ï¼Œæœ€å¸¸è§çš„ä½¿ç”¨å°±æ˜¯ï¼Œä¸€ä¸ªæœåŠ¡æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬V1ï¼Œæ–°ç‰ˆæœ¬v2ã€‚åœ¨çº¿ä¸Šç°åº¦çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ç½‘å…³åŠ¨æ€å®æ—¶æ¨é€ï¼Œè·¯ç”±æƒé‡ä¿¡æ¯ã€‚æ¯”å¦‚95%çš„æµé‡èµ°æœåŠ¡v1ç‰ˆæœ¬ï¼Œ5%çš„æµé‡èµ°æœåŠ¡v2ç‰ˆæœ¬ã€‚ issue: The Spring Cloud Gateway issue of Allow Rolling Deployments https://github.com/spring-cloud/spring-cloud-gateway/issues/67 1.2 Spring Cloud Gatewayæƒé‡è·¯ç”±åŸç†Spring Cloud Gatewayä¸­æä¾›äº†org.springframework.cloud.gateway.handler.predicate.WeightRoutePredicateFactoryå»å®ç°æ ¹æ®åˆ†ç»„è®¾ç½®æƒé‡è¿›è¡Œè·¯ç”±ï¼Œå› æ­¤ä½¿ç”¨èµ·æ¥ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæœ‰å…´è¶£çš„å¯ä»¥debugé˜…è¯»æºç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class WeightRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;WeightConfig&gt; implements ApplicationEventPublisherAware &#123; private static final Log log = LogFactory.getLog(WeightRoutePredicateFactory.class); public static final String GROUP_KEY = WeightConfig.CONFIG_PREFIX + \".group\"; public static final String WEIGHT_KEY = WeightConfig.CONFIG_PREFIX + \".weight\"; private ApplicationEventPublisher publisher; public WeightRoutePredicateFactory() &#123; super(WeightConfig.class); &#125; @Override public void setApplicationEventPublisher(ApplicationEventPublisher publisher) &#123; this.publisher = publisher; &#125; @Override public List&lt;String&gt; shortcutFieldOrder() &#123; return Arrays.asList(GROUP_KEY, WEIGHT_KEY); &#125; @Override public String shortcutFieldPrefix() &#123; return WeightConfig.CONFIG_PREFIX; &#125; @Override public void beforeApply(WeightConfig config) &#123; if (publisher != null) &#123; publisher.publishEvent(new WeightDefinedEvent(this, config)); &#125; &#125; @Override public Predicate&lt;ServerWebExchange&gt; apply(WeightConfig config) &#123; return exchange -&gt; &#123; Map&lt;String, String&gt; weights = exchange.getAttributeOrDefault(WEIGHT_ATTR, Collections.emptyMap()); String routeId = exchange.getAttribute(GATEWAY_PREDICATE_ROUTE_ATTR); // all calculations and comparison against random num happened in // WeightCalculatorWebFilter String group = config.getGroup(); if (weights.containsKey(group)) &#123; String chosenRoute = weights.get(group); if (log.isTraceEnabled()) &#123; log.trace(\"in group weight: \"+ group + \", current route: \" + routeId +\", chosen route: \" + chosenRoute); &#125; return routeId.equals(chosenRoute); &#125; return false; &#125;; &#125;&#125; 2.Spring Cloud Gatewayä¸­çš„æƒé‡è·¯ç”±æ¡ˆä¾‹2.1 æ¡ˆä¾‹ä»£ç åœ°å€https://github.com/SoftwareKing/sc-gateway/tree/master/ch4 2.2 Spring Cloud Gateway Serverè¯´æ˜Spring Cloud Gateway will dispatch 95% of the requests to version 1 and 5% of the traffic to version 2 of a specified service, as shown by the following figure. æˆ‘ä»¬é€šè¿‡åœ¨Spring Cloud Gatewayä¸­ä¼šé…ç½®ä¸åŒçš„æƒé‡ä¿¡æ¯åˆ°ä¸åŒURLä¸Šï¼ŒSpring Cloud Gatewayä¼šæ ¹æ®æˆ‘ä»¬é…ç½®çš„è·¯ç”±æƒé‡ä¿¡æ¯ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æºæœåŠ¡ç»„ï¼Œæƒé‡ä¿¡æ¯å¦‚ch4/ch4-gatewayä¸­çš„application.ymlæ‰€ç¤ºï¼Œä¸»è¦é…ç½®ä¿¡æ¯å¦‚ä¸‹ã€‚ 123456789101112131415161718spring: application: name: ch4-gateway cloud: gateway: routes: - id: service1_v1 uri: http://localhost:8081/v1 predicates: - Path=/test - Weight=service1, 95 - id: service1_v2 uri: http://localhost:8081/v2 predicates: - Path=/test - Weight=service1, 5 Weight=service1, 95ï¼ŒWeight=service1, 5å°±æ˜¯è·¯ç”±çš„æƒé‡ä¿¡æ¯ã€‚ 2.3 æºæœåŠ¡æºæœåŠ¡åœ¨æœ¬æ¡ˆä¾‹ä¸­æºæœåŠ¡å¦‚ch4-service-provideræ‰€ç¤ºï¼Œä¸»è¦ææä¾›Gateway Serveræƒé‡è·¯ç”±å¯¹åº”çš„åç«¯æºæœåŠ¡ã€‚å› ä¸ºæ¯”è¾ƒç®€å•å› æ­¤ä¸åšè¯¦ç»†è¯´æ˜ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011121314151617181920package org.xujin.sc.service;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import reactor.core.publisher.Mono;@RestControllerpublic class ServiceController &#123; @RequestMapping(value = \"/v1\", produces = \"text/plain;charset=UTF-8\") public Mono&lt;String&gt; v1() &#123; return Mono.just(\"v1\"); &#125; @RequestMapping(value = \"/v2\", produces = \"text/plain;charset=UTF-8\") public Mono&lt;String&gt; v2() &#123; return Mono.just(\"v2\"); &#125;&#125; 2.4 æµ‹è¯•åˆ†åˆ«å¯åŠ¨ch4-gatewayï¼Œch4-service-providerè¿›è¡Œè®¿é—®:http://localhost:8080/test æµ‹è¯•,å‘ç°ä¼šæ ¹æ®æ‰€è®¾æƒé‡è¿›è¡Œè·¯ç”±ã€‚","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayä¸­çš„GatewayFilterå’ŒGlobalFilter","slug":"sc/gw/gw07","date":"2018-05-26T06:00:00.000Z","updated":"2019-01-12T03:30:42.775Z","comments":true,"path":"sc/gw/gw07/","link":"","permalink":"http://xujin.org/sc/gw/gw07/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä»€ä¹ˆæ˜¯GatewayFilterå’ŒGlobalFilterï¼Œä»¥åŠåŒºåˆ«å’Œè”ç³»ã€‚ç„¶åä»‹ç»å¦‚ä½•åœ¨Spring Cloud Gatewayä¸­è‡ªå®šä¹‰ä½¿ç”¨GatewayFilterå’ŒGlobalFilterã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä»€ä¹ˆæ˜¯GatewayFilterå’ŒGlobalFilterï¼Œä»¥åŠåŒºåˆ«å’Œè”ç³»ã€‚ç„¶åä»‹ç»å¦‚ä½•åœ¨Spring Cloud Gatewayä¸­è‡ªå®šä¹‰ä½¿ç”¨GatewayFilterå’ŒGlobalFilterã€‚ 1. Spring Cloud gatewayçš„FilterSpring Cloud gatewayä¸­çš„Filterä»æ¥å£å®ç°ä¸Šåˆ†ä¸ºä¸¤ç§ä¸€ç§æ˜¯GatewayFilterï¼Œå¦å¤–ä¸€ç§æ˜¯GlobalFilterã€‚ 1.1 GatewayFilterä¸GlobalFilterçš„åŒºåˆ«åŒºåˆ«ç”¨è‹±è¯­å¯ä»¥æ€»ç»“å¦‚ä¸‹:At a high level global filters are applied to all routes, while a gateway filter will be applied to an individual route(s) åœ¨ä¸€ä¸ªé«˜çš„è§’åº¦æ¥çœ‹ï¼ŒGlobal filtersä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰çš„è·¯ç”±ä¸Šï¼Œè€ŒGateway filterå°†åº”ç”¨åˆ°å•ä¸ªè·¯ç”±ä¸Šæˆ–è€…ä¸€ä¸ªåˆ†ç»„çš„è·¯ç”±ä¸Šã€‚åœ¨ä¸‹é¢çš„æ¡ˆä¾‹ä¸­å°†ä¼šè¿›è¡Œè¯´æ˜ã€‚ 1.2 æœ¬æ–‡ä»£ç åœ°å€ https://github.com/SoftwareKing/sc-gateway/tree/master/ch2 2. GatewayFilterå’ŒGlobalFilter2.1 GatewayFilter2.1.1 ä»€ä¹ˆæ˜¯GatewayFilterContract for interception-style, chained processing of Web requests that may be used to implement cross-cutting, application-agnostic requirements such as security, timeouts, and others. Specific to a Gateway Copied from WebFilter GatewayFilteræ˜¯ä»WebFilterä¸­Copyè¿‡æ¥çš„ï¼Œç›¸å½“äºä¸€ä¸ªFilterè¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è®¿é—®çš„URLè¿‡æ»¤æ¨ªåˆ‡å¤„ç†ï¼Œåº”ç”¨åœºæ™¯æ¯”å¦‚è¶…æ—¶ï¼Œå®‰å…¨ç­‰ã€‚ ä»Spring Cloud Gatewayçš„æºç ä¸­å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºGatewayFilterçš„ä½¿ç”¨åœºæ™¯: 12345678910111213141516171819202122232425/** * Contract for interception-style, chained processing of Web requests that may * be used to implement cross-cutting, application-agnostic requirements such * as security, timeouts, and others. Specific to a Gateway * * Copied from WebFilter * * @author Rossen Stoyanchev * @since 5.0 */public interface GatewayFilter extends ShortcutConfigurable &#123; String NAME_KEY = \"name\"; String VALUE_KEY = \"value\"; /** * Process the Web request and (optionally) delegate to the next * &#123;@code WebFilter&#125; through the given &#123;@link GatewayFilterChain&#125;. * @param exchange the current server exchange * @param chain provides a way to delegate to the next filter * @return &#123;@code Mono&lt;Void&gt;&#125; to indicate when request processing is complete */ Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain);&#125; GatewayFilterå’ŒGlobalFilterä¸¤ä¸ªæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ä¸€æ ·éƒ½æ˜¯Mono filter(ServerWebExchange exchange, GatewayFilterChain chain)ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯GatewayFilterç»§æ‰¿äº†ShortcutConfigurableï¼ŒGlobalFilteræ²¡æœ‰ä»»ä½•ç»§æ‰¿ã€‚ 2.1.2 è‡ªå®šä¹‰GatewayFilter(Custom GatewayFilter)å¦‚org.xujin.sc.filter.CustomFilterä»£ç æ‰€ç¤ºï¼Œé€šè¿‡è‡ªå®šä¹‰GatewayFilterå¯¹è·¯ç”±è½¬å‘çš„å¤„ç†æ—¶é•¿ç»Ÿè®¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738package org.xujin.sc.filter;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.cloud.gateway.filter.GatewayFilter;import org.springframework.cloud.gateway.filter.GatewayFilterChain;import org.springframework.core.Ordered;import org.springframework.web.server.ServerWebExchange;import reactor.core.publisher.Mono;/** * ç»Ÿè®¡æŸä¸ªæˆ–è€…æŸç§è·¯ç”±çš„çš„å¤„ç†æ—¶é•¿ * @author xujin */public class CustomFilter implements GatewayFilter, Ordered &#123; private static final Log log = LogFactory.getLog(GatewayFilter.class); private static final String COUNT_Start_TIME = \"countStartTime\"; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; exchange.getAttributes().put(COUNT_Start_TIME, System.currentTimeMillis()); return chain.filter(exchange).then( Mono.fromRunnable(() -&gt; &#123; Long startTime = exchange.getAttribute(COUNT_Start_TIME); Long endTime=(System.currentTimeMillis() - startTime); if (startTime != null) &#123; log.info(exchange.getRequest().getURI().getRawPath() + \": \" + endTime + \"ms\"); &#125; &#125;) ); &#125; @Override public int getOrder() &#123; return Ordered.LOWEST_PRECEDENCE; &#125;&#125; 2.1.3 Gateway Filterä¸RouteLocatorç»‘å®šä½¿ç”¨åœ¨org.xujin.sc.GatewayServerApplicationä¸­customerRouteLocatorå¦‚ä¸‹æ‰€ç¤º: 1234567891011121314151617181920212223@SpringBootApplicationpublic class GatewayServerApplication &#123; @Bean public RouteLocator customerRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() .route(r -&gt; r.path(\"/test/prefix/**\") .filters(f -&gt; f.stripPrefix(2) .filter(new CustomFilter()) .addResponseHeader(\"X-Response-test\", \"test\")) .uri(\"lb://SC-CONSUMER\") .order(0) .id(\"test_consumer_service\") ) .build(); &#125; public static void main(String[] args) &#123; SpringApplication.run(GatewayServerApplication.class, args); &#125;&#125; r.path(â€œ/test/prefix/**â€)è¡¨ç¤ºè‡ªå®šä¹‰äº†è®¿é—®å‰ç¼€ï¼Œåœ¨çœŸæ­£çš„Gatewayè¿›è¡Œè·¯ç”±è½¬å‘çš„æ—¶å€™ï¼Œä¼šç”¨è¿‡f.stripPrefix(2)æŠŠå‰ç¼€å»æ‰ã€‚ ä½¿ç”¨åœºæ™¯:å¯ä»¥æŠŠå¯¹å¤–æš´éœ²çš„URLé€šè¿‡åŠ å‰ç¼€åˆ†ç»„æ‰“æ ‡ã€‚ filter(new CustomFilter() filter(new CustomFilter()ï¼Œè¡¨ç¤ºæŠŠè‡ªå®šä¹‰çš„FilteråŠ åˆ°Filteré“¾é‡Œé¢æ‰§è¡Œï¼Œæ³¨æ„ä¸€ç‚¹æ˜¯è‡ªå®šä¹‰GlobalFilterä¸éœ€è¦åŠ è¿›å»ã€‚ uri(â€œlb://SC-CONSUMERâ€) uri(â€œlb://SC-CONSUMERâ€)è¡¨ç¤ºSpring Cloud Gatewayå¯¹spring.application.nameç­‰äºsc-consumeræºæœåŠ¡åº”ç”¨ä¸­çš„URLè¿›è¡Œåè®®é€‚é…è½¬å‘ã€‚ 2.1.4 æµ‹è¯•å¦‚ä¸‹:1.è®¿é—®http://localhost:9000/SC-CONSUMER/hello/xujin èƒ½æ­£å¸¸è®¿é—®ã€‚ 123DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping : Route matched: CompositeDiscoveryClient_SC-CONSUMER2018-05-27 09:58:07.905 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping : Mapping [Exchange: GET http://localhost:9000/SC-CONSUMER/hello/xujin] to Route&#123;id='CompositeDiscoveryClient_SC-CONSUMER', uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$337/1295338046@f2ff0c8, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$717/1168359877@1f74a2b, order=1&#125;]&#125;2018-05-27 09:58:07.905 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.handler.FilteringWebHandler : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@f5bf288&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$717/1168359877@1f74a2b, order=1&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@26c77f54&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@4c38cd16&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@2c1d57bc&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@6e9a0bea&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@7ddcb0dc&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@3e856100&#125;, order=2147483647&#125;] ä»ä¸Šé¢çš„æ§åˆ¶å°æ‰“å°æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œæ²¡æœ‰æ‰“å°å‡ºè¯¥URLå¯¹åº”çš„è€—æ—¶ã€‚ 2.åŠ ä¸ŠURLå‰ç¼€/test/prefix/è®¿é—®ï¼Œæµ‹è¯•URLä¸ºhttp://localhost:9000/test/prefix/hello/testCustomFilter/xujin 1232018-05-27 10:01:56.057 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping : Mapping [Exchange: GET http://localhost:9000/test/prefix/hello/testCustomFilter/xujin] to Route&#123;id='test_consumer_service', uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$337/1295338046@6dbaa72e, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.StripPrefixGatewayFilterFactory$$Lambda$340/1149217113@41fb2078, order=0&#125;, org.xujin.sc.filter.CustomFilter@281885a3, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.AddResponseHeaderGatewayFilterFactory$$Lambda$342/1099925775@4705cae6, order=0&#125;]&#125;2018-05-27 10:01:56.057 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.handler.FilteringWebHandler : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@f5bf288&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.StripPrefixGatewayFilterFactory$$Lambda$340/1149217113@41fb2078, order=0&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.AddResponseHeaderGatewayFilterFactory$$Lambda$342/1099925775@4705cae6, order=0&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@26c77f54&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@4c38cd16&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@2c1d57bc&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@6e9a0bea&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@7ddcb0dc&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@3e856100&#125;, order=2147483647&#125;, org.xujin.sc.filter.CustomFilter@281885a3]2018-05-27 10:02:00.347 INFO 31658 --- [ctor-http-nio-8] o.s.cloud.gateway.filter.GatewayFilter : /hello/testCustomFilter/xujin: 859ms å¦‚ä¸Šæ—¥å¿—å¯ä»¥çœ‹åˆ°/hello/testCustomFilter/xujin: 859msï¼ŒGatewayè½¬å‘çš„æ—¶å€™å»æ‰äº†å‰ç¼€ã€‚ 2.2 GlobalFilter2.2.1 ä»€ä¹ˆæ˜¯GlobalFilter The GlobalFilter interface has the same signature as GatewayFilter. These are special filters that are conditionally applied to all routes. (This interface and usage are subject to change in future milestones). Spring Cloud gatewayå®šä¹‰äº†GlobalFilterçš„æ¥å£è®©æˆ‘ä»¬å»è‡ªå®šä¹‰å®ç°è‡ªå·±çš„çš„GlobalFilterã€‚GlobalFilteræ˜¯ä¸€ä¸ªå…¨å±€çš„Filterï¼Œä½œç”¨äºæ‰€æœ‰çš„è·¯ç”±ã€‚ 123456789101112public interface GlobalFilter &#123; /** * Process the Web request and (optionally) delegate to the next * &#123;@code WebFilter&#125; through the given &#123;@link GatewayFilterChain&#125;. * @param exchange the current server exchange * @param chain provides a way to delegate to the next filter * @return &#123;@code Mono&lt;Void&gt;&#125; to indicate when request processing is complete */ Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain);&#125; 2.2.2 è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨(Custom GlobalFilter)åœ¨è¿™é‡Œç®€å•å®šä¹‰AuthSignatureFilterå®ç°GlobalFilterï¼Œä½¿ç”¨åœºæ™¯å°±æ˜¯Gatewayå¯¹è¯·æ±‚çš„URLæ ¡éªŒæƒé™ï¼Œåˆ¤æ–­è¯·æ±‚çš„URLæ˜¯å¦æ˜¯åˆæ³•è¯·æ±‚ã€‚é€šè¿‡ä»ServerWebExchangeè·å–è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­authTokenå¯¹åº”çš„å€¼ï¼Œè¿›è¡Œåˆ¤nullå¤„ç†ï¼Œå…¶å®ƒçš„checké€»è¾‘å¯ä»¥è‡ªå®šå®šåˆ¶ã€‚ 12345678910111213141516171819202122232425262728293031package org.xujin.sc.filter;import org.springframework.cloud.gateway.filter.GatewayFilterChain;import org.springframework.cloud.gateway.filter.GlobalFilter;import org.springframework.core.Ordered;import org.springframework.http.HttpStatus;import org.springframework.stereotype.Component;import org.springframework.web.server.ServerWebExchange;import reactor.core.publisher.Mono;/** * è°ƒç”¨é‰´æƒ */@Componentpublic class AuthSignatureFilter implements GlobalFilter, Ordered &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; String token = exchange.getRequest().getQueryParams().getFirst(\"authToken\"); if (token == null || token.isEmpty()) &#123; exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED); return exchange.getResponse().setComplete(); &#125; return chain.filter(exchange); &#125; @Override public int getOrder() &#123; return -200; &#125;&#125; GlobalFilterå†™å®Œäº†ï¼Œé‚£é—®é¢˜æ¥äº†ï¼Ÿå¦‚ä½•è®©å…¶åœ¨Gatewayä¸­è¿è¡Œç”Ÿæ•ˆï¼Œæœ‰ä¸¤ç§æ–¹å¼ä¸€ç§ç›´æ¥åŠ @Componentæ³¨è§£ï¼Œå¦å¤–ä¸€ç§å¯ä»¥åœ¨ Spring Config ä¸­é…ç½®è¿™ä¸ª Beanå¦‚ä¸‹æ‰€ç¤º: 1234@Beanpublic AuthSignatureFilter authSignatureFilter()&#123; return new AuthSignatureFilter();&#125; æµ‹è¯•1.è®¿é—®http://localhost:9000/test/prefix/hello/testCustomFilter/xujin å¦‚ä¸‹æ‰€ç¤ºç”±äºauthTokenä¸ºç©º401è¿”å›. 2.è®¿é—®http://localhost:9000/test/prefix/hello/testCustomFilter/xujin?authToken=asdasdsddasadsadsadsdadsewew32rg","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud GatewayåŸºäºæœåŠ¡å‘ç°çš„é»˜è®¤è·¯ç”±è§„åˆ™","slug":"sc/gw/gw05","date":"2018-05-21T06:00:00.000Z","updated":"2019-01-12T03:35:27.669Z","comments":true,"path":"sc/gw/gw05/","link":"","permalink":"http://xujin.org/sc/gw/gw05/","excerpt":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayçš„åŸºäºæœåŠ¡å‘ç°çš„é»˜è®¤è·¯ç”±è§„åˆ™ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºGatewayçš„è·¯ç”±è§„åˆ™:http://Gateway_HOST:Gateway_PORT/å¤§å†™çš„serviceId/* å’Œ zuulçš„é»˜è®¤è·¯ç”±è§„åˆ™http://ZUUL_HOST:ZUUL_PORT/å¾®æœåŠ¡åœ¨Eurekaä¸Šçš„serviceId/*å·®ä¸å¤šã€‚","text":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayçš„åŸºäºæœåŠ¡å‘ç°çš„é»˜è®¤è·¯ç”±è§„åˆ™ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºGatewayçš„è·¯ç”±è§„åˆ™:http://Gateway_HOST:Gateway_PORT/å¤§å†™çš„serviceId/* å’Œ zuulçš„é»˜è®¤è·¯ç”±è§„åˆ™http://ZUUL_HOST:ZUUL_PORT/å¾®æœåŠ¡åœ¨Eurekaä¸Šçš„serviceId/*å·®ä¸å¤šã€‚ 1.Spring Gatewayæ¦‚è¿°1.1 ä»€ä¹ˆæ˜¯Spring Cloud Gateway Spring Cloud Gatewayæ˜¯Springå®˜æ–¹åŸºäºSpring 5.0ï¼ŒSpring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼ŒSpring Cloud Gatewayæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚Spring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Netflix ZUULï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/åŸ‹ç‚¹ï¼Œå’Œé™æµç­‰ã€‚ 1.2 Spring Cloud Gatewayçš„åŠŸèƒ½Spring Cloud Gateway çš„ç‰¹å¾ï¼š åŸºäº Spring Framework 5ï¼ŒProject Reactor å’Œ Spring Boot 2.0åŠ¨æ€è·¯ç”± Predicates å’Œ Filters ä½œç”¨äºç‰¹å®šè·¯ç”± é›†æˆ Hystrix æ–­è·¯å™¨ é›†æˆ Spring Cloud DiscoveryClient æ˜“äºç¼–å†™çš„ Predicates å’Œ Filters é™æµ è·¯å¾„é‡å†™ 2. Spring Cloud Gatewayçš„å·¥ç¨‹æµç¨‹ å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ 2.1 Preå’ŒPOSTä¸¤ç§ç±»å‹çš„è¿‡æ»¤å™¨3.åŸºäºæœåŠ¡å‘ç°çš„é»˜è®¤è·¯ç”±è§„åˆ™3.1 zuulå’Œgatewayçš„é»˜è®¤è·¯ç”±è§„åˆ™3.1.1 zuulçš„é»˜è®¤è·¯ç”±è§„åˆ™è¯´æ˜é»˜è®¤æƒ…å†µä¸‹ï¼ŒZuulä¼šä»£ç†æ‰€æœ‰æ³¨å†Œåˆ°Eureka Serverçš„å¾®æœåŠ¡ï¼Œå¹¶ä¸”Zuulçš„è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š http://ZUUL_HOST:ZUUL_PORT/å¾®æœåŠ¡åœ¨Eurekaä¸Šçš„serviceId/** ä¼šè¢«è½¬å‘åˆ°serviceIdå¯¹åº”çš„å¾®æœåŠ¡ã€‚ http://localhost:8040/sc-zuul-first-provider/sc/order/2 3.1.2 gatewayçš„é»˜è®¤è·¯ç”±è§„åˆ™ä¸‹é¢çš„æ¡ˆä¾‹ä¸­ä¼šæ¼”ç¤ºï¼šhttp://localhost:9000/SC-CONSUMER/hello/xujin http://Gateway_HOST:Gateway_PORT/å¤§å†™çš„serviceId/**ï¼Œå…¶ä¸­å¾®æœåŠ¡åº”ç”¨åé»˜è®¤å¤§å†™è®¿é—®ã€‚ 3.2 æ¡ˆä¾‹ç¤ºä¾‹ä»£ç https://github.com/SoftwareKing/sc-gateway/tree/master/ch1 æ¨¡å— è¯´æ˜ ç«¯å£ ch1-sc-consumer æœåŠ¡æ¶ˆè´¹è€… 8000 ch1-sc-eureka Eureka Serveræ³¨å†Œä¸­å¿ƒ 8761 ch1-sc-gateway Spring Cloud Gateway Sever 9000 ch1-sc-provider æœåŠ¡æä¾›è€… 8001 3.2.1 ch1-sc-gatewayå·¥ç¨‹è¯´æ˜3.2.1.1 Mavenä¾èµ–Spring Cloud Gateway severä¸»è¦çš„mavenä¾èµ–å¦‚ä¸‹æ‰€ç¤º 12345678910&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 3.2.1.2 ymlæ–‡ä»¶é…ç½®12345678910111213141516171819spring: application: name: sc-gateway-server cloud: gateway: discovery: locator: enabled: trueserver: port: 9000eureka: client: service-url: defaultZone: http://localhost:8761/eureka/logging: level: org.springframework.cloud.gateway: debug é…ç½®è¯´æ˜ï¼š spring.cloud.gateway.discovery.locator.enabledï¼šæ˜¯å¦ä¸æœåŠ¡å‘ç°ç»„ä»¶è¿›è¡Œç»“åˆï¼Œé€šè¿‡ serviceId è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ã€‚é»˜è®¤ä¸ºfalseï¼Œè®¾ä¸ºtrueä¾¿å¼€å¯é€šè¿‡æœåŠ¡ä¸­å¿ƒçš„è‡ªåŠ¨æ ¹æ® serviceId åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ã€‚ ä¿®æ”¹spring cloud gateway serverç›‘å¬çš„ç«¯å£ä¸º9000 eureka.client.service-url.defaultZone: http://localhost:8761/eureka/,æŒ‡å®šæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼ŒSpring Cloud Gatewayä»æ³¨å†Œä¸­å¿ƒè·å–å·²ç»æ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ã€‚ logging.level.org.springframework.cloud.gateway: debug,å¼€å¯spring-Cloud-gatewayçš„æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œæ–¹ä¾¿debugè°ƒè¯•ã€‚ 3.3 å¯åŠ¨æµ‹è¯•3.3.1 é”™è¯¯çš„è·¯ç”±è§„åˆ™è®¿é—®è®¿é—®Spring Cloud Gatewayå¯¹åº”çš„serverï¼Œå½“è®¿é—®http://localhost:9000/sc-consumer/hello/xujinçš„æ—¶å€™ï¼ŒæŠ¥é”™å¦‚ä¸‹æ‰€ç¤ºï¼Œæ­£ç¡®çš„Spring Cloud Gatewayçš„é»˜è®¤è·¯ç”±è§„åˆ™:http://Gateway_HOST:Gateway_PORT/å¤§å†™çš„serviceId/** 1234567891011122018-05-18 01:10:49.742 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-CONSUMER applying &#123;pattern=/SC-CONSUMER/**&#125; to Path2018-05-18 01:10:49.743 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-CONSUMER applying filter &#123;regexp=/SC-CONSUMER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-18 01:10:49.743 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-CONSUMER2018-05-18 01:10:49.744 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-PRODUCER applying &#123;pattern=/SC-PRODUCER/**&#125; to Path2018-05-18 01:10:49.744 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-PRODUCER applying filter &#123;regexp=/SC-PRODUCER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-18 01:10:49.745 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-PRODUCER2018-05-18 01:10:49.745 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-GATEWAY-SERVER applying &#123;pattern=/SC-GATEWAY-SERVER/**&#125; to Path2018-05-18 01:10:49.747 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-GATEWAY-SERVER applying filter &#123;regexp=/SC-GATEWAY-SERVER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-18 01:10:49.748 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-GATEWAY-SERVER2018-05-18 01:10:49.748 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.h.RoutePredicateHandlerMapping : Route matched: CompositeDiscoveryClient_SC-CONSUMER2018-05-18 01:10:49.749 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.h.RoutePredicateHandlerMapping : Mapping [Exchange: GET http://localhost:9000/SC-CONSUMER/hello/xujin] to Route&#123;id='CompositeDiscoveryClient_SC-CONSUMER', uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$707/751096818@7f4c6373, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$709/672603106@293895d2, order=1&#125;]&#125;2018-05-18 01:10:49.749 DEBUG 6462 --- [ctor-http-nio-5] o.s.c.g.handler.FilteringWebHandler : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@5e85c21b&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$709/672603106@293895d2, order=1&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@38e83838&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@6ef2f7ad&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@41def031&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@4966bab1&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@22d477c2&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@39832280&#125;, order=2147483647&#125;] ä»ä¸Šé¢çš„logï¼Œçœ‹åˆ°è¿”å›äº† 404 é”™è¯¯ï¼Œè¿›ä¸€æ­¥å¯ä»¥çœ‹åˆ° Spring Cloud Gateway å·²ç»ä¸ºæˆ‘ä»¬çš„ provider å’Œ consumer è‡ªåŠ¨åˆ›å»ºäº†å¯¹åº”çš„è·¯ç”±è½¬å‘è§„åˆ™ï¼Œä½†æ˜¯è¿™é‡Œçš„ pattern/regexp é‡Œéƒ½æ˜¯å¤§å†™çš„ï¼Œä¸‹é¢æ¢æˆå¤§å†™çš„æµ‹è¯•ä¸€ä¸‹ã€‚ 3.3.2 Gatewayæ­£ç¡®çš„è·¯ç”±è§„åˆ™æµ‹è¯•è®¿é—®æ­£ç¡®çš„http://localhost:9000/SC-CONSUMER/hello/xujinï¼Œå¯ä»¥æˆåŠŸè®¿é—®ã€‚ 1234567891011122018-05-22 09:04:21.204 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-CONSUMER applying &#123;pattern=/SC-CONSUMER/**&#125; to Path2018-05-22 09:04:21.205 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-CONSUMER applying filter &#123;regexp=/SC-CONSUMER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-22 09:04:21.205 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-CONSUMER2018-05-22 09:04:21.206 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-PRODUCER applying &#123;pattern=/SC-PRODUCER/**&#125; to Path2018-05-22 09:04:21.207 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-PRODUCER applying filter &#123;regexp=/SC-PRODUCER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-22 09:04:21.207 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-PRODUCER2018-05-22 09:04:21.208 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-GATEWAY-SERVER applying &#123;pattern=/SC-GATEWAY-SERVER/**&#125; to Path2018-05-22 09:04:21.208 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition CompositeDiscoveryClient_SC-GATEWAY-SERVER applying filter &#123;regexp=/SC-GATEWAY-SERVER/(?&lt;remaining&gt;.*), replacement=/$&#123;remaining&#125;&#125; to RewritePath2018-05-22 09:04:21.209 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.r.RouteDefinitionRouteLocator : RouteDefinition matched: CompositeDiscoveryClient_SC-GATEWAY-SERVER2018-05-22 09:04:21.209 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping : Route matched: CompositeDiscoveryClient_SC-CONSUMER2018-05-22 09:04:21.209 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping : Mapping [Exchange: GET http://localhost:9000/SC-CONSUMER/hello/xujin] to Route&#123;id='CompositeDiscoveryClient_SC-CONSUMER', uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$706/57023854@24f1a91e, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$708/2036079541@cbb7393, order=1&#125;]&#125;2018-05-22 09:04:21.209 DEBUG 1677 --- [ctor-http-nio-2] o.s.c.g.handler.FilteringWebHandler : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@29a98d9f&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$708/2036079541@cbb7393, order=1&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@544e8149&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@55d58825&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@2da3b078&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@1a96d94c&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@19a64eae&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@7fb66650&#125;, order=2147483647&#125;] å¯ä»¥çœ‹å‡ºï¼ŒSpring Cloud Gateway è‡ªåŠ¨çš„ä¸ºæˆ‘ä»¬çš„ consumer åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±ï¼Œç±»ä¼¼äºä¸‹è¾¹è¿™æ ·12345678routes: - id: CompositeDiscoveryClient_SC-CONSUMER uri: lb://SC-CONSUMER order: 0 predicates: - Path=/SC-CONSUMER/** filters: - RewritePath=/SC-CONSUMER/(?&lt;segment&gt;.*), /$\\&#123;segment&#125; æ‰€ä»¥ä»zuulè¿ç§»åˆ°gatewayçš„æ—¶å€™ï¼ŒæœåŠ¡è·¯ç”±è§„åˆ™ä¸­çš„å¾®æœåŠ¡åº”ç”¨Idé»˜è®¤ä»å°å†™å˜ä¸ºå¤§å†™ã€‚","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayåªæœ‰Preå’ŒPOSTä¸¤ç§ç±»å‹çš„Filter","slug":"sc/gw/gw06","date":"2018-05-21T06:00:00.000Z","updated":"2019-01-12T03:30:08.378Z","comments":true,"path":"sc/gw/gw06/","link":"","permalink":"http://xujin.org/sc/gw/gw06/","excerpt":"æ‘˜è¦:Spring Cloud Gatewayåªæœ‰ä¸¤ç§ç±»å‹çš„Filterï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Spring Cloud Gatewayä¸­åˆ›å»ºä¸€ä¸ªPreæˆ–Postç±»å‹çš„Filterã€‚","text":"æ‘˜è¦:Spring Cloud Gatewayåªæœ‰ä¸¤ç§ç±»å‹çš„Filterï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Spring Cloud Gatewayä¸­åˆ›å»ºä¸€ä¸ªPreæˆ–Postç±»å‹çš„Filterã€‚ zuulçš„Filterç±»å‹Zuul çš„ Filter æ˜¯é€šè¿‡filterType()æ–¹æ³•æ¥æŒ‡å®šï¼Œä¸€ä¸ª Filter åªèƒ½å¯¹åº”ä¸€ç§ç±»å‹ï¼Œè¦ä¹ˆæ˜¯ â€œpreâ€ è¦ä¹ˆæ˜¯â€œpostâ€ Spring Cloud Gatewayçš„Filterç±»å‹Spring Cloud Gateway åŸºäº Project Reactor å’Œ WebFluxï¼Œé‡‡ç”¨å“åº”å¼ç¼–ç¨‹é£æ ¼ï¼Œæ‰“å¼€å®ƒçš„ Filter çš„æ¥å£GatewayFilterä½ ä¼šå‘ç°å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³•filter Preç±»å‹çš„Filteråœ¨Spring Cloud Gatewayæºç ä¸­å®šä¹‰äº†ä¸€ä¸ªPreç±»å‹çš„Filterï¼Œcodeå°†ä¼šåœ¨chain.filter() ä¹‹å‰è¢«æ‰§è¡Œ,ä»£ç :AddRequestHeader 12345678910111213141516171819202122package org.springframework.cloud.gateway.filter.factory;import org.springframework.cloud.gateway.filter.GatewayFilter;import org.springframework.http.server.reactive.ServerHttpRequest;/** * @author Spencer Gibb */public class AddRequestHeaderGatewayFilterFactory extends AbstractNameValueGatewayFilterFactory &#123; @Override public GatewayFilter apply(NameValueConfig config) &#123; return (exchange, chain) -&gt; &#123; ServerHttpRequest request = exchange.getRequest().mutate() .header(config.getName(), config.getValue()) .build(); return chain.filter(exchange.mutate().request(request).build()); &#125;; &#125;&#125; Postç±»å‹çš„Filterå¯¹äºPostç±»å‹çš„Filterï¼ŒSetStatusä»£ç å°†ä¼šåœ¨chain.filter(exchange).then()é‡Œé¢çš„ä»£ç è¿è¡Œã€‚ 12345678910111213141516public class SetStatusGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;SetStatusGatewayFilterFactory.Config&gt; &#123; @Override public GatewayFilter apply(Config config) &#123; final HttpStatus status = ServerWebExchangeUtils.parse(config.status); return (exchange, chain) -&gt; &#123; return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123; // check not really needed, since it is guarded in setStatusCode, // but it's a good example if (!exchange.getResponse().isCommitted()) &#123; setResponseStatus(exchange, status); &#125; &#125;)); &#125;; &#125;&#125;","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"å…¬ç›ŠEureka Serverä¸å®šåˆ¶æ–¹æ³•","slug":"sc/sc-diy-eureka","date":"2018-05-14T06:00:00.000Z","updated":"2019-01-12T03:46:24.845Z","comments":true,"path":"sc/sc-diy-eureka/","link":"","permalink":"http://xujin.org/sc/sc-diy-eureka/","excerpt":"æ‘˜è¦: æœ¬æ–‡ä¸»è¦ç®€å•ä»‹ç»å¦‚ä½•å®šåˆ¶ä¸€ä¸ªeureka serverï¼Œå¹¶ç›´æ¥æŒ‡å‡ºæœ€ä¼˜çš„å®šåˆ¶æ–¹å¼ã€‚","text":"æ‘˜è¦: æœ¬æ–‡ä¸»è¦ç®€å•ä»‹ç»å¦‚ä½•å®šåˆ¶ä¸€ä¸ªeureka serverï¼Œå¹¶ç›´æ¥æŒ‡å‡ºæœ€ä¼˜çš„å®šåˆ¶æ–¹å¼ã€‚ 1. Spring Cloudä¸­å›½å…¬ç›ŠEureka ServerEureka Serverä¸ºä½œä¸ºSpring Cloudå¼€å‘è¿‡ç¨‹ä¸­å¸¸ç”¨çš„æ³¨å†Œä¸­å¿ƒç»„ä»¶ï¼Œä½œä¸ºåŸºç¡€è®¾æ–½ç»„ä»¶ï¼Œå¼€å‘å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦è‡ªå·±åˆ›å»ºEureka Serveråº”ç”¨å’Œé‡å¯ã€‚ä¸ºäº†å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå­¦ä¹ å…¥é—¨ã€‚Spring Cloudä¸­å›½ç¤¾åŒºç‰¹æ­å»ºä¸€ä¸ªå…¬ç›Šæ³¨å†Œä¸­å¿ƒï¼Œä»…ä½œä¸ºå¸®åŠ©Spring Cloudçš„å¼€å‘è€…è¿›è¡Œå­¦ä¹ å’Œè°ƒè¯•ã€‚ä¸ºäº†æ›´å¥½æœåŠ¡å¤§å®¶ï¼Œè¯·å‹¿å¯¹æœ¬æ³¨å†Œä¸­å¿ƒè¿›è¡Œå‹æµ‹ã€‚å®šåˆ¶çš„Eureka Serveræ³¨å†Œä¸­å¿ƒUIå¦‚ä¸‹æ‰€ç¤ºã€‚ 1.1 è®¿é—®åœ°å€ http://eureka.springcloud.cn 2.å®šåˆ¶Eureka Serrverçš„UI2.1 ä¸ºä»€ä¹ˆè¦å®šåˆ¶Eureka Server åŸå› ä¸¤ç‚¹: 1.è§‰å¾—é»˜è®¤çš„UIæ¯”è¾ƒä¸‘ 2.Eureka Serveræƒ³å®¢åˆ¶åŒ–ä¸€ä¸‹ è‡³äºSpring Cloud Eurekaçš„UIå®¢åˆ¶åŒ–æˆä»€ä¹ˆæ ·å­ç”±ä½ è€Œå®šï¼ 3. ä¸¤ç§æ–¹æ³•å®šåˆ¶Eureka Server3.1 ç›´æ¥ä¿®æ”¹eureka serverçš„æºä»£ç  ç›´æ¥ä¿®æ”¹eureka serverçš„æºä»£ç ï¼Œè¯¥æ–¹æ³•æ˜¯æœ€çº¯çš„æ–¹å¼ï¼Œè€Œä¸”æ¯æ¬¡æœ‰ä¸€ä¸ªEureka Serverçš„ç‰ˆæœ¬éƒ½éœ€è¦å»ä¿®æ”¹ã€‚ 3.2 åªä¿®æ”¹Eureka Serverçš„UIåªéœ€è¦ä¿®æ”¹å¯¹åº”çš„html+css+æ–‡æ¡ˆå³å¯ï¼Œå®Œå…¨ä¸ç”¨å»ä¿®æ”¹Eureka Serverçš„æºç ,å¼ºçƒˆæ¨èã€‚ æºç å‚è€ƒåœ°å€:https://github.com/SpringCloud/spring-cloud-eureka 3.3 ä¸ºä»€ä¹ˆæˆ‘å®šåˆ¶è‡ªå·±çš„UIåŠ è¿›å» ä¸ºä»€ä¹ˆæˆ‘å®šåˆ¶è‡ªå·±çš„UIåŠ è¿›å»ï¼Œå°±å¯ä»¥ç›´æ¥Runï¼Œé‚£æºç ä»£ç ä¸­çš„UIæ˜¯ä¸æ˜¯è¢«è¦†ç›–äº†ï¼Ÿ 123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.springcloud.eureka&lt;/groupId&gt; &lt;artifactId&gt;eureka-server-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; å¦‚ä¸Šmavené…ç½®æ‰€ç¤ºï¼Œå®˜æ–¹çš„spring-cloud-starter-netflix-eureka-serverä¾èµ–ä¿¡æ¯é…ç½®åœ¨ä¸‹é¢ï¼Œç”±mavençš„ä¾èµ–åŠ è½½é¡ºåºå†³å®šï¼Œå®šåˆ¶çš„UIä¼˜å…ˆåŠ è½½æ˜¾ç¤ºã€‚ 4. å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨DIYçš„Eureka Serveråªéœ€è¦é…ç½®mavenä¾èµ–å³å¯:123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.springcloud.eureka&lt;/groupId&gt; &lt;artifactId&gt;eureka-server-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt;","categories":[{"name":"Eureka Server","slug":"Eureka-Server","permalink":"http://xujin.org/categories/Eureka-Server/"}],"tags":[{"name":"Eureka Server","slug":"Eureka-Server","permalink":"http://xujin.org/tags/Eureka-Server/"}]},{"title":"Spring Cloud Gatewayçš„Beforeè·¯ç”±æ–­è¨€å·¥å‚","slug":"sc/gw/gw04","date":"2018-03-28T06:00:00.000Z","updated":"2019-01-12T03:35:55.349Z","comments":true,"path":"sc/gw/gw04/","link":"","permalink":"http://xujin.org/sc/gw/gw04/","excerpt":"æ‘˜è¦:åœ¨ä¸Šæœ¬ç¯‡æ–‡ç« Spring Cloud Gatewayçš„Afterè·¯ç”±æ–­è¨€å·¥å‚ä»‹ç»äº†Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µå’ŒAfterè·¯ç”±æ–­è¨€ï¼Œæœ¬æ–‡ç®€å•ä»‹ç»Beforeè·¯ç”±æ–­è¨€å·¥å‚ã€‚å› ä¸ºæ¯”è¾ƒç®€å•æ‰€ä»¥å°±æŠ›ç –å¼•ç‰ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶å¿«é€Ÿå…¥é—¨Spring Cloud Gatewayï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘å¾®ä¿¡Software_Kingï¼Œè¿›å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¾®ä¿¡ç¾¤äº¤æµã€‚","text":"æ‘˜è¦:åœ¨ä¸Šæœ¬ç¯‡æ–‡ç« Spring Cloud Gatewayçš„Afterè·¯ç”±æ–­è¨€å·¥å‚ä»‹ç»äº†Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µå’ŒAfterè·¯ç”±æ–­è¨€ï¼Œæœ¬æ–‡ç®€å•ä»‹ç»Beforeè·¯ç”±æ–­è¨€å·¥å‚ã€‚å› ä¸ºæ¯”è¾ƒç®€å•æ‰€ä»¥å°±æŠ›ç –å¼•ç‰ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶å¿«é€Ÿå…¥é—¨Spring Cloud Gatewayï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘å¾®ä¿¡Software_Kingï¼Œè¿›å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¾®ä¿¡ç¾¤äº¤æµã€‚ 1. Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µ ç½‘å…³ç®€å•çš„è¯´å°±æ˜¯æä¾›ä¸€ä¸ªå¯¹å¤–ç»Ÿä¸€çš„APIå…¥å£å’Œå‡ºå£ï¼Œç»Ÿç®¡ä¼ä¸šå¯¹å¤–çš„æ‰€æœ‰APIå‡ºå£ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç½‘å…³å¯¹å¤–æš´éœ²çš„URLæˆ–è€…æ¥å£ä¿¡æ¯ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¹‹ä¸ºè·¯ç”±ä¿¡æ¯ã€‚å¦‚æœç ”å‘è¿‡ç½‘å…³ä¸­é—´ä»¶ï¼Œæˆ–è€…ä½¿ç”¨æˆ–äº†è§£è¿‡ZUULçš„ï¼Œç½‘å…³çš„æ ¸å¿ƒè‚¯å®šæ˜¯Filterä»¥åŠFilter Chain(Filterè´£ä»»é“¾)ã€‚Spring Cloud Gatewayä¹Ÿå…·æœ‰è·¯ç”±ä¿¡æ¯å’ŒFilterã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹Spring Cloud gatewayä¸­æœ€é‡è¦çš„å‡ ä¸ªæ¦‚å¿µ: è·¯ç”±(route):è·¯ç”±æ˜¯ç½‘å…³æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œè·¯ç”±ä¿¡æ¯ç”±ä¸€ä¸ªIDã€ä¸€ä¸ªç›®çš„urlã€ä¸€ç»„æ–­è¨€å·¥å‚å’Œä¸€ç»„Filterç»„æˆã€‚å¦‚æœè·¯ç”±æ–­è¨€å·¥å‚ä¸ºçœŸï¼Œåˆ™è¯´æ˜è¯·æ±‚çš„Urlå’Œé…ç½®çš„è·¯ç”±åŒ¹é…ã€‚ æ–­è¨€(Predicate): java 8ä¸­çš„æ–­è¨€å‡½æ•°ã€‚Spring Cloud Gatewayä¸­çš„æ–­è¨€å‡½æ•°è¾“å…¥ç±»å‹æ˜¯Spring 5.0æ¡†æ¶ä¸­çš„ServerWebExchangeã€‚Spring Cloud Gatewayä¸­çš„æ–­è¨€å‡½æ•°å…è®¸å¼€å‘è€…å»å®šä¹‰åŒ¹é…æ¥è‡ªäºhttp requestä¸­çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚å¤´å’Œå‚æ•°ç­‰ã€‚ è¿‡æ»¤å™¨(filter):ä¸€ä¸ªæ ‡å‡†çš„Spring webFilterã€‚Spring Cloud Gatewayä¸­çš„Filteråˆ†ä¸ºä¸¤ç§ç±»å‹çš„Filterï¼Œåˆ†åˆ«æ˜¯Gateway Filterå’ŒGlobal Filter.ç½‘å…³ Filterå®ä¾‹æ˜¯ç”±Spring æ¡†æ¶ä¸­çš„ç½‘å…³Filterçš„ç‰¹æ®Šå·¥å‚æ„é€ ã€‚requeståœ¨è½¬å‘åˆ°ç›®å‰æœåŠ¡ä¹‹å‰ï¼Œresponseåœ¨è¿”å›åˆ°è°ƒç”¨ç«¯ä¹‹å‰éƒ½å¯ä»¥è¢«ä¿®æ”¹æˆ–è€…è‡ªå®šä¹‰ã€‚ 2. ä»€ä¹ˆæ˜¯Beforeè·¯ç”±æ–­è¨€ Beforeè·¯ç”±æ–­è¨€å·¥å‚å¸¦æœ‰ä¸€ä¸ªUTCæ—¶é—´æ ¼å¼çš„æ—¶é—´å‚æ•°ï¼Œå½“è¯·æ±‚è¿›æ¥çš„å½“å‰æ—¶é—´åœ¨è·¯ç”±æ–­è¨€å·¥å‚ä¹‹å‰ä¼šæˆåŠŸåŒ¹é…ï¼Œå¦åˆ™ä¸èƒ½æˆåŠŸåŒ¹é…ã€‚ 3. Beforeè·¯ç”±æ–­è¨€å·¥å‚çš„æ¡ˆä¾‹3.1 å¼•å…¥pomä¾èµ–pom.xmlä¾èµ–é…ç½®å¦‚ä¸‹æ‰€ç¤º: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.M9&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; 3.2 application.ymlæ–‡ä»¶é…ç½®:1234567891011121314151617181920server: port: 8082spring: cloud: gateway: routes: - id: before_route uri: http://xujin.org predicates: - Before=2022-03-13T00:54:30.877+08:00[Asia/Shanghai]logging: level: org.springframework.cloud.gateway: TRACE org.springframework.http.server.reactive: DEBUG org.springframework.web.reactive: DEBUG reactor.ipc.netty: DEBUGmanagement.endpoints.web.exposure.include: '*' Spring Cloud Gatewayæä¾›ä¸¤ç§æ–¹å¼å»é…ç½®Beforeè·¯ç”±æ–­è¨€å·¥å‚ï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯ymlæ–‡ä»¶çš„é…ç½®æ–¹å¼ã€‚ 3.3 ç­‰ä»·çš„@Beané…ç½®12345678910111213@Beanpublic RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123; ZonedDateTime datetime = LocalDateTime.now().plusDays(1).atZone(ZoneId.systemDefault()); //@formatter:off return builder.routes() .route(\"before_route\", r -&gt; r.before(datetime) .uri(\"http://xujin.org\")) .build(); //@formatter:on &#125; Spring Cloud Gatewayæä¾›ä¸¤ç§æ–¹å¼å»é…ç½®Afterè·¯ç”±æ–­è¨€å·¥å‚ï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯@Beançš„é…ç½®æ–¹å¼ã€‚ä¸ç®¡é€šè¿‡ymlæ–‡ä»¶é…ç½®æˆ–è€…é€šè¿‡@Beançš„æ–¹å¼é…ç½®æ˜¯ç­‰ä»·çš„ã€‚ 3.4 æµ‹è¯•å¦‚ä¸‹:è®¿é—®http://localhost:8082/ æˆåŠŸè½¬å‘åˆ°http://xujin.orgã€‚","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayçš„Afterè·¯ç”±æ–­è¨€å·¥å‚","slug":"sc/gw/gw03","date":"2018-03-25T06:00:00.000Z","updated":"2019-01-12T03:24:23.992Z","comments":true,"path":"sc/gw/gw03/","link":"","permalink":"http://xujin.org/sc/gw/gw03/","excerpt":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µå’ŒAfterè·¯ç”±æ–­è¨€ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•æ‰€ä»¥å°±æŠ›ç –å¼•ç‰ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶å¿«é€Ÿå…¥é—¨Spring Cloud Gatewayï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘å¾®ä¿¡Software_Kingï¼Œè¿›å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¾®ä¿¡ç¾¤äº¤æµã€‚","text":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µå’ŒAfterè·¯ç”±æ–­è¨€ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•æ‰€ä»¥å°±æŠ›ç –å¼•ç‰ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶å¿«é€Ÿå…¥é—¨Spring Cloud Gatewayï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘å¾®ä¿¡Software_Kingï¼Œè¿›å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¾®ä¿¡ç¾¤äº¤æµã€‚ 1.Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µ ç½‘å…³ç®€å•çš„è¯´å°±æ˜¯æä¾›ä¸€ä¸ªå¯¹å¤–ç»Ÿä¸€çš„APIå…¥å£å’Œå‡ºå£ï¼Œç»Ÿç®¡ä¼ä¸šå¯¹å¤–çš„æ‰€æœ‰APIå‡ºå£ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç½‘å…³å¯¹å¤–æš´éœ²çš„URLæˆ–è€…æ¥å£ä¿¡æ¯ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¹‹ä¸ºè·¯ç”±ä¿¡æ¯ã€‚å¦‚æœç ”å‘è¿‡ç½‘å…³ä¸­é—´ä»¶ï¼Œæˆ–è€…ä½¿ç”¨æˆ–äº†è§£è¿‡ZUULçš„ï¼Œç½‘å…³çš„æ ¸å¿ƒè‚¯å®šæ˜¯Filterä»¥åŠFilter Chain(Filterè´£ä»»é“¾)ã€‚Spring Cloud Gatewayä¹Ÿå…·æœ‰è·¯ç”±ä¿¡æ¯å’ŒFilterã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹Spring Cloud gatewayä¸­æœ€é‡è¦çš„å‡ ä¸ªæ¦‚å¿µ: è·¯ç”±(route):è·¯ç”±æ˜¯ç½‘å…³æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œè·¯ç”±ä¿¡æ¯ç”±ä¸€ä¸ªIDã€ä¸€ä¸ªç›®çš„urlã€ä¸€ç»„æ–­è¨€å·¥å‚å’Œä¸€ç»„Filterç»„æˆã€‚å¦‚æœè·¯ç”±æ–­è¨€å·¥å‚ä¸ºçœŸï¼Œåˆ™è¯´æ˜è¯·æ±‚çš„Urlå’Œé…ç½®çš„è·¯ç”±åŒ¹é…ã€‚ æ–­è¨€(Predicate): java 8ä¸­çš„æ–­è¨€å‡½æ•°ã€‚Spring Cloud Gatewayä¸­çš„æ–­è¨€å‡½æ•°è¾“å…¥ç±»å‹æ˜¯Spring 5.0æ¡†æ¶ä¸­çš„ServerWebExchangeã€‚Spring Cloud Gatewayä¸­çš„æ–­è¨€å‡½æ•°å…è®¸å¼€å‘è€…å»å®šä¹‰åŒ¹é…æ¥è‡ªäºhttp requestä¸­çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚å¤´å’Œå‚æ•°ç­‰ã€‚ è¿‡æ»¤å™¨(filter):ä¸€ä¸ªæ ‡å‡†çš„Spring webFilterã€‚Spring Cloud Gatewayä¸­çš„Filteråˆ†ä¸ºä¸¤ç§ç±»å‹çš„Filterï¼Œåˆ†åˆ«æ˜¯Gateway Filterå’ŒGlobal Filter.ç½‘å…³ Filterå®ä¾‹æ˜¯ç”±Spring æ¡†æ¶ä¸­çš„ç½‘å…³Filterçš„ç‰¹æ®Šå·¥å‚æ„é€ ã€‚requeståœ¨è½¬å‘åˆ°ç›®å‰æœåŠ¡ä¹‹å‰ï¼Œresponseåœ¨è¿”å›åˆ°è°ƒç”¨ç«¯ä¹‹å‰éƒ½å¯ä»¥è¢«ä¿®æ”¹æˆ–è€…è‡ªå®šä¹‰ã€‚ 2.ä»€ä¹ˆæ˜¯Afterè·¯ç”±æ–­è¨€ After Route Predicate Factoryå¸¦æœ‰ä¸€ä¸ªUTCæ—¶é—´æ ¼å¼çš„æ—¶é—´å‚æ•°ï¼Œå½“è¯·æ±‚è¿›æ¥çš„å½“å‰æ—¶é—´åœ¨è·¯ç”±æ–­è¨€å·¥å‚ä¹‹åä¼šæˆåŠŸåŒ¹é…ï¼Œå¦åˆ™ä¸èƒ½æˆåŠŸåŒ¹é…ã€‚ 3.Afterè·¯ç”±æ–­è¨€å·¥å‚çš„æ¡ˆä¾‹3.1 å¼•å…¥pomä¾èµ–pom.xmlä¾èµ–é…ç½®å¦‚ä¸‹æ‰€ç¤º: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.M9&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; 3.2 application.ymlæ–‡ä»¶é…ç½®:123456789101112131415161718192021server: port: 8081spring: cloud: gateway: routes: - id: after_route uri: http://xujin.org predicates: - After=2018-03-18T17:32:58.129+08:00[Asia/Shanghai]logging: level: org.springframework.cloud.gateway: TRACE org.springframework.http.server.reactive: DEBUG org.springframework.web.reactive: DEBUG reactor.ipc.netty: DEBUGmanagement.endpoints.web.exposure.include: '*' Spring Cloud Gatewayæä¾›ä¸¤ç§æ–¹å¼å»é…ç½®Afterè·¯ç”±æ–­è¨€å·¥å‚ï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯ymlæ–‡ä»¶çš„é…ç½®æ–¹å¼ã€‚ 3.3 ç­‰ä»·çš„@Beané…ç½®123456789@Beanpublic RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123; ZonedDateTime minusTime = LocalDateTime.now().minusDays(1).atZone(ZoneId.systemDefault()); return builder.routes() .route(\"after_route\", r -&gt; r.after(minusTime) .uri(\"http://xujin.org\")) .build(); &#125; Spring Cloud Gatewayæä¾›ä¸¤ç§æ–¹å¼å»é…ç½®Afterè·¯ç”±æ–­è¨€å·¥å‚ï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯@Beançš„é…ç½®æ–¹å¼ã€‚ä¸ç®¡é€šè¿‡ymlæ–‡ä»¶é…ç½®æˆ–è€…é€šè¿‡@Beançš„æ–¹å¼é…ç½®æ˜¯ç­‰ä»·çš„ã€‚ 3.4 æµ‹è¯•å¦‚ä¸‹:è®¿é—®http://localhost:8081/æˆåŠŸè½¬å‘åˆ°http://xujin.org","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayæ­ç§˜ä¹‹å¤„ç†è¯·æ±‚æµç¨‹","slug":"sc/gw/gw02","date":"2018-03-17T06:00:00.000Z","updated":"2019-01-12T03:20:23.909Z","comments":true,"path":"sc/gw/gw02/","link":"","permalink":"http://xujin.org/sc/gw/gw02/","excerpt":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»æºç çš„è§’åº¦æ­ç§˜Spring Cloud Gatewayçš„æ€ä¹ˆå¤„ç†è¯·æ±‚æµç¨‹ã€‚","text":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»æºç çš„è§’åº¦æ­ç§˜Spring Cloud Gatewayçš„æ€ä¹ˆå¤„ç†è¯·æ±‚æµç¨‹ã€‚ 1.Spring Gatewayæ¦‚è¿° Spring Cloud Gatewayæ˜¯Springå®˜æ–¹åŸºäºSpring 5.0ï¼ŒSpring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼ŒSpring Cloud Gatewayæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚Spring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Netflix ZUULï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/åŸ‹ç‚¹ï¼Œå’Œé™æµç­‰ã€‚ 2. Spring Cloud gatewayè¯·æ±‚å…¥å£åˆ†æ ä¸ç®¡æ˜¯Zuulï¼Œè¿˜æ˜¯Spring Cloud Gatewayè¿˜æ˜¯åŸºäºNettyçš„è‡ªç ”ç½‘å…³ï¼Œéƒ½ä¼šæŠŠè¯·æ±‚è¿›æ¥çš„Requestï¼Œæˆ–è€…è¿”å›çš„Responseè¿›è¡ŒåŒ…è£…ï¼Œè½¬æ¢æå–ä¸ºç½‘å…³è¿è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œåœ¨Spring Cloud gatewayä¸­ç½‘å…³çš„ä¸Šä¸‹æ–‡ä¸ºServerWebExchangeã€‚ 2.1 å…¥å£HttpServerRequestå’ŒHttpServerResponseè½¬æ¢Spring Cloud Gatewayçš„è¯·æ±‚å…¥å£ï¼Œorg.springframework.http.server.reactive.ReactorHttpHandlerAdapter#applyæ–¹æ³• 123456789101112131415161718192021222324@Override public Mono&lt;Void&gt; apply(HttpServerRequest request, HttpServerResponse response) &#123; NettyDataBufferFactory bufferFactory = new NettyDataBufferFactory(response.alloc()); ServerHttpRequest adaptedRequest; ServerHttpResponse adaptedResponse; try &#123; adaptedRequest = new ReactorServerHttpRequest(request, bufferFactory); adaptedResponse = new ReactorServerHttpResponse(response, bufferFactory); &#125; catch (URISyntaxException ex) &#123; logger.error(\"Invalid URL \" + ex.getMessage(), ex); response.status(HttpResponseStatus.BAD_REQUEST); return Mono.empty(); &#125; if (adaptedRequest.getMethod() == HttpMethod.HEAD) &#123; adaptedResponse = new HttpHeadResponseDecorator(adaptedResponse); &#125; return this.httpHandler.handle(adaptedRequest, adaptedResponse) .doOnError(ex -&gt; logger.error(\"Handling completed with error\", ex)) .doOnSuccess(aVoid -&gt; logger.debug(\"Handling completed with success\")); &#125; PSï¼Œä»£ç æ¥æºäºspring-web-5.0.4.RELEASE.jaræ­¤æ–¹æ³•ä¸ºSpring Cloud Gatewayçš„è¯·æ±‚å…¥å£æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŠŠæ¥æ”¶åˆ°çš„HttpServerRequestæˆ–è€…æœ€ç»ˆéœ€è¦è¿”å›çš„HttpServerResponseï¼ŒåŒ…è£…è½¬æ¢ä¸ºReactorServerHttpRequestå’ŒReactorServerHttpResponseã€‚ 2.2 æ„é€ Spring Cloud gatewayçš„ä¸Šä¸‹æ–‡ServerWebExchangeåœ¨org.springframework.web.server.adapter.HttpWebHandlerAdapterçš„182è¡Œï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º: 1234567@Override public Mono&lt;Void&gt; handle(ServerHttpRequest request, ServerHttpResponse response) &#123; ServerWebExchange exchange = createExchange(request, response); return getDelegate().handle(exchange) .onErrorResume(ex -&gt; handleFailure(request, response, ex)) .then(Mono.defer(response::setComplete)); &#125; createExchange()å°†ServerHttpRequest ServerHttpResponseæ„å»ºç½‘å…³ä¸Šä¸‹æ–‡ServerWebExchangeã€‚ PS:å…¶ä¸­org.springframework.web.server.handler.WebHandlerDecorator.getDelegate()é€šè¿‡å§”æ‰˜çš„æ–¹å¼è·å–ä¸€ç³»åˆ—éœ€è¦å¤„ç†çš„WebHandler. 2.3 è¿›å…¥Filteré“¾org.springframework.cloud.gateway.handler.FilteringWebHandler#handleæ–¹æ³•ï¼Œå³77è¡Œï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º 12345678910111213@Overridepublic Mono&lt;Void&gt; handle(ServerWebExchange exchange) &#123; Route route = exchange.getRequiredAttribute(GATEWAY_ROUTE_ATTR); List&lt;GatewayFilter&gt; gatewayFilters = route.getFilters(); List&lt;GatewayFilter&gt; combined = new ArrayList&lt;&gt;(this.globalFilters); combined.addAll(gatewayFilters); //TODO: needed or cached? AnnotationAwareOrderComparator.sort(combined); logger.debug(\"Sorted gatewayFilterFactories: \"+ combined); return new DefaultGatewayFilterChain(combined).filter(exchange);&#125; 2.4 æ‰§è¡ŒFilteré“¾1234567891011121314151617181920private static class DefaultGatewayFilterChain implements GatewayFilterChain &#123; private int index; private final List&lt;GatewayFilter&gt; filters; public DefaultGatewayFilterChain(List&lt;GatewayFilter&gt; filters) &#123; this.filters = filters; &#125; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange) &#123; if (this.index &lt; filters.size()) &#123; GatewayFilter filter = filters.get(this.index++); return filter.filter(exchange, this); &#125; else &#123; return Mono.empty(); // complete &#125; &#125; &#125; 2.5 Gateway Filterå§”æ‰˜ä¸ºGloable Filteræ‰§è¡Œ123456789101112131415161718192021private static class GatewayFilterAdapter implements GatewayFilter &#123; private final GlobalFilter delegate; public GatewayFilterAdapter(GlobalFilter delegate) &#123; this.delegate = delegate; &#125; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; return this.delegate.filter(exchange, chain); &#125; @Override public String toString() &#123; final StringBuilder sb = new StringBuilder(\"GatewayFilterAdapter&#123;\"); sb.append(\"delegate=\").append(delegate); sb.append('&#125;'); return sb.toString(); &#125; &#125; 2.6 é¢„å‘Šå¾…ç»­åœ¨ä¹‹åçš„æ–‡ç« ä¸­ï¼Œå°†ä¼šæ­ç§˜Spring Cloud Gatewayçš„æ¶æ„è®¾è®¡ï¼ŒFilteré“¾è®¾è®¡ï¼Œä»¥åŠå¯åŠ¨è£…åœ¨æµç¨‹ç­‰ã€‚","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud æºç åˆ†æ","slug":"Spring-Cloud-æºç åˆ†æ","permalink":"http://xujin.org/tags/Spring-Cloud-æºç åˆ†æ/"},{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Gatewayå…¥é—¨æ¡ˆä¾‹","slug":"sc/gw/gw-01","date":"2018-03-15T06:00:00.000Z","updated":"2019-01-12T03:21:16.579Z","comments":true,"path":"sc/gw/gw-01/","link":"","permalink":"http://xujin.org/sc/gw/gw-01/","excerpt":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†ä»€ä¹ˆæ˜¯Spring Cloud Gatewayï¼Œå¹¶åŸºäºSpring Cloud Gatewayçš„Finchley.M8ç‰ˆæœ¬ç¼–å†™ä¸€ä¸ªSpring Cloud Gatewayçš„å…¥é—¨æ¡ˆä¾‹ï¼Œå³åŸºæœ¬ä»£ç†çš„è·¯ç”±è½¬å‘é…ç½®ã€‚","text":"æ‘˜è¦:æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†ä»€ä¹ˆæ˜¯Spring Cloud Gatewayï¼Œå¹¶åŸºäºSpring Cloud Gatewayçš„Finchley.M8ç‰ˆæœ¬ç¼–å†™ä¸€ä¸ªSpring Cloud Gatewayçš„å…¥é—¨æ¡ˆä¾‹ï¼Œå³åŸºæœ¬ä»£ç†çš„è·¯ç”±è½¬å‘é…ç½®ã€‚ 1.Spring Gatewayæ¦‚è¿°1.1 ä»€ä¹ˆæ˜¯Spring Cloud Gateway Spring Cloud Gatewayæ˜¯Springå®˜æ–¹åŸºäºSpring 5.0ï¼ŒSpring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼ŒSpring Cloud Gatewayæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚Spring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Netflix ZUULï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/åŸ‹ç‚¹ï¼Œå’Œé™æµç­‰ã€‚ 2. Spring Cloud Gatewayå…¥é—¨æ¡ˆä¾‹2.1 åˆ›å»ºmavenå·¥ç¨‹é…ç½®Spring Cloud Gatewayçš„ç›¸å…³Mavenä¾èµ– 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;ch18-1&lt;/artifactId&gt; &lt;groupId&gt;cn.springcloud.book&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;ch18-1-gateway&lt;/artifactId&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;ch18-1-gateway&lt;/name&gt; &lt;url&gt;http://springcloud.cn&lt;/url&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.M8&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-snapshots&lt;/id&gt; &lt;name&gt;Spring Snapshots&lt;/name&gt; &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt;&lt;/project&gt; 2.2 Spring Cloud Gatewayä¸»ç¨‹åºSpringCloudGatewayApplication.javaï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º: 12345678910111213141516171819202122232425package cn.springcloud.book.gateway;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.gateway.route.RouteLocator;import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;import org.springframework.context.annotation.Bean;@SpringBootApplicationpublic class SpringCloudGatewayApplication &#123; @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() //basic proxy .route(r -&gt; r.path(\"/baidu\") .uri(\"http://baidu.com:80/\") ).build(); &#125; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudGatewayApplication.class, args); &#125;&#125; 2.3 ç¼–å†™application.ymlæ–‡ä»¶123456789101112131415161718192021server: port: 8080spring: application: name: spring-cloud-gatewayspring: cloud: gateway: routes: - id: xujin_route uri: http://www.xujin.org:80/ predicates: - Path=/xujinlogging: level: org.springframework.cloud.gateway: TRACE org.springframework.http.server.reactive: DEBUG org.springframework.web.reactive: DEBUG reactor.ipc.netty: DEBUG 2.4 åŸºæœ¬ä»£ç†è·¯ç”±é…ç½®ç­‰åŒå†™æ³•Spring Cloud Gatewayæä¾›äº†ä¸¤ç§é…ç½®è·¯ç”±è§„åˆ™çš„æ–¹æ³• ç¬¬ä¸€:é€šè¿‡@Beanè‡ªå®šä¹‰RouteLocator12345678@Beanpublic RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() //basic proxy .route(r -&gt; r.path(\"/baidu\") .uri(\"http://baidu.com:80/\") ).build();&#125; ç¬¬äºŒ:é€šè¿‡å±äºæ–‡ä»¶æˆ–è€…ymlæ–‡ä»¶é…ç½® 12345678spring: cloud: gateway: routes: - id: xujin_route uri: http://www.xujin.org:80/ predicates: - Path=/xujin PS,ä»¥ä¸Šä¸¤ç§æ–¹å¼ç­‰åŒã€‚ 2.5 é”™è¯¯çš„ç¤ºèŒƒä»£ç å¦‚ä¸‹:12345678@Beanpublic RouteLocator routingConfig() &#123; return Routes.locator() .route(\"xujin_route\") .uri(\"http://xujin.org\") .predicate(host(\"**.xujin.org\")) .build();&#125; æ¸©é¦¨æç¤ºï¼Œä¸Šé¢è¿™ç§å†™æ³•æ˜¯åŸºäºSpring Cloud Gateway FM4çš„ç‰ˆæœ¬ï¼Œç›¸å…³ä»£ç å·²åºŸå¼ƒï¼Œç›®å‰Spring Cloud Gatewayå°†ä¼šåœ¨FM9ä¹‹åRealeseã€‚ 2.6 è¿è¡Œæµ‹è¯• è®¿é—®http://localhost:8080/baidu,è·¯ç”±è½¬å‘åˆ°http://www.baidu.com è®¿é—®http://localhost:8080/xujin,è·¯ç”±è½¬å‘åˆ°http://xujin.orgyml 12345678@Bean public RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() //basic proxy .route(r -&gt; r.path(\"/baidu\") .uri(\"http://baidu.com:80/\") ).build(); &#125; 12345678spring: cloud: gateway: routes: - id: xujin_route uri: http://www.xujin.org:80/ predicates: - Path=/xujin","categories":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/categories/Spring-Cloud-Gateway/"}],"tags":[{"name":"Spring Cloud æºç åˆ†æ","slug":"Spring-Cloud-æºç åˆ†æ","permalink":"http://xujin.org/tags/Spring-Cloud-æºç åˆ†æ/"},{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Mysqlæ‰¹é‡æ‰§è¡Œæ›´æ–°shellè„šæœ¬","slug":"ex/mysql-batch-update","date":"2018-02-17T06:00:00.000Z","updated":"2019-01-13T05:17:47.596Z","comments":true,"path":"ex/mysql-batch-update/","link":"","permalink":"http://xujin.org/ex/mysql-batch-update/","excerpt":"æ‘˜è¦:åœ¨ç”Ÿäº§ä¸Šæ‰§è¡Œæ›´æ–°sqlï¼Œå½“æ›´æ–°çš„æ•°æ®è¶…è¿‡ä¸Š100ä¸‡çš„æ—¶å€™ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œä¼šé€ æˆå¡è¡¨æˆ–è€…é”è¡¨ã€‚æœ¬æ–‡ä¸»è¦è®°å½•ä¸€ä¸ªäº†æ‰¹é‡æ›´æ–°MysqlæŸå¼ è¡¨çš„æ•°æ®çš„è„šæœ¬ä»£ç ç‰‡ã€‚","text":"æ‘˜è¦:åœ¨ç”Ÿäº§ä¸Šæ‰§è¡Œæ›´æ–°sqlï¼Œå½“æ›´æ–°çš„æ•°æ®è¶…è¿‡ä¸Š100ä¸‡çš„æ—¶å€™ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œä¼šé€ æˆå¡è¡¨æˆ–è€…é”è¡¨ã€‚æœ¬æ–‡ä¸»è¦è®°å½•ä¸€ä¸ªäº†æ‰¹é‡æ›´æ–°MysqlæŸå¼ è¡¨çš„æ•°æ®çš„è„šæœ¬ä»£ç ç‰‡ã€‚ mysqlçš„æ‰¹é‡æ‰§è¡Œæ›´æ–°1234567891011121314151617181920212223242526#!/bin/bash. ~/.bash_profilelog=/home/apps/update/update_log_1_$(date +%F).logvstart=1step=10000vstop=$(($&#123;vstart&#125;+$&#123;step&#125;))max=14800000echo \"stop value is $vstop\"while [ $&#123;vstart&#125; -lt $(($&#123;max&#125;+1)) ] do echo \"`date +%F-%T`; mysql -uusername -ppwd --default-character-set=utf8 -S /tmp/mysql3306.sock vip_dbname -e\\\"UPDATE tbname set limit_days=3, update_time=now() where pid between $&#123;vstart&#125; and $&#123;vstop&#125;\\\"\" &gt;&gt; $&#123;log&#125; /apps/svr/mysql5/bin/mysql -uusername -ppwd --default-character-set=utf8 -S /tmp/mysql3306.sock vip_dbname -e\"UPDATE tbname set limit_days=3, update_time=now() where pid between $&#123;vstart&#125; and $&#123;vstop&#125; \" vstart=$(($&#123;vstop&#125;+1)) vstop=$(($&#123;vstop&#125;+$&#123;step&#125;)) if [ $&#123;vstop&#125; -gt $&#123;max&#125; ]; then vstop=$&#123;max&#125; fi sleep 1 #echo \"start at $&#123;vstart&#125;, stop at $&#123;vstop&#125;\"done","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"mysql","slug":"mysql","permalink":"http://xujin.org/tags/mysql/"}]},{"title":"Spring Cloudä¸­åŸºäºSleuthçš„å‚æ•°é€ä¼ åŠŸèƒ½æ¢ç´¢","slug":"sc/sq/sc-gfb","date":"2018-01-16T06:00:00.000Z","updated":"2019-01-13T05:09:04.581Z","comments":true,"path":"sc/sq/sc-gfb/","link":"","permalink":"http://xujin.org/sc/sq/sc-gfb/","excerpt":"æ‘˜è¦:æœ¬æ–‡ç”±éƒ­èŠ³ç¢§æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»Spring Cloudä¸­åŸºäºSleuthçš„å‚æ•°é€ä¼ åŠŸèƒ½æ¢ç´¢çš„ç»å†å’Œç›¸å…³è§£å†³æ–¹æ¡ˆã€‚","text":"æ‘˜è¦:æœ¬æ–‡ç”±éƒ­èŠ³ç¢§æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»Spring Cloudä¸­åŸºäºSleuthçš„å‚æ•°é€ä¼ åŠŸèƒ½æ¢ç´¢çš„ç»å†å’Œç›¸å…³è§£å†³æ–¹æ¡ˆã€‚ ä¸€.éœ€æ±‚å¾®æœåŠ¡ç¯å¢ƒï¼Œæœ‰Aï¼ŒBï¼ŒCï¼ŒDå››ä¸ªæœåŠ¡ï¼Œè°ƒç”¨å…³ç³»ä¸ºï¼šA-&gt;B-&gt;C-&gt;Dã€‚ç”¨æˆ·åœ¨Açš„é¡µé¢é€‰æ‹©å½“å‰â€œè¯­è¨€â€ç¯å¢ƒä¸ºâ€œè‹±æ–‡â€,åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå…¶å®ƒå‡ ä¸ªæœåŠ¡éœ€è·å–åˆ°è¿™ä¸ªâ€œè¯­è¨€â€ä¿¡æ¯ã€‚ äºŒ.åˆ†æè¿™ä¸ªéœ€æ±‚è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç±»ä¼¼äºâ€œå‡»é¼“ä¼ èŠ±â€ï¼šå½“å‰æœåŠ¡ä»ä¸Šä¸€ä¸ªæœåŠ¡ä¸­è·å–å‚æ•°ï¼Œå¹¶ä¼ ç»™ä¸‹ä¸€ä¸ªæœåŠ¡ã€‚ä¸ªäººæ„Ÿè§‰åŸºæœ¬ä¸Šæ‰€æœ‰çš„RPCæ¡†æ¶éƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œåªæ˜¯ä»¥å‰SOAæ¶æ„ä¸‹ï¼ŒæœåŠ¡å±‚çº§æ¯”è¾ƒå°‘ï¼Œå°†â€œè¯­è¨€â€ã€â€œç™»é™†â€ç­‰é™„åŠ ä¿¡æ¯æ”¾åœ¨å‚æ•°åˆ—è¡¨ä¸­å¹¶ä¸ä¼šå¸¦æ¥å¤ªå¤šå·¥ä½œé‡ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯å¤ªçªå‡ºã€‚è€Œå¼•å…¥äº†å¾®æœåŠ¡æ¶æ„æ€æƒ³åï¼ŒæœåŠ¡è°ƒç”¨å±‚çº§æ€¥å‰§å¢é•¿ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªæ›´åŠ ä¼˜é›…çš„æ–¹å¼æ¥è§£å†³é™„åŠ ä¿¡æ¯çš„ä¼ é€’é—®é¢˜ã€‚ ä¸‰.æ–¹æ¡ˆæ¢ç´¢3.1 æ–¹æ¡ˆä¸€ï¼šå‚æ•°æ”¾åœ¨æ¥å£å‚æ•°åˆ—è¡¨ä¸­ä¼˜ç‚¹ï¼šæ€è·¯ç®€å•ï¼Œå¼€å‘æ²¡æœ‰å­¦ä¹ æˆæœ¬ ç¼ºç‚¹ï¼š ä»£ç é«˜åº¦è€¦åˆï¼šé™„åŠ ä¿¡æ¯å´è¦æ¯ä¸ªæ¥å£éƒ½æ˜¾å¼ç»´æŠ¤ å‡çº§å›°éš¾ï¼šå¦‚æœå°†æ¥å†åŠ ä¸€ä¸ªå‚æ•°ï¼Œæ‰€æœ‰å±‚çº§çš„æ¥éƒ½è¦æ”¹åŠ¨ å¼•èµ·è¿·æƒ‘ï¼šå¦‚æœBæœåŠ¡çš„é€»è¾‘ä¸éœ€è¦â€œè¯­è¨€â€œå‚æ•°ï¼Œä½†æ˜¯å› ä¸ºDéœ€è¦ï¼Œå®ƒä¹Ÿå¿…é¡»ç»´æŠ¤ å¤ªå‚»äº†ï¼ŒBigä¸å¤Ÿ æ€è€ƒï¼šå¾®æœåŠ¡ä¹‹é—´ç»å¤§å¤šæ•°æƒ…å†µæ˜¯é€šè¿‡HTTPè°ƒç”¨çš„ï¼ŒHTTPçš„headerä¸­ä¹Ÿå¯ä»¥æ”¾å‚æ•°ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæ¥å£å‚æ•°ä¸­å°±ä¸ç”¨ç»´æŠ¤è¿™äº›é™„åŠ ä¿¡äº†ã€‚ 3.2 æ–¹æ¡ˆäºŒï¼šå‚æ•°æ”¾åœ¨httpRequestçš„headerä¸­å®ç°ï¼š 1.è‡ªå®šä¹‰ä¸€ä¸ªFilterï¼Œè·å–Requestä¸­è‡ªå·±éœ€è¦çš„é™„åŠ ä¿¡æ¯ï¼Œ 2.å°†è¿™äº›ä¿¡æ¯æ”¾å…¥ThreadLocalä¸­, 3.å®ç°feign.Client(è¿™é‡Œå…ˆå¿½ç•¥RestTemplate)çš„execute()æ–¹æ³•ï¼Œå°†é™„ä»¶ä¿¡æ¯åœ¨è°ƒç”¨ä¸‹ä¸€å±‚æœåŠ¡å‰å¡å…¥requestçš„headerä¸­ ä¼˜ç‚¹ï¼šå‚æ•°è§£è€¦ ç¼ºç‚¹ï¼šå¦‚æœBåœ¨è·å–åˆ°é™„åŠ ä¿¡æ¯åï¼Œæ–°èµ·äº†ä¸€ä¸ªçº¿ç¨‹â€T1â€œæ¥è°ƒç”¨æœåŠ¡Cï¼Œè¿™æ—¶T1å°±æ— æ³•ä»HhreaLocalæ‹¿åˆ°é™„åŠ ä¿¡æ¯äº† æ€è€ƒï¼š å¦‚æœæˆ‘çŸ¥é“æ€ä¹ˆç”¨æ— ä¾µå…¥çš„æ–¹å¼ï¼Œåœ¨å½“å‰çº¿ç¨‹â€Tâ€åˆ›å»ºå­å­™çº¿ç¨‹â€T1â€ã€â€T1-1â€æ—¶ï¼Œå°†æ•°æ®ä¼ ç»™åä»£ï¼Œå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº† å¾®æœåŠ¡è°ƒç”¨é“¾æ¡†æ¶Sleuthçš„æ ¸å¿ƒåŠŸèƒ½å³æ˜¯è·Ÿè¸ªä¸€æ¬¡è¯·æ±‚ä»Aåˆ°Dçš„å…¨è¿‡ç¨‹ï¼Œå®ƒè‚¯å®šæ”¯æŒå¤šçº¿ç¨‹è°ƒç”¨ä¸‹çš„traceIdçš„ä¼ é€’ã€‚å› æ­¤ï¼Œæˆ‘å¯ä»¥å¤ç”¨Sleuthçš„ç›¸å…³åŠŸèƒ½å¤¹å¸¦ç§è´§ 3.3 æ–¹æ¡ˆä¸‰ï¼šä¿®æ”¹Sleuthæºç ï¼Œå°†é™„åŠ ä¿¡æ¯è·Ÿç€TraceIdä¸€èµ·å¾€åä¼ é€’ä¼˜ç‚¹ï¼š åŸç†ç®€å•ï¼Œä¸ç”¨è€ƒè™‘åº•å±‚å®ç° ä¸ç”¨è€ƒè™‘å…¼å®¹æ€§ç­‰é—®é¢˜ï¼ŒSleuthéƒ½å·²ç»å®ç°å¥½ å¿«(å¯¹ï¼Œå°±æ˜¯è¿™ä¸€ä¸ªå­—)ç¼ºç‚¹ï¼š ç»´æŠ¤å›°éš¾ï¼Œå¾ˆå®¹æ˜“å¿˜è®°ä»¥å‰ä¿®æ”¹äº†å“ªäº›åœ°æ–¹ï¼Œæ›´åˆ«æç§»äº¤ç»™åˆ«äººç»´æŠ¤äº† å‡çº§å›°éš¾ï¼Œä»¥åæ¯æ¬¡Springæˆ–è€…Sleuthå‡çº§ï¼Œéƒ½è¦é‡æ–°ä¸‹è½½æºç ä¿®æ”¹ æ€è€ƒï¼š ç›®å‰è·å–å‚æ•°çš„é—®é¢˜è§£å†³äº†ï¼Œç”¨Filterï¼Œåªå‰©ä¸‹ä¿å­˜å¹¶ä¼ ç»™ä¸‹ä¸€å±‚çš„é—®é¢˜ æ—¢ç„¶Sleuthå·²ç»è§£å†³äº†å¤šçº¿ç¨‹ä¸‹traceIdçš„ä¼ é€’é—®é¢˜ï¼Œé‚£æˆ‘å°±ç›´æ¥ç”¨traceIdæ¥è§£å†³æˆ‘çš„é—®é¢˜ 3.4 æ–¹æ¡ˆå››ï¼šå……åˆ†åˆ©ç”¨traceIdå®ç°ï¼š è‡ªå®šä¹‰Filter(ä¼˜å…ˆçº§è¦ä½äºTraceFilter,å› ä¸ºä½ è¦è·å–TraceFilteré‡Œçš„traceId)ï¼Œæ‹¿åˆ°traceIdå’Œé™„åŠ ä¿¡æ¯åï¼Œå°†å®ƒä»¬å­˜åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼ŒtraceIdä¸ºkeyï¼Œé™„åŠ ä¿¡æ¯ä¸ºvalue å‚è€ƒæ–¹æ¡ˆäºŒçš„å®ç°3ã€‚é‡å†™execute()æ–¹æ³•ï¼Œè·å–å½“å‰çº¿ç¨‹çš„traceId(è¿™ä¸ªSleuthæœ‰æ¥å£ï¼Œä¸å†ä»‹ç»)ï¼Œç„¶åå†é€šè¿‡traceIdå»æœ¬åœ°ç¼“å­˜ä¸­æ‹¿åˆ°é™„åŠ ä¿¡æ¯ï¼Œæ”¾è¿›Requestçš„headerä¸­ ä¼˜ç‚¹ï¼šæ‹¥æœ‰ä¸Šè¿°æ–¹æ¡ˆæ‰€æœ‰çš„ä¼˜ç‚¹,è§£å†³ä¸Šè¿°æ–¹æ¡ˆæ‰€æœ‰ç¼ºç‚¹ ç¼ºç‚¹ï¼šçœ‹ç€å¾ˆå®Œç¾ï¼Œä½†æ˜¯ä½ å¿½ç•¥äº†ä¸€ä»¶äº‹ï¼šSleuthè¦æƒ³ä¼ é€’è‡ªå·±çš„traceIdï¼Œæƒ³å¿…å®ƒå·²ç»é‡å†™äº†execute()æ–¹æ³•(è‚¯å®šçš„ï¼Œé‚£å°±æ˜¯TraceFeignClient)ï¼Œä½ è¦æƒ³ç”¨ï¼Œé‚£å°±è¦æƒ³åŠæ³•åœ¨å¤ç”¨TraceFeignClient.execute()çš„åŒæ—¶ï¼Œå°†è‡ªå·±çš„ç§è´§å¸¦è¿›å» 3.5 æ–¹æ¡ˆäº”ï¼šé‡å†™TraceFeignClientå®ç°ï¼šæœ‰æ—¶å€™ï¼Œæ”¹åŠ¨æºç å¹¶ä¸éœ€è¦ç›´æ¥åœ¨åŸæœ‰åŒ…é‡Œä¿®æ”¹ã€‚æ¯”å¦‚ï¼šA-&gt;B-&gt;C-&gt;Dï¼Œå¦‚æœä½ è¦ä¿®æ”¹Cçš„æºç ï¼Œé‚£å°±å°†ABæºç ä¹Ÿcopyå‡ºï¼Œä½œä¸ºA1,B1,C#ï¼Œç„¶åé‡å†™ç»„ä»¶çš„å…¥å£ï¼Œå°†ç»„ä»¶åŠ è½½é¡ºåºå˜ä¸ºï¼šA1-&gt;B1-&gt;C#-&gt;Dï¼Œå³å¯è¾¾åˆ°é‡å†™æºç çš„ç›®çš„ã€‚è¿™æ—¶å€™æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½A1çš„æ¡ä»¶å¿…é¡»è·ŸåŠ è½½Açš„ç›¸åã€‚å…·ä½“å¯å‚è€ƒæˆ‘ä¹‹å‰é‡å†™Consulçš„å…¥å£ä¾‹å­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ 123456@ConditionalOnExpression(\"$&#123;spring.cloud.consul.ribbon.enabled:true&#125;==false\")public class MyRibbonConsulAutoConfiguration &#123;&#125;// åŸæœ‰å…¥å£ï¼š@ConditionalOnProperty(value = \"spring.cloud.consul.ribbon.enabled\", matchIfMissing = true)public class RibbonConsulAutoConfiguration &#123;&#125; ç»¼ä¸Šï¼Œå¯ä»¥é‡å†™TraceFeigClientçš„å…¥å£ TraceFeignClientAutoConfiguration-&gt;TraceFeignObjectWrapper&gt;TraceFeignClient,å³å¯è¾¾åˆ°è‡ªå·±çš„ç›®çš„. ä¼˜ç‚¹ï¼šæ„Ÿè§‰äº‹å„¿åŸºæœ¬å°±æˆäº† ç¼ºç‚¹ï¼šé…ç½®ä¸ºfalseç”Ÿæ•ˆï¼Œä½¿ç”¨è€…ä¼šè§‰å¾—æ¯”è¾ƒæ€ª,Sleuthä»¿ä½›çŸ¥é“åˆ«äººä¼šè¿™ä¹ˆå¹²ä¼¼çš„ï¼Œå®ƒçš„ç±»çš„è®¿é—®æƒé™åŸºæœ¬éƒ½æ˜¯defaultï¼Œä¸ºäº†copyè¿‡æ¥çš„å‡ ä¸ªç±»èƒ½æ­£å¸¸ç¼–è¯‘é€šè¿‡ï¼Œä½ è¿˜è¦å†copyä¹ä¸ªå®ƒä»¬çš„ä¾èµ–ç±»,ç¨‹åºå¤ªä¸‘ æ€è€ƒ:çªç„¶æƒ³èµ·æ¥ï¼Œè¿˜æœ‰ä¸€ç§æ”¹ä»£ç çš„æ–¹å¼å«å­—èŠ‚ç æ›¿æ¢ï¼Œå¦‚æœæˆ‘èƒ½åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶ï¼Œå°†æˆ‘çš„execute()ç›´æ¥æ›¿æ¢æ‰Sleuthçš„execute(),å°±ä¸€åŠ³æ°¸é€¸äº† 3.6 æ–¹æ¡ˆå…­ï¼šå­—èŠ‚ç æ›¿æ¢ä»£æºç ä¿®æ”¹ä¼˜ç‚¹ï¼šé«˜å¤§ä¸Š,ä¸åœ¨æºç çº§æ›¿æ¢ï¼Œå´åœ¨å­—èŠ‚ç çº§æ›¿æ¢ï¼Œè™šè™šå®å® ç¼ºç‚¹ï¼šæ²¡è¿™ä¹ˆå¹²è¿‡ï¼Œæ€»è§‰å¾—è¯´ç€å®¹æ˜“åšç€éš¾ æ€è€ƒï¼šåŸºæœ¬ä¸Šè§‰å¾—æ–¹æ¡ˆäº”å·²ç»èƒ½è§£å†³é—®é¢˜äº†ã€‚æœ¬ç€ç²¾ç›Šæ±‚ç²¾çš„æ€åº¦ï¼Œå»æŠ€æœ¯ç¾¤é‡Œé—®äº†ä¸‹ï¼Œå¾ˆå¿«æœ‰å¤§ç¥å‘æ¥Demo,çœ‹è¿‡ä»£ç åé¡¿è§‰æƒ­æ„§ï¼šæˆ‘ä¸€ç›´åœ¨æƒ³æ€ä¹ˆé‡å†™TraceFeignClientçš„execute()ï¼Œå…¶å®è¿™ä¸ªexecute()çœŸæ­£åšhttpè¯·æ±‚æ—¶ï¼Œè°ƒç”¨çš„æ˜¯feign.Clientçš„å¦å¤–ä¸€ä¸ªå®ç°ç±»,æ³¨æ„é‚£å¥â€this.delegate.executeâ€ï¼Œåªè¦æƒ³åŠæ³•ç”¨è‡ªå·±çš„Clientæ›¿æ¢æ‰delegateå³å¯ 123456789101112131415161718192021222324252627282930private static final Log log = LogFactory.getLog(MethodHandles.lookup().lookupClass());private final Client delegate; @Overridepublic Response execute(Request request, Request.Options options) throws IOException &#123; String spanName = getSpanName(request); Span span = getTracer().createSpan(spanName); if (log.isDebugEnabled()) &#123; log.debug(\"Created new Feign span \" + span); &#125; try &#123; AtomicReference&lt;Request&gt; feignRequest = new AtomicReference&lt;&gt;(request); spanInjector().inject(span, new FeignRequestTextMap(feignRequest)); span.logEvent(Span.CLIENT_SEND); addRequestTags(request); Request modifiedRequest = feignRequest.get(); if (log.isDebugEnabled()) &#123; log.debug(\"The modified request equals \" + modifiedRequest); &#125; Response response = this.delegate.execute(modifiedRequest, options); logCr(); return response; &#125; catch (RuntimeException | IOException e) &#123; logCr(); logError(e); throw e; &#125; finally &#123; closeSpan(span); &#125;&#125; 3.7 æ–¹æ¡ˆä¸ƒï¼šæ›¿æ¢æ‰TraceFeigClientçš„delegateå³å¯ å®ç°:é€šè¿‡å†æ¬¡è®¤çœŸDebugæºç çŸ¥é“ï¼ŒTraceFeignClienté»˜è®¤ä¼šåŠ è½½ä½ çš„Clientå®ç°ç±»ä½œä¸ºdelegate(æ±—ï¼)ï¼Œå› æ­¤ä½ åªè¦ç›´æ¥å®ç°feign.Clientæ¥å£å³å¯ã€‚æˆ‘å·æ‡’äº†ä¸€æŠŠï¼Œè‡ªå·±å†™ä¸ªå®ç°ç±»ï¼Œç›´æ¥å¤ç”¨äº†LoadBalancerFeignClient.execute() ä¼˜ç‚¹:åŸºæœ¬ä»€ä¹ˆéƒ½æœ‰äº†å§ ç¼ºç‚¹:å¦‚æœä½ ä»¥ä¸ºåªæ˜¯ç®€å•åœ°é‡å†™ä¸ªexecute()å°±è¡Œï¼Œé‚£å°±å¤§é”™ç‰¹äº†ã€‚å› ä¸ºTraceFeignClientç›´æ¥ç”¨äº†ä½ çš„æ–¹æ³•postè¿‡å»ï¼Œå› æ­¤ä½ è¦æƒ³åŠæ³•æŠŠribbonæ‰‹åŠ¨é›†æˆè¿›æ¥ã€‚å¦‚æœä¸è§‰å¾—éº»çƒ¦çš„è¯ï¼Œå¯ä»¥å¥½å¥½çœ‹ä¸‹TraceFeignClientæ€ä¹ˆç”ŸæˆClientçš„å®ä¾‹ï¼šTraceFeignObjectWrapper.wrap(Object bean) æ€è€ƒ:æ—¢ç„¶ä½ å¯ä»¥åœ¨ç¨‹åºé‡Œè·å–åˆ°traceå’Œspanï¼Œé‚£ä¸ºä½•ä¸å°†ä½ çš„ä¿¡æ¯æ”¾åˆ°spané‡Œå‘¢ã€‚å¦‚æœspanä¸­èƒ½æ”¾ç‚¹é¢å¤–ä¿¡æ¯å°±å¥½äº†ï¼Œå°±ä¸ç”¨è‡ªå·±å†™è¿™ä¹ˆå¤šä¸œè¥¿ã€‚ç»å¤§ç¥æé†’ï¼ŒSleuthä¸­æœ‰ä¸ªbaggageå¯ä»¥è¯•è¯• 3.8 æ–¹æ¡ˆå…«ï¼šä½¿ç”¨baggage å®ç°:è·å–å‚æ•°çš„æ–¹å¼ä¸å˜ï¼Œå–å¾—çš„å‚æ•°æ”¾åœ¨baggageä¸­ ä¼˜ç‚¹:ç®€å•,æ”¯æŒRestTemplateè°ƒç”¨çš„æƒ…å†µ,è·Ÿå…¶ä»–ç»„ä»¶å…¼å®¹æ€§å¥½ ç¼ºç‚¹:Sleuthçš„ç¼ºç‚¹ å››.é¡¹ç›®æºç 4.1 åŸºäºsluethçš„å‚æ•°é€ä¼ æ’ä»¶Githubåœ°å€:https://github.com/bishion/sleuth-plugin ç®€ä»‹:å¾®æœåŠ¡ä¸‹ä½¿ç”¨,è°ƒç”¨è¿‡ç¨‹ä¸­ç”¨æˆ·ä¿¡æ¯ï¼Œé¡µé¢è¯­è¨€ä¿¡æ¯çš„é€ä¼ ä½¿ç”¨æ–¹å¼ 1234bizi: sleuth: config: headers: lang_info #å¦‚æœç”±å¤šä¸ªï¼Œé€—å·éš”å¼€.è¿™é‡Œé…ç½®ä»filteré‡Œéœ€è¦è·å–çš„headerName è°ƒç”¨æ–¹å¼ first_line:22 123456789101112@Servicepublic class SessionInfoService &#123; @Resource private SessionInfoOperator sessionInfoOperator; public String getLangInfo()&#123; return sessionInfoOperator.getSessionInfo(\"lang_info\"); &#125; public void setUserId()&#123; sessionInfoOperator.setSessionInfo(\"user_id\",\"bishion\"); &#125;&#125; äº”.ç•™ä¸‹çš„å‘ Sleuthé€šè¿‡LazyTraceExecutorè§£å†³å¤šçº¿ç¨‹ä¸‹çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰è§£å†³ç»™æ‰‹åŠ¨åˆ›å»ºçš„Threadä¼ é€’ä¿¡æ¯çš„é—®é¢˜ æœ‰æœºä¼šè¯•è¯•javaå­—èŠ‚ç æ›¿æ¢æ€ä¹ˆæ“ä½œ Sleuthå¦‚ä½•é‡å†™RestTemplateçš„ TraceFeignClientæ€ä¹ˆç”ŸæˆClientçš„å®ä¾‹ å…­.åè®°å› ä¸ºé™„åŠ ä¿¡æ¯çš„ä¼ é€’åœ¨RPCä¸­æ‰®æ¼”äº†å¾ˆé‡è¦çš„è§’è‰²ï¼Œæˆ‘æ½œæ„è¯†é‡Œè§‰å¾—ï¼Œè‚¯å®šä¼šæœ‰æ›´åŠ ç®€æ´çš„æ–¹æ³•æˆ–è€…æ¡†æ¶æˆ‘è¿˜æ²¡æœ‰äº†è§£åˆ°ã€‚å¸Œæœ›å„ä½å„ä½è¯»è€…è€å¸ˆèƒ½ä¸åç ç‰ï¼Œæ‰¹è¯„æŒ‡æ­£","categories":[{"name":"ç¤¾åŒº","slug":"ç¤¾åŒº","permalink":"http://xujin.org/categories/ç¤¾åŒº/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"}]},{"title":"Spring Cloud ä½¿ç”¨ HTTP2çš„æ€§èƒ½å‹æµ‹å¯¹æ¯”","slug":"sc/sq/sc-http2","date":"2017-12-17T06:00:00.000Z","updated":"2019-01-13T05:08:29.131Z","comments":true,"path":"sc/sq/sc-http2/","link":"","permalink":"http://xujin.org/sc/sq/sc-http2/","excerpt":"æ‘˜è¦:æœ¬æ–‡ç”±ä½•é¹°æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,æœ¬æ–‡ä¸»è¦æ˜¯å¯¹Spring Cloudä¸­çš„HTTP2çš„æ€§èƒ½è¿›è¡Œå‹æµ‹åˆ†æï¼Œç”Ÿæˆå‹æµ‹ç»“æœã€‚spring cloud ä½¿ç”¨ HTTP2æºç åœ°å€","text":"æ‘˜è¦:æœ¬æ–‡ç”±ä½•é¹°æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,æœ¬æ–‡ä¸»è¦æ˜¯å¯¹Spring Cloudä¸­çš„HTTP2çš„æ€§èƒ½è¿›è¡Œå‹æµ‹åˆ†æï¼Œç”Ÿæˆå‹æµ‹ç»“æœã€‚spring cloud ä½¿ç”¨ HTTP2æºç åœ°å€ ä¸€.Spring Cloud ä½¿ç”¨ HTTP2 æˆ‘æœ¬äººæ˜¯ä» Dubbo è½¬ç”¨ Spring cloudã€‚2016å¹´9æœˆå·¦å³åˆšæ¥è§¦ Spring cloudï¼Œé‚£ä¸ªæ—¶å€™è·Ÿå¤§å®¶ä¸€æ ·åšäº†å¾ˆå¤š dubbo vs Spring cloud çš„å¯¹æ¯”åˆ†æã€‚å½“æ—¶æœ€å¤§çš„ç–‘é—®æ˜¯æ€§èƒ½å¯¹æ¯”ï¼Œé—® Josh Long åç»­æœ‰æ— æ”¯æŒç±»ä¼¼äº dubbo çš„å…¶ä»–RPCã€åºåˆ—åŒ–åè®®ï¼Œä»–è¯´ HTTP2æ€§èƒ½å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œæ²¡æœ‰è®¡åˆ’æ”¯æŒã€‚å½“æ—¶æƒ³åˆ° HTTP2æ˜¯å¤šè·¯å¤ç”¨ï¼Œé•¿è¿æ¥ï¼Œæ€§èƒ½æŸå¤±ä»…ä»…æ˜¯åºåˆ—åŒ–ååºåˆ—åŒ–çš„åŒºåˆ«ï¼Œå› æ­¤å°±æ­¤æ‰“ä½æ²¡æœ‰æ·±å…¥æµ‹è¯•ã€‚ ä¸Šå‘¨åœ¨ W3ä¸Šçœ‹åˆ°å¼ ç¦çš„å¸–å­é‡Œè¯´åˆ° ServiceComboä»¥æ€§èƒ½é—®é¢˜ç¬¬ä¸€ä¸ªå°±æŠŠ Spring cloud æ·˜æ±°äº†ï¼ŒåŠ ä¸Šä¹‹å‰çš„dubbo vs Spring cloud æ€§èƒ½æµ‹è¯•ç»“æœï¼Œå°±æƒ³åˆ°ç”¨ HTTP2è¿›ä¸€æ­¥ä¼˜åŒ– Spring cloud æ€§èƒ½ã€‚å­°ä¼˜å­°åŠ£ï¼ŸDubbo VS Spring Cloudæ€§èƒ½æµ‹è¯•å¤§å¯¹å†³ï¼ äºŒ.å¯åŠ¨é¡ºåº2.1 å¯åŠ¨ config2.2 å¯åŠ¨ eureka2.3 å¯åŠ¨ provider2.4 å¯åŠ¨ consumerJDK9ä»¥ä¸‹ä¸é»˜è®¤æ”¯æŒHTTP2ï¼Œéœ€è¦æ·»åŠ å¯åŠ¨å‚æ•°ï¼š -Xbootclasspath/p:/Users/charles/.m2/repository/org/mortbay/jetty/alpn/alpn-boot/8.1.12-SNAPSHOT/alpn-boot-8.1.12-SNAPSHOT.jar ä¸‰.æµ‹è¯• HTTP23.1 æµ‹è¯•æœåŠ¡æä¾›è€…è®¿é—® https://localhost:8443/userè®¿é—® chrome://net-internals/#http2ç¡®è®¤æœåŠ¡å™¨HTTP2æ”¯æŒå·²ç»å¼€å¯ 3.2 æµ‹è¯•æœåŠ¡æ¶ˆè´¹è€…è®¿é—® http://localhost:18090/teståœ¨æœåŠ¡æä¾›è€…æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿— æ˜¯å¦æ˜¯ http2 åè®® 2017-12-17 11:36:59.479 INFO 663 â€” [ XNIO-2 task-7] c.g.c.s.p.p.controller.UserController : query all HTTP/2.0 [accept-language:en-US,en;q=0.9] [upgrade-insecure-requests:1] [Host:localhost:8443] [accept-encoding:gzip, deflate, br] [accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,/;q=0.8] [user-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36] 3.3 æµ‹è¯•æ€§èƒ½è®¿é—®ï¼š http://localhost:18090/test/count?thread=200&amp;api=test100 thread å¯ä»¥ä¸ºä»»æ„å€¼apiä¸º test10 test100 test1000æœåŠ¡æ¶ˆè´¹è€…æ§åˆ¶å°æŸ¥çœ‹ååé‡ å››.æ€§èƒ½å¯¹æ¯”4.1 æµ‹è¯• HTTP with SSL æ€§èƒ½å¯¹æ¯”provider bootstrap.properties æ³¨é‡Š server.http2.enabled=trueå’Œä¸Šé¢ä¸€æ ·è¿›è¡Œæ€§èƒ½æµ‹è¯• 4.2 æµ‹è¯• HTTP æ€§èƒ½å¯¹æ¯”provider bootstrap.properties æ³¨é‡Š server.http2.enabled=trueä»¥åŠä¸‹æ–¹æ‰€æœ‰é…ç½®é¡¹å’Œä¸Šé¢ä¸€æ ·è¿›è¡Œæ€§èƒ½æµ‹è¯• 4.3 æµ‹è¯• HTTP without Keep-Aliveä¿®æ”¹TestController æ¯æ¬¡ new RestTemplate (å…¶å®åœ¨ Header ä¸­æŒ‡å®š Connection=close å¯ä»¥å…³é—­ Keep-Alive ä½†æ˜¯ä¼šè¿è¡Œä¸€æ®µæ—¶é—´åè¶…æ—¶ error) new RestTemplate().getForObject(â€œhttp://127.0.0.1:8080/user/â€œ + api, String.class); // restTemplate.getForObject(â€œhttp://provider/user/â€œ + api, String.class); 4.4 æµ‹è¯•ç»“æœ ååé‡/ç§’ æµ‹è¯•ç»„åˆ HTTP without Keep-Alive HTTP with Keep-Alive HTTP+SSL HTTP2 T100 O10 1210 8850 3310 6320 T100 0100 1115 7525 2225 3410 T100 01000 950 2710 1150 1080 T200 010 1050 8650+error 4200+error 6120 T200 0100 1035 7250 330+error 3250 T200 01000 870 2650 495 930 åˆ†æï¼š æµ‹è¯•ç»“æœä¸ Josh Long æ‰€è¯´ä¸åŒï¼ŒHTTP2å¹¶ä¸èƒ½å¸¦æ¥æ€§èƒ½çš„æå‡ã€‚HTTP2 çš„å¤šè·¯å¤ç”¨ç›¸æ¯” HTTP1.1 Keep-Alive çš„â€å•è·¯å¤ç”¨â€ç›¸æ¯”ä¼˜åŠ¿å¹¶ä¸å¤§ï¼Œåè€Œå¸¦æ¥äº† SSL åŠ è§£å¯†çš„æ€§èƒ½æŸå¤±(HTTP2åè®®æœ¬èº«ä¸è¦æ±‚ SSLï¼Œä½†æ˜¯ç›®å‰å®ç°å‡ä¸º HTTP2å¼ºåˆ¶ SSL)ã€‚HTTP2å¤šè·¯å¤ç”¨å¯ä»¥èŠ‚çœé“¾æ¥ï¼Œé¿å…é“¾æ¥è¶…å®¹å™¨ä¸Šé™ã€‚ HTTP2+SSL ç›¸æ¯” HTTP1.1+SSL æœ‰æ€§èƒ½ä¼˜åŠ¿ï¼Œä½†æ˜¯é’ˆå¯¹ Spring cloud å†…éƒ¨è°ƒç”¨åœºæ™¯æˆ‘ä»¬å¹¶ä¸ä¼šå¼€å¯ HTTPSï¼Œå› æ­¤æ˜¯ä¸ªåºŸçš„ï¼Œåœ¨æ­¤åœºæ™¯ä¹‹ä¸‹æœ€ä½³é€‰æ‹©æ˜¯ HTTP1.1 + Keep-Aliveã€‚ åŸæ–‡é“¾æ¥:http://www.jianshu.com/p/ed3f8f983764","categories":[{"name":"ç¤¾åŒº","slug":"ç¤¾åŒº","permalink":"http://xujin.org/categories/ç¤¾åŒº/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"},{"name":"http2","slug":"http2","permalink":"http://xujin.org/tags/http2/"}]},{"title":"åŸºäºSpring Cloudçš„å‡ ä¸ªè‡ªç ”å¾®æœåŠ¡ç»„ä»¶","slug":"sc/sq/sc-zyzj","date":"2017-12-14T06:00:00.000Z","updated":"2019-01-13T05:09:47.660Z","comments":true,"path":"sc/sq/sc-zyzj/","link":"","permalink":"http://xujin.org/sc/sq/sc-zyzj/","excerpt":"æ‘˜è¦:æœ¬æ–‡ç”±å®œä¿¡-æŠ€æœ¯ç ”å‘ä¸­å¿ƒ-é«˜çº§æ¶æ„å¸ˆ-æ¢é‘«æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,ä¹‹å‰åˆ†äº«äº†ä¸€ä¸‹æˆ‘åœ¨å…¬å¸é¡¹ç›®ä¸­æ­å»ºSpring Cloudæ¡†æ¶çš„ç»éªŒï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œä¸ºäº†æ›´å¥½çš„æ»¡è¶³ä¸šåŠ¡åŠŸèƒ½éœ€æ±‚å’Œä¾¿æ·è¿ç»´çš„éœ€è¦ï¼Œæˆ‘ä»¬å¼€å‘äº†å‡ ä¸ªåŸºäºspringcloudçš„å¾®æœåŠ¡ç»„ä»¶ï¼Œåœ¨æ­¤åšä¸ªæ€»ç»“è·Ÿå¤§å®¶å…±åŒæ¢è®¨ä¸€ä¸‹ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ç”±å®œä¿¡-æŠ€æœ¯ç ”å‘ä¸­å¿ƒ-é«˜çº§æ¶æ„å¸ˆ-æ¢é‘«æŠ•ç¨¿åˆ†äº«ã€‚æŠ•ç¨¿è¯·åŠ å¾®ä¿¡Software_King,ä¹‹å‰åˆ†äº«äº†ä¸€ä¸‹æˆ‘åœ¨å…¬å¸é¡¹ç›®ä¸­æ­å»ºSpring Cloudæ¡†æ¶çš„ç»éªŒï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œä¸ºäº†æ›´å¥½çš„æ»¡è¶³ä¸šåŠ¡åŠŸèƒ½éœ€æ±‚å’Œä¾¿æ·è¿ç»´çš„éœ€è¦ï¼Œæˆ‘ä»¬å¼€å‘äº†å‡ ä¸ªåŸºäºspringcloudçš„å¾®æœåŠ¡ç»„ä»¶ï¼Œåœ¨æ­¤åšä¸ªæ€»ç»“è·Ÿå¤§å®¶å…±åŒæ¢è®¨ä¸€ä¸‹ã€‚ åŸºäºSpringCloudçš„å‡ ä¸ªè‡ªç ”å¾®æœåŠ¡ç»„ä»¶ä¸€.åº”ç”¨ç®¡ç†ä¸­å¿ƒé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ä»¥åï¼ŒæŠŠåŸå…ˆå•ä¸€çš„èŠ‚ç‚¹æ‹†è§£æˆäº†å¤šä¸ªå¾®æœåŠ¡èŠ‚ç‚¹ã€‚å…¬å¸è™½ç„¶æœ‰ä¸€é”®å‘å¸ƒå¹³å°ï¼Œä½†æ˜¯æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹é‡‡å–å•ç‹¬çš„å‘å¸ƒï¼Œå¯åŠ¨ï¼Œåœæ­¢æ“ä½œï¼Œæ²¡æœ‰å…¨å±€åŒ–ç»Ÿä¸€ç®¡ç†åŠŸèƒ½ã€‚ä¸Šçº¿è¿ç»´çš„å·¥ä½œé‡å°±å˜çš„éå¸¸åºå¤§ï¼Œå› æ­¤æˆ‘ä»¬å¼€å‘äº†åŸºäºspringcloudçš„åº”ç”¨ç®¡ç†ä¸­å¿ƒæ¥æ–¹ä¾¿æˆ‘ä»¬çš„å·¥ä½œã€‚ 1.1 å®ç°æœºåˆ¶ æ¯ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œå°†è‡ªèº«çš„è¿›ç¨‹IDï¼Œå½“å‰è·¯å¾„ï¼ŒJDKè·¯å¾„ï¼Œjaråç§°ï¼Œç³»ç»Ÿç”¨æˆ·ï¼ŒIPåœ°å€ï¼Œç«¯å£å·æ³¨å†Œåˆ°zookeeper; åº”ç”¨ç®¡ç†ä¸­å¿ƒä»zookeeperä¸­æŸ¥è¯¢åˆ°æ‰€æœ‰çš„å¾®æœåŠ¡è¿›ç¨‹ä¿¡æ¯ï¼› è·å–ä¿¡æ¯åæ„é€ å¯åŠ¨å‘½ä»¤ï¼Œåœæ­¢å‘½ä»¤ï¼› åœ¨æ•°æ®åº“ä¿å­˜ç³»ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ï¼› åœ¨éƒ¨ç½²æ—¶æŒ‡å®šgitåœ°å€ï¼Œåˆ†æ”¯ï¼ŒIPç­‰è°ƒç”¨jenkinsï¼Œç¼–è¯‘ç”Ÿæˆæœ€æ–°jaråŒ…æ‹·è´åˆ°ç›®æ ‡æœåŠ¡å™¨æŒ‡å®šä½ç½®ï¼› é€šè¿‡è¿œç¨‹jschè¿œç¨‹æ‰§è¡Œshellå‘½ä»¤å¯¹å¾®æœåŠ¡è¿›ç¨‹è¿›è¡Œæ“ä½œã€‚ 1.2 åŠŸèƒ½åŸç† 1.3 æ•ˆæœå›¾ äºŒ.å¾®æœåŠ¡å¥åº·æ£€æµ‹ä¸­å¿ƒåŸºäºactuatoræˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„é’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå½“å‡ºç°é—®é¢˜æ—¶åŠæ—¶æŠ¥è­¦ã€‚ 2.1 å®ç°æœºåˆ¶ ä¿è¯æ‰€æœ‰çš„å¾®æœåŠ¡èŠ‚ç‚¹éƒ½åŠ è½½äº†actuator; ä»eurekaä¸­è·å–æ‰€æœ‰çš„å¾®æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼› å®šæ—¶ä»»åŠ¡è½®è¯¢è¯·æ±‚æ¯ä¸ªå¾®æœåŠ¡çš„healthä¿¡æ¯ï¼› Healthè¿”å›statusæ ‘å£®ç»“æ„ä¿¡æ¯ï¼› å¦‚æœstatusçŠ¶æ€ä¸ºdownå‘é€æŠ¥è­¦å¹¶åŒ…å«healthå®Œæ•´ä¿¡æ¯ã€‚ 2.2 åŠŸèƒ½åŸç† 2.3 æ•ˆæœå›¾æˆ‘ä»¬åœ¨å¥åº·æ£€æµ‹ä¸­å¿ƒä¸­åŒæ—¶åŠ è½½äº†spring boot admin,å¯ä»¥éšæ—¶æŸ¥çœ‹å¾®æœåŠ¡èŠ‚ç‚¹çš„æ‰€æœ‰è¿è¡Œä¿¡æ¯ã€‚ 2.4 éƒ¨åˆ†æºç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@Scheduled(initialDelay = 10000L, fixedRate = 60000L)public void scheduledTaskHandler() &#123; long begin = System.currentTimeMillis(); List&lt;String&gt; items = getIPAndPorts(); for (String IPAndPort : items) &#123; LOGGER.info(\"prepare checking \" + IPAndPort); if (IPAndPort.isEmpty()) &#123; LOGGER.warn(\"checking \" + IPAndPort + \" is empty\"); continue; &#125; try &#123; String[] item = IPAndPort.split(\":\"); String info = healthService.getHealthInfo(item[0], item[1]); String prettyjson = getPrettyJSON(info); ObjectMapper mapper = new ObjectMapper(); @SuppressWarnings(\"rawtypes\") Map&lt;?, ?&gt; infoMap = mapper.readValue(info, new TypeReference&lt;Map&gt;() &#123; &#125;); if (infoMap.containsKey(STATUS)) &#123; String status = infoMap.get(STATUS).toString(); if (status.equals(UP)) &#123; LOGGER.info(\"checking \" + IPAndPort + \" is UP:\\n\" + prettyjson); continue; &#125; &#125; emailService.sendLimitedEmail(prettyjson, IPAndPort, IPAndPort, 10 * 60 * 1000L); LOGGER.info(\"checking \" + IPAndPort + \" is DOWN:\\n\" + prettyjson); &#125; catch (feign.RetryableException ex) &#123; String content = exception2String(ex); emailService.sendEmail(content, \"ç¨‹åºè¿è¡Œå¼‚å¸¸\"); LOGGER.info(\"checking \" + IPAndPort + \" is DOWN\"); LOGGER.error(\"\", ex); &#125; catch (FeignException fex) &#123; String body = getBodyFromFeignException(fex); String prettybody = getPrettyJSON(body); emailService.sendLimitedEmail(prettybody, IPAndPort, IPAndPort, 10 * 60 * 1000L); LOGGER.info(\"checking \" + IPAndPort + \" is DOWN:\\n\" + prettybody); LOGGER.error(\"\", fex); &#125; catch (Exception ex) &#123; String content = exception2String(ex); emailService.sendEmail(content, \"ç¨‹åºè¿è¡Œå¼‚å¸¸\"); LOGGER.info(\"checking \" + IPAndPort + \" is DOWN\"); LOGGER.error(\"\", ex); &#125; &#125; LOGGER.info(\"SkytrainHealthChecking cost: \" + (System.currentTimeMillis() - begin) + \" Millis\");&#125; ä¸‰.å®šæ—¶ä»»åŠ¡ç®¡ç†ä¸­å¿ƒæˆ‘ä»¬éœ€è¦å»ºç«‹å®šæ—¶ä»»åŠ¡å…¨å±€è§†å›¾ï¼Œå¹¶å¸Œæœ›å¯¹æ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å…·å¤‡å¯åœçš„èƒ½åŠ›ã€‚æˆ‘ä»¬é‡‡ç”¨äº†é€šè¿‡ç»§æ‰¿ç»Ÿä¸€çš„AbstractScheduledTaskï¼Œæš´éœ²å®šæ—¶ä»»åŠ¡çš„å¯åŠ¨ï¼Œåœæ­¢æ¥å£ã€‚è®©æ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è‡ªåŠ¨å…·å¤‡çš„å¯åœåŠŸèƒ½ã€‚ 3.1 å®ç°æœºåˆ¶ é€šè¿‡BeanPostProcessoråœ¨beanåˆå§‹å®Œæˆåæ‹¦æˆªæ‰€æœ‰çš„@Scheduledæ³¨è§£ï¼Œè·å–ipï¼Œportï¼ŒapplicationNameï¼ŒclassNameï¼ŒbeanNameï¼Œscheduledç­‰ä¿¡æ¯æ³¨å†Œåˆ°zookeeperï¼› å®šæ—¶ä»»åŠ¡å®ç°ç»§æ‰¿AbstractScheduledTaskInteræ¥å£ï¼Œæš´éœ²startScheduledTaskå’ŒstopScheduledTaskï¼Œå¯ä»¥é’ˆå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œå¯åŠ¨åœæ­¢ï¼› å®ç°åŸºå‡†TaskScheduledControllerç±»ï¼Œé€šè¿‡beanNameè·å–å®šæ—¶ä»»åŠ¡ç±»ï¼Œè°ƒç”¨è¯¥ç±»çš„å¯åŠ¨åœæ­¢æ–¹æ³•ï¼› å®šæ—¶ä»»åŠ¡ç®¡ç†ä¸­å¿ƒæŸ¥è¯¢zookeeperå±•ç¤ºå…¨å±€æ³¨å†Œçš„å®šæ—¶ä»»åŠ¡ï¼Œæä¾›å¯åŠ¨åœæ­¢æ“ä½œå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œæ§åˆ¶ï¼› å®šæ—¶ä»»åŠ¡åˆ†ä¸ºå…¨å±€å”¯ä¸€å®šæ—¶ä»»åŠ¡å’Œéå”¯ä¸€å®šæ—¶ä»»åŠ¡ã€‚ 3.2 åŠŸèƒ½åŸç† 3.3 æ•ˆæœå›¾ 3.4 éƒ¨åˆ†æºç  è·å–å®šæ—¶ä»»åŠ¡ 12345678910111213141516171819202122232425262728public Object postProcessAfter(Object bean, String beanName) &#123; Class&lt;?&gt; targetClass = AopUtils.getTargetClass(bean); Map&lt;Method, Set&lt;Scheduled&gt;&gt; annotatedMethods = MethodIntrospector.selectMethods(targetClass, new MethodIntrospector.MetadataLookup&lt;Set&lt;Scheduled&gt;&gt;() &#123; public Set&lt;Scheduled&gt; inspect(Method method) &#123; Set&lt;Scheduled&gt; scheduledMethods = AnnotatedElementUtils.getMergedRepeatableAnnotations(method, Scheduled.class, Schedules.class); return (!scheduledMethods.isEmpty() ? scheduledMethods : null); &#125; &#125;); if (!annotatedMethods.isEmpty()) &#123; String className = targetClass.getName(); className = SpringBeanUtil.getNormalClassName(className); for (Map.Entry&lt;Method, Set&lt;Scheduled&gt;&gt; entry : annotatedMethods.entrySet()) &#123; Method method = entry.getKey(); for (Scheduled scheduled : entry.getValue()) &#123; String key = className + \":\" + method.getName(); Map&lt;String, String&gt; scheduledMap = new HashMap&lt;String, String&gt;(); scheduledMap.put(\"className\", className); scheduledMap.put(\"methodName\", method.getName()); scheduledMap.put(\"beanName\", beanName); scheduledMap.put(\"scheduled\", scheduled.toString()); taskInfos.put(key, scheduledMap); &#125; &#125; &#125; return null;&#125; AbstractScheduledTask 123456789101112131415161718192021222324252627282930313233343536373839public abstract class AbstractScheduledTask implements AbstractScheduledTaskInter &#123; ... public boolean scheduledTaskStatus = true; public Object startScheduledTask() &#123; scheduledTaskStatus = true; updateRegisterTaskStatus(scheduledTaskStatus); return String.valueOf(scheduledTaskStatus); &#125; public Object stopScheduledTask() &#123; scheduledTaskStatus = false; updateRegisterTaskStatus(scheduledTaskStatus); return String.valueOf(scheduledTaskStatus); &#125; public void updateRegisterTaskStatus(boolean status) &#123; try &#123; String className = this.getClass().getName(); className=SpringBeanUtil.getNormalClassName(className); ... &#125; catch (JSONException e) &#123; LOGGER.error(e.getMessage(), e); &#125; &#125; public boolean isRegister = false; public boolean isRegister() &#123; if (isRegister) &#123; return true; &#125; ... &#125; public void scheduledTaskController() &#123; if (isRegister()) &#123; if (scheduledTaskStatus) &#123; scheduledTaskHandler(); &#125; &#125; &#125; public abstract void scheduledTaskHandler();&#125; å…·å¤‡å¯åœèƒ½åŠ› 123456789101112131415@Controllerpublic class TaskScheduledController &#123; @RequestMapping(value = \"/start_scheduled_task\", produces = \"application/json;charset=UTF-8\") @ResponseBody public Object start(@RequestParam() String beanName) &#123; AbstractScheduledTaskInter scheduledTask = SpringBeanUtil.getBean(beanName); return scheduledTask.startScheduledTask(); &#125; @RequestMapping(value = \"/stop_scheduled_task\", produces = \"application/json;charset=UTF-8\") @ResponseBody public Object stop(@RequestParam() String beanName) &#123; AbstractScheduledTaskInter scheduledTask = SpringBeanUtil.getBean(beanName); return scheduledTask.stopScheduledTask(); &#125;&#125; å››.å…¨å±€çƒ­å¤‡é”æ— è®ºå®šæ—¶ä»»åŠ¡è¿˜æ˜¯æ™®é€šè·‘æ‰¹ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›ä»»åŠ¡å®ç°çƒ­å¤‡ï¼Œä»¥ä¾¿åœ¨å•ç‚¹æ•…éšœæ—¶ä»»åŠ¡ä¾ç„¶å¯ä»¥é¡ºåˆ©çš„æ‰§è¡Œã€‚ 4.1 å®ç°æœºåˆ¶ å…¨å±€çƒ­å¤‡é”åŒ…æ‹¬æ™®é€šä»»åŠ¡ï¼ˆä¾‹å¦‚ç›‘å¬rabbitmqæ¶ˆæ¯ï¼‰å’Œå®šæ—¶ä»»åŠ¡ï¼› ä»»åŠ¡ä»¥applicationNameå’ŒclassNameæ ‡è¯†å”¯ä¸€ï¼Œä»»åŠ¡å¯åŠ¨æ—¶æŠŠç›¸å…³ä¿¡æ¯æ³¨å†Œåˆ°zookeeperï¼› å…¶ä»–èŠ‚ç‚¹çš„ä»»åŠ¡å¯åŠ¨æ—¶å‘ç°å·²ç»æœ‰ä»»åŠ¡è¿è¡Œï¼Œåˆ™ç›‘å¬zookeeperï¼› è¿è¡Œä»»åŠ¡åœæ­¢åï¼Œå…¶å®ƒèŠ‚ç‚¹æ ¹æ®ç›‘å¬çŠ¶æ€å¯åŠ¨è‡ªèº«ä»»åŠ¡ï¼› å®šæ—¶ä»»åŠ¡å’Œæ™®é€šä»»åŠ¡ä¸åŒï¼Œå®šæ—¶ä»»åŠ¡éœ€è¦æ³¨å†Œéè¿è¡ŒèŠ‚ç‚¹ï¼Œå¹¶å¯¹å­èŠ‚ç‚¹æ•°ç›®å˜åŒ–å’Œå­èŠ‚ç‚¹æ•°æ®å˜åŒ–éƒ½åšç›‘å¬ã€‚ 4.2 åŠŸèƒ½åŸç† 4.3 æ•ˆæœå›¾ 4.4 éƒ¨åˆ†æºç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Componentpublic abstract class AbstractGlobalLockTask implements CommandLineRunner &#123; ... public void register(final String... strings) &#123; String className = getClass().getName(); className = SpringBeanUtil.getNormalClassName(className); final String alarmConfigPath = SKYTRAIN_GlOBAL_LOCK_TASK_PREFIX + applicationName + \":\" + className; boolean exists = zooKeeperExecutor.isExists(alarmConfigPath); if (!exists) &#123; JSONObject info = new JSONObject(); try &#123; info.put(\"applicationName\", applicationName); info.put(\"className\", className); info.put(\"ip\", ipAddress); info.put(\"port\", serverPort); info.put(\"date\", new Date()); &#125; catch (JSONException e) &#123; LOGGER.error(e.getMessage(), e); &#125; createGlobalLockNode(alarmConfigPath, info.toString(), strings); &#125; else &#123; try &#123; zooKeeperExecutor.getZooKeeper().exists(alarmConfigPath, new Watcher() &#123; public void process(WatchedEvent watchedEvent) &#123; LOGGER.info(\"äº‹ä»¶ç±»å‹\" + watchedEvent.getType() + \"ï¼Œè·¯å¾„\" + watchedEvent.getPath()); try &#123; register(strings); &#125; catch (Exception e) &#123; LOGGER.error(\"\", e); &#125; &#125; &#125;); &#125; catch (KeeperException e) &#123; LOGGER.error(e.getMessage(), e); &#125; catch (InterruptedException e) &#123; LOGGER.error(e.getMessage(), e); &#125; &#125; &#125; public void createGlobalLockNode(String path, String value, String... strings) &#123; zooKeeperExecutor.createZKNode(path, value); handler(strings); &#125; public void run(String... strings) throws Exception &#123; register(strings); &#125; public abstract void handler(String... strings);&#125; ä½œè€…ï¼šå®œä¿¡-æŠ€æœ¯ç ”å‘ä¸­å¿ƒ-é«˜çº§æ¶æ„å¸ˆ-æ¢é‘«","categories":[{"name":"ç¤¾åŒº","slug":"ç¤¾åŒº","permalink":"http://xujin.org/categories/ç¤¾åŒº/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"},{"name":"Spring Cloudè‡ªç ”ç»„ä»¶","slug":"Spring-Cloudè‡ªç ”ç»„ä»¶","permalink":"http://xujin.org/tags/Spring-Cloudè‡ªç ”ç»„ä»¶/"}]},{"title":"èµ°è¿›Spring Cloud CodeGenä¸Šç¯‡","slug":"ex/sc-codegen","date":"2017-12-13T06:00:00.000Z","updated":"2019-01-13T05:21:29.532Z","comments":true,"path":"ex/sc-codegen/","link":"","permalink":"http://xujin.org/ex/sc-codegen/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»ç”±Spring Cloudä¸­å›½ç¤¾åŒºå‘èµ·çš„ä»¥Spring Cloudä¸ºä¸»çš„ä»£ç ç”Ÿæˆå™¨ï¼Œç›®çš„æ˜¯å¿«é€Ÿï¼ŒæŒ‰éœ€å‹¾é€‰ï¼Œç”Ÿæˆæœ€ä¼˜å®è·µçš„Spring Cloudå·¥ç¨‹ã€‚æ¬¢è¿æœ‰æƒ³æ³•çš„å°ä¼™ä¼´åŠ å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¼€æºæˆ˜é˜Ÿï¼Œå…³äºä»£ç ç”Ÿæˆå™¨å’Œspring-cloud-codegençš„è®¾è®¡ç»†èŠ‚åé¢å°†æœ‰ä¸€ç³»åˆ—çš„æ–‡ç« ä»‹ç»ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»ç”±Spring Cloudä¸­å›½ç¤¾åŒºå‘èµ·çš„ä»¥Spring Cloudä¸ºä¸»çš„ä»£ç ç”Ÿæˆå™¨ï¼Œç›®çš„æ˜¯å¿«é€Ÿï¼ŒæŒ‰éœ€å‹¾é€‰ï¼Œç”Ÿæˆæœ€ä¼˜å®è·µçš„Spring Cloudå·¥ç¨‹ã€‚æ¬¢è¿æœ‰æƒ³æ³•çš„å°ä¼™ä¼´åŠ å…¥Spring Cloudä¸­å›½ç¤¾åŒºå¼€æºæˆ˜é˜Ÿï¼Œå…³äºä»£ç ç”Ÿæˆå™¨å’Œspring-cloud-codegençš„è®¾è®¡ç»†èŠ‚åé¢å°†æœ‰ä¸€ç³»åˆ—çš„æ–‡ç« ä»‹ç»ã€‚ ä¸€.Spring Cloud CodeGenæ¦‚è¿°1.1 ä¸ºä»€ä¹ˆè¦å¼€å‘Spring Cloud CodeGen å¦‚ä½•ç”Ÿæˆé¡¹ç›®çš„ä»£ç ï¼Ÿ ä¸å°‘å¼€å‘äººå‘˜éƒ½ä¼šä½¿ç”¨Mavençš„Archetypeæˆ–IDEAçš„Gradleæ’ä»¶ï¼Œé€šè¿‡å‡ ä¸ªç®€å•çš„äº¤äº’å°±å¯ä»¥å¿«é€Ÿå®Œæˆé¡¹ç›®çš„ç»“æ„å’Œå¯¹åº”çš„ä»£ç ç”Ÿæˆã€‚ä½†æ˜¯Springå®˜æ–¹ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†http://start.spring.io ç”Ÿæˆï¼Œé“ç†å¾ˆç®€å•ï¼šUIå¯è§†åŒ–ï¼Œé€‰æ‹©é¡¹å¤šï¼Œæ›´æ–°å¿«ã€‚ä½†æ˜¯ä¾‹å¦‚:application.propertiesæ–‡ä»¶çš„ç”Ÿæˆ,å®˜æ–¹æ˜¯ä¸ä¼šç”Ÿæˆå¯¹åº”çš„é…ç½®é¡¹çš„ å› æ­¤ä¹Ÿæœ‰ä¸å°‘å…¬å¸å¯¹å…¶è¿›è¡Œä»£ç å¢å¼ºå¤„ç†äºŒæ¬¡å¼€å‘å¤„ç†ã€‚ æ ¹æ®ç›®å‰ç¤¾åŒºå’Œç°åœ¨ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨çš„ç°çŠ¶ï¼Œè¿«åˆ‡å¸Œæœ›æ‰“é€ ä¸€ä¸ªå¦‚ä¸‹çš„ä»£ç ç”Ÿæˆå™¨: ä¸šç•Œæœ€ä½³Spring Cloudå¾®æœåŠ¡å®æˆ˜ç»éªŒæ‰“é€ æœ€ä½³ä»£ç ç”Ÿæˆæ¨¡æ¿ å®¹å™¨åŒ–/Dockeræ”¯æŒï¼š æ ¹æ®ä½ é€‰æ‹©çš„dependencyï¼Œè‡ªåŠ¨ç”Ÿæˆdocker-compose.ymlæ–‡ä»¶ï¼Œå¦‚é€‰æ‹©mysqlï¼Œredisç­‰ï¼Œä¼šåœ¨docker-compse.ymlè‡ªåŠ¨æ·»åŠ å¯¹åº”çš„é•œåƒé…ç½®ï¼Œæ–¹ä¾¿ä½¿ç”¨docker composeè¿›è¡Œç¯å¢ƒé…ç½®å’Œç»„ä»¶ç¼–æ’ã€‚ application.propertiesæ–‡ä»¶ç”Ÿæˆï¼š å®˜æ–¹æ˜¯ä¸ä¼šç”Ÿæˆå¯¹åº”çš„é…ç½®é¡¹çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä¼šç»“åˆSpring Cloudçš„æœ€ä¼˜å®è·µé…ç½®ï¼Œä¸ä»…å¦‚æ­¤æˆ‘ä»¬å°†ä¼šé›†æˆå¸‚é¢ä¸Šå£ç¢‘æœ€å¥½çš„ä¸­é—´ä»¶ç»™å‡ºæœ€ä¼˜é…ç½®ã€‚ è§„èŒƒï¼špom.xmlçš„è§„èŒƒï¼Œapplication.propertiesçš„è§„èŒƒç­‰ï¼Œæä¾›é»˜è®¤é…ç½®ï¼Œåªéœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹æˆ–è€…ä¸éœ€è¦ä»»ä½•è°ƒæ•´å°±å¯ä»¥ä½¿ç”¨ã€‚ å…¶ä»–æ ‡å‡†æ–‡ä»¶çš„è§„èŒƒï¼š.gitignore, logback-spring.xmlç­‰ã€‚ å¦‚æœä½ é€‰æ‹©mybatisä¼šè‡ªåŠ¨ç”Ÿæˆmybatis-config.xmlæ–‡ä»¶ç­‰ã€‚ æŒç»­é›†æˆï¼šè‡ªåŠ¨ç”Ÿæˆ .gitlab-ci.yml æ–‡ä»¶ï¼Œè‡ªåŠ¨é›†æˆ Gitlab CI åŸºäºå¦‚ä¸ŠåŸå› å’Œæ„¿æ™¯,å› æ­¤æˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ªæœ€ä¼˜Spring Cloudå®è·µçš„ä»£ç ç”Ÿæˆå™¨ã€‚ 1.2 Spring Cloud CodeGenæ¦‚è¿°spring-cloud-codegenæ˜¯ç”±Spring Cloudä¸­å›½ç¤¾åŒºå‘èµ·çš„ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨å¼€æºé¡¹ç›®ï¼Œç›®å‰è¯¥å¼€æºé¡¹ç›®ç”±è®¸è¿›ï¼Œä»»æµ©å†›ï¼Œæäº‘é¾™ï¼Œåˆ˜ç¾èƒœå¥‡æŒç»­å¼€å‘è¿­ä»£ã€‚åŸºäºFreemarker+æ¨¡æ¿æ–‡ä»¶çš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥æŒ‰éœ€å‹¾é€‰ç»„ä»¶ï¼Œè½»æ¾å¿«é€Ÿå®ç°å¯¹æ¡†æ¶ä»£ç çš„ä¸€é”®åˆ›å»ºï¼ˆä¾‹å¦‚ä¸šåŠ¡éƒ¨é—¨å®ç°å¯¹åŸºç¡€æ¶æ„éƒ¨æä¾›çš„æ¡†æ¶å¿«é€Ÿæ­å»ºï¼‰ï¼Œå®ç°å¯¹Spring Cloudçš„æœ€ä¼˜å®è·µå’Œé…ç½®å·¥å…·åŒ–å’Œè§„èŒƒåŒ–ã€‚ 1.3 åŠŸèƒ½æœ€ç»ˆåŠŸèƒ½åŒ…å«å¦‚ä¸‹ï¼ŒåŒ…æ‹¬å±è”½XXXæ³¨è§£å’Œé…ç½® generate app structure â€”â€”&gt;çŠ¶æ€doing generate java code and resources â€”â€”&gt;çŠ¶æ€todo generate docker-compose.yml â€”â€”&gt;çŠ¶æ€todo generate .gitlab-ci.yml â€”â€”&gt;çŠ¶æ€todo generate DDD structure â€”â€”&gt;çŠ¶æ€todo äºŒ.èµ°è¿›Spring Cloud CodeGen2.1 é¡¹ç›®ä»‹ç» é¡¹ç›®Demoåœ°å€:http://start.springcloud.cn/é¡¹ç›®å¼€å‘äººå‘˜:è®¸è¿›,ä»»æµ©å†›,åˆ˜ç¾èƒœå¥‡,æäº‘é¾™githubåœ°å€:https://github.com/springcloud/spring-cloud-codegenhttps://github.com/springcloud/spring-cloud-skeleton 2.2 é¡¹ç›®æŠ€æœ¯é€‰å‹Spring Boot+Spring MVC+FreeMarker+Vue 2.3 ä»£ç ç”Ÿæˆå™¨é…ç½®1.skeleton-data.properties ç”¨æ¥æè¿°æ¨¡æ¿æ–‡ä»¶çš„å…¨å±€é…ç½®å€¼ï¼Œé‡Œé¢çš„å€¼æ›¿æ¢æ¨¡æ¿æ–‡ä»¶é‡Œçš„åŠ¨æ€å˜é‡(ç”¨${}è¡¨ç¤º)1234567891011121314151617# ---------- å·¥ç¨‹é…ç½® ----------# moduleName=sales-projectmoduleName=salesbasePackage=cn.springcloudpomGroupId=cn.springcloudpomArtifactId=salespomName=springcloud salespomVersion=1.0.0springCloudVersion=Dalston.SR4springBootVersion=1.5.6.RELEASEjavaVersion=1.8# ---------- æ¡†æ¶é…ç½® ----------serviceName=spring-cloud-salesport=2222eurekaEnabled=trueeurekaUrl=http://localhost:1111/eureka/ skeleton-description.xml å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”¨æ¥æè¿°æ¨¡ç•Œé¢é©±åŠ¨å’Œæ¸²æŸ“çš„ç»„ä»¶ï¼Œåˆ†ä¸ºGroupå’ŒEntityç»“æ„ï¼Œä¸€ä¸ªGroupåŒ…å«å¤šä¸ªEntityï¼Œå…¶ä»–å±æ€§æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä¸»è¦ä»‹ç»å¦‚ä¸‹ highlightable - æ ‡è¯†ä¸ºé«˜äº®é¡¹ï¼Œä¸€èˆ¬ç»„ä»¶æ¸²æŸ“æˆé«˜äº®æ–¹å¼ï¼Œä¾‹å¦‚Labelçº¢è‰²å­—ä½“ï¼Œæç¤ºä½¿ç”¨è€…ç€é‡å…³æ³¨ defaultable - æ ‡è¯†ä¸ºé»˜è®¤é¡¹ï¼Œä¸€èˆ¬ç»„ä»¶æ¸²æŸ“æˆé»˜è®¤é¡¹æ–¹å¼ï¼Œæç¤ºä½¿ç”¨è€…å¯ä»¥ä¸ä¿®æ”¹å¯¹åº”å€¼ emptiable - æ ‡è¯†ä¸ºç•™ç©ºé¡¹ï¼Œä¸€èˆ¬ç»„ä»¶æ¸²æŸ“æˆç•™ç©ºé¡¹æ–¹å¼ï¼Œæç¤ºä½¿ç”¨è€…å¯¹åº”å€¼å¯ä»¥ä¸ºç©º editable - æ ‡è¯†ä¸ºä¸å¯ç¼–è¾‘é¡¹ï¼Œä¸€èˆ¬ç»„ä»¶æ¸²æŸ“æˆä¸å¯ç¼–è¾‘é¡¹æ–¹å¼ï¼Œå¦‚æœfalseåˆ™æŠŠç»„ä»¶ç°æ‰ï¼Œæç¤ºä½¿ç”¨è€…å¯¹åº”å€¼ä¸å¯ç¼–è¾‘ ç¤ºä¾‹Demoæ•°æ®å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;skeleton&gt; &lt;!-- å·¥ç¨‹åŸºæœ¬é…ç½® --&gt; &lt;group&gt; &lt;key&gt;basic&lt;/key&gt; &lt;label&gt;&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;entity&gt; &lt;key&gt;pomGroupId&lt;/key&gt; &lt;label&gt;Group&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;TEXTFIELD&lt;/type&gt; &lt;highlightable&gt;true&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;pomArtifactId&lt;/key&gt; &lt;label&gt;Artifact&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;TEXTFIELD&lt;/type&gt; &lt;highlightable&gt;true&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;moduleName&lt;/key&gt; &lt;label&gt;å·¥ç¨‹æ¨¡å—å&lt;/label&gt; &lt;description&gt;moduleName&lt;/description&gt; &lt;note&gt;ã€å¿…æ”¹é¡¹ã€‘é¦–å­—æ¯å¿…é¡»å°å†™ï¼Œä¸­é—´åªå…è®¸å‡ºç°â€œ-â€&lt;/note&gt; &lt;type&gt;TEXTFIELD&lt;/type&gt; &lt;highlightable&gt;true&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;basePackage&lt;/key&gt; &lt;label&gt;ä¸Šå±‚åŒ…è·¯å¾„&lt;/label&gt; &lt;description&gt;basePackage&lt;/description&gt; &lt;note&gt;ã€å¿…æ”¹é¡¹ã€‘è¯¥è·¯å¾„ä¼šä½œä¸ºæ‰€æœ‰Javaä»£ç çš„ä¸Šå±‚è·¯å¾„ã€‚moduleNameã€basePackageå’ŒprojectTypeä¸‰è€…ç»„åˆèµ·æ¥è§£æå‡ºç›¸å…³ç›®å½•å’Œç»“æ„è§„åˆ™ï¼Œä¾‹å¦‚moduleName=payment-ccbï¼ŒbasePackage=com.nepxionï¼ŒprojectType=serverï¼Œé‚£ä¹ˆå·¥ç¨‹åä¸ºpayment-ccb-serverï¼Œç±»è·¯å¾„ä¸ºcom.nepxion.payment.ccb.server &lt;/note&gt; &lt;type&gt;TEXTFIELD&lt;/type&gt; &lt;highlightable&gt;true&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;javaVersion&lt;/key&gt; &lt;label&gt;Java Version&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;COMBOBOX&lt;/type&gt; &lt;options&gt;1.8;1.7;1.6&lt;/options&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- æ˜¯å¦DockeråŒ– --&gt; &lt;group&gt; &lt;key&gt;docker-template&lt;/key&gt; &lt;label&gt;Dockeræ¨¡æ¿&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;true&lt;/key&gt; &lt;label&gt;æ˜¯&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;false&lt;/key&gt; &lt;label&gt;å¦&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- åº”ç”¨ç±»å‹ --&gt; &lt;group&gt; &lt;key&gt;appType&lt;/key&gt; &lt;label&gt;åº”ç”¨ç±»å‹&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;Spring Boot&lt;/key&gt; &lt;label&gt;Spring Boot&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;Spring Cloud&lt;/key&gt; &lt;label&gt;Spring Cloud&lt;/label&gt; &lt;note&gt;Spring Cloudåº”ç”¨&lt;/note&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;war&lt;/key&gt; &lt;label&gt;waråº”ç”¨&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- Spring Cloudç‹¬ç«‹éƒ¨ç½²ç»„ä»¶ --&gt; &lt;group&gt; &lt;key&gt;sc-alone&lt;/key&gt; &lt;label&gt;Spring Cloud&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;ç‹¬ç«‹ç»„ä»¶&lt;/key&gt; &lt;label&gt;ç‹¬ç«‹ç»„ä»¶&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;service-provider&lt;/key&gt; &lt;label&gt;æœåŠ¡æä¾›è€…&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;service-consumer&lt;/key&gt; &lt;label&gt;æœåŠ¡æ¶ˆè´¹è€…&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- webåŸºç¡€æ¡†æ¶ --&gt; &lt;group&gt; &lt;key&gt;basic-framework&lt;/key&gt; &lt;label&gt;åŸºç¡€æ¡†æ¶&lt;/label&gt; &lt;description&gt;åŸºç¡€æ¡†æ¶-1&lt;/description&gt; &lt;type&gt;CHECKBOX_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;spring-mvc&lt;/key&gt; &lt;label&gt;Spring MVC&lt;/label&gt; &lt;description&gt;Spring MVC&lt;/description&gt; &lt;type&gt;CHECKBOX&lt;/type&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;true&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;Mybatis&lt;/key&gt; &lt;label&gt;Mybatis&lt;/label&gt; &lt;description&gt;Mybatis&lt;/description&gt; &lt;type&gt;CHECKBOX&lt;/type&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- Spring Cloudç‹¬ç«‹éƒ¨ç½²å•é€‰ç»„ä»¶ --&gt; &lt;group&gt; &lt;key&gt;sc-alone-radio&lt;/key&gt; &lt;label&gt;ç‹¬ç«‹ç»„ä»¶&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;eureka-server&lt;/key&gt; &lt;label&gt;Eureka Server&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;zuul-server&lt;/key&gt; &lt;label&gt;Zuul Server&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;sc-gateway&lt;/key&gt; &lt;label&gt;SC Gateway&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;config-server&lt;/key&gt; &lt;label&gt;Config Server&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;zipkin-server&lt;/key&gt; &lt;label&gt;Zipkin Server&lt;/label&gt; &lt;description&gt;&lt;/description&gt; &lt;type&gt;RADIO&lt;/type&gt; &lt;value&gt;false&lt;/value&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt; &lt;!-- Spring Cloudå¯ç»„åˆå¤šé€‰ç»„ä»¶ --&gt; &lt;group&gt; &lt;key&gt;sc-group-checkBox&lt;/key&gt; &lt;label&gt;å¯ç»„åˆç»„ä»¶&lt;/label&gt; &lt;description&gt;Spring Cloudç»„ä»¶&lt;/description&gt; &lt;type&gt;CHECKBOX_GROUP&lt;/type&gt; &lt;layout&gt;HORIZONTAL&lt;/layout&gt; &lt;entity&gt; &lt;key&gt;fegin&lt;/key&gt; &lt;label&gt;Fegin&lt;/label&gt; &lt;description&gt;Spring MVC&lt;/description&gt; &lt;type&gt;CHECKBOX&lt;/type&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;hystrix&lt;/key&gt; &lt;label&gt;hystrix&lt;/label&gt; &lt;description&gt;hystrix&lt;/description&gt; &lt;type&gt;CHECKBOX&lt;/type&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;true&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;entity&gt; &lt;key&gt;ribbon&lt;/key&gt; &lt;label&gt;Ribbon&lt;/label&gt; &lt;description&gt;Ribbon&lt;/description&gt; &lt;type&gt;CHECKBOX&lt;/type&gt; &lt;highlightable&gt;false&lt;/highlightable&gt; &lt;defaultable&gt;false&lt;/defaultable&gt; &lt;emptiable&gt;false&lt;/emptiable&gt; &lt;editable&gt;true&lt;/editable&gt; &lt;/entity&gt; &lt;/group&gt;&lt;/skeleton&gt; 2.4 Spring-cloud-CodeGenå¼€å‘æ¥å£æ ¹æ®é…ç½®æ–‡ä»¶è¿›è¡Œç•Œé¢é©±åŠ¨çš„å…ƒæ•°æ®æ¥å£ 12@RequestMapping(value = \"/getMetaData\", method = RequestMethod.GET)public List&lt;SkeletonGroup&gt; getMetaData() è¿”å›JSONæ ¼å¼çš„æ–‡ä»¶ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹æ ¼å¼ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368[ &#123; \"key\": \"basic\", \"label\": \"\", \"description\": \"\", \"type\": \"NORMAL_GROUP\", \"layoutType\": \"VERTICAL\", \"entityList\": [ &#123; \"key\": \"pomGroupId\", \"label\": \"Group\", \"description\": \"\", \"note\": null, \"value\": \"cn.springcloud\", \"type\": \"TEXTFIELD\", \"options\": null, \"highlightable\": true, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"pomArtifactId\", \"label\": \"Artifact\", \"description\": \"\", \"note\": null, \"value\": \"sales\", \"type\": \"TEXTFIELD\", \"options\": null, \"highlightable\": true, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"moduleName\", \"label\": \"å·¥ç¨‹æ¨¡å—å\", \"description\": \"moduleName\", \"note\": \"ã€å¿…æ”¹é¡¹ã€‘é¦–å­—æ¯å¿…é¡»å°å†™ï¼Œä¸­é—´åªå…è®¸å‡ºç°â€œ-â€\", \"value\": \"sales\", \"type\": \"TEXTFIELD\", \"options\": null, \"highlightable\": true, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"basePackage\", \"label\": \"ä¸Šå±‚åŒ…è·¯å¾„\", \"description\": \"basePackage\", \"note\": \"ã€å¿…æ”¹é¡¹ã€‘è¯¥è·¯å¾„ä¼šä½œä¸ºæ‰€æœ‰Javaä»£ç çš„ä¸Šå±‚è·¯å¾„ã€‚moduleNameã€basePackageå’ŒprojectTypeä¸‰è€…ç»„åˆèµ·æ¥è§£æå‡ºç›¸å…³ç›®å½•å’Œç»“æ„è§„åˆ™ï¼Œä¾‹å¦‚moduleName=payment-ccbï¼ŒbasePackage=com.nepxionï¼ŒprojectType=serverï¼Œé‚£ä¹ˆå·¥ç¨‹åä¸ºpayment-ccb-serverï¼Œç±»è·¯å¾„ä¸ºcom.nepxion.payment.ccb.server\", \"value\": \"cn.springcloud\", \"type\": \"TEXTFIELD\", \"options\": null, \"highlightable\": true, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"javaVersion\", \"label\": \"Java Version\", \"description\": \"\", \"note\": null, \"value\": \"1.8\", \"type\": \"COMBOBOX\", \"options\": [ \"1.8\", \"1.7\", \"1.6\" ], \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"docker-template\", \"label\": \"Dockeræ¨¡æ¿\", \"description\": \"\", \"type\": \"RADIO_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"true\", \"label\": \"æ˜¯\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"false\", \"label\": \"å¦\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"appType\", \"label\": \"åº”ç”¨ç±»å‹\", \"description\": \"\", \"type\": \"RADIO_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"Spring Boot\", \"label\": \"Spring Boot\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"Spring Cloud\", \"label\": \"Spring Cloud\", \"description\": \"\", \"note\": \"Spring Cloudåº”ç”¨\", \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"war\", \"label\": \"waråº”ç”¨\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"sc-alone\", \"label\": \"Spring Cloud\", \"description\": \"\", \"type\": \"RADIO_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"ç‹¬ç«‹ç»„ä»¶\", \"label\": \"ç‹¬ç«‹ç»„ä»¶\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"service-provider\", \"label\": \"æœåŠ¡æä¾›è€…\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"service-consumer\", \"label\": \"æœåŠ¡æ¶ˆè´¹è€…\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"basic-framework\", \"label\": \"åŸºç¡€æ¡†æ¶\", \"description\": \"åŸºç¡€æ¡†æ¶-1\", \"type\": \"CHECKBOX_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"spring-mvc\", \"label\": \"Spring MVC\", \"description\": \"Spring MVC\", \"note\": null, \"value\": null, \"type\": \"CHECKBOX\", \"options\": null, \"highlightable\": false, \"defaultable\": true, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"Mybatis\", \"label\": \"Mybatis\", \"description\": \"Mybatis\", \"note\": null, \"value\": null, \"type\": \"CHECKBOX\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"sc-alone-radio\", \"label\": \"ç‹¬ç«‹ç»„ä»¶\", \"description\": \"\", \"type\": \"RADIO_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"eureka-server\", \"label\": \"Eureka Server\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"zuul-server\", \"label\": \"Zuul Server\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"sc-gateway\", \"label\": \"SC Gateway\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"config-server\", \"label\": \"Config Server\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"zipkin-server\", \"label\": \"Zipkin Server\", \"description\": \"\", \"note\": null, \"value\": null, \"type\": \"RADIO\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;, &#123; \"key\": \"sc-group-checkBox\", \"label\": \"å¯ç»„åˆç»„ä»¶\", \"description\": \"Spring Cloudç»„ä»¶\", \"type\": \"CHECKBOX_GROUP\", \"layoutType\": \"HORIZONTAL\", \"entityList\": [ &#123; \"key\": \"fegin\", \"label\": \"Fegin\", \"description\": \"Spring MVC\", \"note\": null, \"value\": null, \"type\": \"CHECKBOX\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"hystrix\", \"label\": \"hystrix\", \"description\": \"hystrix\", \"note\": null, \"value\": null, \"type\": \"CHECKBOX\", \"options\": null, \"highlightable\": false, \"defaultable\": true, \"emptiable\": false, \"editable\": true &#125;, &#123; \"key\": \"ribbon\", \"label\": \"Ribbon\", \"description\": \"Ribbon\", \"note\": null, \"value\": null, \"type\": \"CHECKBOX\", \"options\": null, \"highlightable\": false, \"defaultable\": false, \"emptiable\": false, \"editable\": true &#125; ] &#125;] ä¸‹è½½è„šæ‰‹æ¶Zipæ–‡ä»¶çš„æ¥å£ï¼Œè¿”å›Zipæ–‡ä»¶çš„byteæ•°ç»„ç±»å‹ï¼ŒBodyçš„å†…å®¹ä¸ºsrc\\main\\resources\\config\\skeleton-data.properties 12@RequestMapping(value = \"/downloadBytes\", method = RequestMethod.POST)public byte[] downloadBytes(@RequestBody String config) ä¸‹è½½è„šæ‰‹æ¶Zipæ–‡ä»¶çš„æ¥å£ï¼Œè¿”å›Zipæ–‡ä»¶çš„ResponseEntityç±»å‹ 12@RequestMapping(value = \"/downloadResponse\", method = RequestMethod.POST)public ResponseEntity&lt;Resource&gt; downloadResponse(@RequestBody String config) 2.5 å‰ç«¯è¿è¡Œspring-cloud-codegen-uié‡‡ç”¨Vueå¼€å‘ï¼Œæœ¬åœ°å¼€å‘è°ƒè¯•ï¼Œé‡‡ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ã€‚ 12345678# install dependenciesnpm install# serve with hot reload at localhost:8081npm run dev# build for production with minificationnpm run build","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"},{"name":"ä»£ç ç”Ÿæˆå™¨","slug":"ä»£ç ç”Ÿæˆå™¨","permalink":"http://xujin.org/tags/ä»£ç ç”Ÿæˆå™¨/"}]},{"title":"Spring initializræºç å·¥ç¨‹è§£æ","slug":"ex/spring-initializr","date":"2017-12-09T06:00:00.000Z","updated":"2019-01-13T05:19:01.346Z","comments":true,"path":"ex/spring-initializr/","link":"","permalink":"http://xujin.org/ex/spring-initializr/","excerpt":"ä»€ä¹ˆæ˜¯Spring initializrä»€ä¹ˆæ˜¯Spring initializrinitializræ˜¯Springæä¾›çš„ä¸€ä¸ªå¿«é€Ÿæ ¹æ®æŒ‰éœ€ç”Ÿæˆå¸¦æœ‰Springé£æ ¼çš„å·¥ç¨‹çš„ä»£ç ç”Ÿæˆå™¨ã€‚ä»£ç åœ°å€:https://github.com/spring-io/initializr/åœ¨çº¿åœ°å€:https://start.spring.io","text":"ä»€ä¹ˆæ˜¯Spring initializrä»€ä¹ˆæ˜¯Spring initializrinitializræ˜¯Springæä¾›çš„ä¸€ä¸ªå¿«é€Ÿæ ¹æ®æŒ‰éœ€ç”Ÿæˆå¸¦æœ‰Springé£æ ¼çš„å·¥ç¨‹çš„ä»£ç ç”Ÿæˆå™¨ã€‚ä»£ç åœ°å€:https://github.com/spring-io/initializr/åœ¨çº¿åœ°å€:https://start.spring.io å·¥ç¨‹ç›®å½•è§£è¯» æ¨¡å—å è¯´æ˜ initializr-actuator å¯é€‰æ¨¡å—ï¼Œæä¾›ç»Ÿè®¡æ•°æ®å’ŒæŒ‡æ ‡ initializr-docs æ–‡æ¡£ initializr-generator å•ç‹¬çš„ç”Ÿæˆç±»åº“ï¼Œæ ¸å¿ƒæ¨¡å—ï¼Œå¯ä»¥å¼•å…¥è‡ªå·±çš„ä»£ç ç”Ÿæˆå™¨å·¥ç¨‹ä¸­ initializr-service Spring Bootçš„ä¸»å…¥å£åº”ç”¨å·¥ç¨‹ initializr-web RESTç«¯ç‚¹å’Œwebæ¥å£ï¼Œä¸»è¦æ˜¯Controllerç±» æœªå®Œå¾…ç»­","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ€»ç»“ä¹‹åŒç±»å®¹å™¨å’Œå¼‚æ­¥å®¹å™¨","slug":"bf/bf01","date":"2017-10-03T13:00:00.000Z","updated":"2019-01-13T05:27:48.118Z","comments":true,"path":"bf/bf01/","link":"","permalink":"http://xujin.org/bf/bf01/","excerpt":"ä¸€. åŒæ­¥ç±»å®¹å™¨1.1 åŒæ­¥ç±»å®¹å™¨éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦åŠ é”æ¥ä¿æŠ¤å¤åˆæ“ä½œã€‚ å¤åˆæ“ä½œå¦‚ï¼š è¿­ä»£(åå¤è®¿é—®å…ƒç´ ï¼Œéå†å®¹å™¨ä¸­æ‰€æœ‰çš„å…ƒç´ )ï¼Œ è·³è½¬ï¼ˆæ ¹æ®æŒ‡å®šçš„é¡ºåºæ‰¾åˆ°å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œä»¥åŠæ¡ä»¶è¿ç®—ã€‚","text":"ä¸€. åŒæ­¥ç±»å®¹å™¨1.1 åŒæ­¥ç±»å®¹å™¨éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦åŠ é”æ¥ä¿æŠ¤å¤åˆæ“ä½œã€‚ å¤åˆæ“ä½œå¦‚ï¼š è¿­ä»£(åå¤è®¿é—®å…ƒç´ ï¼Œéå†å®¹å™¨ä¸­æ‰€æœ‰çš„å…ƒç´ )ï¼Œ è·³è½¬ï¼ˆæ ¹æ®æŒ‡å®šçš„é¡ºåºæ‰¾åˆ°å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œä»¥åŠæ¡ä»¶è¿ç®—ã€‚ è¿™äº›å¤åˆæ“ä½œåœ¨å¤šçº¿å¹¶å‘åœ°ä¿®æ”¹å®¹å™¨æ—¶ï¼Œå¯èƒ½ä¼šè¡¨ç°å‡ºæ„å¤–çš„è¡Œä¸ºï¼Œæœ€ç»å…¸çš„ä¾¿æ˜¯ConcurrentModificationExceptionï¼ŒåŸå› æ˜¯å½“å®¹å™¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œè¢«å¹¶å‘çš„ä¿®æ”¹äº†å†…å®¹ï¼Œè¿™æ˜¯ç”±äºæ—©æœŸè¿­ä»£å™¨è®¾è®¡çš„æ—¶å€™å¹¶æ²¡æœ‰è€ƒè™‘å¹¶å‘ä¿®æ”¹çš„é—®é¢˜ã€‚ 1234567891011121314151617public class Tickets &#123; public static void main(String[] args) &#123; //åˆå§‹åŒ–ç«è½¦ç¥¨æ± å¹¶æ·»åŠ ç«è½¦ç¥¨:é¿å…çº¿ç¨‹åŒæ­¥å¯é‡‡ç”¨Vectoræ›¿ä»£ArrayList HashTableæ›¿ä»£HashMap final Vector&lt;String&gt; tickets = new Vector&lt;String&gt;(); for (int i = 1; i &lt;= 1000; i++) &#123; tickets.add(\"ç«è½¦ç¥¨\" + i); &#125; for (Iterator iterator = tickets.iterator(); iterator.hasNext(); ) &#123; String string = (String) iterator.next(); tickets.remove(20); &#125; &#125;&#125; è¿è¡Œå‡ºç°ï¼Œå¦‚ä¸‹é”™è¯¯: 1234Exception in thread &quot;main&quot; java.util.ConcurrentModificationException at java.util.Vector$Itr.checkForComodification(Vector.java:1184) at java.util.Vector$Itr.next(Vector.java:1137) at org.xujin.janus.poc.server.Tickets.main(Tickets.java:35) 1.2 åŒæ­¥ç±»å®¹å™¨:å¦‚å¤è€çš„Vectorï¼ŒHashTableã€‚è¿™äº›å®¹å™¨çš„åŒæ­¥åŠŸèƒ½å…¶å®éƒ½æ˜¯ç”±jdkçš„Collections.synchronized*** æ¯”å¦‚:Collections.synchronizedMapç­‰å·¥å‚æ–¹æ³•å»åˆ›å»ºå®ç°çš„ã€‚æ¯”å¦‚,å¦‚ä¸‹ï¼š 1Map&lt;String, String&gt; map = Collections.synchronizedMap(new HashMap&lt;String, String&gt;()); æœ¬èº«hashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯Collections.synchronizedMap(new HashMap())å·¥å‚æ–¹æ³•åŒ…è£¹ä¹‹åï¼Œå°±å˜æˆçº¿ç¨‹å®‰å…¨çš„ã€‚ å…¶åº•å±‚çš„æœºåˆ¶æ— éå°±æ˜¯ä¼ ç»Ÿçš„synchronizedå…³é”®å­—å¯¹æ¯ä¸ªå…¬ç”¨çš„æ–¹æ³•éƒ½è¿›è¡ŒåŒæ­¥ï¼Œä½¿å¾—æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®¹å™¨çš„çŠ¶æ€ã€‚è¿™å¾ˆæ˜æ˜¾ä¸æ»¡è¶³æˆ‘ä»¬ä»Šå¤©äº’è”ç½‘æ—¶ä»£é«˜å¹¶å‘çš„éœ€æ±‚ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œä¹Ÿå¿…é¡»è¦æœ‰è¶³å¤Ÿå¥½çš„æ€§èƒ½ã€‚ 123456789101112131415161718192021public class Tickets &#123; public static void main(String[] args) &#123; final Vector&lt;String&gt; tickets = new Vector&lt;String&gt;(); for (int i = 1; i &lt;= 1000; i++) &#123; tickets.add(\"ç«è½¦ç¥¨\" + i); &#125; for (int i = 1; i &lt;= 10; i++) &#123; new Thread(\"çº¿ç¨‹\" + i) &#123; public void run() &#123; while (true) &#123; if (tickets.isEmpty()) break; System.out.println(Thread.currentThread().getName() + \"---\" + tickets.remove(0)); &#125; &#125; &#125;.start(); &#125; &#125;&#125; Ps:åœ¨å®é™…å¼€å‘ä¸­ï¼Œå°½é‡ä½¿ç”¨å¹¶å‘ç±»å®¹å™¨æ›¿ä»£åŒæ­¥ç±»å®¹å™¨ã€‚ å¹¶å‘ç±»å®¹å™¨å¹¶å‘ç±»å®¹å™¨æ¦‚è¿°jdk5.0ä¹‹åæä¾›äº†å¤šç§å¹¶å‘ç±»å®¹å™¨æ¥æ›¿ä»£åŒæ­¥ç±»å®¹å™¨ä»è€Œæ”¹å–„æ€§èƒ½ã€‚åŒæ­¥ç±»å®¹å™¨çš„çŠ¶æ€éƒ½æ˜¯ä¸²è¡ŒåŒ–çš„ï¼Œä»–ä»¬è™½ç„¶å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ä¸¥é‡é™ä½äº†å¹¶å‘æ€§ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒæ—¶ï¼Œä¸¥é‡é™ä½äº†åº”ç”¨ç¨‹åºçš„ååé‡ã€‚ å¹¶å‘ç±»å®¹å™¨æ˜¯ä¸“é—¨é’ˆå¯¹å¹¶å‘è®¾è®¡çš„ï¼Œä½¿ç”¨ConcurrentHashMapæ¥æ›¿ä»£ç»™äºˆæ•£åˆ—çš„ä¼ ç»ŸhashTableï¼Œè€Œä¸”åœ¨ConcurrentHashMapä¸­ï¼Œæ·»åŠ äº†ä¸€äº›å¸¸è§å¤åˆæ“ä½œçš„æ”¯æŒã€‚ä»¥åŠä½¿ç”¨äº†CopyOnWriteArrayListä»£æ›¿Voctorï¼Œå¹¶å‘çš„CopOnwriteArraySetï¼Œä»¥åŠå¹¶å‘çš„Queueï¼ŒConcurrentLinkedQueueå’ŒLinkedBlockingQueueï¼Œå‰è€…æ˜¯é«˜æ€§èƒ½çš„é˜Ÿåˆ—ï¼Œåè€…æ˜¯ä»¥é˜»å¡å½¢å¼çš„é˜Ÿåˆ—ï¼Œå…·ä½“å®ç°Queueè¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ArrayBlockQueueï¼ŒPriorityBlockingQueueï¼ŒSynchronousQueueç­‰ã€‚ ConcurrentMapConcurrentMapæ¥å£ä¸‹æœ‰ä¸¤ä¸ªé‡è¦çš„å®ç°: ConcurrentHashMap,ConcurrentSkipListMap(æ”¯æŒå¹¶å‘æ’åºåŠŸèƒ½ï¼Œå¼¥è¡¥ConcurrentHashMap) ConcurrentHashMapå†…éƒ¨ä½¿ç”¨åˆ†æ®µé”(segment)æ¥æ ‡è¯†è¿™äº›ä¸åŒçš„éƒ¨é—¨ï¼Œåœ¨æ¯ä¸ªæ®µå…¶å®å°±æ˜¯ä¸€ä¸ªå°çš„hashTableï¼Œå®ƒä»¬æœ‰è‡ªå·±çš„é”ã€‚åªè¦å¤šä¸ªä¿®æ”¹æ“ä½œå‘ç”Ÿåœ¨ä¸åŒçš„æ®µä¸Šï¼Œå®ƒä»¬å°±æ˜¯å¯ä»¥å¹¶å‘è¿›è¡Œã€‚æŠŠä¸€ä¸ªæ•´ä½“åˆ’åˆ†æˆäº†16ä¸ªæ®µ(segment)ã€‚ä¹Ÿå°±æ˜¯æœ€é«˜æ”¯æŒ16ä¸ªçº¿ç¨‹çš„å¹¶å‘ä¿®æ”¹æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯åœ¨å¤šçº¿ç¨‹åœºæ™¯æ—¶å‡å°é”çš„ç²’åº¦ä»è€Œå‡ä½é”ç«äº‰çš„ä¸€ç§æ–¹æ¡ˆã€‚å¹¶ä¸”ä»£ç ä¸­å¤§å¤šå…±äº«å˜é‡ä½¿ç”¨volatileå…³é”®å­—å£°æ˜ï¼Œç›®çš„æ˜¯ç¬¬ä¸€æ—¶é—´è·å–ä¿®æ”¹çš„å†…å®¹ï¼Œæ€§èƒ½éå¸¸å¥½ã€‚ ConcurrentHashMapæœ€é«˜æ”¯æŒåˆ†16ä¸ªæ®µã€‚ Copy-On-Writeå®¹å™¨ æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚ã€‚","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"Spring Bootä¸­è‡ªå®šä¹‰æ³¨è§£+AOPå®ç°ä¸»å¤‡åº“åˆ‡æ¢","slug":"sb/sb-aop","date":"2017-09-26T06:00:00.000Z","updated":"2019-01-13T05:38:30.183Z","comments":true,"path":"sb/sb-aop/","link":"","permalink":"http://xujin.org/sb/sb-aop/","excerpt":"æ‘˜è¦: æœ¬ç¯‡æ–‡ç« çš„åœºæ™¯æ˜¯åšè°ƒåº¦ä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒæ—¶çš„éœ€æ±‚ï¼Œåç«¯ä½¿ç”¨TDDLå®ç°åˆ†è¡¨åˆ†åº“ï¼Œéœ€æ±‚:å®ç°å…³é”®ä¸šåŠ¡çš„æŸ¥è¯¢ç›‘æ§,å½“ç”¨MybatisæŸ¥è¯¢æ•°æ®æ—¶éœ€è¦ä»ä¸»åº“åˆ‡æ¢åˆ°å¤‡åº“æˆ–è€…ç›´æ¥è¿åˆ°å¤‡åº“ä¸ŠæŸ¥è¯¢,ä»è€Œå‡å°ä¸»åº“çš„å‹åŠ›ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦è®°å½•åœ¨Spring Bootä¸­é€šè¿‡è‡ªå®šä¹‰æ³¨è§£ç»“åˆAOPå®ç°ç›´æ¥è¿æ¥å¤‡åº“æŸ¥è¯¢ã€‚","text":"æ‘˜è¦: æœ¬ç¯‡æ–‡ç« çš„åœºæ™¯æ˜¯åšè°ƒåº¦ä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒæ—¶çš„éœ€æ±‚ï¼Œåç«¯ä½¿ç”¨TDDLå®ç°åˆ†è¡¨åˆ†åº“ï¼Œéœ€æ±‚:å®ç°å…³é”®ä¸šåŠ¡çš„æŸ¥è¯¢ç›‘æ§,å½“ç”¨MybatisæŸ¥è¯¢æ•°æ®æ—¶éœ€è¦ä»ä¸»åº“åˆ‡æ¢åˆ°å¤‡åº“æˆ–è€…ç›´æ¥è¿åˆ°å¤‡åº“ä¸ŠæŸ¥è¯¢,ä»è€Œå‡å°ä¸»åº“çš„å‹åŠ›ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦è®°å½•åœ¨Spring Bootä¸­é€šè¿‡è‡ªå®šä¹‰æ³¨è§£ç»“åˆAOPå®ç°ç›´æ¥è¿æ¥å¤‡åº“æŸ¥è¯¢ã€‚ ä¸€.é€šè¿‡AOP è‡ªå®šä¹‰æ³¨è§£å®ç°ä¸»åº“åˆ°å¤‡åº“çš„åˆ‡æ¢1.1 è‡ªå®šä¹‰æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£å¦‚ä¸‹ä»£ç æ‰€ç¤º 12345678910import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.METHOD)public @interface SwitchDataBase &#123; boolean switch2Backup() default false;&#125; 1.2 å®ç°æ–¹æ³•æ‹¦æˆªå™¨å¯¹è‡ªå®šä¹‰æ³¨è§£å¤„ç†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import java.lang.reflect.Method;import java.util.Arrays;import org.aopalliance.intercept.MethodInterceptor;import org.aopalliance.intercept.MethodInvocation;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.stereotype.Component;/** * å¤„ç†èµ°å¤‡åº“é€»è¾‘çš„æ³¨è§£ */@Componentpublic class SwitchDataBaseInterceptor implements MethodInterceptor &#123; private final Logger log = LoggerFactory.getLogger(SwitchDataBaseInterceptor.class); @Override public Object invoke(MethodInvocation invocation) throws Throwable &#123; Method method = invocation.getMethod(); SwitchDataBase annotation = getAnnotation(method); if (annotation == null) &#123; return invocation.proceed(); &#125; Object val = null; if(!ThreadLocalMap.containsKey(GroupDataSourceRouteHelper.DATASOURCE_INDEX)) &#123; if (annotation.switch2Backup()) &#123; log.info(\"query back up DB, method: \" + method.getName()); GroupDataSourceRouteHelper.executeByGroupDataSourceIndex(1, true); &#125; else &#123; log.info(\"query primary DB, method: \" + method.getName()); GroupDataSourceRouteHelper.executeByGroupDataSourceIndex(0, true); &#125; &#125; try &#123; val = invocation.proceed(); &#125; catch (Exception e) &#123; log.info(method.getDeclaringClass().getName() + \".\" + invocation.getMethod().getName() + \"æ–¹æ³•è°ƒç”¨å¤±è´¥ï¼Œargumentsï¼š\" + Arrays.toString(invocation.getArguments())); throw new RuntimeException(e); &#125; finally &#123; GroupDataSourceRouteHelper.removeGroupDataSourceIndex(); &#125; return val; &#125; /** * æ‰¾æ–¹æ³•ä¸Šé¢å£°æ˜çš„æ³¨è§£ */ private SwitchDataBase getAnnotation(Method method) &#123; if (method.isAnnotationPresent(SwitchDataBase.class)) &#123; return method.getAnnotation(SwitchDataBase.class); &#125; return null; &#125;&#125; 1.3 é…ç½®OverallQueryConfiguration åœ¨Spring Bootä¸­è£…é…AOP Beanï¼Œå®ç°æ‰«æç‰¹å®šç›®å½•ä¸‹çš„æ³¨è§£ï¼Œå®ç°åˆ‡é¢å˜æˆå½¢æˆé€šçŸ¥å¤„ç†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637package com.wdk.wms.configuration;import com.wdk.wms.annotation.SwitchDataBaseInterceptor;import org.springframework.aop.Advisor;import org.springframework.aop.support.DefaultPointcutAdvisor;import org.springframework.aop.support.JdkRegexpMethodPointcut;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class SwitchDataBaseConfiguration &#123; @Bean(name = \"overallQueryInterceptor\") public SwitchDataBaseInterceptor overallQueryInterceptor() &#123; return new SwitchDataBaseInterceptor(); &#125; //æ·»åŠ aopçš„pointcut @Bean(name = \"jdkRegexpMethodPointcut\") public JdkRegexpMethodPointcut jdkRegexpMethodPointcut() &#123; JdkRegexpMethodPointcut jdkRegexpMethodPointcut = new JdkRegexpMethodPointcut(); jdkRegexpMethodPointcut.setPatterns(\"com.wdk.wms.mapper.*\"); return jdkRegexpMethodPointcut; &#125; //è®¾ç½®é»˜è®¤çš„aopé…ç½®å¯¹åº”çš„æ˜¯åŸæ¥çš„&lt;aop:advisor&gt; @Bean public Advisor druidAdvisor() &#123; DefaultPointcutAdvisor defaultPointcutAdvisor = new DefaultPointcutAdvisor(); defaultPointcutAdvisor.setPointcut(jdkRegexpMethodPointcut()); defaultPointcutAdvisor.setAdvice(overallQueryInterceptor()); return defaultPointcutAdvisor; &#125;&#125; 1.4 å¦‚ä½•ä½¿ç”¨æ³¨è§£ä»ä¸»åº“åˆ°å¤‡åº“çš„åˆ‡æ¢12@SwitchDataBase(switch2Backup = true)List&lt;ConsumerNoticeMsg&gt; listByTemplateOver3(@Param(\"templates\") List&lt;Integer&gt; templates);","categories":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://xujin.org/categories/Spring-Boot/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://xujin.org/tags/Spring-Boot/"}]},{"title":"å¹¶å‘ç¼–ç¨‹ä¹‹ThreadLocalä¸å•ä¾‹çš„æ¨èå†™æ³•","slug":"bf/bf-th-sing","date":"2017-08-27T13:00:00.000Z","updated":"2019-01-13T05:28:15.225Z","comments":true,"path":"bf/bf-th-sing/","link":"","permalink":"http://xujin.org/bf/bf-th-sing/","excerpt":"æ‘˜è¦:æœ¬æ–‡ç»“åˆæœ€è¿‘ç½‘å…³é¡¹ç›®ä»£ç é‡æ„ï¼Œæ€»ç»“ä»‹ç»äº†ThreadLocalæ˜¯ä¸€ç§å¤šçº¿ç¨‹é—´å¹¶å‘è®¿é—®å˜é‡çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œå¹¶ç”¨ä»£ç ç¤ºä¾‹è¯´æ˜ï¼Œè¿˜ä»‹ç»äº†ä»€ä¹ˆæ˜¯å•ä¾‹ä»¥åŠå•ä¾‹çš„æ¨èä¸¤ç§å†™æ³•åˆ†åˆ«æ˜¯é™æ€å†…éƒ¨ç±»å†™æ³•å’Œdubbl check instanceçš„å†™æ³•ï¼Œæ‰©å±•ä»‹ç»äº†å…¶å®ƒæ‡’æ±‰ï¼Œæšä¸¾,é¥¿æ±‰çš„å†™æ³•ç­‰ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ç»“åˆæœ€è¿‘ç½‘å…³é¡¹ç›®ä»£ç é‡æ„ï¼Œæ€»ç»“ä»‹ç»äº†ThreadLocalæ˜¯ä¸€ç§å¤šçº¿ç¨‹é—´å¹¶å‘è®¿é—®å˜é‡çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œå¹¶ç”¨ä»£ç ç¤ºä¾‹è¯´æ˜ï¼Œè¿˜ä»‹ç»äº†ä»€ä¹ˆæ˜¯å•ä¾‹ä»¥åŠå•ä¾‹çš„æ¨èä¸¤ç§å†™æ³•åˆ†åˆ«æ˜¯é™æ€å†…éƒ¨ç±»å†™æ³•å’Œdubbl check instanceçš„å†™æ³•ï¼Œæ‰©å±•ä»‹ç»äº†å…¶å®ƒæ‡’æ±‰ï¼Œæšä¸¾,é¥¿æ±‰çš„å†™æ³•ç­‰ã€‚ ä¸€.ThreadLocalçš„æ¦‚å¿µ1.1 ThreadLocalæ¦‚å¿µThreadLocalæ¦‚å¿µï¼šçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ˜¯ä¸€ç§å¤šçº¿ç¨‹é—´å¹¶å‘è®¿é—®å˜é‡çš„è§£å†³æ–¹æ¡ˆã€‚ä¸å…¶synchronizedç­‰åŠ é”çš„æ–¹å¼ä¸åŒï¼ŒThreadLocalå®Œå…¨ä¸æä¾›é”ï¼Œè€Œä½¿ç”¨ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ‰‹æ®µï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å˜é‡çš„ç‹¬ç«‹å‰¯æœ¬ï¼Œä»¥ä¿éšœçº¿ç¨‹å®‰å…¨ã€‚ ä»æ€§èƒ½ä¸Šè¯´ï¼ŒThreadLocalä¸å…·æœ‰ç»å¯¹çš„ä¼˜åŠ¿ï¼Œåœ¨å¹¶å‘ä¸æ˜¯å¾ˆé«˜çš„æ—¶å€™ï¼ŒåŠ é”çš„æ€§èƒ½ä¼šæ›´å¥½ï¼Œä½†ä½œä¸ºä¸€å¥—ä¸é”å®Œå…¨æ— å…³çš„çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œåœ¨é«˜å¹¶å‘é‡æˆ–è€…ç«äº‰æ¿€çƒˆçš„åœºæ™¯ï¼Œä½¿ç”¨ThreadLocalå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘é”ç«äº‰ã€‚ ThreadLocalå¤šçº¿ç¨‹é—´å¹¶å‘è®¿é—®å˜é‡çš„è§£å†³æ–¹æ¡ˆï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å˜é‡çš„å‰¯æœ¬ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚å› ä¸ºThreadLocalåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹è¯¥å˜é‡ä¼šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œå³æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ªè¯¥å˜é‡ï¼Œä¸”åœ¨çº¿ç¨‹å†…éƒ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ï¼Œè¿™æ ·ä¸€æ¥å°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¹Ÿä¸ä¼šä¸¥é‡å½±å“ç¨‹åºæ‰§è¡Œæ€§èƒ½ã€‚ è™½ç„¶ThreadLocalèƒ½å¤Ÿè§£å†³ä¸Šé¢è¯´çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†å‰¯æœ¬ï¼Œæ‰€ä»¥è¦è€ƒè™‘å®ƒå¯¹èµ„æºçš„æ¶ˆè€—ï¼Œæ¯”å¦‚å†…å­˜çš„å ç”¨ä¼šæ¯”ä¸ä½¿ç”¨ThreadLocalè¦å¤§ã€‚ 1.2 ThreadLocalä»£ç ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243package org.xujin.bf;public class ConnThreadLocal &#123; //ç”¨ThreadLocalå»å­˜å‚¨å¤šçº¿ç¨‹ä¸‹è®¿é—®çš„å˜é‡ public static ThreadLocal&lt;String&gt; th = new ThreadLocal&lt;String&gt;(); public void setTh(String value)&#123; th.set(value); &#125; public void getTh()&#123; System.out.println(Thread.currentThread().getName() + \":\" + this.th.get()); &#125; public static void main(String[] args) throws InterruptedException &#123; final ConnThreadLocal ct = new ConnThreadLocal(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; ct.setTh(\"å¼ ä¸‰\"); ct.getTh(); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(1000); ct.setTh(\"æå››\"); ct.getTh(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125; &#125; æ‰§è¡Œç»“æœå¦‚ä¸‹: 12t1:å¼ ä¸‰t2:æå›› å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œå¦‚æœæŠŠct.setTh(â€œæå››â€)æ³¨é‡Šï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 12t1:å¼ ä¸‰t2:null PS:ä¸¤ä¸ªçº¿ç¨‹ä¹‹å‰éƒ½ä½¿ç”¨äº†ThreadLocalåŒ…è£…çš„å˜é‡thï¼Œä½†æ˜¯Threadlocalä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®ç‹¬ç«‹ï¼Œå› æ­¤t1,t2ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®è®¿é—®éš”ç¦»äº†ã€‚ äºŒ.å•ä¾‹ä¸å¤šçº¿ç¨‹ä»€ä¹ˆæ˜¯å•ä¾‹? å•ä¾‹æ˜¯åº”ç”¨æˆ–è€…ç³»ç»Ÿä¸­ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ å•ä¾‹æ¨¡å¼ï¼Œæœ€å¸¸è§çš„å°±æ˜¯é¥¥é¥¿æ¨¡å¼å’Œæ‡’æ±‰æ¨¡å¼ï¼Œä¸€ä¸ªç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯åœ¨è°ƒç”¨æ–¹æ³•æ—¶è¿›è¡Œå®ä¾‹åŒ–å¯¹è±¡ã€‚åœ¨å¤šçº¿ç¨‹æ¨¡å¼ä¸­ï¼Œè€ƒè™‘åˆ°æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©ä¸‹é¢ä¸¤ç§æ¯”è¾ƒç»å…¸çš„å•ä¾‹æ¨¡å¼ï¼Œåœ¨æ€§èƒ½æé«˜çš„åŒæ—¶ï¼Œåˆä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ å•ä¾‹æ¨èçš„å†™æ³•æœ‰dubble check instanceï¼Œstatic inner class(é™æ€å†…éƒ¨ç±»çš„æ¨¡å¼)ï¼Œå› ä¸ºç®€å•å®‰å…¨ï¼Œæºç”Ÿå°±æ”¯æŒå¤šçº¿ç¨‹ï¼Œå¯¹å¤šçº¿ç¨‹æ¯”è¾ƒå‹å¥½ï¼Œå› æ­¤æ¨èé™æ€å†…éƒ¨çš„å†™æ³•ã€‚ 2.1 é¥¿æ±‰æ¨¡å¼è¿™ç§æ–¹æ³•éå¸¸ç®€å•ï¼Œå› ä¸ºå•ä¾‹çš„å®ä¾‹è¢«å£°æ˜æˆ static å’Œ final å˜é‡äº†ï¼Œåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»åˆ°å†…å­˜ä¸­æ—¶å°±ä¼šåˆå§‹åŒ–ï¼Œæ‰€ä»¥åˆ›å»ºå®ä¾‹æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 123456789 public class Singleton&#123; //ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ– private static final Singleton instance = new Singleton(); private Singleton()&#123;&#125; public static Singleton getInstance()&#123; return instance; &#125;&#125; è¿™ç§å†™æ³•å¦‚æœå®Œç¾çš„è¯ï¼Œå°±æ²¡å¿…è¦åœ¨å•°å—¦é‚£ä¹ˆå¤šåŒæ£€é”çš„é—®é¢˜äº†ã€‚ç¼ºç‚¹æ˜¯å®ƒä¸æ˜¯ä¸€ç§æ‡’åŠ è½½æ¨¡å¼ï¼ˆlazy initializationï¼‰ï¼Œå•ä¾‹ä¼šåœ¨åŠ è½½ç±»åä¸€å¼€å§‹å°±è¢«åˆå§‹åŒ–ï¼Œå³ä½¿å®¢æˆ·ç«¯æ²¡æœ‰è°ƒç”¨ getInstance()æ–¹æ³•ã€‚é¥¿æ±‰å¼çš„åˆ›å»ºæ–¹å¼åœ¨ä¸€äº›åœºæ™¯ä¸­å°†æ— æ³•ä½¿ç”¨ï¼šè­¬å¦‚ Singleton å®ä¾‹çš„åˆ›å»ºæ˜¯ä¾èµ–å‚æ•°æˆ–è€…é…ç½®æ–‡ä»¶çš„ï¼Œåœ¨ getInstance() ä¹‹å‰å¿…é¡»è°ƒç”¨æŸä¸ªæ–¹æ³•è®¾ç½®å‚æ•°ç»™å®ƒï¼Œé‚£æ ·è¿™ç§å•ä¾‹å†™æ³•å°±æ— æ³•ä½¿ç”¨äº†ã€‚ 2.2 æšä¸¾å†™æ³• ç”¨æšä¸¾å†™å•ä¾‹å®åœ¨å¤ªç®€å•äº†ï¼è¿™ä¹Ÿæ˜¯å®ƒæœ€å¤§çš„ä¼˜ç‚¹ã€‚ä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯å£°æ˜æšä¸¾å®ä¾‹çš„é€šå¸¸åšæ³•ã€‚ 123 public enum EasySingleton&#123; INSTANCE;&#125; å¯ä»¥é€šè¿‡EasySingleton.INSTANCEæ¥è®¿é—®å®ä¾‹ï¼Œè¿™æ¯”è°ƒç”¨getInstance()æ–¹æ³•ç®€å•å¤šäº†ã€‚åˆ›å»ºæšä¸¾é»˜è®¤å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒdouble checked lockingï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–å¯¼è‡´é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ 2.3 æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨12345678910 public class Singleton &#123; private static Singleton instance; private Singleton ()&#123;&#125; public static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; è¿™æ®µä»£ç ç®€å•æ˜äº†ï¼Œè€Œä¸”ä½¿ç”¨äº†æ‡’åŠ è½½æ¨¡å¼ï¼Œä½†æ˜¯å´å­˜åœ¨è‡´å‘½çš„é—®é¢˜ã€‚å½“æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè°ƒç”¨ getInstance() çš„æ—¶å€™ï¼Œå°±ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å¤šçº¿ç¨‹ä¸‹ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ 2.4 æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†æ•´ä¸ª getInstance() æ–¹æ³•è®¾ä¸ºåŒæ­¥ï¼ˆsynchronizedï¼‰ã€‚ 123456 public static synchronized Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance;&#125; è™½ç„¶åšåˆ°äº†çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”è§£å†³äº†å¤šå®ä¾‹çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é«˜æ•ˆã€‚å› ä¸ºåœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ getInstance() æ–¹æ³•ã€‚ä½†æ˜¯åŒæ­¥æ“ä½œåªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰è¢«éœ€è¦ï¼Œå³ç¬¬ä¸€æ¬¡åˆ›å»ºå•ä¾‹å®ä¾‹å¯¹è±¡æ—¶ã€‚è¿™å°±å¼•å‡ºäº†åŒé‡æ£€éªŒé”ã€‚ 2.5 å•ä¾‹æ¨¡å¼çš„ä¸¤ç§æ¨èå†™æ³•2.5.1 é™æ€å†…éƒ¨ç±»(static inner class)çš„æ–¹å¼ä¸ªäººæ¨èä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæ˜¯ã€ŠEffective Javaã€‹ä¸Šæ‰€æ¨èçš„ 123456789101112131415161718package org.xujin.bf;/** * @author xujin */public class InnerSingleton &#123; //ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œæ„é€ å•ä¾‹ private static class Singletion &#123; private static Singletion single = new Singletion(); &#125; //ç”¨è¿‡æš´éœ²getInstanceæ–¹æ³•ï¼Œreturné™æ€å†…éƒ¨ç±»çš„æ–¹å¼ public static Singletion getInstance()&#123; return Singletion.single; &#125; &#125; è¿™ç§å†™æ³•ä»ç„¶ä½¿ç”¨JVMæœ¬èº«æœºåˆ¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›ç”±äº Singletion æ˜¯ç§æœ‰çš„ï¼Œé™¤äº† getInstance() ä¹‹å¤–æ²¡æœ‰åŠæ³•è®¿é—®å®ƒï¼Œå› æ­¤å®ƒæ˜¯æ‡’æ±‰å¼çš„ï¼›åŒæ—¶è¯»å–å®ä¾‹çš„æ—¶å€™ä¸ä¼šè¿›è¡ŒåŒæ­¥ï¼Œæ²¡æœ‰æ€§èƒ½ç¼ºé™·ï¼›ä¹Ÿä¸ä¾èµ– JDK ç‰ˆæœ¬ã€‚ 2.5.2 Dubble Checkçš„æ–¹å¼ç†è§£æˆDubble Checkçš„å†™æ³•ä¹‹å‰ï¼Œå¤§å®¶å…ˆçœ‹ä¸€ä¸‹ï¼Œæˆ‘åœ¨Janusç½‘å…³é¡¹ç›®çš„ä¸­çš„å†™æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415public class ConfigManager extends Observable &#123; private static ConfigManager instance; private ConfigManager() &#123;&#125; public static ConfigManager getInstance() &#123; if (instance == null) &#123; synchronized (ConfigManager.class) &#123; if (instance == null) &#123; instance = new ConfigManager(); &#125; &#125; &#125; return instance; &#125; &#125; åŒé‡æ£€éªŒé”æ¨¡å¼ï¼ˆdouble checked locking patternï¼‰ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨åŒæ­¥å—åŠ é”çš„æ–¹æ³•ã€‚ç¨‹åºå‘˜ç§°å…¶ä¸ºåŒé‡æ£€æŸ¥é”ï¼Œå› ä¸ºä¼šæœ‰ä¸¤æ¬¡æ£€æŸ¥ instance == nullï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å¤–ï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å†…ã€‚ä¸ºä»€ä¹ˆåœ¨åŒæ­¥å—å†…è¿˜è¦å†æ£€éªŒä¸€æ¬¡ï¼Ÿå› ä¸ºå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·è¿›å…¥åŒæ­¥å—å¤–çš„ ifï¼Œå¦‚æœåœ¨åŒæ­¥å—å†…ä¸è¿›è¡ŒäºŒæ¬¡æ£€éªŒçš„è¯å°±ä¼šç”Ÿæˆå¤šä¸ªå®ä¾‹äº†ã€‚ 2.5.2.1 åªåšä¸€æ¬¡checkçš„å†™æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class DubbleSingleton &#123; private static DubbleSingleton ds; public static DubbleSingleton getDs()&#123; //ç¬¬ä¸€æ¬¡check if(ds == null)&#123; try &#123; //æ¨¡æ‹Ÿåˆå§‹åŒ–å¯¹è±¡çš„å‡†å¤‡æ—¶é—´... Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (DubbleSingleton.class) &#123; ds = new DubbleSingleton(); &#125; &#125; return ds; &#125; public static void main(String[] args) &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;,\"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;,\"t2\"); Thread t3 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;,\"t3\"); t1.start(); t2.start(); t3.start(); &#125; &#125; ä¸‰ä¸ªçº¿ç¨‹è®¿é—®æ‰§è¡Œç»“æœï¼Œæ‰“å°å‡ºæ¥çš„é¥¿HashCode 12318921053615138969011785098644 å¦‚ä¸Šè¿°æ‰€ç¤ºï¼Œåªåšä¸€æ¬¡checkçš„å†™æ³•ï¼Œå¯¼è‡´ä¸‰ä¸ªçº¿ç¨‹è®¿é—®ï¼ŒhashCodeä¸ä¸€è‡´ï¼ŒåŸå› æ²¡æœ‰åšä¸¤æ¬¡checkã€‚ 2.5.2.2 åšä¸¤æ¬¡checkçš„å†™æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package org.xujin.bf;/** * @author xujin */public class DubbleSingleton &#123; private static DubbleSingleton ds; public static DubbleSingleton getDs() &#123; //???check if (ds == null) &#123; try &#123; //????????????... Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (DubbleSingleton.class) &#123; //???check,??????check? if (ds == null) &#123; ds = new DubbleSingleton(); &#125; &#125; &#125; return ds; &#125; public static void main(String[] args) &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;, \"t2\"); Thread t3 = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(DubbleSingleton.getDs().hashCode()); &#125; &#125;, \"t3\"); t1.start(); t2.start(); t3.start(); &#125;&#125; ä¸‰ä¸ªçº¿ç¨‹è®¿é—®æ‰§è¡Œç»“æœï¼Œæ‰“å°å‡ºæ¥çš„é¥¿HashCode 123786514993786514993786514993 è¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œå¾ˆå¯æƒœï¼Œå®ƒæ˜¯æœ‰é—®é¢˜ã€‚ä¸»è¦åœ¨äºds = new DubbleSingleton();è¿™å¥ï¼Œè¿™å¹¶éæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œäº‹å®ä¸Šåœ¨ JVM ä¸­è¿™å¥è¯å¤§æ¦‚åšäº†ä¸‹é¢ 3 ä»¶äº‹æƒ…ã€‚ 1.ç»™ instance åˆ†é…å†…å­˜ 2.è°ƒç”¨ Singleton çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ 3.å°†instanceå¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥instanceå°±ä¸ºénulläº†ï¼‰ ä½†æ˜¯åœ¨ JVM çš„å³æ—¶ç¼–è¯‘å™¨ä¸­å­˜åœ¨æŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-2-3 ä¹Ÿå¯èƒ½æ˜¯ 1-3-2ã€‚å¦‚æœæ˜¯åè€…ï¼Œåˆ™åœ¨ 3 æ‰§è¡Œå®Œæ¯•ã€2 æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«çº¿ç¨‹äºŒæŠ¢å äº†ï¼Œè¿™æ—¶ instance å·²ç»æ˜¯é null äº†ï¼ˆä½†å´æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹äºŒä¼šç›´æ¥è¿”å› instanceï¼Œç„¶åä½¿ç”¨ï¼Œç„¶åé¡ºç†æˆç« åœ°æŠ¥é”™ ä½†æ˜¯æˆ‘ä»¬åªéœ€è¦å°† instance å˜é‡å£°æ˜æˆ volatileå¦‚ä¸‹æ‰€ç¤ºï¼Œç¤ºä¾‹ä»£ç å°±OKã€‚ 123456789101112131415public class Singleton &#123; private volatile static Singleton instance; //å£°æ˜æˆ volatile private Singleton ()&#123;&#125; public static Singleton getSingleton() &#123; if (instance == null) &#123; synchronized (Singleton.class) &#123; if (instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125; &#125; æœ‰äº›äººè®¤ä¸ºä½¿ç”¨ volatile çš„åŸå› æ˜¯å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¿è¯çº¿ç¨‹åœ¨æœ¬åœ°ä¸ä¼šå­˜æœ‰ instance çš„å‰¯æœ¬ï¼Œæ¯æ¬¡éƒ½æ˜¯å»ä¸»å†…å­˜ä¸­è¯»å–ã€‚ä½†å…¶å®æ˜¯ä¸å¯¹çš„ã€‚ä½¿ç”¨ volatile çš„ä¸»è¦åŸå› æ˜¯å…¶å¦ä¸€ä¸ªç‰¹æ€§ï¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ volatile å˜é‡çš„èµ‹å€¼æ“ä½œåé¢ä¼šæœ‰ä¸€ä¸ªå†…å­˜å±éšœï¼ˆç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¸Šï¼‰ï¼Œè¯»æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå–æ“ä½œå¿…é¡»åœ¨æ‰§è¡Œå®Œ 1-2-3 ä¹‹åæˆ–è€… 1-3-2 ä¹‹åï¼Œä¸å­˜åœ¨æ‰§è¡Œåˆ° 1-3 ç„¶åå–åˆ°å€¼çš„æƒ…å†µã€‚ä»ã€Œå…ˆè¡Œå‘ç”ŸåŸåˆ™ã€çš„è§’åº¦ç†è§£çš„è¯ï¼Œå°±æ˜¯å¯¹äºä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼ˆè¿™é‡Œçš„â€œåé¢â€æ˜¯æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºï¼‰ã€‚ ä½†æ˜¯ç‰¹åˆ«æ³¨æ„åœ¨ jdk 1.5 ä»¥å‰çš„ç‰ˆæœ¬ä½¿ç”¨äº† volatile çš„åŒæ£€é”è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚å…¶åŸå› æ˜¯ Java 5 ä»¥å‰çš„ JMM ï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰æ˜¯å­˜åœ¨ç¼ºé™·çš„ï¼Œå³æ—¶å°†å˜é‡å£°æ˜æˆ volatile ä¹Ÿä¸èƒ½å®Œå…¨é¿å…é‡æ’åºï¼Œä¸»è¦æ˜¯ volatile å˜é‡å‰åçš„ä»£ç ä»ç„¶å­˜åœ¨é‡æ’åºé—®é¢˜ã€‚è¿™ä¸ª volatile å±è”½é‡æ’åºçš„é—®é¢˜åœ¨ jdk 1.5 ä¸­æ‰å¾—ä»¥ä¿®å¤ï¼Œæ‰€ä»¥åœ¨è¿™ä¹‹åæ‰å¯ä»¥æ”¾å¿ƒä½¿ç”¨ volatile åœ¨JDK1.5åŠå…¶åç»­ç‰ˆæœ¬ä¸­ï¼Œæ‰©å……äº†volatileè¯­ä¹‰ï¼Œç³»ç»Ÿå°†ä¸å…è®¸å¯¹ å†™å…¥ä¸€ä¸ªvolatileå˜é‡çš„æ“ä½œä¸å…¶ä¹‹å‰çš„ä»»ä½•è¯»å†™æ“ä½œ é‡æ–°æ’åºï¼Œä¹Ÿä¸å…è®¸å°† è¯»å–ä¸€ä¸ªvolatileå˜é‡çš„æ“ä½œä¸å…¶ä¹‹åçš„ä»»ä½•è¯»å†™æ“ä½œ é‡æ–°æ’åºã€‚ ä¸‰.å‚è€ƒæ–‡ç« ä½¿ç”¨å•ä¾‹æ¨¡å¼éœ€è¦æ³¨æ„çš„å‡ ä¸ªé—®é¢˜ åŒé‡æ£€æŸ¥é”å®šå¤±è´¥å¯èƒ½æ€§","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"Mybatisä»£ç ç”Ÿæˆ+åˆ†é¡µ+Mapperç»§æ‰¿æ‰©å±•","slug":"mybatis/mybatis-01","date":"2017-08-25T06:00:00.000Z","updated":"2019-01-13T05:39:37.968Z","comments":true,"path":"mybatis/mybatis-01/","link":"","permalink":"http://xujin.org/mybatis/mybatis-01/","excerpt":"æ‘˜è¦ æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä½¿ç”¨mybatis-genneratorå¿«é€Ÿç”Ÿæˆä»£ç ï¼Œä½†æ˜¯æ¯æ¬¡ç”Ÿæˆçš„Mapperæˆ–æ¥å£éƒ½ä¼šè¦†ç›–è‡ªå®šä¹‰çš„Mapperï¼Œå› æ­¤ä»‹ç»äº†Mapperæ¥å£çš„ç»§æ‰¿æ–¹å¼è§£å†³ï¼Œè¿˜ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨åˆ†é¡µå·¥å…·ä½¿ç”¨pagehelperç»“åˆMybatiså¿«é€Ÿå®ç°åˆ†é¡µã€‚ ä¸€. mybatis-gennerator1.1 mybatis-genneratorè‡ªåŠ¨ç”Ÿæˆä»£ç 1.1.1 mybatis-genneratorçš„å®‰è£…Mybatis-Generatorçš„ä¸‹è½½åœ°å€:https://github.com/mybatis/generator/releases åœ¨Eclipseå®‰è£…mybatis-genneratoræ’ä»¶ã€‚ https://marketplace.eclipse.org/content/mybatis-generator","text":"æ‘˜è¦ æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä½¿ç”¨mybatis-genneratorå¿«é€Ÿç”Ÿæˆä»£ç ï¼Œä½†æ˜¯æ¯æ¬¡ç”Ÿæˆçš„Mapperæˆ–æ¥å£éƒ½ä¼šè¦†ç›–è‡ªå®šä¹‰çš„Mapperï¼Œå› æ­¤ä»‹ç»äº†Mapperæ¥å£çš„ç»§æ‰¿æ–¹å¼è§£å†³ï¼Œè¿˜ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨åˆ†é¡µå·¥å…·ä½¿ç”¨pagehelperç»“åˆMybatiså¿«é€Ÿå®ç°åˆ†é¡µã€‚ ä¸€. mybatis-gennerator1.1 mybatis-genneratorè‡ªåŠ¨ç”Ÿæˆä»£ç 1.1.1 mybatis-genneratorçš„å®‰è£…Mybatis-Generatorçš„ä¸‹è½½åœ°å€:https://github.com/mybatis/generator/releases åœ¨Eclipseå®‰è£…mybatis-genneratoræ’ä»¶ã€‚ https://marketplace.eclipse.org/content/mybatis-generator 2.åœ¨é¡¹ç›®ä¸­å®‰è£…Mavenæ’ä»¶ 123456789101112131415161718192021222324252627282930313233&lt;build&gt; &lt;finalName&gt;janus-admin&lt;/finalName&gt; &lt;pluginManagement&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;version&gt;3.3&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;6.0.6&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;configuration&gt; &lt;!--é…ç½®æ–‡ä»¶çš„è·¯å¾„ --&gt; &lt;configurationFile&gt;$&#123;basedir&#125;/generatorConfig.xml&lt;/configurationFile&gt; &lt;overwrite&gt;true&lt;/overwrite&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;/build&gt; ä½¿ç”¨å‘½ä»¤:mybatis-generator:generateç”Ÿæˆ æ¨èå®‰è£…IDEæ’ä»¶çš„æ–¹å¼æˆ–è€…Mavenæ’ä»¶çš„æ–¹å¼ï¼Œç”Ÿæˆçš„ä»£ç ç›´æ¥åˆ·æ–°å·¥ç¨‹å³å¯ generatorConfig.xmlç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE generatorConfiguration PUBLIC \"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN\" \"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd\" &gt; &lt;generatorConfiguration&gt; &lt;!-- æ•°æ®åº“é©±åŠ¨åŒ…ä½ç½® --&gt; &lt;classPathEntry location=\"D:\\develop\\apache-maven-3.5.0\\res\\mysql\\mysql-connector-java\\5.1.35\\mysql-connector-java-5.1.35.jar\" /&gt; &lt;context id=\"context1\"&gt; &lt;commentGenerator&gt; &lt;!-- æ˜¯å¦å»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt; &lt;property name=\"suppressAllComments\" value=\"true\"/&gt; &lt;/commentGenerator&gt; &lt;!-- æ•°æ®åº“é“¾æ¥URLã€ç”¨æˆ·åã€å¯†ç  --&gt; &lt;jdbcConnection driverClass=\"com.mysql.jdbc.Driver\" connectionURL=\"jdbc:mysql://ä¸»æœº:3306/æ•°æ®åº“\" userId=\"ç”¨æˆ·å\" password=\"å¯†ç \" /&gt; &lt;!-- ç”Ÿæˆæ¨¡å‹çš„åŒ…åå’Œä½ç½® --&gt; &lt;javaModelGenerator targetPackage=\"org.xujin.janus.admin.entity\" targetProject=\"janus-admin/src/main/java\" /&gt; &lt;!-- ç”Ÿæˆçš„æ˜ å°„æ–‡ä»¶æŠ¥åå’Œä½ç½® --&gt; &lt;sqlMapGenerator targetPackage=\"mapper\" targetProject=\"janus-admin/src/main/resources\" /&gt; &lt;!-- ç”ŸæˆDAOçš„åŒ…åå’Œä½ç½® --&gt; &lt;javaClientGenerator targetPackage=\"org.xujin.janus.admin.mapper\" targetProject=\"janus-admin/src/main/java\" type=\"XMLMAPPER\" /&gt; &lt;!-- è¦ç”Ÿæˆçš„é‚£äº›è¡¨(æ›´æ”¹tableName å’ŒdomainObjectName å°±å¯ä»¥äº†) --&gt; &lt;table schema=\"janus_admin\" tableName=\"cluster\" domainObjectName=\"Cluster\" enableCountByExample=\"false\" enableUpdateByExample=\"false\" enableDeleteByExample=\"false\" enableSelectByExample=\"false\" selectByExampleQueryId=\"false\"&gt; &lt;/table&gt; &lt;table schema=\"janus_admin\" tableName=\"route_info\" domainObjectName=\"RouteInfo\" enableCountByExample=\"false\" enableUpdateByExample=\"false\" enableDeleteByExample=\"false\" enableSelectByExample=\"false\" selectByExampleQueryId=\"false\"&gt; &lt;/table&gt; &lt;!-- æˆ–è€…ä½¿ç”¨ tableName=\"%\"é€šé…å…¨éƒ¨ç”Ÿæˆ &lt;table tableName=\"%\" enableCountByExample=\"false\" enableUpdateByExample=\"false\" enableDeleteByExample=\"false\" enableSelectByExample=\"false\" selectByExampleQueryId=\"false\"&gt; &lt;!--mysql é…ç½®--&gt; &lt;generatedKey column=\"id\" sqlStatement=\"Mysql\" identity=\"true\"/&gt; &lt;!--oracle é…ç½®--&gt; &lt;!--&lt;generatedKey column=\"id\" sqlStatement=\"select SEQ_&#123;1&#125;.nextval from dual\" identity=\"false\" type=\"pre\"/&gt;--&gt; &lt;/table&gt; --&gt; &lt;/context&gt; &lt;/generatorConfiguration&gt; äºŒ.Mybatisåˆ†é¡µæ’ä»¶2.1 å¼•å…¥mavenä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt; &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.3&lt;/version&gt;&lt;/dependency&gt; 2.2 ä½¿ç”¨pagehelper1234567891011public interface ExRouteInfoMapper extends RouteInfoMapper &#123; public List&lt;RouteInfo&gt; selectAll(); /** * åˆ†é¡µæŸ¥è¯¢æ•°æ® * @return */ Page&lt;RouteInfo&gt; findByPage();&#125; ä¸šåŠ¡å±‚ä½¿ç”¨ä»£ç ç¤ºli 1234567@Overridepublic PageInfo&lt;RouteInfo&gt; findByPage(int pageNo, int pageSize) &#123; PageHelper.startPage(pageNo, pageSize); Page&lt;RouteInfo&gt; pagelist = routeMapper.findByPage(); PageInfo&lt;RouteInfo&gt; pageInfo = new PageInfo&lt;&gt;(pagelist); return pageInfo;&#125; ä¸‰.Mybatisçš„Mapperç»§æ‰¿3.1 ä¸ºä»€ä¹ˆä½¿ç”¨Mapperç»§æ‰¿ä½¿ç”¨mybatis-genneratorè‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œæ¯æ¬¡è‡ªåŠ¨ç”Ÿæˆä»£ç éƒ½ä¼šè¦†ç›–ä¹‹å‰çš„Mapperæ–‡ä»¶ï¼Œä¸ºäº†å°†è‡ªå®šä¹‰çš„Mapperå’Œæ¥å£ä¸ç”Ÿæˆçš„Mapperä¸æ¥å£åˆ†å¼€ï¼Œä½¿ç”¨ç»§æ‰¿æ–¹å¼å¤„ç†ã€‚ 3.2 ä»£ç ç¤ºä¾‹å¤„ç†1.mybatis-genneratorè‡ªåŠ¨ç”Ÿæˆçš„Mapperæ¥å£ 12345678910111213public interface RouteInfoMapper &#123; int deleteByPrimaryKey(Long id); int insert(RouteInfo record); int insertSelective(RouteInfo record); RouteInfo selectByPrimaryKey(Long id); int updateByPrimaryKeySelective(RouteInfo record); int updateByPrimaryKey(RouteInfo record);&#125; 2.è‡ªåŠ¨ç”Ÿæˆçš„Mapperæ–‡ä»¶ 123456789101112&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"org.xujin.janus.admin.mapper.RouteInfoMapper\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"org.xujin.janus.admin.entity.RouteInfo\"&gt; &lt;id column=\"id\" jdbcType=\"BIGINT\" property=\"id\" /&gt; &lt;result column=\"domain_id\" jdbcType=\"INTEGER\" property=\"domainId\" /&gt; &lt;result column=\"type\" jdbcType=\"VARCHAR\" property=\"type\" /&gt; &lt;result column=\"name\" jdbcType=\"VARCHAR\" property=\"name\" /&gt; &lt;/resultMap&gt; &lt;!-- å…¶ä½™çœç•¥ --&gt;&lt;/mapper&gt; 3.ç»§æ‰¿RouteInfoMapperæ‰©å±•çš„æ¥å£ 1234567891011public interface ExRouteInfoMapper extends RouteInfoMapper &#123; public List&lt;RouteInfo&gt; selectAll(); /** * åˆ†é¡µæŸ¥è¯¢æ•°æ® * @return */ Page&lt;RouteInfo&gt; findByPage();&#125; 4.æ‰©å±•çš„Mapperæ–‡ä»¶ 123456789101112&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"org.xujin.janus.admin.mapper.ex.ExRouteInfoMapper\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"org.xujin.janus.admin.entity.RouteInfo\"&gt; &lt;id column=\"id\" jdbcType=\"BIGINT\" property=\"id\" /&gt; &lt;result column=\"domain_id\" jdbcType=\"INTEGER\" property=\"domainId\" /&gt; &lt;result column=\"type\" jdbcType=\"VARCHAR\" property=\"type\" /&gt; &lt;result column=\"name\" jdbcType=\"VARCHAR\" property=\"name\" /&gt; &lt;/resultMap&gt; &lt;!-- å…¶ä½™çœç•¥ --&gt;&lt;/mapper&gt; 5.Serviceå±‚ä¾èµ–æ³¨å…¥ExRouteInfoMapperä½¿ç”¨ 1234567891011121314@Service@Transactional(readOnly = true)public class RouteInfoServiceImpl implements RouteInfoService &#123; @Autowired private ExRouteInfoMapper routeMapper; @Override @Transactional public void insert(RouteInfoModel routeInfoModel) &#123; RouteInfo RouteInfo = BeanMapper.map(routeInfoModel, RouteInfo.class); routeMapper.insert(RouteInfo); &#125;&#125;","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"http://xujin.org/categories/MyBatis/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"MyBatis","slug":"MyBatis","permalink":"http://xujin.org/tags/MyBatis/"}]},{"title":"Spring Bootæ‚è°ˆæ€»ç»“(ä¸€)","slug":"sb/sb-01","date":"2017-08-23T06:00:00.000Z","updated":"2019-01-13T05:38:53.480Z","comments":true,"path":"sb/sb-01/","link":"","permalink":"http://xujin.org/sb/sb-01/","excerpt":"æ‘˜è¦ æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»åœ¨Spring Bootä¸­ä½¿ç”¨Fastjsonä»£æ›¿Jacksonï¼Œä»¥åŠå®ç°è‡ªå·±çš„è‡ªå®šä¹‰å¼‚å¸¸å’Œæ‰©å±•Spring MVCå…¨å±€å¼‚å¸¸è§£æå™¨ï¼Œä»¥åŠä¸ºäº†ç»™å‰ç«¯æµ‹è¯•æä¾›æ¥å£æ–‡æ¡£Spring Booté›†æˆswaggerï¼Œä»¥åŠé›†æˆswaggeré‡åˆ°é—®é¢˜çš„å¤„ç†ã€‚ ä¸€.Spring Bootä¸­ä½¿ç”¨Fastjsonä»£æ›¿Jackson1.1 ä¸ºä»€ä¹ˆä½¿ç”¨Fastjsonä»£æ›¿Jackson Jacksonæœ€ä¸»è¦çš„åŸå› æ˜¯Jacksonåœ¨å¤„ç†å¯¹è±¡ä¹‹å‰çš„å¾ªç¯åµŒå¥—å…³ç³»æ—¶ä¸ä¾¿ã€‚ä»€ä¹ˆæ˜¯å¯¹è±¡é—´çš„å¾ªç¯åµŒå¥—ï¼Ÿæ¯”å¦‚Aæœ‰ä¸€ä¸ªListï¼ŒBå¯¹è±¡é‡Œåˆæœ‰ä¸€ä¸ªAå¯¹è±¡ï¼Œå½“ç„¶è¿”å›Aå¯¹è±¡çš„Jsonå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœæ˜¯Jacksonå°±ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œå› ä¸ºJacksonå¤©ç”Ÿä¸å…·å¤‡å¤„ç†è¿™ç§å…³ç³»çš„èƒ½åŠ›ï¼Œè€ŒFastjsonæ­£å¥½å…·å¤‡äº†è¿™ç§èƒ½åŠ›ã€‚ å¦‚æœä½ ç”¨çš„æ˜¯ Jacksonï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„æ³¨è§£æ¥æ”¯æŒå¯¹è±¡é—´çš„å¾ªç¯åµŒå¥—ã€‚å¯ä»¥ç™¾åº¦Jacksonå¾ªç¯åµŒå¥—ã€‚","text":"æ‘˜è¦ æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»åœ¨Spring Bootä¸­ä½¿ç”¨Fastjsonä»£æ›¿Jacksonï¼Œä»¥åŠå®ç°è‡ªå·±çš„è‡ªå®šä¹‰å¼‚å¸¸å’Œæ‰©å±•Spring MVCå…¨å±€å¼‚å¸¸è§£æå™¨ï¼Œä»¥åŠä¸ºäº†ç»™å‰ç«¯æµ‹è¯•æä¾›æ¥å£æ–‡æ¡£Spring Booté›†æˆswaggerï¼Œä»¥åŠé›†æˆswaggeré‡åˆ°é—®é¢˜çš„å¤„ç†ã€‚ ä¸€.Spring Bootä¸­ä½¿ç”¨Fastjsonä»£æ›¿Jackson1.1 ä¸ºä»€ä¹ˆä½¿ç”¨Fastjsonä»£æ›¿Jackson Jacksonæœ€ä¸»è¦çš„åŸå› æ˜¯Jacksonåœ¨å¤„ç†å¯¹è±¡ä¹‹å‰çš„å¾ªç¯åµŒå¥—å…³ç³»æ—¶ä¸ä¾¿ã€‚ä»€ä¹ˆæ˜¯å¯¹è±¡é—´çš„å¾ªç¯åµŒå¥—ï¼Ÿæ¯”å¦‚Aæœ‰ä¸€ä¸ªListï¼ŒBå¯¹è±¡é‡Œåˆæœ‰ä¸€ä¸ªAå¯¹è±¡ï¼Œå½“ç„¶è¿”å›Aå¯¹è±¡çš„Jsonå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœæ˜¯Jacksonå°±ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œå› ä¸ºJacksonå¤©ç”Ÿä¸å…·å¤‡å¤„ç†è¿™ç§å…³ç³»çš„èƒ½åŠ›ï¼Œè€ŒFastjsonæ­£å¥½å…·å¤‡äº†è¿™ç§èƒ½åŠ›ã€‚ å¦‚æœä½ ç”¨çš„æ˜¯ Jacksonï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„æ³¨è§£æ¥æ”¯æŒå¯¹è±¡é—´çš„å¾ªç¯åµŒå¥—ã€‚å¯ä»¥ç™¾åº¦Jacksonå¾ªç¯åµŒå¥—ã€‚ 1.2 ä½¿ç”¨Fastjsonä»£æ›¿Jacksonè¿‡ç¨‹1.å¼•å…¥ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.29&lt;/version&gt;&lt;/dependency&gt; ä¸‰ç§å®ç°æ–¹å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package org.xujin.janus.admin.exception;import java.util.ArrayList;import java.util.List;import org.springframework.context.annotation.Configuration;import org.springframework.http.MediaType;import org.springframework.http.converter.HttpMessageConverter;import org.springframework.web.servlet.HandlerExceptionResolver;import org.springframework.web.servlet.config.annotation.EnableWebMvc;import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;import com.alibaba.fastjson.serializer.SerializerFeature;import com.alibaba.fastjson.support.config.FastJsonConfig;import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;/** * Spring MVCå…¨å±€ä¸€åœºè§£æå™¨ * @author xujin * */@Configuration@EnableWebMvcpublic class ApplicationExceptionAdapter extends WebMvcConfigurerAdapter &#123; /** * é…ç½®fastJson ç”¨äºæ›¿ä»£jackson */ @Override public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123; super.configureMessageConverters(converters); // 1.å®šä¹‰ä¸€ä¸ªconvert è½¬æ¢æ¶ˆæ¯çš„å¯¹è±¡ FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter(); // 2 æ·»åŠ fastjson çš„é…ç½®ä¿¡æ¯ æ¯”å¦‚ æ˜¯å¦è¦æ ¼å¼åŒ– è¿”å›çš„jsonæ•°æ® FastJsonConfig fastJsonConfig = new FastJsonConfig(); fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat); fastConverter.setFastJsonConfig(fastJsonConfig); // è§£å†³ä¹±ç çš„é—®é¢˜ List&lt;MediaType&gt; fastMediaTypes = new ArrayList&lt;&gt;(); fastMediaTypes.add(MediaType.APPLICATION_JSON_UTF8); fastConverter.setSupportedMediaTypes(fastMediaTypes); converters.add(fastConverter); &#125; /** ç”¨è‡ªå·±çš„å…¨å±€å¼‚å¸¸è§£æå™¨æ›¿æ¢Spring MVCæœ¬èº«çš„å¼‚å¸¸è§£æå™¨ **/ @Override public void configureHandlerExceptionResolvers( List&lt;HandlerExceptionResolver&gt; exceptionResolvers) &#123; exceptionResolvers.add(new ApplicationExceptionResolver()); super.configureHandlerExceptionResolvers(exceptionResolvers); &#125;&#125; æˆ–è€… 1234567891011121314151617181920212223242526@EnableWebMvcpublic class JanusAdminApplication extends WebMvcConfigurerAdapter &#123; /** * é…ç½®fastJson ç”¨äºæ›¿ä»£jackson */ @Override public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123; super.configureMessageConverters(converters); // 1.å®šä¹‰ä¸€ä¸ªconvert è½¬æ¢æ¶ˆæ¯çš„å¯¹è±¡ FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter(); // 2 æ·»åŠ fastjson çš„é…ç½®ä¿¡æ¯ æ¯”å¦‚ æ˜¯å¦è¦æ ¼å¼åŒ– è¿”å›çš„jsonæ•°æ® FastJsonConfig fastJsonConfig = new FastJsonConfig(); fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat); fastConverter.setFastJsonConfig(fastJsonConfig); // è§£å†³ä¹±ç çš„é—®é¢˜ List&lt;MediaType&gt; fastMediaTypes = new ArrayList&lt;&gt;(); fastMediaTypes.add(MediaType.APPLICATION_JSON_UTF8); fastConverter.setSupportedMediaTypes(fastMediaTypes); converters.add(fastConverter); &#125; public static void main(String[] args) &#123; SpringApplication.run(JanusAdminApplication.class, args); &#125;&#125; äºŒ.Spring Bootè‡ªå®šä¹‰Spring MVCå¼‚å¸¸è§£æå™¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package org.xujin.janus.admin.exception;import java.io.IOException;import java.util.Arrays;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.apache.log4j.Logger;import org.apache.shiro.authz.UnauthenticatedException;import org.springframework.web.servlet.HandlerExceptionResolver;import org.springframework.web.servlet.ModelAndView;import org.xujin.janus.admin.base.ResultData;import org.xujin.janus.admin.constant.Config;import org.xujin.janus.admin.utils.FastjsonFilterUtil;import org.xujin.janus.admin.utils.ResourcesUtil;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;/** * @author xujin * @Description: å…¨å±€å¼‚å¸¸å¤„ç†å™¨ */public class ApplicationExceptionResolver implements HandlerExceptionResolver &#123; /** * Logç±» */ private Logger logger = Logger.getLogger(getClass()); @Override public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) &#123; logger.info(\"å¼‚å¸¸æ‹¦æˆªå™¨æ‰§è¡Œå¼€å§‹ã€‚\"); // è¾“å‡º å¼‚å¸¸ä¿¡æ¯ String msgContent = ResourcesUtil.getValue(Config.MESSAGE, ex.getMessage()); logger.error(\"å‘ç”Ÿå¼‚å¸¸:\" + msgContent, ex); // å°†å¼‚å¸¸ä¿¡æ¯è½¬jsonè¾“å‡º this.writeJsonByFilter(response, this.resolveExceptionCustom(ex), null, null); logger.info(\"å¼‚å¸¸æ‹¦æˆªå™¨æ‰§è¡Œç»“æŸã€‚\"); return new ModelAndView(); &#125; /** * å¼‚å¸¸ä¿¡æ¯è§£ææ–¹æ³• * * @param ex */ private ResultData resolveExceptionCustom(Exception ex) &#123; ResultData model = new ResultData(); if (ex instanceof ApplicationException) &#123; // æŠ›å‡ºçš„æ˜¯ç³»ç»Ÿè‡ªå®šä¹‰å¼‚å¸¸ model.setMsgCode(this.getMsgCode(ex)); &#125; else if (ex instanceof UnauthenticatedException) &#123; // æ²¡æœ‰æƒé™çš„å¼‚å¸¸ model.setMsgCode(\"ECOMMON00002\"); &#125; else &#123; // æœªçŸ¥é”™è¯¯ model.setMsgCode(\"ECOMMON00001\"); &#125; return model; &#125; private String getMsgCode(Exception ex) &#123; // è¾“å‡º å¼‚å¸¸ä¿¡æ¯ String msgCode = ex.getMessage(); // è‹¥è¿”å›çš„å¼‚å¸¸ä¸ç›´æ¥æ˜¯è‡ªå®šä¹‰å¼‚å¸¸ï¼Œè€Œæ˜¯ç»è¿‡å°è£…çš„å¼‚å¸¸ if (msgCode.charAt(0) != 'E' &amp;&amp; msgCode.charAt(0) != 'W' &amp;&amp; msgCode.charAt(0) != 'I') &#123; msgCode = ex.getCause().getMessage(); &#125; return msgCode; &#125; /** * å°†å¯¹è±¡è½¬æ¢æˆJSONå­—ç¬¦ä¸²ï¼Œå¹¶å“åº”å›å‰å° */ protected void writeJsonByFilter(HttpServletResponse response, Object object, String[] includesProperties, String[] excludesProperties) &#123; try &#123; // excludesä¼˜å…ˆäºincludes FastjsonFilterUtil filter = new FastjsonFilterUtil(); if (excludesProperties != null &amp;&amp; excludesProperties.length &gt; 0) &#123; filter.getExcludes().addAll(Arrays.&lt;String&gt; asList(excludesProperties)); &#125; if (includesProperties != null &amp;&amp; includesProperties.length &gt; 0) &#123; filter.getIncludes().addAll(Arrays.&lt;String&gt; asList(includesProperties)); &#125; // ä½¿ç”¨SerializerFeature.WriteDateUseDateFormatç‰¹æ€§æ¥åºåˆ—åŒ–æ—¥æœŸæ ¼å¼çš„ç±»å‹ä¸ºyyyy-MM-dd // hh24:mi:ss // ä½¿ç”¨SerializerFeature.DisableCircularReferenceDetectç‰¹æ€§å…³é—­å¼•ç”¨æ£€æµ‹å’Œç”Ÿæˆ String json = JSON.toJSONString(object, filter, SerializerFeature.WriteDateUseDateFormat, SerializerFeature.DisableCircularReferenceDetect); logger.info(\"JSON String is:\" + json); response.setContentType(\"text/html;charset=utf-8\"); response.getWriter().write(json); response.getWriter().flush(); response.getWriter().close(); &#125; catch (IOException e) &#123; logger.error(\"An error occurred when object was converted to JSON\", e); &#125; &#125;&#125; ä¸‰ Spring Booté›†æˆswagger3.1 Spring Booté›†æˆswagger12345678910&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.5.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.5.0&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839package org.xujin.janus.admin.configuration;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.Profile;import springfox.documentation.builders.ApiInfoBuilder;import springfox.documentation.builders.PathSelectors;import springfox.documentation.builders.RequestHandlerSelectors;import springfox.documentation.service.ApiInfo;import springfox.documentation.spi.DocumentationType;import springfox.documentation.spring.web.plugins.Docket;import springfox.documentation.swagger2.annotations.EnableSwagger2;/** * Swagger2 é…ç½® * @author xujin * */@Configuration@EnableSwagger2// åœ¨ç”Ÿäº§ç¯å¢ƒä¸å¼€å¯@Profile(&#123; \"dev\", \"local\" &#125;)public class Swagger2Config &#123; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()).select() .apis(RequestHandlerSelectors .basePackage(\"org.xujin.janus.admin.controller\")) .paths(PathSelectors.any()).build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder().title(\"Janusç½‘å…³ç®¡æ§å¹³å°\").description(\"Janusç½‘å…³ç®¡æ§å¹³å°\") .contact(\"Software_King@qq.com\").version(\"1.0\").build(); &#125;&#125; 3.2 é‡åˆ°çš„é—®é¢˜è®¿é—®http://localhost:8080/swagger-ui.htmlï¼Œæ§åˆ¶å°å‡ºç°é”™è¯¯ 1.é¡µé¢æ˜¾ç¤ºé»˜è®¤æŠ¥é”™é¡µé¢ã€‚åå°æŠ¥é”™ï¼š1No handler found for GET /swagger-ui.html 2.æ˜¾ç¤ºSwaggerç©ºç™½é¡µé¢ åŸå› åˆ†æ:åœ¨è®¿é—®http://localhost:8080/swagger-ui.html æ—¶ï¼Œè¿™ä¸ªswagger-ui.htmlç›¸å…³çš„æ‰€æœ‰å‰ç«¯é™æ€æ–‡ä»¶éƒ½åœ¨springfox-swagger-ui-2.6.1.jaré‡Œé¢ã€‚Spring Bootè‡ªåŠ¨é…ç½®æœ¬èº«ä¸ä¼šè‡ªåŠ¨æŠŠ/swagger-ui.htmlè¿™ä¸ªè·¯å¾„æ˜ å°„åˆ°å¯¹åº”çš„ç›®å½•META-INF/resources/ä¸‹é¢ã€‚æˆ‘ä»¬åŠ ä¸Šè¿™ä¸ªæ˜ å°„å³å¯ã€‚ 1234567891011121314@Configuration@EnableWebMvcpublic class ApplicationExceptionAdapter extends WebMvcConfigurerAdapter &#123; @Override public void addResourceHandlers(ResourceHandlerRegistry registry) &#123; registry.addResourceHandler(\"swagger-ui.html\") .addResourceLocations(\"classpath:/META-INF/resources/\"); registry.addResourceHandler(\"/webjars/**\") .addResourceLocations(\"classpath:/META-INF/resources/webjars/\"); &#125;&#125; å››.å‚è€ƒæ–‡ç«  http://www.cnblogs.com/bingshu/p/6864131.html http://www.jianshu.com/p/840320d431a1","categories":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://xujin.org/categories/Spring-Boot/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://xujin.org/tags/Spring-Boot/"}]},{"title":"è‡ªç ”ç½‘å…³çº³ç®¡Spring Cloud(ä¸€)","slug":"janus/janus-01","date":"2017-08-16T06:00:00.000Z","updated":"2019-01-13T05:25:05.061Z","comments":true,"path":"janus/janus-01/","link":"","permalink":"http://xujin.org/janus/janus-01/","excerpt":"æ‘˜è¦: æœ¬æ–‡ä¸»è¦ä»ç½‘å…³çš„éœ€æ±‚ï¼Œä»¥åŠSpring Cloud Zuulçš„çº¿ç¨‹æ¨¡å‹å’Œæºç ç“¶é¢ˆåˆ†æç»“åˆï¼Œç›®å‰æœ€è¿‘ä¸€æ®µæ—¶é—´è‡ªç ”ç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudçš„ç»éªŒæ±‡æ€»æ•´ç†ã€‚ ä¸€.è‡ªç ”ç½‘å…³çº³ç®¡Spring Cloudçš„åŸå› 1.1 ä¸ºä»€ä¹ˆè¦è‡ªç ”ç½‘å…³1.ç½‘å…³é…ç½®å®æ—¶ç”Ÿæ•ˆï¼Œé…ç½®ç°åº¦ï¼Œå›æ»šç­‰2.ç½‘å…³çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯é˜²åˆ·ï¼Œé™æµï¼ŒWAFç­‰3.åŠ¨æ€Filter ï¼Œç›®å‰Zuulå¯ä»¥åšåˆ°åŠ¨æ€Filterï¼ŒFilteré…ç½®ä¸‹å‘ï¼Œå®æ—¶åŠ¨æ€Filter4.å¯¹ç½‘å…³çš„ç›‘æ§ï¼Œå‘Šè­¦ï¼Œæµé‡è°ƒæ‹¨ï¼Œç½‘å…³é›†ç¾¤ã€‚5.æµç¨‹å®¡è®¡ï¼Œå¢åŠ Dsboardä¾¿æ·çš„æ“ä½œã€‚","text":"æ‘˜è¦: æœ¬æ–‡ä¸»è¦ä»ç½‘å…³çš„éœ€æ±‚ï¼Œä»¥åŠSpring Cloud Zuulçš„çº¿ç¨‹æ¨¡å‹å’Œæºç ç“¶é¢ˆåˆ†æç»“åˆï¼Œç›®å‰æœ€è¿‘ä¸€æ®µæ—¶é—´è‡ªç ”ç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudçš„ç»éªŒæ±‡æ€»æ•´ç†ã€‚ ä¸€.è‡ªç ”ç½‘å…³çº³ç®¡Spring Cloudçš„åŸå› 1.1 ä¸ºä»€ä¹ˆè¦è‡ªç ”ç½‘å…³1.ç½‘å…³é…ç½®å®æ—¶ç”Ÿæ•ˆï¼Œé…ç½®ç°åº¦ï¼Œå›æ»šç­‰2.ç½‘å…³çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯é˜²åˆ·ï¼Œé™æµï¼ŒWAFç­‰3.åŠ¨æ€Filter ï¼Œç›®å‰Zuulå¯ä»¥åšåˆ°åŠ¨æ€Filterï¼ŒFilteré…ç½®ä¸‹å‘ï¼Œå®æ—¶åŠ¨æ€Filter4.å¯¹ç½‘å…³çš„ç›‘æ§ï¼Œå‘Šè­¦ï¼Œæµé‡è°ƒæ‹¨ï¼Œç½‘å…³é›†ç¾¤ã€‚5.æµç¨‹å®¡è®¡ï¼Œå¢åŠ Dsboardä¾¿æ·çš„æ“ä½œã€‚ 1.2 å›é¡¾Webå®¹å™¨çº¿ç¨‹æ¨¡å‹Servletåªæ˜¯åŸºäºJavaæŠ€æœ¯çš„webç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”±å®¹å™¨æ‰˜ç®¡ï¼Œç”¨äºç”ŸæˆåŠ¨æ€å†…å®¹ã€‚Servletå®¹å™¨æ˜¯web Serveræˆ–application server çš„ä¸€éƒ¨åˆ†ï¼Œä¾›åŸºäºRequest/Responseå‘é€æ¨¡å‹çš„ç½‘ç»œæœåŠ¡ï¼Œè§£ç åŸºäºMIMEçš„è¯·æ±‚ï¼Œå¹¶æ ¼å¼åŒ–åŸºäºMIMEçš„å“åº”ã€‚Servletå®¹å™¨åŒ…å«å¹¶ç®¡ç†Servletç”Ÿå‘½å‘¨æœŸã€‚å…¸å‹çš„Servletå®¹å™¨æœ‰Tomcatã€Jettyã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒTomcatåŸºäºNIOçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶åŸºäºå…¸å‹çš„Acceptor/Reactorçº¿ç¨‹æ¨¡å‹ï¼Œåœ¨Tomcatçš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒWorkerçº¿ç¨‹ç”¨æ¥å¤„ç†Requestã€‚å½“å®¹å™¨æ”¶åˆ°ä¸€ä¸ªRequeståï¼Œè°ƒåº¦çº¿ç¨‹ä»Workerçº¿ç¨‹æ± ä¸­é€‰å‡ºä¸€ä¸ªWorkerçº¿ç¨‹ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™è¯¥çº¿ç¨‹ï¼Œç„¶åç”±è¯¥çº¿ç¨‹æ¥æ‰§è¡ŒServletçš„service()æ–¹æ³•ã€‚ä¸”è¯¥workerçº¿ç¨‹åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªRequestè¯·æ±‚ï¼Œå¦‚æœè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é˜»å¡ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œè€Œä¸èƒ½å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚ Servleté»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªå•ä¾‹å¤šçº¿ç¨‹ã€‚ å›åˆ°zuulï¼Œzuulé€»è¾‘çš„å…¥å£æ˜¯ZuulServlet.service(ServletRequest servletRequest, ServletResponse servletResponse)ï¼ŒZuulServletæœ¬è´¨å°±æ˜¯ä¸€ä¸ªServletã€‚ RequestContextæä¾›äº†æ‰§è¡Œfilter Pipelineæ‰€éœ€è¦çš„Contextï¼Œå› ä¸ºServletæ˜¯å•ä¾‹å¤šçº¿ç¨‹ï¼Œè¿™å°±è¦æ±‚RequestContextå³è¦çº¿ç¨‹å®‰å…¨åˆè¦Requestå®‰å…¨ã€‚contextä½¿ç”¨ThreadLocalä¿å­˜ï¼Œè¿™æ ·æ¯ä¸ªworkerçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸å…¶ç»‘å®šçš„RequestContextï¼Œå› ä¸ºworkerä»…èƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªRequestï¼Œè¿™å°±ä¿è¯äº†Request Context å³æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåˆæ˜¯Requestå®‰å…¨çš„ã€‚æ‰€è°“Request å®‰å…¨ï¼Œå³è¯¥Requestçš„Contextä¸ä¼šä¸å…¶ä»–åŒæ—¶å¤„ç†Requestå†²çªã€‚ RequestContextç»§æ‰¿äº†ConcurrentHashMapã€‚ ä¸‰ä¸ªæ ¸å¿ƒçš„æ–¹æ³•preRoute(),route(), postRoute()ï¼Œzuulå¯¹requestå¤„ç†é€»è¾‘éƒ½åœ¨è¿™ä¸‰ä¸ªæ–¹æ³•é‡Œï¼ŒZuulServletäº¤ç»™ZuulRunnerå»æ‰§è¡Œã€‚ç”±äºZuulServletæ˜¯å•ä¾‹ï¼Œå› æ­¤ZuulRunnerä¹Ÿä»…æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ å› æ­¤ç»¼ä¸Šæ‰€è¿°ï¼ŒSpring Cloud Zuulçš„Qpsåœ¨1000-2000Qpsä¹‹é—´æ˜¯æœ‰åŸå› çš„ï¼Œç½‘å…³ä½œä¸ºå¦‚æ­¤é‡è¦çš„ç»„ä»¶ï¼ŒåŸºäºå¦‚ä¸Šæ‰€è¿°çš„éœ€æ±‚ï¼Œè§‰å¾—è‡ªç ”ç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudå¾ˆæœ‰å¿…è¦ã€‚ äºŒ.è‡ªç ”ç½‘å…³çº³ç®¡Spring Cloud2.1 ç½‘å…³æ•´åˆSpring CloudæœåŠ¡æ²»ç†ä½“ç³»2.1.1 æ•´åˆæœåŠ¡æ²»ç†ä½“ç³»æ€è·¯ å¦‚æœæœåŠ¡æ³¨å†Œä¸­å¿ƒä½¿ç”¨çš„æ˜¯Eurekaï¼Œå¯ä»¥ä¸å¼•å…¥Spring Cloud Eurekaç›¸å…³çš„ä¾èµ–ï¼Œç›´æ¥é€šè¿‡å®šæ—¶ä»»åŠ¡å‘èµ·Eureka RESTè¯·æ±‚ï¼Œç½‘å…³è‡ªèº«ç»´æŠ¤ä¸€ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œè‡ªå·±å†™LBï¼Œæ‰¾åˆ°æœåŠ¡åˆ—è¡¨è½¬å‘ã€‚ ä¼˜ç‚¹ï¼šä¸éœ€è¦å¼•å…¥Spring Cloudï¼Œå¯¹ç½‘å…³Serverè¿›è¡Œç˜¦èº«ï¼Œæ´ç™–è®¨åŒå„ç§å¼•å…¥æ— ç”¨çš„jarï¼›ç¼ºç‚¹: æ³¨å†Œä¸­å¿ƒä½¿ç”¨Eurekaï¼Œå¯ä»¥é€šè¿‡Eureka RESTæ¥å£è·å–æœåŠ¡æ³¨å†Œåˆ—è¡¨ï¼Œä½†æ˜¯æ¢æˆZKï¼ŒConsulï¼Œæˆ–è€…Etcdï¼Œç›´æ¥æ­‡èœã€‚ é€šè¿‡é›†æˆSpring Cloud Commonä¸­é«˜åº¦æŠ½è±¡çš„DiscoveryClientã€‚ ä¼˜ç‚¹: é€šè¿‡é«˜åº¦æŠ½è±¡çš„DiscoveryClientï¼Œæ— éœ€å…³å¿ƒå®ç°ç»†èŠ‚å’Œå®šæ—¶ä»»åŠ¡å»åˆ·æ–°æ³¨å†Œåˆ—è¡¨ã€‚ç¼ºç‚¹ï¼šæ¢æ³¨å†Œä¸­å¿ƒï¼Œéœ€è¦ç›¸åº”çš„æ›´æ¢å¯¹åº”é…ç½®å’Œä¾èµ–ï¼Œä¸€å †æœ‰äº›æ— å…³ç´§è¦çš„jarï¼Œéœ€è¦è‡ªå·±å¯¹å…¶ç˜¦èº«ã€‚ 2.1.2 ç½‘å…³æ•´åˆSpring Cloud Eureka1.å¼•å…¥Spring Cloud Eureka Starterï¼Œæ’é™¤ä¸ç”¨çš„ä¾èµ–ï¼Œè¿˜éœ€è¦åŠªåŠ›ç˜¦èº«ingã€‚ 1234567891011121314151617181920212223242526272829&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;version&gt;1.3.1.RELEASE&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-netflix-core&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;groupId&gt;com.netflix.ribbon&lt;/groupId&gt; &lt;artifactId&gt;ribbon-eureka&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt; spring-cloud-starter-archaius &lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt; &lt;groupId&gt;org.hibernate&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; 2ã€åŒZuulä¸€æ ·ï¼ŒæŠŠç½‘å…³è‡ªèº«æ³¨å†Œåˆ°Eureka Serverä¸Šï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–æœåŠ¡æ³¨å†Œåˆ—è¡¨ã€‚ 123456server.port=8082spring.application.name=janus-servereureka.client.service-url.defaultZone=http://localhost:8761/eureka/ PS:é„™è§†çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒSpring Cloudåº”è¯¥æä¾›ä¸€ä¸ªè½»é‡çº§çš„java clientï¼Œé…ç½®æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œè¿˜ä¸éœ€è¦æŠŠç½‘å…³è‡ªèº«æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚åŸå› æ˜¯ï¼šç½‘å…³ä¸­é—´ä»¶ï¼Œä¸éœ€è¦å’ŒæœåŠ¡æ²»ç†æ¡†æ¶è€¦åˆçš„å¾ˆæ·±ã€‚ 2.1.3 Netty Serverä¸Spring Cloudå†…ç½®çš„Serverçš„æ•´åˆNetty Http Servertæä¾›ç«¯å£ç”¨äºæ¥æ”¶ç½‘å…³å¯¹å¤–çš„è¯·æ±‚ï¼ŒSpring Bootå†…ç½®çš„serveræä¾›ç«¯å£ç”¨äºå’ŒGateway-consoleäº¤äº’ï¼Œç›®å‰æ²¡æ‰¾åˆ°Spring Bootå†…ç½®Serverå’ŒNetty ServeråˆäºŒä¸ºä¸€çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸€ä¸ªæœåŠ¡æš´éœ²ä¸¤ä¸ªç«¯å£ï¼Œå¾ˆæœ‰å¿…è¦ã€‚ 1234567891011121314151617181920212223242526272829303132@SpringBootApplication@EnableDiscoveryClientpublic class JanusServerAppliaction &#123; private static Logger logger = LoggerFactory.getLogger(JanusServerAppliaction.class); // éSSLçš„ç›‘å¬HTTPç«¯å£ public static int httpPort = 8081; public static void main(String[] args) throws Exception &#123; //â‘ å…ˆå¯åŠ¨Spring Bootå†…ç½®Server SpringApplication.run(JanusServerAppliaction.class, args); // logger.info(\"services: &#123;&#125;\", context.getBean(\"discoveryClient\", // DiscoveryClient.class).getServices()); logger.info(\"Gateway Server Application Start...\"); // è§£æå¯åŠ¨å‚æ•° parseArgs(args); // åˆå§‹åŒ–ç½‘å…³Filterå’Œé…ç½® logger.info(\"init Gateway Server ...\"); JanusBootStrap.initGateway(); logger.info(\"start netty Server...\"); final JanusNettyServer gatewayServer = new JanusNettyServer(); // â‘¡å¯åŠ¨HTTPå®¹å™¨ gatewayServer.startServer(httpPort); &#125;&#125; NettyServeræœåŠ¡å¯åŠ¨åï¼Œé˜»å¡ç›‘å¬ç«¯å£,ä¼šå¯¼è‡´é›†æˆspring bootå†…ç½®Serverå¯åŠ¨æ— æ—¥å¿—æ‰“å°ï¼Œspring Bootå®¹å™¨ä¹Ÿæ²¡å¯åŠ¨ã€‚å› æ­¤æ³¨æ„å¯åŠ¨é¡ºåºã€‚ 2.2 æé«˜è‡ªç ”ç½‘å…³çš„QPSå¿…æ€æŠ€2.2.1 NettyServeråˆå§‹åŒ–åŠå¯åŠ¨ä»£ç è‡ªç ”ç½‘å…³ä½¿ç”¨nettyè‡ªå¸¦çš„çº¿ç¨‹æ± ï¼Œå…±æœ‰ä¸‰ç»„çº¿ç¨‹æ± ï¼Œåˆ†åˆ«ä¸ºbossGroupã€workerGroupå’ŒexecutorGroupï¼ŒbossGroupç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„TCPè¿æ¥ï¼ŒworkerGroupç”¨äºå¤„ç†I/Oç­‰ï¼ŒexecutorGroupç”¨äºå¤„ç†ç½‘å…³ä½œä¸š(æ‰§è¡ŒFilteré“¾)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public void startServer(int noSSLPort) throws InterruptedException &#123; // httpè¯·æ±‚ChannelInbound final HttpInboundHandler httpInboundHandler = new HttpInboundHandler(); ServerBootstrap insecure = new ServerBootstrap(); insecure.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class) // SO_REUSEADDR,è¡¨ç¤ºå…è®¸é‡å¤ä½¿ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£ .option(ChannelOption.SO_REUSEADDR, Boolean.TRUE) .option(ChannelOption.ALLOCATOR, ByteBufManager.byteBufAllocator) /** * SO_KEEPALIVE * è¯¥å‚æ•°ç”¨äºè®¾ç½®TCPè¿æ¥ï¼Œå½“è®¾ç½®è¯¥é€‰é¡¹ä»¥åï¼Œè¿æ¥ä¼šæµ‹è¯•é“¾æ¥çš„çŠ¶æ€ï¼Œè¿™ä¸ªé€‰é¡¹ç”¨äºå¯èƒ½é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤æµçš„è¿æ¥ã€‚å½“è®¾ç½®è¯¥é€‰é¡¹ä»¥åï¼Œ * å¦‚æœåœ¨ä¸¤å°æ—¶å†…æ²¡æœ‰æ•°æ®çš„é€šä¿¡æ—¶ï¼ŒTCPä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªæ´»åŠ¨æ¢æµ‹æ•°æ®æŠ¥æ–‡ã€‚ */ .childOption(ChannelOption.SO_KEEPALIVE, Boolean.TRUE) .childOption(ChannelOption.TCP_NODELAY, Boolean.TRUE) .childOption(ChannelOption.ALLOCATOR, ByteBufManager.byteBufAllocator) .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override public void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // å¯¹channelç›‘æ§çš„æ”¯æŒ æš‚ä¸æ”¯æŒ // keepalive_timeout çš„æ”¯æŒ pipeline.addLast( new IdleStateHandler(ProperityConfig.keepAliveTimeout, 0, 0, TimeUnit.MILLISECONDS)); // pipeline.addLast(new JanusHermesHandler()); pipeline.addLast(new HttpResponseEncoder()); // ç»è¿‡HttpRequestDecoderä¼šå¾—åˆ°Nä¸ªå¯¹è±¡HttpRequest,first HttpChunk,second // HttpChunk,....HttpChunkTrailer pipeline.addLast(new HttpRequestDecoder( ProperityConfig.maxInitialLineLength, ProperityConfig.maxHeaderSize, 8192, ProperityConfig.validateHeaders)); // æŠŠHttpRequestDecoderå¾—åˆ°çš„Nä¸ªå¯¹è±¡åˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´çš„httpè¯·æ±‚å¯¹è±¡ pipeline.addLast(new HttpObjectAggregator( ProperityConfig.httpAggregatorMaxLength)); // gzipçš„æ”¯æŒ if (ProperityConfig.gzip) &#123; pipeline.addLast(new JanusHttpContentCompressor( ProperityConfig.gzipLevel, ProperityConfig.gzipMinLength)); &#125; pipeline.addLast(httpInboundHandler); &#125; &#125;); ChannelFuture insecureFuture = insecure.bind(noSSLPort).sync(); logger.info(\"[listen HTTP NoSSL][\" + noSSLPort + \"]\"); /** * Wait until the server socket is closed.&lt;/br&gt; * æ‰¾åˆ°ä¹‹å‰çš„æ— æ—¥å¿—æ‰“å°spring å®¹å™¨ä¹Ÿæ²¡å¯åŠ¨çš„åŸå› äº†ï¼Œé›†æˆspring boot * å’Œeurekaæ”¾ä¸Šæ”¾ä¸‹å¹¶ä¸æ˜¯é—®é¢˜ï¼Œæ˜¯å› ä¸ºJanusNettyServeræœåŠ¡å¯åŠ¨åï¼Œé˜»å¡ç›‘å¬ç«¯å£å¯¼è‡´çš„ **/ insecureFuture.channel().closeFuture().sync(); logger.info(\"[stop HTTP NoSSL success]\"); &#125; 2.2.2 åŸºäºNetty Channel Poolå®ç°RESTçš„å¼‚æ­¥è½¬å‘RestInvokerFilterå¼‚æ­¥è½¬å‘Filterï¼ŒåŸºäºNetty Channel Poolå®ç°RESTçš„å¼‚æ­¥è½¬å‘,æé«˜è‡ªç½‘å…³çš„æ€§èƒ½çš„å¿…æ€æŠ€ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class RestInvokerFilter extends AbstractFilter &#123; @Override public void run(final AbstractFilterContext filterContext, final JanusHandleContext janusHandleContext) throws Exception &#123; // è‡ªå®šä¹‰LBä»Spring Cloudä¸­æœåŠ¡æ³¨å†Œç¼“å­˜åˆ—è¡¨ä¸­è·å–æœåŠ¡å®ä¾‹ ServiceInstance serviceInstance = SpringCloudHelper.getServiceInstanceByLB( janusHandleContext, janusHandleContext.getAPIInfo().getRouteServiceId()); // ç”Ÿæˆå‘é€çš„Requestå¯¹è±¡ FullHttpRequest outBoundRequest = getOutBoundHttpRequest(janusHandleContext); // è½¬å‘çš„æ—¶å€™è®¾ç½®LBè·å–åˆ°çš„ä¸»æœºIPå’Œç«¯å£å³å¯ AsyncHttpRequest.builder() .remoteAddress( serviceInstance.getHost() + \":\" + serviceInstance.getPort()) .sessionContext(janusHandleContext) /** * connection holding 500ms */ .holdingTimeout(ProperityConfig.janusHttpPoolOauthMaxHolding).build() .execute(new SimpleHttpCallback(janusHandleContext) &#123; @Override public void onSuccess(FullHttpResponse result) &#123; // testResult(result); janusHandleContext.setRestFullHttpResponse(result); // è·³è½¬åˆ°ä¸‹ä¸€ä¸ªFilter filterContext.skipNextFilter(janusHandleContext); &#125; @Override public void onError(Throwable e) &#123; //çœç•¥ &#125; @Override public void onTimeout() &#123; //çœç•¥ &#125; &#125;, outBoundRequest); &#125; //å…¶ä½™çœç•¥&#125; ä¸‰.è‡ªç ”ç½‘å…³Filteré“¾çš„è®¾è®¡ä¸€å±‚æ¥å£ï¼Œä¸€å±‚ abstractç±»ï¼Œä¸€å±‚åŸºäºEventè§‚å¯Ÿè€…æ¨¡å¼çš„æŠ½è±¡ç±»ï¼Œä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„æ¥å£ï¼Œ è‡ªå®šä¹‰Filteræ ¹æ®éœ€è¦ç»§æ‰¿å¤„ç†ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚ å››.è‡ªç ”ç½‘å…³çº³ç®¡Spring Cloudçš„ç»“æœ4.1 è‡ªç ”ç½‘å…³æ³¨å†Œåˆ°Eureka Serverä¸ŠæŠŠè‡ªç ”ç½‘å…³æ³¨å†Œåˆ°Eureka Serverä¸Šï¼Œç”¨äºè·å–æœåŠ¡åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸Šå›¾ä¸­æœ‰ä¸¤ä¸ªæœåŠ¡æä¾›è€…1ï¼Œ2ï¼Œä»¥åŠä¸€ä¸ªç½‘å…³Serverã€‚ 4.2 æ— ç¼æ”¯æŒRESTè½¬RESTçš„GETå’ŒPOSTçš„è½¬å‘è‡ªå®šä¹‰LBï¼ŒåŸºäºNetty Channel Poolå®ç°äº†GETï¼ŒPOSTçš„åè®®é€‚é…å’Œå¼‚æ­¥è½¬å‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ http://localhost:8081/ï¼Œæ˜¯æœ¬åœ°ç½‘å…³Serverçš„ä¸»æœºå’Œç«¯å£ã€‚ äº”.å‚è€ƒæ–‡ç« Nettyç³»åˆ—ä¹‹Nettyçº¿ç¨‹æ¨¡å‹","categories":[{"name":"Janusç½‘å…³","slug":"Janusç½‘å…³","permalink":"http://xujin.org/categories/Janusç½‘å…³/"}],"tags":[{"name":"ç½‘å…³ä¸­é—´ä»¶","slug":"ç½‘å…³ä¸­é—´ä»¶","permalink":"http://xujin.org/tags/ç½‘å…³ä¸­é—´ä»¶/"}]},{"title":"Spring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(ä¸‰)","slug":"sc/sc-zuul-s3","date":"2017-08-15T06:00:00.000Z","updated":"2019-01-13T05:03:12.947Z","comments":true,"path":"sc/sc-zuul-s3/","link":"","permalink":"http://xujin.org/sc/sc-zuul-s3/","excerpt":"æ‘˜è¦: æ¥ç€ä¸Šä¸€ç¯‡ã€ŠSpring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(äºŒ)ã€‹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»Netflix Zuul coreæ¨¡å—çš„Filteré“¾çš„è®¾è®¡å’ŒFifter Loaderå’ŒFilter Managerç›¸å…³ä»£ç çš„è®¾è®¡ä¸åˆ†æã€‚","text":"æ‘˜è¦: æ¥ç€ä¸Šä¸€ç¯‡ã€ŠSpring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(äºŒ)ã€‹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»Netflix Zuul coreæ¨¡å—çš„Filteré“¾çš„è®¾è®¡å’ŒFifter Loaderå’ŒFilter Managerç›¸å…³ä»£ç çš„è®¾è®¡ä¸åˆ†æã€‚ ä¸€.Zuul Filterçš„æŠ½è±¡è®¾è®¡1.1 è‡ªå®šä¹‰Zuul Filterå½“æˆ‘ä»¬ä½¿ç”¨Spring Cloud Zuuléƒ½ä¼šç›´æ¥ç»§æ‰¿ZuulFilterï¼Œè¦†ç›–å®ç°æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º: 12345678910111213141516171819202122232425262728293031323334public class PreFilter extends ZuulFilter &#123; private static final Logger logger = LoggerFactory.getLogger(PreFilter.class); @Override public String filterType() &#123; return \"pre\"; &#125; @Override public int filterOrder() &#123; return 0; &#125; @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() &#123; RequestContext ctx = RequestContext.getCurrentContext(); String token = ctx.getRequest().getHeader(HttpHeaders.AUTHORIZATION); String labels = TOKEN_LABEL_MAP.get(token); logger.info(\"label: \" + labels); CoreHeaderInterceptor.initHystrixRequestContext(labels); // zuulæœ¬èº«è°ƒç”¨å¾®æœåŠ¡ ctx.addZuulRequestHeader(CoreHeaderInterceptor.HEADER_LABEL, labels); // ä¼ é€’ç»™åç»­å¾®æœåŠ¡ return null; &#125;&#125; 1.2 IZuulFilterä»£ç å®šä¹‰ IZuulFilter interfaceï¼Œå…±åŒçš„å¸¸ç”¨æ–¹æ³• 12345678910111213141516public interface IZuulFilter &#123; /** * a \"true\" return from this method means that the run() method should be invoked * * @return true if the run() method should be invoked. false will not invoke the run() method */ boolean shouldFilter(); /** * if shouldFilter() is true, this method will be invoked. this method is the core method of a ZuulFilter * * @return Some arbitrary artifact may be returned. Current implementation ignores it. */ Object run();&#125; 1.2 æŠ½è±¡ç±»ZuulFilterä»£ç æŠ½è±¡ç±»ZuulFilterå®ç°IZuulFilterï¼Œå¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public abstract class ZuulFilter implements IZuulFilter, Comparable&lt;ZuulFilter&gt; &#123; private final DynamicBooleanProperty filterDisabled = DynamicPropertyFactory.getInstance().getBooleanProperty(disablePropertyName(), false); //filterç±»å‹ abstract public String filterType(); // Filterçš„æ‰§è¡Œé¡ºåº abstract public int filterOrder(); //æ˜¯å¦æ˜¯é™æ€Filter public boolean isStaticFilter() &#123; return true; &#125; public String disablePropertyName() &#123; return \"zuul.\" + this.getClass().getSimpleName() + \".\" + filterType() + \".disable\"; &#125; //Filteræ˜¯å¦å¯åŠ¨ public boolean isFilterDisabled() &#123; return filterDisabled.get(); &#125; public ZuulFilterResult runFilter() &#123; ZuulFilterResult zr = new ZuulFilterResult(); if (!isFilterDisabled()) &#123; if (shouldFilter()) &#123; Tracer t = TracerFactory.instance().startMicroTracer(\"ZUUL::\" + this.getClass().getSimpleName()); try &#123; Object res = run(); zr = new ZuulFilterResult(res, ExecutionStatus.SUCCESS); &#125; catch (Throwable e) &#123; t.setName(\"ZUUL::\" + this.getClass().getSimpleName() + \" failed\"); zr = new ZuulFilterResult(ExecutionStatus.FAILED); zr.setException(e); &#125; finally &#123; t.stopAndLog(); &#125; &#125; else &#123; zr = new ZuulFilterResult(ExecutionStatus.SKIPPED); &#125; &#125; return zr; &#125; public int compareTo(ZuulFilter filter) &#123; return Integer.compare(this.filterOrder(), filter.filterOrder()); &#125; &#125; äºŒ.Spring Cloud Zuulçš„Filterç®¡ç† zuulæ”¯æŒåŠ¨åŠ è½½Filterç±»æ–‡ä»¶ã€‚å®ç°åŸç†æ˜¯ç›‘æ§å­˜æ”¾Filteræ–‡ä»¶çš„ç›®å½•ï¼Œå®šæœŸæ‰«æè¿™äº›ç›®å½•ï¼Œå¦‚æœå‘ç°æœ‰æ–°Filteræºç æ–‡ä»¶æˆ–è€…Filteræºç æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œåˆ™å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘åŠ è½½ã€‚ç›®å‰zuulæ”¯æŒä½¿ç”¨Groovyç¼–å†™çš„Filterã€‚ 2.1 FilterFileManager groovyçš„æ–‡ä»¶filteråŠ è½½,é€šè¿‡FilterFileManagerï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¼€å§‹è½®è¯¢GroovyFilterFileçš„ç›®å½• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137public class FilterFileManager &#123; private static final Logger LOG = LoggerFactory.getLogger(FilterFileManager.class); String[] aDirectories; int pollingIntervalSeconds; Thread poller; boolean bRunning = true; static FilenameFilter FILENAME_FILTER; static FilterFileManager INSTANCE; private FilterFileManager() &#123; &#125; public static void setFilenameFilter(FilenameFilter filter) &#123; FILENAME_FILTER = filter; &#125; /** * Initialized the GroovyFileManager. * * @param pollingIntervalSeconds the polling interval in Seconds * @param directories Any number of paths to directories to be polled may be specified * @throws IOException * @throws IllegalAccessException * @throws InstantiationException */ public static void init(int pollingIntervalSeconds, String... directories) throws Exception, IllegalAccessException, InstantiationException &#123; if (INSTANCE == null) INSTANCE = new FilterFileManager(); INSTANCE.aDirectories = directories; INSTANCE.pollingIntervalSeconds = pollingIntervalSeconds; INSTANCE.manageFiles(); INSTANCE.startPoller(); &#125; public static FilterFileManager getInstance() &#123; return INSTANCE; &#125; /** * Shuts down the poller */ public static void shutdown() &#123; INSTANCE.stopPoller(); &#125; void stopPoller() &#123; bRunning = false; &#125; // å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¼€å§‹è½®è¯¢ void startPoller() &#123; poller = new Thread(\"GroovyFilterFileManagerPoller\") &#123; public void run() &#123; while (bRunning) &#123; try &#123; sleep(pollingIntervalSeconds * 1000); manageFiles(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;; poller.setDaemon(true); poller.start(); &#125; /** * Returns the directory File for a path. A Runtime Exception is thrown if the directory is in valid * * @param sPath * @return a File representing the directory path */ public File getDirectory(String sPath) &#123; File directory = new File(sPath); if (!directory.isDirectory()) &#123; URL resource = FilterFileManager.class.getClassLoader().getResource(sPath); try &#123; directory = new File(resource.toURI()); &#125; catch (Exception e) &#123; LOG.error(\"Error accessing directory in classloader. path=\" + sPath, e); &#125; if (!directory.isDirectory()) &#123; throw new RuntimeException(directory.getAbsolutePath() + \" is not a valid directory\"); &#125; &#125; return directory; &#125; /** * Returns a List&lt;File&gt; of all Files from all polled directories * * @return */ List&lt;File&gt; getFiles() &#123; List&lt;File&gt; list = new ArrayList&lt;File&gt;(); for (String sDirectory : aDirectories) &#123; if (sDirectory != null) &#123; File directory = getDirectory(sDirectory); File[] aFiles = directory.listFiles(FILENAME_FILTER); if (aFiles != null) &#123; list.addAll(Arrays.asList(aFiles)); &#125; &#125; &#125; return list; &#125; /** * puts files into the FilterLoader. The FilterLoader will only addd new or changed filters * * @param aFiles a List&lt;File&gt; * @throws IOException * @throws InstantiationException * @throws IllegalAccessException */ void processGroovyFiles(List&lt;File&gt; aFiles) throws Exception, InstantiationException, IllegalAccessException &#123; for (File file : aFiles) &#123; //æ›´æ–°åˆ™é€šè¿‡FilterLoader.putFilter()ç½®å…¥FilterRegistr FilterLoader.getInstance().putFilter(file); &#125; &#125; //æ¯æ¬¡è½®è¯¢ï¼Œå¤„ç†ç›®å½•å†…çš„æ‰€æœ‰*.groovyæ–‡ä»¶ï¼Œå³è°ƒç”¨FilterLoader.getInstance().putFilter(file); void manageFiles() throws Exception, IllegalAccessException, InstantiationException &#123; List&lt;File&gt; aFiles = getFiles(); processGroovyFiles(aFiles); &#125; &#125; 2.2 FilterLoader com.netflix.zuul.FilterLoaderï¼Œç¼–è¯‘ã€åŠ è½½filteræ–‡ä»¶ï¼Œå¹¶ä¸”æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦æœ‰å˜æ›´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æŒ‰ç…§filterTypeç»„ç»‡å¹¶ç»´æŠ¤List 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152public class FilterLoader &#123; final static FilterLoader INSTANCE = new FilterLoader(); private static final Logger LOG = LoggerFactory.getLogger(FilterLoader.class); private final ConcurrentHashMap&lt;String, Long&gt; filterClassLastModified = new ConcurrentHashMap&lt;String, Long&gt;(); private final ConcurrentHashMap&lt;String, String&gt; filterClassCode = new ConcurrentHashMap&lt;String, String&gt;(); private final ConcurrentHashMap&lt;String, String&gt; filterCheck = new ConcurrentHashMap&lt;String, String&gt;(); private final ConcurrentHashMap&lt;String, List&lt;ZuulFilter&gt;&gt; hashFiltersByType = new ConcurrentHashMap&lt;String, List&lt;ZuulFilter&gt;&gt;(); private FilterRegistry filterRegistry = FilterRegistry.instance(); static DynamicCodeCompiler COMPILER; static FilterFactory FILTER_FACTORY = new DefaultFilterFactory(); /** * Sets a Dynamic Code Compiler * * @param compiler */ public void setCompiler(DynamicCodeCompiler compiler) &#123; COMPILER = compiler; &#125; // overidden by tests public void setFilterRegistry(FilterRegistry r) &#123; this.filterRegistry = r; &#125; /** * Sets a FilterFactory * * @param factory */ public void setFilterFactory(FilterFactory factory) &#123; FILTER_FACTORY = factory; &#125; /** * @return Singleton FilterLoader */ public static FilterLoader getInstance() &#123; return INSTANCE; &#125; /** * Given source and name will compile and store the filter if it detects that the filter code has changed or * the filter doesn't exist. Otherwise it will return an instance of the requested ZuulFilter * * @param sCode source code * @param sName name of the filter * @return the ZuulFilter * @throws IllegalAccessException * @throws InstantiationException */ public ZuulFilter getFilter(String sCode, String sName) throws Exception &#123; if (filterCheck.get(sName) == null) &#123; filterCheck.putIfAbsent(sName, sName); if (!sCode.equals(filterClassCode.get(sName))) &#123; LOG.info(\"reloading code \" + sName); filterRegistry.remove(sName); &#125; &#125; ZuulFilter filter = filterRegistry.get(sName); if (filter == null) &#123; Class clazz = COMPILER.compile(sCode, sName); if (!Modifier.isAbstract(clazz.getModifiers())) &#123; filter = (ZuulFilter) FILTER_FACTORY.newInstance(clazz); &#125; &#125; return filter; &#125; /** * @return the total number of Zuul filters */ public int filterInstanceMapSize() &#123; return filterRegistry.size(); &#125; /** * From a file this will read the ZuulFilter source code, compile it, and add it to the list of current filters * a true response means that it was successful. * * @param file * @return true if the filter in file successfully read, compiled, verified and added to Zuul * @throws IllegalAccessException * @throws InstantiationException * @throws IOException */ public boolean putFilter(File file) throws Exception &#123; String sName = file.getAbsolutePath() + file.getName(); // å¦‚æœæ–‡ä»¶åœ¨ä¸Šæ¬¡åŠ è½½åå‘ç”Ÿäº†å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘åŠ è½½ if (filterClassLastModified.get(sName) != null &amp;&amp; (file.lastModified() != filterClassLastModified.get(sName))) &#123; LOG.debug(\"reloading filter \" + sName); filterRegistry.remove(sName); &#125; ZuulFilter filter = filterRegistry.get(sName); if (filter == null) &#123; // ç¼–è¯‘ã€åŠ è½½æ–‡ä»¶ Class clazz = COMPILER.compile(file); if (!Modifier.isAbstract(clazz.getModifiers())) &#123; filter = (ZuulFilter) FILTER_FACTORY.newInstance(clazz); // æ¸…ç©ºfilter.filterType()ç±»å‹çš„List&lt;Filter&gt;ç¼“å­˜ï¼Œé‡æ–°æ„å»º List&lt;ZuulFilter&gt; list = hashFiltersByType.get(filter.filterType()); if (list != null) &#123; //é‡æ–°æ„å»ºæŸç§ç±»å‹Filterçš„List hashFiltersByType.remove(filter.filterType()); //rebuild this list &#125; //å‘Filter Registryæ”¾å…¥æ–°çš„Filter filterRegistry.put(file.getAbsolutePath() + file.getName(), filter); filterClassLastModified.put(sName, file.lastModified()); return true; &#125; &#125; return false; &#125; /** * æ ¹æ®Filterç±»å‹è¿”å›åŒä¸€ç±»å‹çš„Filter * * @param filterType * @return a List&lt;ZuulFilter&gt; */ public List&lt;ZuulFilter&gt; getFiltersByType(String filterType) &#123; List&lt;ZuulFilter&gt; list = hashFiltersByType.get(filterType); if (list != null) return list; list = new ArrayList&lt;ZuulFilter&gt;(); Collection&lt;ZuulFilter&gt; filters = filterRegistry.getAllFilters(); for (Iterator&lt;ZuulFilter&gt; iterator = filters.iterator(); iterator.hasNext(); ) &#123; ZuulFilter filter = iterator.next(); if (filter.filterType().equals(filterType)) &#123; list.add(filter); &#125; &#125; //æ ¹æ® Collections.sort(list); hashFiltersByType.putIfAbsent(filterType, list); return list; &#125;&#125; æŠŠGroovyæºç è¿›è¡Œç¼–è¯‘å¹¶åŠ è½½è¿›jvmé‡Œã€‚ 2.3 FilterRegistry com.netflix.zuul.filters.FilterRegistryå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ç”¨ConcurrentHashMapï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å­˜å‚¨Filterçš„æ•°æ®ç»“æ„ï¼Œè¿›è¡ŒPutæˆ–Revomeæ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334public class FilterRegistry &#123; private static final FilterRegistry INSTANCE = new FilterRegistry(); public static final FilterRegistry instance() &#123; return INSTANCE; &#125; private final ConcurrentHashMap&lt;String, ZuulFilter&gt; filters = new ConcurrentHashMap&lt;String, ZuulFilter&gt;(); private FilterRegistry() &#123; &#125; public ZuulFilter remove(String key) &#123; return this.filters.remove(key); &#125; public ZuulFilter get(String key) &#123; return this.filters.get(key); &#125; public void put(String key, ZuulFilter filter) &#123; this.filters.putIfAbsent(key, filter); &#125; public int size() &#123; return this.filters.size(); &#125; public Collection&lt;ZuulFilter&gt; getAllFilters() &#123; return this.filters.values(); &#125;&#125; 2.4 DynamicCodeCompiler com.netflix.zuul.DynamicCodeCompiler.java,ä¸»è¦æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰ä¸¤ç§åŠ è½½ç¼–è¯‘æºç çš„æ–¹æ³•ï¼š 12345public interface DynamicCodeCompiler &#123; Class compile(String sCode, String sName) throws Exception; Class compile(File file) throws Exception;&#125; ä¸‰.å‚è€ƒæ–‡ç«  http://microservices.io/patterns/apigateway.html","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Zuul","slug":"Spring-Cloud-Zuul","permalink":"http://xujin.org/tags/Spring-Cloud-Zuul/"}]},{"title":"Spring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(äºŒ)","slug":"sc/sc-zuul-s2","date":"2017-08-14T06:00:00.000Z","updated":"2019-01-13T05:03:44.866Z","comments":true,"path":"sc/sc-zuul-s2/","link":"","permalink":"http://xujin.org/sc/sc-zuul-s2/","excerpt":"æ‘˜è¦: æ¥ç€ä¸Šä¸€ç¯‡ã€ŠSpring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(ä¸€)ã€‹ï¼ŒZuulControllerç»§æ‰¿äº†ServletWrappingControllerï¼Œå°†å½“å‰åº”ç”¨ä¸­çš„ZuulServletç›´æ¥åŒ…è£…ä¸ºä¸€ä¸ªControllerï¼Œæš´éœ²ä¸ºå…¥å£è®¿é—®ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä»‹ç»etflix-zuul-coreçš„ä»£ç Zuulçš„æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚ ä¸€.Netflix zuul coreæºç åˆ†æcom.netflix.zuul.http.ZuulServletæ˜¯ZuulFilteré“¾æ‰§è¡Œçš„å…¥å£ï¼Œé€šè¿‡serviceæ–¹æ³•ï¼Œæå–è¯·æ±‚åˆ°RequestContextï¼Œç„¶åé€šè¿‡è°ƒç”¨ZuulRunnerï¼Œä¾æ¬¡æŒ‰é¡ºåºæ‰§è¡Œæ¯ç§ç±»å‹çš„Filterï¼Œå®Œæˆæ•´ä¸ªFilterçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚","text":"æ‘˜è¦: æ¥ç€ä¸Šä¸€ç¯‡ã€ŠSpring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(ä¸€)ã€‹ï¼ŒZuulControllerç»§æ‰¿äº†ServletWrappingControllerï¼Œå°†å½“å‰åº”ç”¨ä¸­çš„ZuulServletç›´æ¥åŒ…è£…ä¸ºä¸€ä¸ªControllerï¼Œæš´éœ²ä¸ºå…¥å£è®¿é—®ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä»‹ç»etflix-zuul-coreçš„ä»£ç Zuulçš„æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚ ä¸€.Netflix zuul coreæºç åˆ†æcom.netflix.zuul.http.ZuulServletæ˜¯ZuulFilteré“¾æ‰§è¡Œçš„å…¥å£ï¼Œé€šè¿‡serviceæ–¹æ³•ï¼Œæå–è¯·æ±‚åˆ°RequestContextï¼Œç„¶åé€šè¿‡è°ƒç”¨ZuulRunnerï¼Œä¾æ¬¡æŒ‰é¡ºåºæ‰§è¡Œæ¯ç§ç±»å‹çš„Filterï¼Œå®Œæˆæ•´ä¸ªFilterçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚ 1.1 ZuulServletä»£ç åˆ†æ åœ¨ZuulConfigurationä¸­ç‚¹å‡»com.netflix.zuul.http.ZuulServletæ‰“å¼€ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104public class ZuulServlet extends HttpServlet &#123; private static final long serialVersionUID = -3374242278843351500L; private ZuulRunner zuulRunner; @Override public void init(ServletConfig config) throws ServletException &#123; super.init(config); String bufferReqsStr = config.getInitParameter(\"buffer-requests\"); boolean bufferReqs = bufferReqsStr != null &amp;&amp; bufferReqsStr.equals(\"true\") ? true : false; zuulRunner = new ZuulRunner(bufferReqs); &#125; @Override public void service(javax.servlet.ServletRequest servletRequest, javax.servlet.ServletResponse servletResponse) throws ServletException, IOException &#123; try &#123; //è°ƒç”¨zuulRunner.init(servletRequest, servletResponse)è¿›è¡Œè¯·æ±‚ä¸Šä¸‹æ–‡çš„ä¼ é€’ init((HttpServletRequest) servletRequest, (HttpServletResponse) servletResponse); // Marks this request as having passed through the \"Zuul engine\", as opposed to servlets // explicitly bound in web.xml, for which requests will not have the same data attached RequestContext context = RequestContext.getCurrentContext(); context.setZuulEngineRan(); try &#123; preRoute(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; route(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; postRoute(); &#125; catch (ZuulException e) &#123; error(e); return; &#125; &#125; catch (Throwable e) &#123; error(new ZuulException(e, 500, \"UNHANDLED_EXCEPTION_\" + e.getClass().getName())); &#125; finally &#123; RequestContext.getCurrentContext().unset(); &#125; &#125; /** * æ‰§è¡Œ \"post\" ZuulFilters * * @throws ZuulException */ void postRoute() throws ZuulException &#123; zuulRunner.postRoute(); &#125; /** * æ‰§è¡Œ \"route\" filters * * @throws ZuulException */ void route() throws ZuulException &#123; zuulRunner.route(); &#125; /** * æ‰§è¡Œ \"pre\" filters * * @throws ZuulException */ void preRoute() throws ZuulException &#123; zuulRunner.preRoute(); &#125; /** * initializes request * * @param servletRequest * @param servletResponse */ void init(HttpServletRequest servletRequest, HttpServletResponse servletResponse) &#123; zuulRunner.init(servletRequest, servletResponse); &#125; /** * sets error context info and executes \"error\" filters * * @param e */ void error(ZuulException e) &#123; RequestContext.getCurrentContext().setThrowable(e); zuulRunner.error(); &#125; &#125; å¦‚ä¸Šæ‰€ç¤ºï¼ŒZuulServletå…¶å®å°±æ˜¯ä¸€ä¸ªServletï¼Œserviceæ–¹æ³•åŒ…å«äº†Zuulçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ 1.1.1 ZuulServlet initä»£ç æ‹†è§£åˆ†æ1234//init() - æ³¨å†Œä¸€ä¸ªZuulRunnerç”¨äºè°ƒç”¨æ•´ä¸ªfilter é“¾void init(HttpServletRequest servletRequest, HttpServletResponse servletResponse) &#123; zuulRunner.init(servletRequest, servletResponse); &#125; 1.1.2 ZuulServlet serviceä»£ç åˆ†æ123456789101112131415161718192021222324252627282930313233343536373839// è°ƒç”¨initå°†req,resç½®å…¥ä¸Šä¸‹æ–‡.è·å–å¹¶æ ‡è®°ä¸Šä¸‹æ–‡æ­¤sessionå·²ç»é€šè¿‡è¿›å…¥@Override public void service(javax.servlet.ServletRequest servletRequest, javax.servlet.ServletResponse servletResponse) throws ServletException, IOException &#123; try &#123; init((HttpServletRequest) servletRequest, (HttpServletResponse) servletResponse); // Marks this request as having passed through the \"Zuul engine\", as opposed to servlets // explicitly bound in web.xml, for which requests will not have the same data attached RequestContext context = RequestContext.getCurrentContext(); context.setZuulEngineRan(); try &#123; preRoute(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; route(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; postRoute(); &#125; catch (ZuulException e) &#123; error(e); return; &#125; &#125; catch (Throwable e) &#123; error(new ZuulException(e, 500, \"UNHANDLED_EXCEPTION_\" + e.getClass().getName())); &#125; finally &#123; RequestContext.getCurrentContext().unset(); &#125; &#125; æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯·æ±‚åªç»è¿‡pre -&gt; route -&gt; postã€‚ä¸¤å±‚tryâ€¦catchï¼Œå†…å±‚åªæ•è·ZuulExceptionï¼Œè€Œå…¶ä»–å¼‚å¸¸ç”±å¤–å±‚æ•è·ã€‚å†…å±‚3ä¸ªtryâ€¦catchè¯­å¥ï¼Œåªæœ‰pre,routeæŠ›å‡ºZuulExceptionæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œerrrorï¼Œå†æ‰§è¡Œpostã€‚è€Œå½“post(88è¡Œ)æŠ›å‡ºZuulExceptionåï¼Œåªä¼šæ‰§è¡Œerrorã€‚å¤–å±‚æ•è·å…¶ä»–å¼‚å¸¸(å†…å±‚tryè¯­å¥å—ä¸­æŠ›å‡ºçš„éZuulExceptionå¼‚å¸¸ä»¥åŠå†…å±‚catchè¯­å¥ä¸­æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸)åï¼Œå°†HTTPçŠ¶æ€ç è®¾ç½®ä¸º500ï¼ŒåŒæ—¶äº¤ç»™errorå¤„ç†ã€‚æ•´ä¸ªæµç¨‹çš„ç»ˆç‚¹æœ‰ä¸¤ä¸ªï¼špoståŠerrorï¼›è€Œéåªæœ‰postä¸€ä¸ªã€‚ 1.2 Zuulçš„è¯·æ±‚ä¸Šä¸‹æ–‡ RequestContext com.netflix.zuul.context.RequestContextç»§æ‰¿äº†ConcurrentHashMapï¼Œæ˜¯Zuul Filterç”Ÿå‘½å‘¨æœŸä¸­å¤„ç†httpè¯·æ±‚ä¸Šä¸‹æ–‡,æ˜¯ä¸€ä¸ªthreadlocalçš„Map. 1234567891011121314151617181920public class RequestContext extends ConcurrentHashMap&lt;String, Object&gt; &#123; private static final Logger LOG = LoggerFactory.getLogger(RequestContext.class); protected static Class&lt;? extends RequestContext&gt; contextClass = RequestContext.class; private static RequestContext testContext = null; protected static final ThreadLocal&lt;? extends RequestContext&gt; threadLocal = new ThreadLocal&lt;RequestContext&gt;() &#123; @Override protected RequestContext initialValue() &#123; try &#123; return contextClass.newInstance(); &#125; catch (Throwable e) &#123; throw new RuntimeException(e); &#125; &#125; &#125;; //å…¶ä½™çœç•¥&#125; 1.3 ContextLifecycleFilter com.netflix.zuul.context.ContextLifecycleFilteræ˜¯è°ƒç”¨é“¾å¤–å›´finallyä¸­removeä¸Šæ–‡ä¸­threadlocal. 1234567891011121314151617 public class ContextLifecycleFilter implements Filter &#123; public void destroy() &#123;&#125; public void init(FilterConfig filterConfig) throws ServletException &#123;&#125; public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException &#123; try &#123; chain.doFilter(req, res); &#125; finally &#123; RequestContext.getCurrentContext().unset(); &#125; &#125;&#125; 1.4 Zuulçš„è¿è¡Œæ‰§è¡Œå™¨-ZuulRunnercom.netflix.zuul.ZuulRunnerï¼Œ 1234567891011121314151617181920212223242526272829303132333435363738public class ZuulRunner &#123; private boolean bufferRequests; /** * Creates a new &lt;code&gt;ZuulRunner&lt;/code&gt; instance. */ public ZuulRunner() &#123; this.bufferRequests = true; &#125; /** * * @param bufferRequests - whether to wrap the ServletRequest in HttpServletRequestWrapper and buffer the body. */ public ZuulRunner(boolean bufferRequests) &#123; this.bufferRequests = bufferRequests; &#125; /** * sets HttpServlet request and HttpResponse * * @param servletRequest * @param servletResponse */ // ZuulRunnerå†…ä¼ å…¥çš„req/reså°±ä¼šè¢«æ›¿æ¢ä¸ºwrapperç±»å¢å¼ºåŠŸèƒ½: public void init(HttpServletRequest servletRequest, HttpServletResponse servletResponse) &#123; RequestContext ctx = RequestContext.getCurrentContext(); if (bufferRequests) &#123; ctx.setRequest(new HttpServletRequestWrapper(servletRequest)); &#125; else &#123; ctx.setRequest(servletRequest); &#125; ctx.setResponse(new HttpServletResponseWrapper(servletResponse)); &#125;&#125; com.netflix.zuul.filters.ZuulServletFilterè·Ÿè·ŸZuulServletæ˜¯åŒä¸€ä»½ä»£ç .com.netflix.zuul.monitoringï¼Œé¢„ç•™äº†CounterFactoryä¸TracerFactoryçš„æ¥å£ï¼Œç”¨æ¥æ‰©å±•å®ç°counterä¸timer.","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Zuul","slug":"Spring-Cloud-Zuul","permalink":"http://xujin.org/tags/Spring-Cloud-Zuul/"}]},{"title":"Spring Cloud Zuulé—å¤±çš„ä¸–ç•Œ(ä¸€)","slug":"sc/sc-zuul-s1","date":"2017-08-13T06:00:00.000Z","updated":"2019-01-13T05:02:46.238Z","comments":true,"path":"sc/sc-zuul-s1/","link":"","permalink":"http://xujin.org/sc/sc-zuul-s1/","excerpt":"æ‘˜è¦: Zuulä½œä¸ºjavaç½‘å…³å±Šçš„é¼»ç¥–ï¼Œ2016å¹´è‡ªç ”ç½‘å…³ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå¯¹å…¶æºç çœ‹äº†å¾ˆå¤šæ¬¡ï¼Œç»è¿‡ä¸¤å¤§äº’è”ç½‘å…¬å¸ä¸­é—´ä»¶çš„æ´—ç¤¼ä¹‹åï¼Œç›®å‰è½®åˆ°è‡ªå·±è®¾è®¡ä¸€ä¸ªç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudã€‚æœ€è¿‘æŠ½ç©ºæŠŠè‡ªå·±çš„ç†è§£ï¼Œå¤‡æ³¨ä¸€ä¸‹ã€‚ç”±äºSpring cloudæ•´åˆZuulçš„ä»£ç è¿‡å¤šã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Spring Cloudå¯¹Netflix Zuulé«˜åº¦æŠ½è±¡å°è£…æ•´åˆéƒ¨åˆ†ã€‚å³spring-cloud-netflix-coreçš„ä»£ç ã€‚","text":"æ‘˜è¦: Zuulä½œä¸ºjavaç½‘å…³å±Šçš„é¼»ç¥–ï¼Œ2016å¹´è‡ªç ”ç½‘å…³ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå¯¹å…¶æºç çœ‹äº†å¾ˆå¤šæ¬¡ï¼Œç»è¿‡ä¸¤å¤§äº’è”ç½‘å…¬å¸ä¸­é—´ä»¶çš„æ´—ç¤¼ä¹‹åï¼Œç›®å‰è½®åˆ°è‡ªå·±è®¾è®¡ä¸€ä¸ªç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudã€‚æœ€è¿‘æŠ½ç©ºæŠŠè‡ªå·±çš„ç†è§£ï¼Œå¤‡æ³¨ä¸€ä¸‹ã€‚ç”±äºSpring cloudæ•´åˆZuulçš„ä»£ç è¿‡å¤šã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Spring Cloudå¯¹Netflix Zuulé«˜åº¦æŠ½è±¡å°è£…æ•´åˆéƒ¨åˆ†ã€‚å³spring-cloud-netflix-coreçš„ä»£ç ã€‚ ä¸€.Spring Cloud Zuulæºç åˆ†æ1.1 @EnableZuulProxyä¸@EnableZuulServerå¦‚ä¸‹ä¸»åº”ç”¨ç¨‹åºä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨Spring Cloud Zuulåªéœ€è¦åŠ ä¸Š@EnableZuulProxyæˆ–@EnableZuulServerä¸¤ç§æ³¨è§£å°±å¯ä»¥ã€‚ 12345678@SpringBootApplication@EnableZuulProxypublic class SpringCloudZuulApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudZuulApplication.class, args); &#125;&#125; @EnableZuulProxyä¸@EnableZuulServer,@EnableZuulServer - æ™®é€šZuul Server,åªæ”¯æŒåŸºæœ¬çš„routeä¸filteråŠŸèƒ½.@EnableZuulProxy - æ™®é€šZuul Server+æœåŠ¡å‘ç°ä¸ç†”æ–­ç­‰åŠŸèƒ½çš„å¢å¼ºç‰ˆ,å…·æœ‰åå‘ä»£ç†åŠŸèƒ½. 1.2 @EnableZuulProxyæ³¨è§£å…¥å£ ç‚¹å¼€æ³¨è§£@EnableZuulProxyï¼Œè¿›å…¥åˆ°org.springframework.cloud.netflix.zuul.EnableZuulProxyï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567@EnableCircuitBreaker@EnableDiscoveryClient@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Import(ZuulProxyConfiguration.class)public @interface EnableZuulProxy &#123;&#125; 1.3 ZuulProxyConfigurationä»£ç @Import(ZuulProxyConfiguration.class)ï¼ŒæŸ¥çœ‹å¯¼å…¥çš„ç±»org.springframework.cloud.netflix.zuul.ZuulProxyConfigurationï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°org.springframework.cloud.netflix.zuul.ZuulProxyConfiguration,ç»§æ‰¿äº†ä¸Šæ–‡çš„ZuulConfiguration,æ–°å¢äº†æœåŠ¡ä¸å®ä¾‹ç­‰æ¦‚å¿µï¼Œæ ¸å¿ƒé‡è¦ä»£ç å·²ç»åŠ å…¥æ³¨é‡Š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273@Configuration@Import(&#123; RibbonCommandFactoryConfiguration.RestClientRibbonConfiguration.class, RibbonCommandFactoryConfiguration.OkHttpRibbonConfiguration.class, RibbonCommandFactoryConfiguration.HttpClientRibbonConfiguration.class &#125;)public class ZuulProxyConfiguration extends ZuulConfiguration &#123; @SuppressWarnings(\"rawtypes\") @Autowired(required = false) private List&lt;RibbonRequestCustomizer&gt; requestCustomizers = Collections.emptyList(); // DiscoveryClientè‚©è´Ÿç€ä»Eurekaä¸­è·å–æœåŠ¡åˆ—è¡¨,è·å–å¯¹åº”å®ä¾‹çš„åŠŸèƒ½ @Autowired private DiscoveryClient discovery; @Autowired private ServiceRouteMapper serviceRouteMapper; // zuulFeature ä¾ç„¶æ˜¯å°†Zuulæ ‡è¯†ä¸ºDiscoveryæ¨¡å¼. @Override public HasFeatures zuulFeature() &#123; return HasFeatures.namedFeature(\"Zuul (Discovery)\", ZuulProxyConfiguration.class); &#125; @Bean @ConditionalOnMissingBean(DiscoveryClientRouteLocator.class) public DiscoveryClientRouteLocator discoveryRouteLocator() &#123; return new DiscoveryClientRouteLocator(this.server.getServletPrefix(), this.discovery, this.zuulProperties, this.serviceRouteMapper); &#125; // ä¾ç„¶æ˜¯æ³¨å†Œäº†è¿™ä¹ˆä¸ªApplicationEventæ¥è§¦å‘ä¸Šæ–‡ä¸­çš„dirtyçŠ¶æ€. @Bean public ApplicationListener&lt;ApplicationEvent&gt; zuulDiscoveryRefreshRoutesListener() &#123; return new ZuulDiscoveryRefreshListener(); &#125; private static class ZuulDiscoveryRefreshListener implements ApplicationListener&lt;ApplicationEvent&gt; &#123; private HeartbeatMonitor monitor = new HeartbeatMonitor(); @Autowired private ZuulHandlerMapping zuulHandlerMapping; @Override public void onApplicationEvent(ApplicationEvent event) &#123; if (event instanceof InstanceRegisteredEvent) &#123; reset(); &#125; else if (event instanceof ParentHeartbeatEvent) &#123; ParentHeartbeatEvent e = (ParentHeartbeatEvent) event; resetIfNeeded(e.getValue()); &#125; else if (event instanceof HeartbeatEvent) &#123; HeartbeatEvent e = (HeartbeatEvent) event; resetIfNeeded(e.getValue()); &#125; &#125; private void resetIfNeeded(Object value) &#123; if (this.monitor.update(value)) &#123; reset(); &#125; &#125; private void reset() &#123; this.zuulHandlerMapping.setDirty(true); &#125; &#125; //å…¶ä½™çœç•¥&#125; DiscoveryClientRouteLocatorç±»ä¸­çš„locateRoutes()æ–¹æ³•ï¼Œå°†pathä¸ä¸Šæ–‡çš„ZuulRouteé€šè¿‡DiscoveryClientRouteLocator.locateRoutes()çš„å¯¹åº”åœ¨ä¸€èµ·.ç‚¹å‡»æŸ¥çœ‹å…¶çˆ¶ç±»ï¼Œorg.springframework.cloud.netflix.zuul.ZuulConfiguration,å¦‚ä¸‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Netflixçš„Zuul-coreçš„å…¥å£ï¼ŒZuulServletã€‚ 1.4 DiscoveryClientRouteLocatorä¸­locateRoutesDiscoveryClientRouteLocatorç±»ä¸­çš„locateRoutesçš„å¤§æ¦‚æµç¨‹ å°†ä¸Šæ–‡SimpleRouteLocatorä¸­è§£æå‡ºæ¥çš„Routeåˆ—è¡¨çŒå…¥å†…éƒ¨çš„LinkedHashMap æŠ½å–Routeè‡ªå¸¦çš„serviceId,å°†å…¶ä½œä¸ºkey,å½¢æˆä¸€ä¸ªstaticServicesçš„map éå†DiscoveryClientæ‹¿åˆ°çš„serviceIdåˆ—è¡¨,åŒ¹é…æ­£åˆ™å½¢å¼å®šä¹‰çš„serviceIdå¹¶å°†å¯¹åº”çš„ZuulRouteä¸ä¹‹å¯¹åº” è°ƒæ•´LinkedHashMapå†…è·¯ç”±é¡ºåº,å°†/**æŒªåˆ°æœ€å å¾®è°ƒmapå†…å®¹,å°†keyå€¼åŠ ä¸Š/æˆ–è€…è‡ªå®šä¹‰prefix 1.5 ZuulConfiguration1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071@Configuration@EnableConfigurationProperties(&#123; ZuulProperties.class &#125;)@ConditionalOnClass(ZuulServlet.class)// Make sure to get the ServerProperties from the same place as a normal web app would@Import(ServerPropertiesAutoConfiguration.class)public class ZuulConfiguration &#123; //zuulProperties å¯¹åº”é…ç½®æ–‡ä»¶çš„å†…å®¹ @Autowired protected ZuulProperties zuulProperties; @Autowired protected ServerProperties server; @Autowired(required = false) private ErrorController errorController; //å‘ŠçŸ¥actuatorç›‘æ§å½“å‰æ¨¡å¼:Simple/Discovery @Override public HasFeatures zuulFeature() &#123; return HasFeatures.namedFeature(\"Zuul (Discovery)\", ZuulProxyConfiguration.class); &#125; //é€šè¿‡ç»§æ‰¿ServletWrappingControlleræ¥ç®¡äº†ä¸Šæ–‡å®šä¹‰çš„ZuulServlet,å› æ­¤ZuulControllerå°±æ˜¯Zuulçš„å…¥å£ @Bean public ZuulController zuulController() &#123; return new ZuulController(); &#125; /** *ZuulHandlerMapping,å“åº”å™¨æ¨¡å¼,å…¶å®ç›®å‰å°±æ˜¯æŠŠæ‰€æœ‰è·¯å¾„çš„è¯·æ±‚å¯¼å…¥åˆ°ZuulControllerä¸Š.&lt;/br&gt; *å¦å¤–çš„åŠŸæ•ˆæ˜¯å½“è§‰å¯ŸRouteLocatorè·¯ç”±è¡¨å˜æ›´,åˆ™æ›´æ–°è‡ªå·±dirtyçŠ¶æ€,é‡æ–°æ³¨å†Œæ‰€æœ‰Routeåˆ°ZuulController. */ @Bean public ZuulHandlerMapping zuulHandlerMapping(RouteLocator routes) &#123; ZuulHandlerMapping mapping = new ZuulHandlerMapping(routes, zuulController()); mapping.setErrorController(this.errorController); return mapping; &#125; /** * ZuulRefreshListener, */ private static class ZuulRefreshListener implements ApplicationListener&lt;ApplicationEvent&gt; &#123; @Autowired private ZuulHandlerMapping zuulHandlerMapping; private HeartbeatMonitor heartbeatMonitor = new HeartbeatMonitor(); @Override public void onApplicationEvent(ApplicationEvent event) &#123; // Simpleæ¨¡å¼ä¸‹æ³¨å†ŒRoutesRefreshedEvent,è§£æé…ç½®æ–‡ä»¶, // ç»´æŠ¤è·¯ç”±è¡¨å¹¶ç›‘å¬å˜åŒ–,å°†è¯·æ±‚éƒ½å¯¼å‘ZuulControllerå»å†ç»filters if (event instanceof ContextRefreshedEvent || event instanceof RefreshScopeRefreshedEvent || event instanceof RoutesRefreshedEvent) &#123; this.zuulHandlerMapping.setDirty(true); &#125; // Endpointæ¨¡å¼ä¸‹åˆæ·»åŠ äº†HeartbeatEvent else if (event instanceof HeartbeatEvent) &#123; if (this.heartbeatMonitor.update(((HeartbeatEvent) event).getValue())) &#123; this.zuulHandlerMapping.setDirty(true); &#125; &#125; &#125; &#125; //å…¶ä½™çœç•¥&#125; ä»ZuulConfigurationä¸­å¯ä»¥æ‹¿åˆ°Simpleæ¨¡å¼ä¸‹æ‰€æœ‰bean. 1.6 ZuulControlleræ•´åˆè®¿é—®çš„æ¡¥æ¢ ZuulControllerç»§æ‰¿äº†ServletWrappingControllerï¼Œå°†å½“å‰åº”ç”¨ä¸­çš„æŸä¸ªServletç›´æ¥åŒ…è£…ä¸ºä¸€ä¸ªControllerï¼Œæ‰€æœ‰åˆ°ServletWrappingControllerçš„è¯·æ±‚å®é™…ä¸Šæ˜¯ç”±å®ƒå†…éƒ¨æ‰€åŒ…è£…çš„è¿™ä¸ªServlet å®ä¾‹æ¥å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å†…éƒ¨å°è£…çš„Servletå®ä¾‹å¹¶ä¸å¯¹å¤–å¼€æ”¾ï¼Œå¯¹äºç¨‹åºçš„å…¶ä»–èŒƒå›´æ˜¯ä¸å¯è§çš„ï¼Œé€‚é…æ‰€æœ‰çš„HTTPè¯·æ±‚åˆ°å†…éƒ¨å°è£…çš„Servletå®ä¾‹è¿›è¡Œå¤„ç†ã€‚å®ƒé€šå¸¸ç”¨äºå¯¹å·²å­˜çš„Servletçš„é€»è¾‘é‡ç”¨ä¸Šã€‚å…¶å®è¿™ä¹Ÿå°±æ˜¯Spring Cloudä¸Netflix Zuulæ•´åˆçš„å…³é”®ç‚¹ã€‚ 12345678910111213141516171819202122public class ZuulController extends ServletWrappingController &#123; public ZuulController() &#123; setServletClass(ZuulServlet.class); setServletName(\"zuul\"); setSupportedMethods((String[]) null); // Allow all &#125; @Override public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; try &#123; // We don't care about the other features of the base class, just want to // handle the request return super.handleRequestInternal(request, response); &#125; finally &#123; // @see com.netflix.zuul.context.ContextLifecycleFilter.doFilter RequestContext.getCurrentContext().unset(); &#125; &#125;&#125; 1.7 ZuulProperties123456zuul.ignoredServiceszuul.routeszuul: ignored-services: routes: å…¶ä¸­routeså¯¹åº”ç€å†…éƒ¨ç±»å®šä¹‰ZuulRoute. 1.8 å…¶å®ƒè¡¥å……è¯´æ˜org.springframework.cloud.netflix.zuul.filters.Route,æ˜¯Spring Cloud çš„æŠ½è±¡,å°±æ˜¯ä¸Šæ–‡RouteLocatoræ½œç§»é»˜åŒ–è½¬æ¢çš„éƒ¨åˆ†. org.springframework.cloud.netflix.zuul.ZuulFilterInitializer,å®ç°ServletContextListener,servletå†…å®¹æ¥è‡ªtomcatã€‚","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Zuul","slug":"Spring-Cloud-Zuul","permalink":"http://xujin.org/tags/Spring-Cloud-Zuul/"}]},{"title":"ã€ŠSpring Cloudä¸­å›½ç¤¾åŒºä¸Šæµ·ç½‘å…³ä¸“é¢˜ä¼šè®®ã€‹","slug":"sc/sc-gw","date":"2017-08-05T06:00:00.000Z","updated":"2019-01-13T03:22:31.047Z","comments":true,"path":"sc/sc-gw/","link":"","permalink":"http://xujin.org/sc/sc-gw/","excerpt":"ç½‘å…³åœ¨å¾®æœåŠ¡ä¸­çš„åœ°ä½å°¤å…¶é‡è¦ï¼Œå¦‚æœç½‘å…³æŒ‚äº†æˆ–è€…å‡ºç°ä»»ä½•æŠ–åŠ¨ï¼Œç”¨æˆ·è¯·æ±‚çš„æµé‡å°†ä¼šæŸè€—ï¼Œå°†ä¼šé€ æˆå·¨å¤§çš„æŸå¤±ã€‚å› æ­¤Spring Cloudä¸­å›½ç¤¾åŒºè”åˆä¸Šæµ·ç§¦è‹ç§‘æŠ€ï¼Œèµ°è¿›ä¼ä¸šç•…èŠSpring Cloudå®æˆ˜ç»éªŒï¼Œä»¥åŠç½‘å…³ç»éªŒã€‚ ä¸€.ä¼šè®®å†…å®¹1.ä¸»é¢˜ã€ŠSpring Cloudä¸­å›½ç¤¾åŒºä¸Šæµ·ç½‘å…³ä¸“é¢˜ã€‹2.æ—¶é—´:2017å¹´8æœˆ20ï¼Œä¼šè®®æ–¹å¼:é—­é—¨ä¼šè®®3.åœ°ç‚¹:ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºå³¨å±±è·¯91å¼„é™†å®¶å˜´è½¯ä»¶å›­9å·æ¥¼ï¼ˆåŒ—æ¥¼ï¼‰8æ¥¼4.ä¸»åŠæ–¹Spring Cloudä¸­å›½ç¤¾åŒº+ä¸Šæµ·ç§¦è‹ç§‘æŠ€5.é¢„è®¡å‚ä¼šäººæ•°: 40-50äººä¹‹é—´ï¼Œå…ˆåˆ°å…ˆå¾—ï¼Œåé¢æ»¡å…³é—­æŠ¥åé€šé“ã€‚6.åˆ†äº«æ–¹å¼(åˆ†äº«äººåˆ†äº«+è®¨è®º+å¤´è„‘é£æš´)","text":"ç½‘å…³åœ¨å¾®æœåŠ¡ä¸­çš„åœ°ä½å°¤å…¶é‡è¦ï¼Œå¦‚æœç½‘å…³æŒ‚äº†æˆ–è€…å‡ºç°ä»»ä½•æŠ–åŠ¨ï¼Œç”¨æˆ·è¯·æ±‚çš„æµé‡å°†ä¼šæŸè€—ï¼Œå°†ä¼šé€ æˆå·¨å¤§çš„æŸå¤±ã€‚å› æ­¤Spring Cloudä¸­å›½ç¤¾åŒºè”åˆä¸Šæµ·ç§¦è‹ç§‘æŠ€ï¼Œèµ°è¿›ä¼ä¸šç•…èŠSpring Cloudå®æˆ˜ç»éªŒï¼Œä»¥åŠç½‘å…³ç»éªŒã€‚ ä¸€.ä¼šè®®å†…å®¹1.ä¸»é¢˜ã€ŠSpring Cloudä¸­å›½ç¤¾åŒºä¸Šæµ·ç½‘å…³ä¸“é¢˜ã€‹2.æ—¶é—´:2017å¹´8æœˆ20ï¼Œä¼šè®®æ–¹å¼:é—­é—¨ä¼šè®®3.åœ°ç‚¹:ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºå³¨å±±è·¯91å¼„é™†å®¶å˜´è½¯ä»¶å›­9å·æ¥¼ï¼ˆåŒ—æ¥¼ï¼‰8æ¥¼4.ä¸»åŠæ–¹Spring Cloudä¸­å›½ç¤¾åŒº+ä¸Šæµ·ç§¦è‹ç§‘æŠ€5.é¢„è®¡å‚ä¼šäººæ•°: 40-50äººä¹‹é—´ï¼Œå…ˆåˆ°å…ˆå¾—ï¼Œåé¢æ»¡å…³é—­æŠ¥åé€šé“ã€‚6.åˆ†äº«æ–¹å¼(åˆ†äº«äººåˆ†äº«+è®¨è®º+å¤´è„‘é£æš´) äºŒ.åˆ†äº«å†…å®¹ Spring Cloud Zuulä¸GPRCæœåŠ¡æ²»ç†ä½“ç³»æ•´åˆï¼Œæ¥æºäºSpring Cloudä¸­å›½ç¤¾åŒºå¼€æºé¡¹ç›®salukiã€‚ åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶çº³ç®¡Spring Cloudã€‚ å¦‚ä½•å‹æµ‹å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ç½‘å…³ ä¸Šæµ·ç§¦è‹ç§‘æŠ€(ä¹°å•ä¾ )Spring Cloudç”Ÿäº§å®æˆ˜åˆ†äº«(åŒ…æ‹¬Zuul) PS:åˆ†äº«å˜‰å®¾ä¿å¯†ï¼Œé—­é—¨ä¼šè®®ï¼Œæ‚¨æ‡‚å¾—ã€‚ ä¸‰.æŠ¥åæ–¹å¼æ‰«æ”¯ä»˜å®äºŒç»´ç ï¼Œæ”¯ä»˜å®Œæ¯•ä¹‹åï¼ŒåŠ ç®¡ç†å‘˜å¾®ä¿¡Software_Kingï¼Œè¿›å…¥å¾®ä¿¡ç¾¤ï¼ŒåŒæ—¶ä¼šè¿›å…¥Spring Cloudä¸­å›½ç¤¾åŒºVIPä¼šå‘˜ç¾¤ã€‚ æŠ¥åè´¹-&gt;ç”¨äºèŒ¶æ­‡+è¯·åˆ†äº«å˜‰å®¾å–å’–å•¡","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"}]},{"title":"å¾®æœåŠ¡ç½‘å…³è§£å†³æ–¹æ¡ˆè°ƒç ”å’Œä½¿ç”¨æ€»ç»“","slug":"janus/gw-solution","date":"2017-07-29T06:00:00.000Z","updated":"2019-01-13T05:25:35.149Z","comments":true,"path":"janus/gw-solution/","link":"","permalink":"http://xujin.org/janus/gw-solution/","excerpt":"ä¸€.ä»€ä¹ˆæ˜¯ç½‘å…³1.1 ä»€ä¹ˆæ˜¯ç½‘å…³API Gatewayï¼ˆAPIGW / API ç½‘å…³ï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œä¸Šçš„ä¸€ä¸ªé¢å‘APIçš„ã€ä¸²è¡Œé›†ä¸­å¼çš„å¼ºç®¡æ§æœåŠ¡ï¼Œè¿™é‡Œçš„è¾¹ç•Œæ˜¯ä¼ä¸šITç³»ç»Ÿçš„è¾¹ç•Œï¼Œå¯ä»¥ç†è§£ä¸ºä¼ä¸šçº§åº”ç”¨é˜²ç«å¢™ï¼Œä¸»è¦èµ·åˆ°éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿçš„ä½œç”¨ã€‚åœ¨å¾®æœåŠ¡æ¦‚å¿µçš„æµè¡Œä¹‹å‰ï¼ŒAPIç½‘å…³å°±å·²ç»è¯ç”Ÿäº†ï¼Œä¾‹å¦‚é“¶è¡Œã€è¯åˆ¸ç­‰é¢†åŸŸå¸¸è§çš„å‰ç½®æœºç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯è§£å†³è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ç­‰é—®é¢˜çš„ã€‚","text":"ä¸€.ä»€ä¹ˆæ˜¯ç½‘å…³1.1 ä»€ä¹ˆæ˜¯ç½‘å…³API Gatewayï¼ˆAPIGW / API ç½‘å…³ï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œä¸Šçš„ä¸€ä¸ªé¢å‘APIçš„ã€ä¸²è¡Œé›†ä¸­å¼çš„å¼ºç®¡æ§æœåŠ¡ï¼Œè¿™é‡Œçš„è¾¹ç•Œæ˜¯ä¼ä¸šITç³»ç»Ÿçš„è¾¹ç•Œï¼Œå¯ä»¥ç†è§£ä¸ºä¼ä¸šçº§åº”ç”¨é˜²ç«å¢™ï¼Œä¸»è¦èµ·åˆ°éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿçš„ä½œç”¨ã€‚åœ¨å¾®æœåŠ¡æ¦‚å¿µçš„æµè¡Œä¹‹å‰ï¼ŒAPIç½‘å…³å°±å·²ç»è¯ç”Ÿäº†ï¼Œä¾‹å¦‚é“¶è¡Œã€è¯åˆ¸ç­‰é¢†åŸŸå¸¸è§çš„å‰ç½®æœºç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯è§£å†³è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ç­‰é—®é¢˜çš„ã€‚ APIç½‘å…³çš„æµè¡Œï¼Œæºäºè¿‘å‡ å¹´æ¥ï¼Œç§»åŠ¨åº”ç”¨ä¸ä¼ä¸šé—´äº’è”éœ€æ±‚çš„å…´èµ·ã€‚ç§»åŠ¨åº”ç”¨ã€ä¼ä¸šäº’è”ï¼Œä½¿å¾—åå°æœåŠ¡æ”¯æŒçš„å¯¹è±¡ï¼Œä»ä»¥å‰å•ä¸€çš„Webåº”ç”¨ï¼Œæ‰©å±•åˆ°å¤šç§ä½¿ç”¨åœºæ™¯ï¼Œä¸”æ¯ç§ä½¿ç”¨åœºæ™¯å¯¹åå°æœåŠ¡çš„è¦æ±‚éƒ½ä¸å°½ç›¸åŒã€‚è¿™ä¸ä»…å¢åŠ äº†åå°æœåŠ¡çš„å“åº”é‡ï¼Œè¿˜å¢åŠ äº†åå°æœåŠ¡çš„å¤æ‚æ€§ã€‚éšç€å¾®æœåŠ¡æ¶æ„æ¦‚å¿µçš„æå‡ºï¼ŒAPIç½‘å…³æˆä¸ºäº†å¾®æœåŠ¡æ¶æ„çš„ä¸€ä¸ªæ ‡é…ç»„ä»¶ã€‚ 1.2 ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šç½‘å…³è¯¥å…·å¤‡çš„æœ€åŸºæœ¬çš„å››å¤§åŠŸèƒ½:ç»Ÿä¸€æ¥å…¥ï¼Œæµé‡ç®¡æ§ï¼Œåè®®é€‚é…è½¬å‘ï¼Œå®‰å…¨é˜²æŠ¤ã€‚ äºŒ.ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ2.1 Nginx+ Lua Nginxæ˜¯ç”±IgorSysoevä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹å¼€å‘çš„ï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚Ngnixä¸€æ–¹é¢å¯ä»¥åšåå‘ä»£ç†ï¼Œå¦å¤–ä¸€æ–¹é¢åšå¯ä»¥åšé™æ€èµ„æºæœåŠ¡å™¨ã€‚ ä½†æ˜¯å‡†ç¡®çš„æ¥è¯´ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ç§æ–¹æ¡ˆä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç½‘å…³ï¼Œè€Œä¸”å³ä½¿è‡ªç ”ç½‘å…³çš„ç›®æ ‡ä¹Ÿæ˜¯å¹²æ‰Ngnixã€‚ 2.2 Kong Kongæ˜¯Mashapeæä¾›çš„ä¸€æ¬¾APIç®¡ç†è½¯ä»¶ï¼Œå®ƒæœ¬èº«æ˜¯åŸºäºNgnix+luaçš„ï¼Œä½†æ¯”nginxæä¾›äº†æ›´ç®€å•çš„é…ç½®æ–¹å¼ï¼Œæ•°æ®é‡‡ç”¨äº† ApacheCassandra/PostgreSQLå­˜å‚¨ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›ä¼˜ç§€çš„æ’ä»¶ï¼Œæ¯”å¦‚éªŒè¯ï¼Œæ—¥å¿—ï¼Œè°ƒç”¨é¢‘æ¬¡é™åˆ¶ç­‰ã€‚ Kongçš„ä¸€ä¸ªéå¸¸è¯±äººçš„åœ°æ–¹å°±æ˜¯æä¾›äº†å¤§é‡çš„æ’ä»¶æ¥æ‰©å±•åº”ç”¨ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„æ’ä»¶å¯ä»¥ä¸ºæœåŠ¡æä¾›å„ç§å¢å¼ºçš„åŠŸèƒ½ã€‚Kongé»˜è®¤æ’ä»¶æ’ä»¶åŒ…æ‹¬ï¼š èº«ä»½è®¤è¯ï¼šKongæä¾›äº†Basic Authenticationã€Key authenticationã€OAuth2.0authenticationã€HMAC authenticationã€JWTã€LDAP authenticationè®¤è¯å®ç°ã€‚ å®‰å…¨ï¼šACLï¼ˆè®¿é—®æ§åˆ¶ï¼‰ã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ã€åŠ¨æ€SSLã€IPé™åˆ¶ã€çˆ¬è™«æ£€æµ‹å®ç°ã€‚ æµé‡æ§åˆ¶ï¼šè¯·æ±‚é™æµï¼ˆåŸºäºè¯·æ±‚è®¡æ•°é™æµï¼‰ã€ä¸Šæ¸¸å“åº”é™æµï¼ˆæ ¹æ®upstreamå“åº”è®¡æ•°é™æµï¼‰ã€è¯·æ±‚å¤§å°é™åˆ¶ã€‚é™æµæ”¯æŒæœ¬åœ°ã€Rediså’Œé›†ç¾¤é™æµæ¨¡å¼ã€‚ åˆ†æç›‘æ§ï¼šGalileoï¼ˆè®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®ï¼Œå®ç°APIåˆ†æï¼‰ã€Datadogï¼ˆè®°å½•API Metricå¦‚è¯·æ±‚æ¬¡æ•°ã€è¯·æ±‚å¤§å°ã€å“åº”çŠ¶æ€å’Œå»¶è¿Ÿï¼Œå¯è§†åŒ–API Metricï¼‰ã€Runscopeï¼ˆè®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®ï¼Œå®ç°APIæ€§èƒ½æµ‹è¯•å’Œç›‘æ§ï¼‰ã€‚ è½¬æ¢ï¼šè¯·æ±‚è½¬æ¢ã€å“åº”è½¬æ¢ ä¼˜ç‚¹:Kongæœ¬èº«ä¹Ÿæ˜¯åŸºäºNginxçš„ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¸Šéƒ½æ²¡æœ‰é—®é¢˜ã€‚Kongä½œä¸ºä¸€æ¬¾å•†ä¸šè½¯ä»¶ï¼Œåœ¨Nginxä¸Šåšäº†å¾ˆæ‰©å±•å·¥ä½œï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šä»˜è´¹çš„å•†ä¸šæ’ä»¶ã€‚Kongæœ¬èº«ä¹Ÿæœ‰ä»˜è´¹çš„ä¼ä¸šç‰ˆï¼Œå…¶ä¸­åŒ…æ‹¬æŠ€æœ¯æ”¯æŒã€ä½¿ç”¨åŸ¹è®­æœåŠ¡ä»¥åŠAPI åˆ†ææ’ä»¶ã€‚ ç¼ºç‚¹:Kongçš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨Spring Cloudï¼ŒKongå¦‚ä½•ç»“åˆç›®å‰å·²æœ‰çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Ÿ 2.3 Spring Cloud ZuulZuul æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€ä¸ªAPIç½‘å…³ç»„ä»¶ï¼ŒSpring Cloudå¯¹å…¶è¿›è¡ŒäºŒæ¬¡åŸºäºSpring Bootçš„æ³¨è§£å¼å°è£…åšåˆ°å¼€ç®±å³ç”¨ã€‚ç›®å‰æ¥è¯´ï¼Œç»“åˆSring Cloudæä¾›çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Œå¯ä»¥åšåˆ°è¯·æ±‚è½¬å‘ï¼Œæ ¹æ®é…ç½®çš„æˆ–è€…é»˜è®¤çš„è·¯ç”±è§„åˆ™è¿›è¡Œè·¯ç”±å’ŒLoad Balanceï¼Œé›†æˆHystrixã€‚è¯¦ç»†å¯ä»¥å‚è€ƒSpring Cloud Zuulçš„URLè½¬å‘å’Œè·¯ç”±è§„åˆ™ã€‚ Spring Cloud Zuulå¤„ç†æ¯ä¸ªè¯·æ±‚çš„æ–¹å¼æ˜¯é’ˆå¯¹æ¯ä¸ªè¯·æ±‚æ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚PSï¼Œæ ¹æ®ç»Ÿè®¡æ•°æ®ç›®å‰Zuulæœ€å¤šèƒ½è¾¾åˆ°ï¼ˆ1000-2000)QPSã€‚ä½¿ç”¨è¿‡Nettyçš„éƒ½çŸ¥é“ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨Boosç»„å’Œworkç»„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ‰€æœ‰è¯·æ±‚ä¼šè¢«æ”¾åˆ°å¤„ç†é˜Ÿåˆ—ä¸­ï¼Œä»çº¿ç¨‹æ± ä¸­é€‰å–ç©ºé—²çº¿ç¨‹æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚ Spring Cloud Zuuléœ€è¦åšä¸€äº›ç°åº¦ï¼Œé™çº§ï¼Œæ ‡ç­¾è·¯ç”±ï¼Œé™æµï¼ŒWAFå°ç¦ï¼Œéœ€è¦è‡ªå®šä¹‰Filterå»æˆ–è€…åšä¸€äº›å®šåˆ¶åŒ–å®ç°ã€‚è¯¦ç»†æ–‡ç« å¯ä»¥å‚è€ƒåœ¨Spring Cloudä¸­å®ç°é™çº§ä¹‹æƒé‡è·¯ç”±å’Œæ ‡ç­¾è·¯ç”± è™½ç„¶å¯ä»¥é€šè¿‡è‡ªå®šä¹‰Filterå®ç°ï¼Œæˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºZuulæœ¬èº«çš„è®¾è®¡å’ŒåŸºäºå•çº¿ç¨‹çš„æ¥æ”¶è¯·æ±‚å’Œè½¬å‘å¤„ç†ï¼Œåœ¨æˆ‘çœ‹æ¥ç›®å‰æ¥çœ‹Zuul å°±æ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œéšç€Zuul2ä¸€ç›´è·³ç¥¨ï¼ŒSpring Cloudæ¨å‡ºè‡ªå·±çš„Spring Cloud Gateway. The API Gateway is Dead! Long Live the API Gateway! å¤§æ„:Zuulå·²æ­»ï¼ŒSpring Cloud Gatewayæ°¸ç”Ÿã€‚ 2.4 Spring Cloud GatewayA Gateway built on Spring Framework 5.0 and Spring Boot 2.0 providing routing and moreã€‚ Spring Cloud Gatewayæ˜¯åŸºäºSpring æ¡†æ¶5.0ç‰ˆæœ¬å’ŒSpring Boot 2.0çš„ç‰ˆæœ¬æ„å»ºï¼Œæä¾›è·¯ç”±ç­‰åŠŸèƒ½ã€‚ Spring Cloud GateWayå…·æœ‰ä»¥ä¸‹ç‰¹å¾ Java 8/Spring 5/Boot 2 WebFlux/Reactor HTTP/2 and Websockets Finchley Release Train (Q4 2017) ç”±äºSpring 5.0æ”¯æŒNettyï¼ŒHttp2ï¼Œè€ŒSpring Boot 2.0æ”¯æŒSpring 5.0ï¼Œå› æ­¤Spring Cloud Gatewayæ”¯æŒNettyå’ŒHttp2é¡ºç†æˆç« ã€‚è‡³äº2017å¹´Q4å­£åº¦æ˜¯å¦å‘å¸ƒå®Œæ•´çš„Spring Cloud Gatewayæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼Œä½†æ˜¯è‡³äºæœ€ç»ˆè½åœ°çœ‹æœ€ç»ˆä½¿ç”¨æƒ…å†µã€‚ è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒï¼šSpring Cloud Gatewayç¦»å¼€å­µåŒ–å™¨çš„å˜åŒ– 2.5 Kong+Zuulçš„ç½‘å…³æ–¹æ¡ˆ å¦‚ä¸Šå›¾æ‰€ç¤º:Kong+Zuulå®ç°çš„ç½‘å…³æ–¹æ¡ˆï¼Œåœ¨åŠ ä¸Šé˜¿é‡Œäº‘çš„SLBï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯å¤šäº†å¥½å‡ å±‚ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå‘æŒ¥Kong+Spring Cloud Zuulå„è‡ªçš„ä¼˜ç‚¹å½¢æˆâ€œèšåˆç½‘å…³â€ã€‚ä¸ªäººä¸å»ºè®®è¿™æ ·ä½¿ç”¨ç½‘å…³ï¼Œå› æ­¤è‡ªç ”ç½‘å…³ä¸­é—´ä»¶ï¼Œæ˜¾å¾—å°¤å…¶é‡è¦ã€‚ ä¸‰.åŸºäºSpring Cloud Zuulæ„å»ºç½‘å…³ç”¨Spring Cloud Zuulæ„å»ºç½‘å…³å…¶å®ç›¸å½“é¸¡è‚‹ï¼Œæ¯”å¦‚åŠ¨æ€Filterï¼Œæ¯”å¦‚æ ‡ç­¾è·¯ç”±ï¼Œé™çº§ï¼Œæ¯”å¦‚åŠ¨æ€Filterï¼Œæ¯”å¦‚å¸¦ç®¡æ§å®¡è®¡æµç¨‹ï¼Œæ˜“æ“ä½œçš„UIç•Œé¢ç­‰ã€‚ zuulæ˜¯netfixçš„api ç½‘å…³ï¼Œä¸»è¦ç‰¹è‰²æœ‰ï¼šfilterçš„PRPE(pre,route,post,error)æ¨¡å‹ã€groovyçš„fitleræœºåˆ¶ï¼Œå…¶ä¸­spring cloudå¯¹å…¶æœ‰æ¯”è¾ƒå¥½çš„æ‰©å±•ï¼Œä½†æ˜¯spring cloudå¯¹å…¶çš„æ‰©å±•æ„Ÿè§‰ä¸æ˜¯å¾ˆå®Œç¾ï¼Œå­˜åœ¨è·¯ç”±è§„åˆ™æ— æ³•åªèƒ½æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥å­˜å‚¨ï¼Œè€Œæ— æ³•åŠ¨æ€é…ç½®çš„ç›®çš„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªäººå†™äº†ä¸€ä¸ªstarteræ’ä»¶æ¥è§£å†³è·¯ç”±è§„åˆ™é…ç½®åˆ°Cassandraçš„é—®é¢˜ï¼Œè¯¦ç»†è¯·çœ‹ï¼šå°†è·¯ç”±è§„åˆ™é…ç½®åˆ°KVåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»ŸCassandra 3.1 å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶è¿™é‡Œä¸»è¦æ˜¯åšäº†æµæ§åŠåè®®è½¬åŒ–çš„å·¥ä½œï¼Œè¿™é‡Œä¸»è¦æ˜¯http-&gt;grpcçš„è½¬æ¢ï¼›LimitAccessFilterï¼šåˆ©ç”¨redisä»¤ç‰Œæ¡¶ç®—æ³•è¿›è¡Œæµæ§GrpcRemoteRouteFilterï¼šhttpè½¬åŒ–ä¸ºgrpcçš„åè®®è½¬æ¢ 3.2 è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°å®ç°åŠ¨æ€è·¯ç”±æœ‰ä¸¤ç§å®ç°æ–¹å¼:1.ç¬¬ä¸€æ˜¯DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–,æ¨èæ˜¯ï¼ŒSpring Cloudæ•´åˆGRPCï¼ŒRESTåè®®é€‚é…è½¬å‘ä¸ºå†…éƒ¨GRPCæœåŠ¡æ—¶é‡‡ç”¨æ­¤ç§æ–¹æ³•æ‰©å±•ä¿®æ”¹ã€‚ 2.ç¬¬äºŒæ˜¯å®ç°äº†RefreshableRouteLocatoræ¥å£ï¼Œèƒ½å¤Ÿå®ç°åŠ¨æ€åˆ·æ–°ï¼Œå¯ä»¥å‚è€ƒ spring cloud ZuulåŠ¨æ€è·¯ç”± 3.2.1 åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ ä¸ºä»€ä¹ˆè¦åŸºäºäº‹ä»¶æ›´æ–°ï¼ŒåŸç†å¦‚ä¸‹æ‰€ç¤ºï¼šåœ¨org.springframework.cloud.netflix.zuul.ZuulConfiguration.javaä¸­228-250è¡Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136 @Configuration@EnableConfigurationProperties(&#123; ZuulProperties.class &#125;)@ConditionalOnClass(ZuulServlet.class)// Make sure to get the ServerProperties from the same place as a normal web app would@Import(ServerPropertiesAutoConfiguration.class)public class ZuulConfiguration &#123; //zuulçš„é…ç½®ä¿¡æ¯,å¯¹åº”äº†application.propertiesæˆ–ymlä¸­çš„é…ç½®ä¿¡æ¯ @Autowired protected ZuulProperties zuulProperties; @Autowired protected ServerProperties server; @Autowired(required = false) private ErrorController errorController; @Bean public HasFeatures zuulFeature() &#123; return HasFeatures.namedFeature(\"Zuul (Simple)\", ZuulConfiguration.class); &#125; @Bean @ConditionalOnMissingBean(RouteLocator.class) public RouteLocator routeLocator() &#123; //é»˜è®¤é…ç½®çš„å®ç°æ˜¯SimpleRouteLocator.class return new SimpleRouteLocator(this.server.getServletPrefix(), this.zuulProperties); &#125; @Bean public ZuulController zuulController() &#123; return new ZuulController(); &#125; @Bean public ZuulHandlerMapping zuulHandlerMapping(RouteLocator routes) &#123; ZuulHandlerMapping mapping = new ZuulHandlerMapping(routes, zuulController()); mapping.setErrorController(this.errorController); return mapping; &#125; //æ³¨å†Œäº†ä¸€ä¸ªè·¯ç”±åˆ·æ–°ç›‘å¬å™¨ï¼Œé»˜è®¤å®ç°æ˜¯ZuulRefreshListener.class @Bean public ApplicationListener&lt;ApplicationEvent&gt; zuulRefreshRoutesListener() &#123; return new ZuulRefreshListener(); &#125; @Bean @ConditionalOnMissingBean(name = \"zuulServlet\") public ServletRegistrationBean zuulServlet() &#123; ServletRegistrationBean servlet = new ServletRegistrationBean(new ZuulServlet(), this.zuulProperties.getServletPattern()); // The whole point of exposing this servlet is to provide a route that doesn't // buffer requests. servlet.addInitParameter(\"buffer-requests\", \"false\"); return servlet; &#125; // pre filters @Bean public ServletDetectionFilter servletDetectionFilter() &#123; return new ServletDetectionFilter(); &#125; @Bean public FormBodyWrapperFilter formBodyWrapperFilter() &#123; return new FormBodyWrapperFilter(); &#125; @Bean public DebugFilter debugFilter() &#123; return new DebugFilter(); &#125; @Bean public Servlet30WrapperFilter servlet30WrapperFilter() &#123; return new Servlet30WrapperFilter(); &#125; // post filters @Bean public SendResponseFilter sendResponseFilter() &#123; return new SendResponseFilter(); &#125; @Bean public SendErrorFilter sendErrorFilter() &#123; return new SendErrorFilter(); &#125; @Bean public SendForwardFilter sendForwardFilter() &#123; return new SendForwardFilter(); &#125; @Configuration protected static class ZuulFilterConfiguration &#123; @Autowired private Map&lt;String, ZuulFilter&gt; filters; @Bean public ZuulFilterInitializer zuulFilterInitializer() &#123; return new ZuulFilterInitializer(this.filters); &#125; &#125; private static class ZuulRefreshListener implements ApplicationListener&lt;ApplicationEvent&gt; &#123; @Autowired private ZuulHandlerMapping zuulHandlerMapping; private HeartbeatMonitor heartbeatMonitor = new HeartbeatMonitor(); @Override public void onApplicationEvent(ApplicationEvent event) &#123; if (event instanceof ContextRefreshedEvent || event instanceof RefreshScopeRefreshedEvent || event instanceof RoutesRefreshedEvent) &#123; this.zuulHandlerMapping.setDirty(true); &#125; else if (event instanceof HeartbeatEvent) &#123; if (this.heartbeatMonitor.update(((HeartbeatEvent) event).getValue())) &#123; this.zuulHandlerMapping.setDirty(true); &#125; &#125; &#125; &#125;&#125; å¦‚ä¸Šæ‰€ç¤º,å½“ä½¿ç”¨ApplicationEventPublisherå‘é€çš„Eventä¸ºContextRefreshedEventï¼ŒRefreshScopeRefreshedEventï¼ŒRoutesRefreshedEventæ‰ä¼šé€šçŸ¥Zuulå»åˆ·æ–°è·¯ç”±ã€‚ 3.3 åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator3.3.1 å¤„ç†æ€è·¯æ­¤æ’ä»¶é’ˆå¯¹çš„spring cloud zuulç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œå› æ­¤éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œå°†è·¯ç”±é…ç½®å¯ä»¥é…ç½®åˆ°mysqlè¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¯¦ç»†è¯·çœ‹Zuulçš„æ”¹åŠ¨ç‚¹ã€‚ 3.3.2 å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›– å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–ï¼Œè¯¥ç±»çš„ä½œç”¨å°±æ˜¯ä»ymlæˆ–å±æ€§æ–‡ä»¶ä¸­è¯»å–è·¯ç”±è§„åˆ™ï¼› å…·ä½“å‚çœ‹æºç org.springframework.cloud.netflix.zuul.filters.discovery.DiscoveryClientRouteLocatorï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼Œå°±ä¸åšå¤šä½™è§£é‡Šã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263@Override protected LinkedHashMap&lt;String, ZuulRoute&gt; locateRoutes() &#123; LinkedHashMap&lt;String, ZuulRoute&gt; routesMap = new LinkedHashMap&lt;String, ZuulRoute&gt;(); routesMap.putAll(super.locateRoutes()); if (this.discovery != null) &#123; Map&lt;String, ZuulRoute&gt; staticServices = new LinkedHashMap&lt;String, ZuulRoute&gt;(); for (ZuulRoute route : routesMap.values()) &#123; String serviceId = route.getServiceId(); if (serviceId == null) &#123; serviceId = route.getId(); &#125; if (serviceId != null) &#123; staticServices.put(serviceId, route); &#125; &#125; // Add routes for discovery services by default List&lt;String&gt; services = this.discovery.getServices(); String[] ignored = this.properties.getIgnoredServices() .toArray(new String[0]); for (String serviceId : services) &#123; // Ignore specifically ignored services and those that were manually // configured String key = \"/\" + mapRouteToService(serviceId) + \"/**\"; if (staticServices.containsKey(serviceId) &amp;&amp; staticServices.get(serviceId).getUrl() == null) &#123; // Explicitly configured with no URL, cannot be ignored // all static routes are already in routesMap // Update location using serviceId if location is null ZuulRoute staticRoute = staticServices.get(serviceId); if (!StringUtils.hasText(staticRoute.getLocation())) &#123; staticRoute.setLocation(serviceId); &#125; &#125; if (!PatternMatchUtils.simpleMatch(ignored, serviceId) &amp;&amp; !routesMap.containsKey(key)) &#123; // Not ignored routesMap.put(key, new ZuulRoute(key, serviceId)); &#125; &#125; &#125; if (routesMap.get(DEFAULT_ROUTE) != null) &#123; ZuulRoute defaultRoute = routesMap.get(DEFAULT_ROUTE); // Move the defaultServiceId to the end routesMap.remove(DEFAULT_ROUTE); routesMap.put(DEFAULT_ROUTE, defaultRoute); &#125; LinkedHashMap&lt;String, ZuulRoute&gt; values = new LinkedHashMap&lt;&gt;(); for (Entry&lt;String, ZuulRoute&gt; entry : routesMap.entrySet()) &#123; String path = entry.getKey(); // Prepend with slash if not already present. if (!path.startsWith(\"/\")) &#123; path = \"/\" + path; &#125; if (StringUtils.hasText(this.properties.getPrefix())) &#123; path = this.properties.getPrefix() + path; if (!path.startsWith(\"/\")) &#123; path = \"/\" + path; &#125; &#125; values.put(path, entry.getValue()); &#125; return values; &#125; 3.3.3 ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥æ•°æ®å˜æ›´å¯¹ç½‘å…³çš„ç¨³å®šæ€§æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å½“å¯¹è·¯ç”±ä¿¡æ¯è¿›è¡ŒCRUDæ“ä½œä¹‹åï¼Œéœ€è¦Spring Cloud Zuulé‡æ–°åˆ·æ–°è·¯ç”±è§„åˆ™ï¼Œå®ç°æ–¹å¼é€šè¿‡springçš„eventæ¥å®ç°ã€‚ 1.å®ç°åŸºäºApplicationEventPublisherAwareçš„äº‹ä»¶ç”Ÿäº§è€…çš„ä»£ç ç‰‡æ®µ12private ApplicationEventPublisher publisher;publisher.publishEvent(new InstanceRegisteredEvent&lt;&gt;(this, this.environment)); 2.Spring Cloud netflixå†…éƒ¨çš„äº‹ä»¶æ¶ˆè´¹è€… org.springframework.cloud.netflix.zuul.RoutesRefreshedEvent 123456789101112131415@SuppressWarnings(\"serial\")public class RoutesRefreshedEvent extends ApplicationEvent &#123; private RouteLocator locator; public RoutesRefreshedEvent(RouteLocator locator) &#123; super(locator); this.locator = locator; &#125; public RouteLocator getLocator() &#123; return this.locator; &#125;&#125; å››.åŸºäºSpring Cloud Gatewayæ„å»ºç½‘å…³ç”±äºSpring Cloud Gatewayæœªå®Œå…¨æˆç†Ÿï¼Œè€Œä¸”æ€§èƒ½ï¼Œç¨³å®šæ€§ç­‰ï¼Œç°åœ¨æ— ä»è€ƒè¯ï¼Œæ²¡æœ‰ä½¿ç”¨æ¡ˆä¾‹ï¼ŒåŸºäºSpring Cloud Gatewayæ–¹æ¡ˆæ„å»ºè‡ªå·±çš„ç½‘å…³é£é™©æ¯”è¾ƒå¤§ï¼Œè€Œä¸”PSä¸çŸ¥é“åˆ°å¹´åº•æ˜¯å¦æˆç†Ÿå¯ç”¨ã€‚æ•…åœ¨è¿™é‡Œä¸åšè¿‡å¤šè¯´æ˜ã€‚ äº”.åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶5.1 æ¶æ„å›¾å¯ä»¥å‚è€ƒæ¶æ„å›¾å¦‚ä¸‹: 5.2 è®¾è®¡åŸåˆ™ 1.æ¯ä¸ªFilteråŸºäºè´£ä»»é“¾ï¼Œåªåšä¸“ä¸€çš„ä¸€ä»¶äº‹ 2.æ¯ä¸ªFilteræœ‰å„è‡ªç‹¬ç«‹çš„æ•°æ® 3.æŸè€—æ€§èƒ½çš„Filteré¡ºåºå¾€åæ”¾ 4.å¯åŠ¨è¯»å–é…ç½®é¡ºåºï¼Œå…ˆè¿œç«¯ï¼Œè‹¥è¿œç«¯å¤±è´¥ï¼Œåˆ™è¯»å–æœ¬åœ°ã€‚ 5.é›†ç¾¤ç½‘å…³ï¼Œè¦æ³¨æ„æ•°æ®çš„diffå’Œç°åº¦ 6.å°½é‡åšåˆ°å’ŒæœåŠ¡æ²»ç†æ¡†æ¶è§£è€¦ï¼Œæ˜“äºæ¥å…¥ï¼Œæ˜“äºå‡çº§ å…­.å‚è€ƒæ–‡ç« ä¼ä¸šçº§APIç½‘å…³çš„è®¾è®¡å¾®æœåŠ¡ä¸API ç½‘å…³ï¼ˆä¸Šï¼‰: ä¸ºä»€ä¹ˆéœ€è¦APIç½‘å…³ï¼Ÿhttp://blog.csdn.net/u013815546/article/details/68944039https://segmentfault.com/a/1190000009191419","categories":[{"name":"Janusç½‘å…³","slug":"Janusç½‘å…³","permalink":"http://xujin.org/categories/Janusç½‘å…³/"}],"tags":[{"name":"ç½‘å…³ä¸­é—´ä»¶","slug":"ç½‘å…³ä¸­é—´ä»¶","permalink":"http://xujin.org/tags/ç½‘å…³ä¸­é—´ä»¶/"}]},{"title":"æ·±å…¥ç†è§£HashMapä¸Šç¯‡","slug":"java/hm01","date":"2017-07-10T06:00:00.000Z","updated":"2019-01-13T05:23:20.028Z","comments":true,"path":"java/hm01/","link":"","permalink":"http://xujin.org/java/hm01/","excerpt":"å‰è¨€: HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ€è¿‘åˆšå¥½æœ‰æ—¶é—´ï¼Œåˆšå¥½æŠŠHashMapç›¸å…³çš„å†…å®¹å’Œä¹‹å‰åšå”¯å“ä¼šç½‘å…³çš„ä¸€äº›ç»éªŒæ•´ç†ä¸€ä¸‹ã€‚ ä¸€.HashMapçš„æ¦‚è¿°1.1 HashMapçš„æ•°æ®ç»“æ„HashMapçš„å†…å­˜ç»“æ„å’ŒåŸç†ï¼Œä»¥åŠçº¿ç¨‹å®‰å…¨éƒ½æ˜¯é¢è¯•çš„çƒ­ç‚¹é—®é¢˜ã€‚Javaä¸­çš„æ•°æ®ç»“æ„åŸºæœ¬å¯ä»¥ç”¨æ•°ç»„+é“¾è¡¨çš„è§£å†³ã€‚ æ•°ç»„çš„ä¼˜ç¼ºç‚¹:é€šè¿‡ä¸‹æ ‡ç´¢å¼•æ–¹ä¾¿æŸ¥æ‰¾ï¼Œä½†æ˜¯åœ¨æ•°ç»„ä¸­æ’å…¥æˆ–åˆ é™¤ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒå›°éš¾ã€‚ é“¾è¡¨çš„ä¼˜ç¼ºç‚¹:ç”±äºåœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ éœ€è¦ä»¥éå†é“¾è¡¨çš„æ–¹å¼å»æŸ¥æ‰¾ï¼Œè€Œæ’å…¥ï¼Œåˆ é™¤å¿«é€Ÿã€‚å› æ­¤é“¾è¡¨é€‚åˆå¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ï¼Œä¸åˆ©äºæŸ¥æ‰¾ã€‚","text":"å‰è¨€: HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ€è¿‘åˆšå¥½æœ‰æ—¶é—´ï¼Œåˆšå¥½æŠŠHashMapç›¸å…³çš„å†…å®¹å’Œä¹‹å‰åšå”¯å“ä¼šç½‘å…³çš„ä¸€äº›ç»éªŒæ•´ç†ä¸€ä¸‹ã€‚ ä¸€.HashMapçš„æ¦‚è¿°1.1 HashMapçš„æ•°æ®ç»“æ„HashMapçš„å†…å­˜ç»“æ„å’ŒåŸç†ï¼Œä»¥åŠçº¿ç¨‹å®‰å…¨éƒ½æ˜¯é¢è¯•çš„çƒ­ç‚¹é—®é¢˜ã€‚Javaä¸­çš„æ•°æ®ç»“æ„åŸºæœ¬å¯ä»¥ç”¨æ•°ç»„+é“¾è¡¨çš„è§£å†³ã€‚ æ•°ç»„çš„ä¼˜ç¼ºç‚¹:é€šè¿‡ä¸‹æ ‡ç´¢å¼•æ–¹ä¾¿æŸ¥æ‰¾ï¼Œä½†æ˜¯åœ¨æ•°ç»„ä¸­æ’å…¥æˆ–åˆ é™¤ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒå›°éš¾ã€‚ é“¾è¡¨çš„ä¼˜ç¼ºç‚¹:ç”±äºåœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ éœ€è¦ä»¥éå†é“¾è¡¨çš„æ–¹å¼å»æŸ¥æ‰¾ï¼Œè€Œæ’å…¥ï¼Œåˆ é™¤å¿«é€Ÿã€‚å› æ­¤é“¾è¡¨é€‚åˆå¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ï¼Œä¸åˆ©äºæŸ¥æ‰¾ã€‚ è€ŒHashMapå°±æ˜¯ç»¼åˆäº†ä¸Šè¿°çš„ä¸¤ç§æ•°æ®ç»“æ„çš„ä¼˜ç‚¹ï¼ŒHashMapç”±Entryæ•°ç»„+é“¾è¡¨ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°HashMapæ˜¯ç”±Entryæ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œä¸€ä¸ªé•¿åº¦ä¸º16çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ å­˜å‚¨çš„æ˜¯ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚é‚£ä¹ˆè¿™äº›å…ƒç´ æ˜¯æŒ‰ç…§ä»€ä¹ˆæ ·çš„è§„åˆ™å­˜å‚¨åˆ°æ•°ç»„ä¸­å‘¢ã€‚ä¸€èˆ¬æƒ…å†µæ˜¯é€šè¿‡hash(key)%lenè·å¾—ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ çš„keyçš„å“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°ã€‚æ¯”å¦‚ä¸Šè¿°å“ˆå¸Œè¡¨ä¸­ï¼Œ12%16=12,28%16=12,108%16=12,140%16=12ã€‚æ‰€ä»¥12ã€28ã€108ä»¥åŠ140éƒ½å­˜å‚¨åœ¨æ•°ç»„ä¸‹æ ‡ä¸º12çš„ä½ç½®ã€‚ 1.2 HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜1.2.1 HashMap putæ–¹æ³•å®ç°1.é¦–å…ˆHashMapé‡Œé¢å®ç°ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Entryï¼Œå…¶é‡è¦çš„å±æ€§æœ‰ key , value, nextï¼Œä»å±æ€§key,valueæˆ‘ä»¬å°±èƒ½å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥Entryå°±æ˜¯HashMapé”®å€¼å¯¹å®ç°çš„ä¸€ä¸ªåŸºç¡€beanï¼Œæˆ‘ä»¬ä¸Šé¢è¯´åˆ°HashMapçš„åŸºç¡€å°±æ˜¯ä¸€ä¸ªçº¿æ€§æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯Entry[]ï¼ŒMapé‡Œé¢çš„å†…å®¹éƒ½ä¿å­˜åœ¨Entry[]é‡Œé¢ã€‚ 123456static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key;//Key-valueç»“æ„çš„key V value;//å­˜å‚¨å€¼ Entry&lt;K,V&gt; next;//æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ final int hash;//å“ˆå¸Œå€¼&#125; 2.æ—¢ç„¶æ˜¯çº¿æ€§æ•°ç»„ï¼Œä¸ºä»€ä¹ˆèƒ½éšæœºå­˜å–ï¼Ÿè¿™é‡ŒHashMapç”¨äº†ä¸€ä¸ªå°ç®—æ³•ï¼Œå¤§è‡´æ˜¯è¿™æ ·å®ç°ï¼š 1234567891011121314//å­˜å‚¨æ—¶:// è¿™ä¸ªhashCodeæ–¹æ³•è¿™é‡Œä¸è¯¦è¿°,åªè¦ç†è§£æ¯ä¸ªkeyçš„hashæ˜¯ä¸€ä¸ªå›ºå®šçš„intå€¼int hash = key.hashCode();int index = hash % Entry[].length;Entry[index] = value;//å–å€¼æ—¶:int hash = key.hashCode();int index = hash % Entry[].length;return Entry[index]; åˆ°è¿™é‡Œæˆ‘ä»¬è½»æ¾çš„ç†è§£äº†HashMapé€šè¿‡é”®å€¼å¯¹å®ç°å­˜å–çš„åŸºæœ¬åŸç† 3.ç–‘é—®ï¼šå¦‚æœä¸¤ä¸ªkeyé€šè¿‡hash%Entry[].lengthå¾—åˆ°çš„indexç›¸åŒï¼Œä¼šä¸ä¼šæœ‰è¦†ç›–çš„å±é™©ï¼Ÿ è¿™é‡ŒHashMapé‡Œé¢ç”¨åˆ°é“¾å¼æ•°æ®ç»“æ„çš„ä¸€ä¸ªæ¦‚å¿µã€‚ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡Entryç±»é‡Œé¢æœ‰ä¸€ä¸ªnextå±æ€§ï¼Œä½œç”¨æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªEntryã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹Aè¿›æ¥ï¼Œé€šè¿‡è®¡ç®—å…¶keyçš„hashå¾—åˆ°çš„index=0ï¼Œè®°åš:Entry[0] = Aã€‚ä¸€ä¼šååˆè¿›æ¥ä¸€ä¸ªé”®å€¼å¯¹Bï¼Œé€šè¿‡è®¡ç®—å…¶indexä¹Ÿç­‰äº0ï¼Œç°åœ¨æ€ä¹ˆåŠï¼ŸHashMapä¼šè¿™æ ·åš:B.next = A,Entry[0] = B,å¦‚æœåˆè¿›æ¥C,indexä¹Ÿç­‰äº0,é‚£ä¹ˆC.next = B,Entry[0] = Cï¼›è¿™æ ·æˆ‘ä»¬å‘ç°index=0çš„åœ°æ–¹å…¶å®å­˜å–äº†A,B,Cä¸‰ä¸ªé”®å€¼å¯¹,ä»–ä»¬é€šè¿‡nextè¿™ä¸ªå±æ€§é“¾æ¥åœ¨ä¸€èµ·ã€‚æ‰€ä»¥ç–‘é—®ä¸ç”¨æ‹…å¿ƒã€‚ä¹Ÿå°±æ˜¯è¯´æ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯æœ€åæ’å…¥çš„å…ƒç´ ã€‚åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒHashMapçš„å¤§è‡´å®ç°ï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»æ¸…æ¥šäº†ã€‚ å½“ç„¶HashMapé‡Œé¢ä¹ŸåŒ…å«ä¸€äº›ä¼˜åŒ–æ–¹é¢çš„å®ç°ï¼Œè¿™é‡Œä¹Ÿè¯´ä¸€ä¸‹ã€‚æ¯”å¦‚ï¼šEntry[]çš„é•¿åº¦ä¸€å®šåï¼Œéšç€mapé‡Œé¢æ•°æ®çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åŒä¸€ä¸ªindexçš„é“¾å°±ä¼šå¾ˆé•¿ï¼Œä¼šä¸ä¼šå½±å“æ€§èƒ½ï¼ŸHashMapé‡Œé¢è®¾ç½®ä¸€ä¸ªå› ç´ ï¼ˆä¹Ÿç§°ä¸ºå› å­ï¼‰ï¼Œéšç€mapçš„sizeè¶Šæ¥è¶Šå¤§ï¼ŒEntry[]ä¼šä»¥ä¸€å®šçš„è§„åˆ™åŠ é•¿é•¿åº¦ã€‚ äºŒ.HashMapéçº¿ç¨‹å®‰å…¨2.1 HashMapè¿›è¡ŒPutæ“ä½œ2.1.1 Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œputæ“ä½œä¸»è¦æ˜¯åˆ¤ç©ºï¼Œå¯¹keyçš„hashcodeæ‰§è¡Œä¸€æ¬¡HashMapè‡ªå·±çš„å“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°bucketindexä½ç½®ï¼Œè¿˜æœ‰å¯¹é‡å¤keyçš„è¦†ç›–æ“ä½œã€‚ åœ¨HashMapåšputæ“ä½œçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ä»¥ä¸‹çš„æ–¹æ³•ï¼ŒaddEntryå’ŒcreateEntry 1234567891011121314151617181920212223242526public V put(K key, V value) &#123; if (key == null) return putForNullKey(value); //å¾—åˆ°keyçš„hashcodeï¼ŒåŒæ—¶å†åšä¸€æ¬¡hashæ“ä½œ int hash = hash(key.hashCode()); //å¯¹æ•°ç»„é•¿åº¦å–ä½™ï¼Œå†³å®šä¸‹æ ‡ä½ç½® int i = indexFor(hash, table.length); /** * é¦–å…ˆæ‰¾åˆ°æ•°ç»„ä¸‹æ ‡å¤„çš„é“¾è¡¨ç»“ç‚¹ï¼Œ * åˆ¤æ–­keyå¯¹ä¸€ä¸ªçš„hashå€¼æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°†å…¶æ›¿æ¢ä¸ºæ–°çš„value */ for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; //Hashç¢°æ’çš„è§£å†³ if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; addEntry(hash, key, value, i); return null; &#125; æ¶‰åŠåˆ°çš„å‡ ä¸ªæ–¹æ³•ï¼š 12345678static int hash(int h) &#123; h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4); &#125; static int indexFor(int h, int length) &#123; return h &amp; (length-1); &#125; ç°åœ¨å‡å¦‚Açº¿ç¨‹å’ŒBçº¿ç¨‹åŒæ—¶è¿›å…¥addEntryï¼Œç„¶åè®¡ç®—å‡ºäº†ç›¸åŒçš„å“ˆå¸Œå€¼å¯¹åº”äº†ç›¸åŒçš„æ•°ç»„ä½ç½®ï¼Œå› ä¸ºæ­¤æ—¶è¯¥ä½ç½®è¿˜æ²¡æ•°æ®ï¼Œç„¶åå¯¹åŒä¸€ä¸ªæ•°ç»„ä½ç½®è°ƒç”¨createEntryï¼Œä¸¤ä¸ªçº¿ç¨‹ä¼šåŒæ—¶å¾—åˆ°ç°åœ¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åAå†™å…¥æ–°çš„å¤´ç»“ç‚¹ä¹‹åï¼ŒBä¹Ÿå†™å…¥æ–°çš„å¤´ç»“ç‚¹ï¼Œé‚£Bçš„å†™å…¥æ“ä½œå°±ä¼šè¦†ç›–Açš„å†™å…¥æ“ä½œé€ æˆAçš„å†™å…¥æ“ä½œä¸¢å¤±ã€‚ 2.1.2 jdk8ä¸­HashMapçš„Putæ“ä½œ â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼› â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼› â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼› â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼› â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼› â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚ JDK1.8HashMapçš„putæ–¹æ³•æºç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657 public V put(K key, V value) &#123; // å¯¹keyçš„hashCode()åšhash return putVal(hash(key), key, value, false, true); &#125; final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨ else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key,value,null); //é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç† if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; // keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; 2.2 HashMapè¿›è¡ŒGetæ“ä½œ1234567891011121314public V get(Object key) &#123; if (key == null) return getForNullKey(); int hash = hash(key.hashCode()); /** * å…ˆå®šä½åˆ°æ•°ç»„å…ƒç´ ï¼Œå†éå†è¯¥å…ƒç´ å¤„çš„é“¾è¡¨ * åˆ¤æ–­çš„æ¡ä»¶æ˜¯keyçš„hashå€¼ç›¸åŒï¼Œå¹¶ä¸”é“¾è¡¨çš„å­˜å‚¨çš„keyå€¼å’Œä¼ å…¥çš„keyå€¼ç›¸åŒ */ for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];e != null;e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) return e.value; &#125; return null; çœ‹ä¸€ä¸‹é“¾è¡¨çš„ç»“ç‚¹æ•°æ®ç»“æ„ï¼Œä¿å­˜äº†å››ä¸ªå­—æ®µï¼ŒåŒ…æ‹¬keyï¼Œvalueï¼Œkeyå¯¹åº”çš„hashå€¼ä»¥åŠé“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼š 123456static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key;//Key-valueç»“æ„çš„key V value;//å­˜å‚¨å€¼ Entry&lt;K,V&gt; next;//æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ final int hash;//å“ˆå¸Œå€¼&#125; 2.3 HashMapæ‰©å®¹çš„æ—¶å€™æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚ è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªaddEntryæ–¹æ³•ä¸­ï¼Œæœ‰ä¸ªæ‰©å®¹çš„æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä¼šæ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„æ•°ç»„ï¼Œç„¶åå¯¹åŸæ•°ç»„çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°è¿›è¡Œè®¡ç®—å’Œå†™å…¥æ–°çš„æ•°ç»„ï¼Œä¹‹åæŒ‡å‘æ–°ç”Ÿæˆçš„æ•°ç»„ã€‚æ¥çœ‹ä¸€ä¸‹æ‰©å®¹çš„æºç ï¼š 12345678910111213141516171819//ç”¨æ–°çš„å®¹é‡æ¥ç»™tableæ‰©å®¹ void resize(int newCapacity) &#123; Entry[] oldTable = table; //å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„ int oldCapacity = oldTable.length; //ä¿å­˜old capacity // å¦‚æœæ—§çš„å®¹é‡å·²ç»æ˜¯ç³»ç»Ÿé»˜è®¤æœ€å¤§å®¹é‡äº†(æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº† )ï¼Œé‚£ä¹ˆå°†é˜ˆå€¼è®¾ç½®æˆæ•´å½¢çš„æœ€å¤§å€¼ï¼Œé€€å‡º , if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; //åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„ Entry[] newTable = new Entry[newCapacity]; //å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ transfer(newTable, initHashSeedAsNeeded(newCapacity)); //HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„ table = newTable; //è®¾ç½®é˜ˆå€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1); &#125; è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥ï¼Œæ£€æµ‹åˆ°æ€»æ•°é‡è¶…è¿‡é—¨é™å€¼çš„æ—¶å€™å°±ä¼šåŒæ—¶è°ƒç”¨resizeæ“ä½œï¼Œå„è‡ªç”Ÿæˆæ–°çš„æ•°ç»„å¹¶rehashåèµ‹ç»™è¯¥mapåº•å±‚çš„æ•°ç»„tableï¼Œç»“æœæœ€ç»ˆåªæœ‰æœ€åä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆçš„æ–°æ•°ç»„è¢«èµ‹ç»™tableå˜é‡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‡ä¼šä¸¢å¤±ã€‚è€Œä¸”å½“æŸäº›çº¿ç¨‹å·²ç»å®Œæˆèµ‹å€¼è€Œå…¶ä»–çº¿ç¨‹åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå°±ä¼šç”¨å·²ç»è¢«èµ‹å€¼çš„tableä½œä¸ºåŸå§‹æ•°ç»„ï¼Œè¿™æ ·ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥åœ¨æ‰©å®¹æ“ä½œçš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å¹¶å‘çš„é—®é¢˜ã€‚ 2.4 åˆ é™¤æ•°æ®çš„æ—¶å€™123456789101112131415161718192021222324252627282930313233343536 //æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤Entryï¼Œè¿”å›å¯¹åº”çš„value public V remove(Object key) &#123; Entry&lt;K,V&gt; e = removeEntryForKey(key); return (e == null ? null : e.value); &#125; //æ ¹æ®æŒ‡å®šçš„keyï¼Œåˆ é™¤Entry,å¹¶è¿”å›å¯¹åº”çš„value final Entry&lt;K,V&gt; removeEntryForKey(Object key) &#123; if (size == 0) &#123; return null; &#125; int hash = (key == null) ? 0 : hash(key); int i = indexFor(hash, table.length); Entry&lt;K,V&gt; prev = table[i]; Entry&lt;K,V&gt; e = prev; while (e != null) &#123; Entry&lt;K,V&gt; next = e.next; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; modCount++; size--; if (prev == e) //å¦‚æœåˆ é™¤çš„æ˜¯tableä¸­çš„ç¬¬ä¸€é¡¹çš„å¼•ç”¨ table[i] = next;//ç›´æ¥å°†ç¬¬ä¸€é¡¹ä¸­çš„nextçš„å¼•ç”¨å­˜å…¥table[i]ä¸­ else prev.next = next; //å¦åˆ™å°†table[i]ä¸­å½“å‰Entryçš„å‰ä¸€ä¸ªEntryä¸­çš„nextç½®ä¸ºå½“å‰Entryçš„next e.recordRemoval(this); return e; &#125; prev = e; e = next; &#125; return e; &#125; åˆ é™¤è¿™ä¸€å—å¯èƒ½ä¼šå‡ºç°ä¸¤ç§çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¬¬ä¸€ç§æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­å¾—åˆ°äº†æŒ‡å®šçš„æ•°ç»„ä½ç½®iå¹¶è¿›å…¥äº†å¾ªç¯ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨åŒæ ·çš„ä½ç½®å·²ç»åˆ æ‰äº†iä½ç½®çš„é‚£ä¸ªæ•°æ®äº†ï¼Œç„¶åç¬¬ä¸€ä¸ªçº¿ç¨‹é‚£è¾¹å°±æ²¡äº†ã€‚ä½†æ˜¯åˆ é™¤çš„è¯ï¼Œæ²¡äº†å€’é—®é¢˜ä¸å¤§ã€‚ å†çœ‹å¦ä¸€ç§æƒ…å†µï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªæ•°ç»„ä½ç½®çš„æ—¶å€™ï¼Œä¹Ÿéƒ½ä¼šå…ˆå–å¾—ç°åœ¨çŠ¶æ€ä¸‹è¯¥ä½ç½®å­˜å‚¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åå„è‡ªå»è¿›è¡Œè®¡ç®—æ“ä½œï¼Œä¹‹åå†æŠŠç»“æœå†™ä¼šåˆ°è¯¥æ•°ç»„ä½ç½®å»ï¼Œå…¶å®å†™å›çš„æ—¶å€™å¯èƒ½å…¶ä»–çš„çº¿ç¨‹å·²ç»å°±æŠŠè¿™ä¸ªä½ç½®ç»™ä¿®æ”¹è¿‡äº†ï¼Œå°±ä¼šè¦†ç›–å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹ã€‚ æ€»ä¹‹HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘çš„åœºåˆä½¿ç”¨çš„è¯ï¼Œè¦ç”¨Collections.synchronizedMapè¿›è¡ŒåŒ…è£…ä¸€ä¸‹ã€‚ ä¸‰.å‚è€ƒæ–‡ç« https://zhuanlan.zhihu.com/p/21673805http://www.importnew.com/7099.htmlhttp://www.admin10000.com/document/3322.htmlhttp://www.cnblogs.com/chenssy/p/3521565.html","categories":[{"name":"java","slug":"java","permalink":"http://xujin.org/categories/java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"Jdk","slug":"Jdk","permalink":"http://xujin.org/tags/Jdk/"}]},{"title":"Spring Cloud Gatewayç¦»å¼€å­µåŒ–å™¨çš„å˜åŒ–","slug":"sc/sc-gateway","date":"2017-07-08T06:00:00.000Z","updated":"2019-01-13T03:26:25.716Z","comments":true,"path":"sc/sc-gateway/","link":"","permalink":"http://xujin.org/sc/sc-gateway/","excerpt":"æ‘˜è¦: Spring Cloudå¯¹Netflixçš„Zuulè¿›è¡Œå°è£…ä¹‹åï¼ŒSpring Cloud Zuulä½œä¸ºSpring Cloudçš„ç½‘å…³ä¸€ç›´è¢«å¤§å®¶ä½¿ç”¨ç”¨è‡³ä»Šï¼Œåœ¨Spring Cloudçš„æ ¸å¿ƒé¡¹ç›®å¼€å‘è€…Spencergibbçš„ä¸€ç¯‡åšå®¢The API Gateway is Dead! Long Live the API Gateway!ä¸­ä»‹ç»äº†Zuulï¼ŒZuul 2ä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰Spring Cloud Gateway,å¤§å®¶æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ã€‚æœ¬æ–‡å°†ä¼šå¯¹spring-cloud-gateway-mvcæºç è¿›è¡Œdemoæ¼”ç¤ºå’Œç®€å•åˆ†æã€‚ ä¸€.Spring Cloud Gatewayæ¦‚å†µ1.1 ä»€ä¹ˆæ˜¯Spring Cloud GateWayA Gateway built on Spring Framework 5.0 and Spring Boot 2.0 providing routing and moreã€‚ Spring Cloud Gatewayæ˜¯åŸºäºSpring æ¡†æ¶5.0ç‰ˆæœ¬å’ŒSpring Boot 2.0çš„ç‰ˆæœ¬æ„å»ºï¼Œæä¾›è·¯ç”±ç­‰åŠŸèƒ½ã€‚","text":"æ‘˜è¦: Spring Cloudå¯¹Netflixçš„Zuulè¿›è¡Œå°è£…ä¹‹åï¼ŒSpring Cloud Zuulä½œä¸ºSpring Cloudçš„ç½‘å…³ä¸€ç›´è¢«å¤§å®¶ä½¿ç”¨ç”¨è‡³ä»Šï¼Œåœ¨Spring Cloudçš„æ ¸å¿ƒé¡¹ç›®å¼€å‘è€…Spencergibbçš„ä¸€ç¯‡åšå®¢The API Gateway is Dead! Long Live the API Gateway!ä¸­ä»‹ç»äº†Zuulï¼ŒZuul 2ä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰Spring Cloud Gateway,å¤§å®¶æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ã€‚æœ¬æ–‡å°†ä¼šå¯¹spring-cloud-gateway-mvcæºç è¿›è¡Œdemoæ¼”ç¤ºå’Œç®€å•åˆ†æã€‚ ä¸€.Spring Cloud Gatewayæ¦‚å†µ1.1 ä»€ä¹ˆæ˜¯Spring Cloud GateWayA Gateway built on Spring Framework 5.0 and Spring Boot 2.0 providing routing and moreã€‚ Spring Cloud Gatewayæ˜¯åŸºäºSpring æ¡†æ¶5.0ç‰ˆæœ¬å’ŒSpring Boot 2.0çš„ç‰ˆæœ¬æ„å»ºï¼Œæä¾›è·¯ç”±ç­‰åŠŸèƒ½ã€‚ 1.2 Spring Cloud GateWayçš„åŠŸèƒ½Spring Cloud GateWayå…·æœ‰ä»¥ä¸‹ç‰¹å¾ Java 8/Spring 5/Boot 2 WebFlux/Reactor HTTP/2 and Websockets Finchley Release Train (Q4 2017) ç”±äºSpring 5.0æ”¯æŒNettyï¼ŒHttp2ï¼Œè€ŒSpring Boot 2.0æ”¯æŒSpring 5.0ï¼Œå› æ­¤Spring Cloud Gatewayæ”¯æŒNettyå’ŒHttp2é¡ºç†æˆç« ã€‚è‡³äº2017å¹´Q4å­£åº¦æ˜¯å¦å‘å¸ƒå®Œæ•´çš„Spring Cloud Gatewayæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚ 1.3 Spring Cloud GateWayç¦»å¼€å­µåŒ–å™¨ä»2016å¹´12æœˆä»½ä»¥åï¼Œåœ¨Githubä¸Šå‡ºç°äº†Spring Cloud Gatewayçš„é¡¹ç›®ï¼Œåœ°å€ä¸º:https://github.com/spring-cloud-incubator/spring-cloud-gateway,å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Spring Cloud GateWayç¦»å¼€å­µåŒ–å™¨ä¹‹åmasteråˆ†æ”¯æœ‰MVCæ¨¡å—,éœ€è¦æŸ¥çœ‹å®Œæ•´çš„å…¶å®ƒçš„æ¨¡å—è¯·åˆ‡æ¢åˆ†æ”¯åˆ°2.X ã€‚å› æ­¤åœ¨æœ¬æ–‡ä¸åˆ†æcoreé‡Œé¢çš„è®¾è®¡å’Œå®ç°,åé¢å°†ä¼šè¡¥ä¸€ç¯‡æ–‡ç« ä»‹ç»ã€‚ 2.Spring Cloud Gatewayçš„è®¾è®¡æ ¸å¿ƒä»£ç ä¸»è¦åœ¨spring-cloud-gateway-core,ä½†æ˜¯ç”±äºç›®å‰ç¦»å¼€å­µåŒ–å™¨ä¹‹åspring-cloud-gateway-coreçš„ä»£ç æŒªåˆ°äº†2.Xä¸­,ç‚¹å‡»è®¿é—®ä¼šè‡ªåŠ¨è½¬å‘åˆ°https://github.com/spring-cloud/spring-cloud-gateway å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç›®å‰masteråˆ†æ”¯ä¸­gatewayæ²¡æœ‰coreå’Œstarterï¼Œç›¸å¯¹è€Œè¨€å¢åŠ äº†ä¸€ä¸ªspring-cloud-gateway-mvcæ¨¡å—ï¼Œåœ¨ä¸‹é¢ç« èŠ‚å°†ä¼šå¯¹è¯¥æ¨¡å—è¿›è¡Œdemoå’Œæºç åˆ†æã€‚ 1.3 ç”¨Spring MVCçš„æ–¹å¼æ„å»ºGateway1.3.1 How to Include Spring Cloud GatewayTo include Spring Cloud Gateway in your project add a dependency with group org.springframework.cloud and artifact id spring-cloud-gateway-mvc. See the Spring Cloud Project page for details on setting up your build system with the current Spring Cloud Release Train. ä½¿ç”¨spring-cloud-gateway-mvcï¼Œåªè¦å¼•å…¥å¯¹åº”çš„spring-cloud-gateway-mvcçš„ä¾èµ–åæ ‡ã€‚ 1.3.2 Building a Gateway Using Spring MVCSpring Cloud Gateway provides a utility object called ProxyExchange which you can use inside a regular Spring MVC handler as a method parameter. It supports basic downstream HTTP exchanges via methods that mirror the HTTP verbs, or forwarding to a local handler via the forward() method. Example (proxying a request to â€œ/testâ€ downstream to a remote server): 12345678910111213 @RestController@SpringBootApplicationpublic class GatewaySampleApplication &#123; @Value(\"$&#123;remote.home&#125;\") private URI home; @GetMapping(\"/test\") public ResponseEntity&lt;?&gt; proxy(ProxyExchange&lt;Object&gt; proxy) throws Exception &#123; return proxy.uri(home.toString() + \"/image/png\").get(); &#125;&#125; Spring Cloud Gateway æä¾›äº†ä¸€ä¸ªå®ç”¨çš„å¯¹è±¡å«ProxyExchangeï¼Œä½ å¯ä»¥ç”¨å®ƒåƒä½¿ç”¨Spring MVC Handlerçš„æ–¹å¼å»è½¬å‘ï¼Œé‡å®šå‘æ„å»ºç½‘å…³ã€‚ æ›´å¤šä¿¡æ¯å‚è€ƒ:https://github.com/spring-cloud/spring-cloud-gateway/blob/master/docs/src/main/asciidoc/spring-cloud-gateway.adoc äºŒ.Spring Cloud Gatewayçš„MVCæ¨¡å—æºç åˆ†æ2.1 æ„å»ºSpring Cloud Gatewayçš„DemoSpring Cloud Gatewayçš„å·¥ç¨‹é‡Œå·²ç»ç»™æˆ‘æä¾›äº†ä¸€ä¸ªï¼Œspring-cloud-gateway-sampleçš„å·¥ç¨‹ï¼Œè¯¥å·¥ç¨‹é¡¹ç›®ä¾èµ–äºspring-cloud-gateway-mvcï¼Œå› æ­¤è¦å¯¹å…¶æºç åˆ†æï¼Œåªéœ€è®©æ‰sample æ­£å¸¸workå°±okã€‚ ä»å·¥ç¨‹æˆªå›¾æ¥çœ‹ï¼Œå’Œæˆ‘ä¹‹å‰çœ‹çš„coreæ¨¡å—æ¥è¯´ï¼Œmvcæ¨¡å—åªæ˜¯åšäº†ä¸ªè¯·æ±‚çš„è½¬å‘ã€‚ 2.2 Spring Cloud Gatewayæ¨¡å—æºç åˆ†æ1.åœ¨spring-cloud-gateway-sampleä¸­application.ymlå¢åŠ åº”ç”¨åå’Œç«¯å£é…ç½® 123456789101112 server: port: 8080spring: application: name: sc-gwmanagement: security: enabled: falseremote: home: http://httpbin.org #è¯·æ±‚è½¬å‘çš„ç›®æ ‡æœåŠ¡Url 2.org.springframework.cloud.gateway.sample.GatewaySampleApplication.java 123456789101112131415161718192021222324252627282930 @RestController@SpringBootApplicationpublic class GatewaySampleApplication &#123; @Value(\"$&#123;remote.home&#125;\") private URI home; //è¯¥æ–¹æ³•éœ€è¦ä¼ é€’headä¸ºx-host=png.abc.orgæ–¹å¯è°ƒç”¨ @GetMapping(path=\"/test\", headers=\"x-host=png.abc.org\") public ResponseEntity&lt;Object&gt; proxy(ProxyExchange&lt;Object&gt; proxy) throws Exception &#123; return proxy.uri(home.toString() + \"/image/png\") .get(header(\"X-TestHeader\", \"foobar\")); &#125; @GetMapping(\"/test2\") public ResponseEntity&lt;Object&gt; proxyFoos(ProxyExchange&lt;Object&gt; proxy) throws Exception &#123; return proxy.uri(home.toString() + \"/image/webp\").get(header(\"X-AnotherHeader\", \"baz\")); &#125; private Function&lt;ResponseEntity&lt;Object&gt;, ResponseEntity&lt;Object&gt;&gt; header(String key, String value) &#123; return response -&gt; ResponseEntity.status(response.getStatusCode()) .headers(response.getHeaders()).header(key, value) .body(response.getBody()); &#125; public static void main(String[] args) &#123; SpringApplication.run(GatewaySampleApplication.class, args); &#125;&#125; 2.3 ä»£ç åˆ†æ å¯åŠ¨GatewaySampleApplicationä¸»åº”ç”¨ç¨‹åºï¼Œè®¿é—®http://localhost:8080/test2,Debugæµç¨‹å¦‚ä¸‹ã€‚ 1234@GetMapping(\"/test2\")public ResponseEntity&lt;Object&gt; proxyFoos(ProxyExchange&lt;Object&gt; proxy) throws Exception &#123; return proxy.uri(home.toString() + \"/image/webp\").get(header(\"X-AnotherHeader\", \"baz\"));&#125; åœ¨ProxyExchange.javaä¸­çš„237è¡Œä»£ç  12345678910public ProxyExchange&lt;T&gt; uri(String uri) &#123; try &#123; //å°†uri:http://httpbin.org/image/webpï¼Œnew URIå¯¹è±¡è¿”å› this.uri = new URI(uri); &#125; catch (URISyntaxException e) &#123; throw new IllegalStateException(\"Cannot create URI\", e); &#125; return this;&#125; åœ¨RestTemplate.javaä¸­çš„628è¡ŒdoExecuteå»ä½¿ç”¨å¯¹åº”çš„httpClientå®ç°è¿œç¨‹è°ƒç”¨ 123456@Overridepublic &lt;T&gt; T execute(URI url, HttpMethod method, RequestCallback requestCallback, ResponseExtractor&lt;T&gt; responseExtractor) throws RestClientException &#123; return doExecute(url, method, requestCallback, responseExtractor);&#125; æœ€ç»ˆè°ƒç”¨ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤º,ç”±äºæºç æ¯”è¾ƒç®€å•ï¼Œå› æ­¤æœ‰äº›ç»†èŠ‚æµç¨‹ç•¥è¿‡ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±è·Ÿè¸ªç†è§£ã€‚","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Gateway","slug":"Spring-Cloud-Gateway","permalink":"http://xujin.org/tags/Spring-Cloud-Gateway/"}]},{"title":"Spring Cloud Zuulå¼‚å¸¸å¤„ç†","slug":"sc/sc-zuul-excpetion","date":"2017-06-24T04:23:31.000Z","updated":"2019-01-13T05:01:58.908Z","comments":true,"path":"sc/sc-zuul-excpetion/","link":"","permalink":"http://xujin.org/sc/sc-zuul-excpetion/","excerpt":"æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ªGitHub issueåœ¨è®¨è®ºå¦‚ä½•åœ¨postç±»å‹çš„zuul filterä¸­è®¾ç½®response bodyï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå¦‚ä½•è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„response bodyã€‚æ­£å¥½æˆ‘åœ¨å‡çº§spring-cloudï¼Œä¹Ÿæƒ³å¼„æ¸…æ¥šï¼Œspring-cloud-zuulæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸æƒ…å†µçš„ï¼Œæ‰€ä»¥å°±ä»”ç»†çœ‹äº†çœ‹è¿™éƒ¨åˆ†çš„å®ç°ç»†èŠ‚ï¼Œç°åœ¨åšä¸ªç¬”è®°è®°å½•ä¸‹æ¥ã€‚","text":"æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ªGitHub issueåœ¨è®¨è®ºå¦‚ä½•åœ¨postç±»å‹çš„zuul filterä¸­è®¾ç½®response bodyï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå¦‚ä½•è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„response bodyã€‚æ­£å¥½æˆ‘åœ¨å‡çº§spring-cloudï¼Œä¹Ÿæƒ³å¼„æ¸…æ¥šï¼Œspring-cloud-zuulæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸æƒ…å†µçš„ï¼Œæ‰€ä»¥å°±ä»”ç»†çœ‹äº†çœ‹è¿™éƒ¨åˆ†çš„å®ç°ç»†èŠ‚ï¼Œç°åœ¨åšä¸ªç¬”è®°è®°å½•ä¸‹æ¥ã€‚ 1.zullè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå›¾å…³äºzuulæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™é‡Œä¸å†ä»‹ç»ï¼Œå…·ä½“å¯ä»¥å‚çœ‹è¿™é‡Œã€‚å®˜æ–¹ç»™äº†ä¸€ä¸ªzullè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå›¾ï¼š ä¸Šå›¾ä¸­ï¼Œå®çº¿è¡¨ç¤ºè¯·æ±‚å¿…ç„¶ç»è¿‡çš„è·¯å¾„ï¼Œè€Œè™šçº¿è¡¨ç¤ºå¯èƒ½ç»è¿‡çš„è·¯å¾„ï¼›ä»è¿™å¼ å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š æ‰€æœ‰è¯·æ±‚éƒ½å¿…ç„¶æŒ‰ç…§pre-&gt; route -&gt; postçš„é¡ºåºæ‰§è¡Œã€‚ postè¿”å›responseã€‚ å¦‚æœpreä¸­æœ‰è‡ªå®šä¹‰filterï¼Œåˆ™æ‰§è¡Œè‡ªå®šä¹‰filterã€‚ å¦‚æœpre,route,postå‘ç”Ÿé”™è¯¯åˆ™æ‰§è¡Œerrorï¼Œç„¶åå†æ‰§è¡Œpostã€‚ è¿™å¼ å›¾å¿½ç•¥äº†å¾ˆå¤šç»†èŠ‚ï¼›æœ€æ˜æ˜¾çš„å°±æ˜¯ï¼Œè‡ªå®šä¹‰çš„filterå¯ä»¥æ˜¯pre,route,post,errorä¸­çš„ä»»ä½•ä¸€ç§ï¼›å…¶æ¬¡å‡å¦‚postä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ‰§è¡Œæµç¨‹äº¤ç»™errorå¤„ç†å®Œä¹‹åï¼Œåˆé‡æ–°å›åˆ°postä¸­ï¼Œä¼šä¸ä¼šåˆæœ‰é—®é¢˜ï¼Ÿ æ‰€ä»¥è¿˜æ˜¯çœ‹çœ‹ä»£ç æ¯”è¾ƒé è°±ã€‚ä»¥ä¸‹åŸºäºspring-cloud Dalston.RELEASEåšä»£ç åˆ†æã€‚ è°ƒè¯•ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯·æ±‚è¿›å…¥zuulä¹‹åçš„æ•´ä¸ªè°ƒç”¨é“¾ï¼Œç®€å•æ¥è¯´å¦‚ä¸‹ï¼šZuulServlet#service -&gt; FilterProcessor#processZuulFilter -&gt; ZuulFilter#runFilter -&gt; [Concret]ZuulFilter#runã€‚ 2.æºç åˆ†æZuulServlet#serviceé¦–å…ˆæ‰¾åˆ°è¯·æ±‚è¿›å…¥zuul filtersçš„å…¥å£ï¼šZuulServlet#service(ServletRequest, ServletResponse)ã€‚ ä¸‹é¢æŠ½å‡ºè¿™ä¸ªå‡½æ•°çš„ä¸»å¹²ï¼š 12345678910111213141516171819202122232425try &#123; try &#123; preRoute(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; route(); &#125; catch (ZuulException e) &#123; error(e); postRoute(); return; &#125; try &#123; postRoute(); &#125; catch (ZuulException e) &#123; error(e); return; &#125; &#125; catch (Throwable e) &#123; error(new ZuulException(e, 500, \"UNHANDLED_EXCEPTION_\" + e.getClass().getName())); &#125; è¿™ä¸ªå‡½æ•°åŸºæœ¬éµä»ä½†ä¸å®Œå…¨ç¬¦åˆå®˜ç½‘ç»™å‡ºçš„ç”Ÿå‘½å‘¨æœŸå›¾ï¼š æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯·æ±‚åªç»è¿‡pre -&gt; route -&gt; postã€‚ ä¸¤å±‚try...catchï¼Œå†…å±‚åªæ•è·ZuulExceptionï¼Œè€Œå…¶ä»–å¼‚å¸¸ç”±å¤–å±‚æ•è·ã€‚ å†…å±‚3ä¸ªtry...catchè¯­å¥ï¼Œåªæœ‰pre,routeæŠ›å‡ºZuulExceptionæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œerrrorï¼Œå†æ‰§è¡Œpostã€‚è€Œå½“post(88è¡Œ)æŠ›å‡ºZuulExceptionåï¼Œåªä¼šæ‰§è¡Œerrorã€‚ å¤–å±‚æ•è·å…¶ä»–å¼‚å¸¸(å†…å±‚tryè¯­å¥å—ä¸­æŠ›å‡ºçš„éZuulExceptionå¼‚å¸¸ä»¥åŠå†…å±‚catchè¯­å¥ä¸­æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸)åï¼Œå°†HTTPçŠ¶æ€ç è®¾ç½®ä¸º500ï¼ŒåŒæ—¶äº¤ç»™errorå¤„ç†ã€‚ æ•´ä¸ªæµç¨‹çš„ç»ˆç‚¹æœ‰ä¸¤ä¸ªï¼špoståŠerrorï¼›è€Œéåªæœ‰postä¸€ä¸ªã€‚ å¦å¤–çœ‹ä¸€ä¸‹error(ZuulException)è¿™ä¸ªå‡½æ•°åˆ°åº•åšäº†ä»€ä¹ˆï¼š 1234void error(ZuulException e) &#123; RequestContext.getCurrentContext().setThrowable(e); zuulRunner.error();&#125; å¼‚å¸¸ä¿¡æ¯æ˜¯åœ¨è¿™é‡Œè¢«åŠ å…¥åˆ°RequestContextä¸­çš„ï¼Œä»¥ä¾›åç»­çš„filterä½¿ç”¨ï¼Œç„¶åè°ƒç”¨error filtersã€‚ è‡³æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæµç¨‹å›¾(æ„Ÿè§‰è¿˜ä¸å¦‚ä»£ç çœ‹å¾—æ¸…æ™°-_-!!)ï¼š FilterProcessor#processZuulFilterFilterPreocessor#processZuulFilterï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨ZuulFilterï¼Œå¹¶ä¸”ä¼šå°†å¼‚å¸¸é‡æ–°æŠ›å‡ºï¼Œå¦‚æœæ˜¯éZuulExceptionçš„å¼‚å¸¸ï¼Œåˆ™è½¬ä¸ºçŠ¶æ€ç ä¸º500çš„ZuulExceptionã€‚ 123456789101112131415161718192021222324try &#123; Throwable t = null; ZuulFilterResult result = filter.runFilter(); ExecutionStatus s = result.getStatus(); switch (s) &#123; case FAILED: t = result.getException(); break; &#125; if (t != null) throw t; &#125; catch (Throwable e) &#123; if (e instanceof ZuulException) &#123; throw (ZuulException) e; &#125; else &#123; ZuulException ex = new ZuulException(e, \"Filter threw Exception\", 500, filter.filterType() + \":\" + filterName); throw ex; &#125; &#125; å¦‚æœZuulFilteræ‰§è¡Œå¤±è´¥ï¼Œå³ç»“æœçŠ¶æ€ä¸ºFAILEDï¼Œåˆ™ä»ZuulFilterçš„æ‰§è¡Œç»“æœZuulFilterResultä¸­æå–å‡ºå¼‚å¸¸ä¿¡æ¯(199è¡Œ)ï¼Œç„¶åæŠ›å‡º(214)ï¼›åœ¨catchè¯­å¥å—ä¸­ï¼Œæ•è·åˆšæ‰æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºZuulExceptionï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥æŠ›å‡ºï¼Œå¦åˆ™è½¬åŒ–ä¸ºçŠ¶æ€ä¸º500çš„ZuulExceptionå†æŠ›å‡ºã€‚ çœ‹åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ç¡®è®¤çš„ä¸€ç‚¹æ˜¯ï¼ŒZuulFilterä¸­æŠ›å‡ºçš„ä»»ä½•å½¢å¼çš„å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬åŒ–ä¸ºZuulExceptionæŠ›ç»™ä¸Šå±‚è°ƒç”¨è€…ï¼Œå³ZuulServlet#serviceã€‚ä½†æ˜¯è¿™é‡Œå¹¶ä¸æ˜¯é€šè¿‡try...catchæ¥æ•è·ZuulFilteræ‰§è¡Œä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œæ˜¯ä»è¿”å›ç»“æœZuulFilterResultä¸­ç›´æ¥è·å–çš„ï¼Œè¿™æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œéœ€è¦å†çœ‹ä¸‹ZuulFilter#runFilterçš„å®ç°é€»è¾‘ã€‚ ZuulFilter#runFilterä¸‹é¢æ˜¯ä»ZuulFilter#runFilter()æŠ½å–å‡ºæ¥çš„æ ¸å¿ƒä»£ç ï¼š 1234567891011ZuulFilterResult zr = new ZuulFilterResult(); try &#123; Object res = run(); zr = new ZuulFilterResult(res, ExecutionStatus.SUCCESS); &#125; catch (Throwable e) &#123; zr = new ZuulFilterResult(ExecutionStatus.FAILED); zr.setException(e); &#125; return zr; è¿™æ®µä»£ç ä¼šè°ƒç”¨æŸä¸ªå…·ä½“çš„ZuulFilterå®ç°çš„runæ–¹æ³•ï¼Œå¦‚æœä¸æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è¿”å›çŠ¶æ€ä¸ºExecutionStatus.SUCCESSçš„ZuulFilterResult(117è¡Œ)ï¼›è‹¥æœ‰ä»»ä½•å¼‚å¸¸ï¼Œåˆ™å°†è¿”å›ç»“æœçš„çŠ¶æ€è®¾ç½®ä¸ºExecutionStatus.FAILED(120)ï¼ŒåŒæ—¶å°†å¼‚å¸¸ä¿¡æ¯è®¾ç½®åˆ°è¿”å›ç»“æœä¸­(121)ã€‚å³æˆ‘ä»¬å®ç°ä¸€ä¸ªZuulFilterï¼Œå¦‚æœä¸æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¼šè¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ï¼Œå¦åˆ™å°±ä¼šè¢«å½“ä½œå¤±è´¥çš„ã€‚ ç»“åˆä¸Šé¢ä¸¤èŠ‚çš„ä»£ç åˆ†æï¼ŒZuulFilterä¸­ä¸€æ—¦æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œå¿…ç„¶æ˜¯(æˆ–è¢«è½¬åŒ–ä¸º)ZuulExceptionï¼Œç„¶åå¿…ç„¶è¿›å…¥åˆ°error filtersä¸­å¤„ç†ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ä¸Šé¢çš„æµç¨‹å›¾ï¼š 3.SpringCloudä¸­çš„SendErrorFilteråœ¨Dalston.RELEASEä¹‹å‰ï¼Œspring-cloud-netflixä¸­å¹¶ä¸åŒ…å«errorç±»å‹çš„Filterï¼›è€Œå¤„ç†é”™è¯¯æƒ…å†µçš„filterä¸ºSendErrorFilterï¼Œå…¶ç±»å‹ä¸ºpostï¼Œorderä¸º0ï¼Œæ¯”SendResponseFilterä¼˜å…ˆçº§é«˜(1000)ï¼Œå³æ›´æ—©è°ƒç”¨ã€‚å…ˆæ¥åˆ†æä¸€ä¸‹Dalston.RELEASEä¹‹å‰ç‰ˆæœ¬çš„SendErrorFilterï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‘˜è‡ªspring-cloud-netflix 1.2.7.RELEASEï¼š 1234567891011121314151617181920212223242526272829@Value(\"$&#123;error.path:/error&#125;\") private String errorPath; @Override public boolean shouldFilter() &#123; RequestContext ctx = RequestContext.getCurrentContext(); // only forward to errorPath if it hasn't been forwarded to already return ctx.containsKey(\"error.status_code\") &amp;&amp; !ctx.getBoolean(SEND_ERROR_FILTER_RAN, false); &#125; @Override public Object run() &#123; int statusCode = (Integer) ctx.get(\"error.status_code\"); request.setAttribute(\"javax.servlet.error.status_code\", statusCode); Object e = ctx.get(\"error.exception\"); request.setAttribute(\"javax.servlet.error.exception\", e); String message = (String) ctx.get(\"error.message\"); request.setAttribute(\"javax.servlet.error.message\", message); RequestDispatcher dispatcher = request.getRequestDispatcher( this.errorPath); dispatcher.forward(request, ctx.getResponse()); &#125; ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ç‚¹ï¼š SendErrorFilterçš„è¿›å…¥æ¡ä»¶æ˜¯ï¼šRequestContextä¸­åŒ…å«error.status_codeï¼Œä¸”ä¹‹å‰ä»æœªæ‰§è¡Œè¿‡è¯¥filterã€‚(55, 56) ä¼šå°†é”™è¯¯ä¿¡æ¯è½¬å‘ç»™errorPathæ‰§è¡Œï¼›errorPathå¯ç”±é…ç½®é¡¹error.pahtæŒ‡å®šï¼Œé»˜è®¤ä¸º/errorã€‚(38, 79, 84) è½¬å‘çš„é”™è¯¯ä¿¡æ¯æ˜¯ä»RequestContextä¸­çš„ä¸‰ä¸ªkeyå¾—åˆ°ï¼šerror.status_code, error.exception, error.messageã€‚(65~76) å¦‚æœè¦ä½¿ç”¨SendErrorFilterï¼Œåˆ™æˆ‘ä»¬åœ¨è‡ªå·±å®ç°è‡ªå®šä¹‰ZuulFilteråšå¼‚å¸¸å¤„ç†çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ï¼š å¦‚æœæ˜¯pre, routeç±»å‹çš„filterï¼Œåˆ™æ•è·æ‰€æœ‰å†…éƒ¨å¼‚å¸¸ï¼Œå°†å¼‚å¸¸ä¿¡æ¯è®¾ç½®åˆ°error.messageä¸­ï¼Œè®¾ç½®æ‰€éœ€è¿”å›çš„HTTPçŠ¶æ€ç åˆ°error.status_codeä¸­ï¼›ç„¶åæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚æŠ›å‡ºå¼‚å¸¸æ˜¯ä¸ºäº†å°†æ‰§è¡Œæµç¨‹äº¤ç»™error-&gt;postè¿™ä¸ªæ‰§è¡Œåˆ†æ”¯ï¼›å¦åˆ™ï¼Œå½“å‰filterä¼šè¢«è®¤ä¸ºæ‰§è¡ŒæˆåŠŸï¼Œç»§ç»­æ‰§è¡Œåç»­çš„filterã€‚run()æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éœ€æ˜¯(æˆ–ç»§æ‰¿)RuntimeExceptionï¼Œå› ä¸ºIZuulFilter#run()æ¥å£æ²¡æœ‰æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœæ˜¯ postç±»å‹ï¼š è®¾ç½®è¯¥filterçš„orderï¼Œå°äº0(è¿™æ˜¯SendErrorFilter)ã€‚ ä»”ç»†è€ƒè™‘shouldFilter()çš„å®ç°ç»†èŠ‚ï¼Œå› ä¸ºå¼‚å¸¸æµä¹Ÿä¼šè¿›å…¥post filtersï¼Œç¡®å®šæ˜¯å¦éœ€è¦å¤„ç†ã€‚ run()æ–¹æ³•ä¸­æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œç„¶åè®¾ç½®error.status_code, error.message, error.exceptionï¼Œå¹¶ä¸”ä¸å†æŠ›å‡ºå¼‚å¸¸ã€‚å¦åˆ™ä¼šè¿›å…¥error filtersï¼Œä½†æ˜¯ç°åœ¨æ²¡æœ‰ï¼Œç”±SendErrorFilteræ›¿ä»£ï¼›é™¤éè‡ªå·±å®ç°ä¸€ä¸ªerror filterï¼Œç„¶åç¦æ‰SendErrorFilterã€‚ è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œspring-cloud-netflixæä¾›çš„è¿™ä¸ªSendErrorFilteræœ‰æ˜æ˜¾çš„ç¼ºé™·ï¼Œæ— æ³•å¤„ç†ç”±post filtersæŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¹Ÿä¸ç¬¦åˆzuulè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå›¾ã€‚æ‰€ä»¥åœ¨Dalston.RELEASEä¹‹åï¼Œå³spring-cloud-netflix 1.3.0.RELEASEï¼Œå°†SendErrorFilterçš„ç±»å‹æ”¹ä¸ºäº†errorã€‚ ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‘˜è‡ªspring-cloud-netflix 1.3.0.RELEASEçš„SendErrorFilterç±»: 12345678910111213141516171819202122232425262728293031@Override public String filterType() &#123; return ERROR_TYPE; &#125; @Override public boolean shouldFilter() &#123; RequestContext ctx = RequestContext.getCurrentContext(); // only forward to errorPath if it hasn't been forwarded to already return ctx.getThrowable() != null &amp;&amp; !ctx.getBoolean(SEND_ERROR_FILTER_RAN, false); &#125; @Override public Object run() &#123; ZuulException exception = findZuulException(ctx.getThrowable()); request.setAttribute(\"javax.servlet.error.status_code\", exception.nStatusCode); request.setAttribute(\"javax.servlet.error.exception\", exception); request.setAttribute(\"javax.servlet.error.message\", exception.errorCause); &#125; ZuulException findZuulException(Throwable throwable) &#123; if (throwable.getCause() instanceof ZuulRuntimeException) &#123; // this was a failure initiated by one of the local filters return (ZuulException) throwable.getCause().getCause(); &#125; &#125; éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š ç±»å‹ä¸ºerror(53è¡Œ)ã€‚ è¿›å…¥æ¡ä»¶ä¸ºï¼šRequestContextä¸­æœ‰å¼‚å¸¸ï¼Œå¹¶ä¸”è¯¥filterä»æœªæ‰§è¡Œè¿‡(65, 66)ã€‚å¼‚å¸¸å¯¹è±¡æ˜¯åœ¨ZuulServlet#error(ZuulException)æ–¹æ³•ä¸­è®¾ç½®çš„ã€‚ run()æ–¹æ³•ä¸­æå–é”™è¯¯ä¿¡æ¯ä¸å†æ˜¯ä»RequestContextçš„ä¸‰ä¸ªkey(error.status_code, error.message, error.exception)ä¸­è·å–ï¼›è€Œæ˜¯ç›´æ¥ä»ZuulExceptionå¯¹è±¡ä¸­è·å–(73~82)ã€‚ å¦‚ä½•å–å¾—ZuulExceptionå¯¹è±¡(100118)ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ä»ZuulRuntimeExceptionä¸­æå–ZuulExceptionå¯¹è±¡(101103)ï¼Œè€ŒZuulRuntimeExceptionç»§æ‰¿RuntimeExceptionã€‚ æ³¨æ„101è¡Œä»£ç ï¼Œæ˜¯åˆ¤æ–­throwable.getCause()æ˜¯å¦ä¸ºZuulRuntimeExceptionï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰éZuulExceptionçš„å¼‚å¸¸åœ¨FilterProcessor#processZuulFilter()(227è¡Œ)ä¸­ä¼šè¢«è½¬åŒ–ä¸ºZuulExceptionã€‚ findZuulExceptionæ²¡æœ‰è´´å…¨ï¼Œå…¶ä¼šä¼˜å…ˆä»è‡ªå®šä¹‰filterä¸­æŠ›å‡ºçš„ZuulRuntimeExceptionä¸­æå–ZuulExceptionå¯¹è±¡ã€‚è¿™æ ·å°±å…è®¸æˆ‘ä»¬è¿”å›æˆ‘ä»¬æƒ³è¦çš„é”™è¯¯ä¿¡æ¯å’ŒHTTPçŠ¶æ€ç ã€‚ é‚£åŸºäº1.3.0.RELEASEï¼Œæˆ‘ä»¬åœ¨å†™è‡ªå®šä¹‰filteræ—¶ï¼Œå¦‚ä½•åšå¼‚å¸¸å¤„ç†å‘¢ï¼š å°†filterå†…éƒ¨å¼‚å¸¸è½¬åŒ–ä¸ºZuulExceptionï¼Œè®¾ç½®è‡ªå·±éœ€è¦è¿”å›çš„HTTPçŠ¶æ€ç ï¼Œç„¶ååŒ…è£…ä¸ºZuulRuntimeExceptionæŠ›å‡ºã€‚ å¦‚è‹¥ä¸å°è£…ä¸ºZuulRuntimeExceptionï¼Œåˆ™è¿”å›çš„HTTPçŠ¶æ€ç ä¸º500ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 12345678public Object run() &#123; try &#123; // do something &#125; catch (Throwable t) &#123; throw new ZuulRuntimeException(new ZuulException(t, HttpStatus.BAD_REQUEST.value(), t.getMessage())); &#125; return null;&#125; å¦‚æœæƒ³è‡ªå®šä¹‰è¿”å›çš„å¼‚å¸¸ä¿¡æ¯çš„response bodyçš„æ ¼å¼ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»¿ç…§BasicErrorControlleré‡å†™ä¸€ä¸‹/erroræ¥å£ã€‚","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Zuul","slug":"Spring-Cloud-Zuul","permalink":"http://xujin.org/tags/Spring-Cloud-Zuul/"}]},{"title":"ä½¿ç”¨Spring MVCæ‹¦æˆªå™¨è‡ªå®šä¹‰æ³¨è§£å®ç°å®¡è®¡æ—¥å¿—æ”¶é›†","slug":"ex/ex-mt-anto","date":"2017-06-21T06:00:00.000Z","updated":"2019-01-13T05:22:51.412Z","comments":true,"path":"ex/ex-mt-anto/","link":"","permalink":"http://xujin.org/ex/ex-mt-anto/","excerpt":"å‰è¨€ Spring WebMvcæ¡†æ¶ä¸­çš„Interceptorï¼Œä¸Servlet APIä¸­çš„Filterååˆ†ç±»ä¼¼ï¼Œç”¨äºå¯¹Webè¯·æ±‚è¿›è¡Œé¢„å¤„ç†/åå¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹è¿™äº›é¢„å¤„ç†/åå¤„ç†é€»è¾‘æ˜¯é€šç”¨çš„ï¼Œå¯ä»¥è¢«åº”ç”¨äºæ‰€æœ‰æˆ–å¤šä¸ªWebè¯·æ±‚ï¼Œä¾‹å¦‚ï¼š è®°å½•Webè¯·æ±‚ç›¸å…³æ—¥å¿—ï¼Œå¯ä»¥ç”¨äºåšä¸€äº›ä¿¡æ¯ç›‘æ§ã€ç»Ÿè®¡ã€åˆ†æ æ£€æŸ¥Webè¯·æ±‚è®¿é—®æƒé™ï¼Œä¾‹å¦‚å‘ç°ç”¨æˆ·æ²¡æœ‰ç™»å½•åï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ æ‰“å¼€/å…³é—­æ•°æ®åº“è¿æ¥â€”â€”é¢„å¤„ç†æ—¶æ‰“å¼€ï¼Œåå¤„ç†å…³é—­ï¼Œå¯ä»¥é¿å…åœ¨æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ä¸­éƒ½ç¼–å†™ç±»ä¼¼ä»£ç ï¼Œä¹Ÿä¸ä¼šå¿˜è®°å…³é—­æ•°æ®åº“è¿æ¥","text":"å‰è¨€ Spring WebMvcæ¡†æ¶ä¸­çš„Interceptorï¼Œä¸Servlet APIä¸­çš„Filterååˆ†ç±»ä¼¼ï¼Œç”¨äºå¯¹Webè¯·æ±‚è¿›è¡Œé¢„å¤„ç†/åå¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹è¿™äº›é¢„å¤„ç†/åå¤„ç†é€»è¾‘æ˜¯é€šç”¨çš„ï¼Œå¯ä»¥è¢«åº”ç”¨äºæ‰€æœ‰æˆ–å¤šä¸ªWebè¯·æ±‚ï¼Œä¾‹å¦‚ï¼š è®°å½•Webè¯·æ±‚ç›¸å…³æ—¥å¿—ï¼Œå¯ä»¥ç”¨äºåšä¸€äº›ä¿¡æ¯ç›‘æ§ã€ç»Ÿè®¡ã€åˆ†æ æ£€æŸ¥Webè¯·æ±‚è®¿é—®æƒé™ï¼Œä¾‹å¦‚å‘ç°ç”¨æˆ·æ²¡æœ‰ç™»å½•åï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ æ‰“å¼€/å…³é—­æ•°æ®åº“è¿æ¥â€”â€”é¢„å¤„ç†æ—¶æ‰“å¼€ï¼Œåå¤„ç†å…³é—­ï¼Œå¯ä»¥é¿å…åœ¨æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ä¸­éƒ½ç¼–å†™ç±»ä¼¼ä»£ç ï¼Œä¹Ÿä¸ä¼šå¿˜è®°å…³é—­æ•°æ®åº“è¿æ¥ åœºæ™¯éœ€æ±‚ä½¿ç”¨æ‰‹åŠ¨åŸ‹ç‚¹ï¼Œæ”¶é›†ç”¨æˆ·å®¡è®¡æ—¥å¿—ï¼ŒåŒ…æ‹¬æ“ä½œäººï¼Œå¯¹åº”çš„Urlï¼Œæ“ä½œçš„æ¨¡å—ï¼Œè°ƒç”¨çš„æ–¹æ³•(url),æ–¹æ³•çš„æè¿°ã€‚ å®ç°æ€è·¯æ‰‹åŠ¨åœ¨æ¯ä¸ªControlleræ–¹æ³•ä¸­ï¼Œé€ä¸€åŸ‹ç‚¹å®¡è®¡æ—¥å¿—ï¼Œè¿™æ ·çš„æ–¹å¼æ¯”è¾ƒlowï¼Œè€Œä¸”æ— æ³•åšåˆ°ç»„ä»¶å¼é€šç”¨ã€‚å› æ­¤ï¼Œé‡‡ç”¨Spring MVCçš„HandlerInterceptor(æ‹¦æˆªå™¨)+è‡ªå®šä¹‰æ³¨è§£å®ç°ã€‚ å®ç°ç»†èŠ‚æ–¹æ³•æ‹¦æˆªå™¨HandlerInterceptoråœ¨HandlerInterceptorä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•:123456789101112 public interface HandlerInterceptor &#123; // åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œ boolean preHandle(HttpServletRequest request,HttpServletResponse response, Object handler)throws Exception; // æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹åæ‰§è¡Œ void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)throws Exception; // åœ¨è¯·æ±‚å·²ç»è¿”å›ä¹‹åæ‰§è¡Œ void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)throws Exception;&#125; åœ¨ä»¥ä¸Šæ³¨é‡Šä¸­å·²ç»å†™æ˜æ‰§è¡Œé¡ºåº: preHandle()ï¼šé¢„å¤„ç†å›è°ƒæ–¹æ³•ï¼Œè‹¥æ–¹æ³•è¿”å›å€¼ä¸ºtrueï¼Œè¯·æ±‚ç»§ç»­ï¼ˆè°ƒç”¨ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨æˆ–å¤„ç†å™¨æ–¹æ³•ï¼‰ï¼›è‹¥æ–¹æ³•è¿”å›å€¼ä¸ºfalseï¼Œè¯·æ±‚å¤„ç†æµç¨‹ä¸­æ–­ï¼Œä¸ä¼šç»§ç»­è°ƒç”¨å…¶ä»–çš„æ‹¦æˆªå™¨æˆ–å¤„ç†å™¨æ–¹æ³•ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡responseäº§ç”Ÿå“åº”ï¼› postHandle()ï¼šåå¤„ç†å›è°ƒæ–¹æ³•ï¼Œå®ç°å¤„ç†å™¨çš„åå¤„ç†ï¼ˆä½†åœ¨æ¸²æŸ“è§†å›¾ä¹‹å‰ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡modelAndViewå¯¹æ¨¡å‹æ•°æ®è¿›è¡Œå¤„ç†æˆ–å¯¹è§†å›¾è¿›è¡Œå¤„ç† afterCompletion()ï¼šæ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å›è°ƒæ–¹æ³•ï¼Œå³åœ¨è§†å›¾æ¸²æŸ“å®Œæ¯•æ—¶è°ƒç”¨ 12345 @Overridepublic boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; System.out.println(handler.getClass()); return true;&#125; æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ä»DispatcherServletæ¥è°ƒç”¨è¯·æ±‚urlå¯¹åº”çš„æ–¹æ³•çš„,å› æ­¤æˆ‘ä»¬å¯ä»¥è·å–åˆ°URLå¯¹åº”çš„Controlleræ–¹æ³•ã€‚ è‡ªå®šä¹‰æ³¨è§£å®šä¹‰ä¸€ä¸ª@interfaceç±»ï¼ŒAuditLogæ³¨è§£ 123456789101112131415161718import java.lang.annotation.*;@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface AuditLog &#123; String url() default \"\"; String module() default \"\"; String operation() default \"\"; String description() default \"\"; String objType() default \"\";&#125; @Targetæ³¨è§£æ˜¯æ ‡æ³¨è¿™ä¸ªç±»å®ƒå¯ä»¥æ ‡æ³¨çš„ä½ç½®ï¼Œå¸¸ç”¨çš„å…ƒç´ ç±»å‹(ElementType)å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536public enum ElementType &#123; /** Class, interface (including annotation type), or enum declaration */ // TYPEç±»å‹å¯ä»¥å£°æ˜åœ¨ç±»ä¸Šæˆ–æšä¸¾ä¸Šæˆ–è€…æ˜¯æ³¨è§£ä¸Š TYPE, /** Field declaration (includes enum constants) */ // FIELDå£°æ˜åœ¨å­—æ®µä¸Š FIELD, /** Method declaration */ // å£°æ˜åœ¨æ–¹æ³•ä¸Š METHOD, /** Formal parameter declaration */ // å£°æ˜åœ¨å½¢å‚åˆ—è¡¨ä¸­ PARAMETER, /** Constructor declaration */ // å£°æ˜åœ¨æ„é€ æ–¹æ³•ä¸Š CONSTRUCTOR, /** Local variable declaration */ // å£°æ˜åœ¨å±€éƒ¨å˜é‡ä¸Š LOCAL_VARIABLE, /** Annotation type declaration */ ANNOTATION_TYPE, /** Package declaration */ PACKAGE, /** * Type parameter declaration * * @since 1.8 */ TYPE_PARAMETER, /** * Use of a type * * @since 1.8 */ TYPE_USE&#125; @Retentionæ³¨è§£è¡¨ç¤ºçš„æ˜¯æœ¬æ³¨è§£(æ ‡æ³¨è¿™ä¸ªæ³¨è§£çš„æ³¨è§£ä¿ç•™æ—¶æœŸ) 12345678910111213141516171819202122 public enum RetentionPolicy &#123; /** * Annotations are to be discarded by the compiler. */ // æºä»£ç æ—¶æœŸ SOURCE, /** * Annotations are to be recorded in the class file by the compiler * but need not be retained by the VM at run time. This is the default * behavior. */ // å­—èŠ‚ç æ—¶æœŸ, ç¼–è¯‘ä¹‹å CLASS, /** * Annotations are to be recorded in the class file by the compiler and * retained by the VM at run time, so they may be read reflectively. * * @see java.lang.reflect.AnnotatedElement */ // è¿è¡Œæ—¶æœŸ, ä¹Ÿå°±æ˜¯ä¸€ç›´ä¿ç•™, é€šå¸¸ä¹Ÿéƒ½ç”¨è¿™ä¸ª RUNTIME&#125; @Documentedæ˜¯å¦ç”Ÿæˆæ–‡æ¡£çš„æ ‡æ³¨, ä¹Ÿå°±æ˜¯ç”Ÿæˆæ¥å£æ–‡æ¡£æ˜¯, æ˜¯å¦ç”Ÿæˆæ³¨è§£æ–‡æ¡£ã€‚ Controllerä½¿ç”¨ç¤ºä¾‹1234567 @ResponseBody @RequestMapping(value = \"/&#123;id&#125;\", method = RequestMethod.DELETE) @AuditLog(module = AuditLogModule.CHANNEL, operation = AuditLogOperate.DELETE, description = \"deleteBuild\", objType = AuditLogObjType.CHANNELBUILD) public ResponseEntity deleteBuild(HttpServletRequest request, @PathVariable(value = \"id\") long id) &#123; //å…¶å®ƒä»£ç çœç•¥&#125; AuditLogHandlerInterceptorä¸»è¦ä»£ç ç¤ºä¾‹12345678910111213141516171819202122232425@Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; if (handler instanceof HandlerMethod) &#123; HandlerMethod handlerMethod = (HandlerMethod) handler; LOGGER.error(\"auditlog create\"); Method method = handlerMethod.getMethod(); AuditLog auditLog = method.getAnnotation(AuditLog.class); if (auditLog == null) &#123; return; &#125; try &#123; AuditLogInfo auditLogInfo = createAuditLog(auditLog, request, response); if (auditLogInfo != null) &#123; AuditLogHandler.createAuditLog(auditLogInfo); &#125; &#125; catch (Exception e) &#123; LOGGER.error(\"auditlog create error\", e); &#125; &#125; &#125; æ‰©å±•è‡ªå®šä¹‰æ³¨è§£å®ç°æƒé™æ§åˆ¶è‡ªå®šä¹‰æ³¨è§£123456789101112 @Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface Access &#123; String[] value() default &#123;&#125;; String[] authorities() default &#123;&#125;; String[] roles() default &#123;&#125;;&#125; åœ¨æ–¹æ³•ä¸Šé…ç½®æƒé™12345678910 @RestControllerpublic class HelloController &#123; @RequestMapping(value = \"/admin\", produces = MediaType.APPLICATION_JSON_UTF8_VALUE, method = RequestMethod.GET) // é…ç½®æ³¨è§£æƒé™, å…è®¸èº«ä»½ä¸ºadmin, æˆ–è€…è¯´å…è®¸æƒé™ä¸ºadminçš„äººè®¿é—® @Access(authorities = &#123;\"admin\"&#125;) public String hello() &#123; return \"Hello, admin\"; &#125;&#125; æƒé™é€»è¾‘12345678910111213141516171819202122232425262728293031323334353637 // è‡ªå®šä¹‰ä¸€ä¸ªæƒé™æ‹¦æˆªå™¨, ç»§æ‰¿HandlerInterceptorAdapterç±»public class AuthenticationInterceptor extends HandlerInterceptorAdapter &#123; // åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰æ‰§è¡Œæ‹¦æˆª @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; // å°†handlerå¼ºè½¬ä¸ºHandlerMethod, å‰é¢å·²ç»è¯å®è¿™ä¸ªhandlerå°±æ˜¯HandlerMethod HandlerMethod handlerMethod = (HandlerMethod) handler; // ä»æ–¹æ³•å¤„ç†å™¨ä¸­è·å–å‡ºè¦è°ƒç”¨çš„æ–¹æ³• Method method = handlerMethod.getMethod(); // è·å–å‡ºæ–¹æ³•ä¸Šçš„Accessæ³¨è§£ Access access = method.getAnnotation(Access.class); if (access == null) &#123; // å¦‚æœæ³¨è§£ä¸ºnull, è¯´æ˜ä¸éœ€è¦æ‹¦æˆª, ç›´æ¥æ”¾è¿‡ return true; &#125; if (access.authorities().length &gt; 0) &#123; // å¦‚æœæƒé™é…ç½®ä¸ä¸ºç©º, åˆ™å–å‡ºé…ç½®å€¼ String[] authorities = access.authorities(); Set&lt;String&gt; authSet = new HashSet&lt;&gt;(); for (String authority : authorities) &#123; // å°†æƒé™åŠ å…¥ä¸€ä¸ªseté›†åˆä¸­ authSet.add(authority); &#125; String role = request.getParameter(\"role\"); if (StringUtils.isNotBlank(role)) &#123; if (authSet.contains(role)) &#123; // æ ¡éªŒé€šè¿‡è¿”å›true, å¦åˆ™æ‹¦æˆªè¯·æ±‚ return true; &#125; &#125; &#125; // æ‹¦æˆªä¹‹ååº”è¯¥è¿”å›å…¬å…±ç»“æœ, è¿™é‡Œæ²¡åšå¤„ç† return false; &#125;&#125;","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]},{"title":"Spring Cloudé¡¹ç›®ä¸­é€šè¿‡Feignè¿›è¡Œå†…éƒ¨æœåŠ¡è°ƒç”¨å‘ç”Ÿ401\\407é”™è¯¯æ— è¿”å›ä¿¡æ¯çš„é—®é¢˜","slug":"sc/sc-feign-4xx","date":"2017-06-16T06:00:00.000Z","updated":"2019-01-13T03:14:27.158Z","comments":true,"path":"sc/sc-feign-4xx/","link":"","permalink":"http://xujin.org/sc/sc-feign-4xx/","excerpt":"å‰è¨€ æœ€è¿‘å¥½å‡ ä¸ªå°ä¼™ä¼´ï¼Œé—®Spring Cloudé¡¹ç›®ä¸­é€šè¿‡Feignè¿›è¡Œå†…éƒ¨æœåŠ¡è°ƒç”¨å‘ç”Ÿ401\\407é”™è¯¯æ— è¿”å›ä¿¡æ¯çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰å¼‚å¸¸è‡ªå®šä¹‰Codeæˆ–è€…ç³»ç»Ÿä¸­æ²¡æœ‰è‡ªå®šä¹‰codeä¸º401æˆ–407çš„codeï¼ŒåŸºæœ¬å¾ˆå°‘èƒ½ç¢°åˆ°ã€‚åˆšå¥½Spring Cloudä¸­å›½ç¤¾åŒºçš„VIPä¼šå‘˜ä»»èªåšå®¢åŸæ–‡ä¹Ÿé‡åˆ°è¿™ä¸ªï¼Œç»è¿‡å’Œä»–äº¤æµä¹‹åã€‚æ•´ç†å‡ºè¿™ç¯‡æ–‡ç« å¸Œæœ›èƒ½å¸®åŠ©æ›´å¤šçš„äººå¿«é€Ÿå®šä½é—®é¢˜ã€‚","text":"å‰è¨€ æœ€è¿‘å¥½å‡ ä¸ªå°ä¼™ä¼´ï¼Œé—®Spring Cloudé¡¹ç›®ä¸­é€šè¿‡Feignè¿›è¡Œå†…éƒ¨æœåŠ¡è°ƒç”¨å‘ç”Ÿ401\\407é”™è¯¯æ— è¿”å›ä¿¡æ¯çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰å¼‚å¸¸è‡ªå®šä¹‰Codeæˆ–è€…ç³»ç»Ÿä¸­æ²¡æœ‰è‡ªå®šä¹‰codeä¸º401æˆ–407çš„codeï¼ŒåŸºæœ¬å¾ˆå°‘èƒ½ç¢°åˆ°ã€‚åˆšå¥½Spring Cloudä¸­å›½ç¤¾åŒºçš„VIPä¼šå‘˜ä»»èªåšå®¢åŸæ–‡ä¹Ÿé‡åˆ°è¿™ä¸ªï¼Œç»è¿‡å’Œä»–äº¤æµä¹‹åã€‚æ•´ç†å‡ºè¿™ç¯‡æ–‡ç« å¸Œæœ›èƒ½å¸®åŠ©æ›´å¤šçš„äººå¿«é€Ÿå®šä½é—®é¢˜ã€‚ é—®é¢˜æè¿°æœ€è¿‘åœ¨ä½¿ç”¨Spring Cloudæ”¹é€ ç°æœ‰æœåŠ¡çš„å·¥ä½œä¸­ï¼Œåœ¨å†…éƒ¨æœåŠ¡çš„è°ƒç”¨æ–¹å¼ä¸Šé€‰æ‹©äº†Feignç»„ä»¶ï¼Œç”±äºæœåŠ¡ä¸æœåŠ¡ä¹‹é—´æœ‰æƒé™æ§åˆ¶ï¼Œå‘ç°é€šè¿‡Feignæ¥è¿›è¡Œè°ƒç”¨æ—¶å¦‚æœå‘ç”Ÿäº†401ã€407é”™è¯¯æ—¶ï¼Œè°ƒç”¨æ–¹ä¸èƒ½å¤Ÿå–å›è¢«è°ƒç”¨æ–¹è¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚ äº§ç”ŸåŸå› åˆ†æäº§ç”ŸåŸå› Feigné»˜è®¤ä½¿ç”¨java.net.HttpURLConnectionè¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡æŸ¥çœ‹å…¶å­ç±»sun.net.www.protocol.http.HttpURLConnectionæºç å‘ç°ä»£ç ä¸­åœ¨è¿›è¡Œé€šä¿¡æ—¶å•ç‹¬å¯¹é”™è¯¯ç ä¸º401\\407çš„é”™è¯¯è¯·æ±‚åšäº†å¤„ç†ï¼Œå½“è¯·æ±‚çš„é”™è¯¯ç ä¸º401\\407æ—¶ï¼Œä¼šå…³é—­è¯·æ±‚æµï¼Œç”±äºæ­¤æ—¶è¿˜å¹¶æ²¡æœ‰å°†è¿”å›çš„é”™è¯¯ä¿¡æ¯å†™å…¥å“åº”æµä¸­ï¼Œæ‰€ä»¥æ¥æ”¶çš„è¿”å›ä¿¡æ¯ä¸­ä»…ä»…èƒ½è·å–åˆ°response.status()ï¼Œè€Œresponse.body()ä¸ºnullã€‚HttpURLConnectionç›¸å…³ä¿¡æ¯çš„æºç é“¾æ¥ é—®é¢˜æºä»£ç ç¤ºä¾‹1234567if (respCode == HTTP_UNAUTHORIZED) &#123; if (streaming()) &#123; disconnectInternal(); throw new HttpRetryException (RETRY_MSG2, HTTP_UNAUTHORIZED); &#125; //å…¶ä½™ä»£ç çœç•¥&#125; java.net.HttpURLConnectionä¸­çš„HTTP_UNAUTHORIZEDçš„å®šä¹‰å¦‚ä¸‹: 1public static final int HTTP_UNAUTHORIZED = 401; è§£å†³æ€è·¯å…³äºæ­¤é—®é¢˜äº§ç”Ÿçš„åŸå› å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯feign.Clientå®ç°é€šä¿¡çš„æ–¹å¼é€‰ç”¨äº†æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨çš„HttpURLConnectionã€‚æƒ³åˆ°é€šå¸¸åœ¨Springçš„ä»£ç ä¸­OCPéƒ½æ˜¯è¿ç”¨å¾—å¾ˆå¥½çš„ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šæœ‰è§£å†³æ­¤é—®é¢˜çš„ä¿¡å¿ƒäº†ï¼Œæœ€ä¸æµå°±æ˜¯è‡ªå·±æ‰©å±•Feignï¼Œå®ç°ä¸€ä¸ªè‡ªå·±æƒ³è¦çš„feign.Clientï¼Œå½“ç„¶è¿™ç§äº‹æƒ…Spring CloudåŸºæœ¬éƒ½ä¼šè‡ªå·±æå®šï¼Œè¿™ä¹Ÿæ˜¯Spring Cloudå¼ºå¤§å®Œå–„çš„ä¸€ä¸ªåœ°æ–¹ã€‚é€šè¿‡è¿™ä¸ªæ€è·¯æŸ¥çœ‹æºç ï¼Œæœç„¶çœ‹åˆ°äº†Spring Cloudåœ¨ä½¿ç”¨Feignæå‰å†…ç½®äº†ä¸‰ç§é€šä¿¡æ–¹å¼ï¼ˆfeign.Client.Defaultï¼Œfeign.httpclient.ApacheHttpClientï¼Œfeign.okhttp.OkHttpClientï¼‰ï¼Œå…¶ä¸­ç¼ºçœçš„æƒ…å†µä½¿ç”¨çš„å°±æ˜¯feign.Client.Defaultï¼Œè¿™ä¸ªå°±æ˜¯ä½¿ç”¨HttpURLConnectioné€šä¿¡çš„æ–¹å¼ã€‚ æºç è§£æåœ¨Spring Cloudé¡¹ç›®ä¸­ä½¿ç”¨äº†Ribbonçš„ç»„ä»¶ï¼Œå…¶ä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†ä½¿ç”¨Feignï¼ŒæŸ¥çœ‹org.springframework.cloud.netflix.feign.ribbon.FeignRibbonClientAutoConfigurationæºç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859@ConditionalOnClass(&#123; ILoadBalancer.class, Feign.class &#125;)@Configuration@AutoConfigureBefore(FeignAutoConfiguration.class)public class FeignRibbonClientAutoConfiguration &#123; @Bean @ConditionalOnMissingBean public Client feignClient(CachingSpringLoadBalancerFactory cachingFactory, SpringClientFactory clientFactory) &#123; return new LoadBalancerFeignClient(new Client.Default(null, null), cachingFactory, clientFactory); &#125; @Configuration @ConditionalOnClass(ApacheHttpClient.class) @ConditionalOnProperty(value = \"feign.httpclient.enabled\", matchIfMissing = true) protected static class HttpClientFeignLoadBalancedConfiguration &#123; @Autowired(required = false) private HttpClient httpClient; @Bean @ConditionalOnMissingBean(Client.class) public Client feignClient(CachingSpringLoadBalancerFactory cachingFactory, SpringClientFactory clientFactory) &#123; ApacheHttpClient delegate; if (this.httpClient != null) &#123; delegate = new ApacheHttpClient(this.httpClient); &#125; else &#123; delegate = new ApacheHttpClient(); &#125; return new LoadBalancerFeignClient(delegate, cachingFactory, clientFactory); &#125; &#125; @Configuration @ConditionalOnClass(OkHttpClient.class) @ConditionalOnProperty(value = \"feign.okhttp.enabled\", matchIfMissing = true) protected static class OkHttpFeignLoadBalancedConfiguration &#123; @Autowired(required = false) private okhttp3.OkHttpClient okHttpClient; @Bean @ConditionalOnMissingBean(Client.class) public Client feignClient(CachingSpringLoadBalancerFactory cachingFactory, SpringClientFactory clientFactory) &#123; OkHttpClient delegate; if (this.okHttpClient != null) &#123; delegate = new OkHttpClient(this.okHttpClient); &#125; else &#123; delegate = new OkHttpClient(); &#125; return new LoadBalancerFeignClient(delegate, cachingFactory, clientFactory); &#125; &#125;&#125; ä»feignClient(CachingSpringLoadBalancerFactory cachingFactory, SpringClientFactory clientFactory) æ–¹æ³•ç»“åˆå…¶ä¸Šæ³¨è§£æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ï¼Œå½“æ²¡æœ‰feign.ClientBeançš„æ—¶å€™ä¼šé»˜è®¤ç”Ÿæˆfeign.Client.Defaultæ¥è¿›è¡Œé€šä¿¡ï¼Œè¿™å°±æ˜¯ä¹‹å‰è¯´çš„ç¼ºçœé€šä¿¡æ–¹å¼ ä»HttpClientFeignLoadBalancedConfigurationã€OkHttpFeignLoadBalancedConfigurationï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ç”Ÿæ•ˆçš„æ¡ä»¶ï¼Œå½“classpathä¸­æœ‰feign.httpclient.ApacheHttpClientå¹¶ä¸”é…ç½®feign.httpclient.enabled=trueï¼ˆç¼ºçœä¸ºtrueï¼‰ã€feign.okhttp.OkHttpClientå¹¶ä¸”é…ç½®feign.okhttp.enabled=trueï¼ˆç¼ºçœä¸ºtrueï¼‰ å½“ä½¿ç”¨ApacheHttpClientæˆ–è€…OkHttpClientè¿›è¡Œé€šä¿¡æ—¶å°±ä¸ä¼šå¯¼è‡´å‘ç”Ÿ401\\407é”™è¯¯æ—¶ï¼Œå–ä¸åˆ°è¿”å›çš„é”™è¯¯ä¿¡æ¯äº† è§£å†³æ–¹æ³•é€šè¿‡å…¶ä¸Šçš„åˆ†æï¼Œè§£å†³æ–¹æ³•å·²ç»æ˜¾è€Œæ˜“è§äº†æ›¿æ¢é»˜è®¤çš„Client pom.xmlæ–‡ä»¶ä¸­æ–°å¢ä¾èµ–æ›¿æ¢ä¸ºé»˜è®¤ä¸ºokhttp Client å¢åŠ ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.netflix.feign&lt;/groupId&gt; &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt; &lt;version&gt;8.18.0&lt;/version&gt; &lt;/dependency&gt; 2.åœ¨application.propertieså¢åŠ é…ç½®å¦‚ä¸‹: 1feign.okhttp.enabled=true å¦‚ä½•æŠŠé»˜è®¤çš„Clientæ›¿æ¢ä¸ºokhttpåœ¨è¿™é‡Œä¸åšè¿‡å¤šé˜è¿°ï¼Œå¯ä»¥å‚è€ƒï¼šspring cloud feignä½¿ç”¨okhttp3 æ›¿æ¢ä¸ºhttpclient å¢åŠ ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.netflix.feign&lt;/groupId&gt; &lt;artifactId&gt;feign-httpclient&lt;/artifactId&gt; &lt;version&gt;8.18.0&lt;/version&gt; &lt;/dependency&gt; 2.åœ¨application.propertieså¢åŠ é…ç½®å¦‚ä¸‹: 1feign.httpclient.enabled=true å¯ä»¥å‚è€ƒæ›´æ¢Feigné»˜è®¤ä½¿ç”¨çš„HTTP Client æ€»ç»“ ç”±äºæ–°å¢çš„ä¾èµ–æ²¡æœ‰è¢«startç®¡ç†ï¼Œå¹¶ä¸”ç¼ºçœä¸ä¼šå¯¼è‡´ç¨‹åºå¯åŠ¨å¼‚å¸¸ï¼Œå¹¶ä¸”è¿”å›å“åº”ä¸ºnullä¸æ­¤ä¾èµ–æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå› æ­¤ä¸æ–¹ä¾¿å®šä½åˆ°é—®é¢˜ï¼Œç‰¹æ­¤è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°é‡åˆ°åŒæ ·é—®é¢˜çš„äººï¼Œå¦‚å¯¹æ–‡ç« æœ‰ä¸åŒçš„çœ‹æ³•ï¼Œæœ›ç»™äºˆæŒ‡æ­£ã€‚ æœ¬æ–‡å»ºç«‹åœ¨å·²ç»æ­å»ºå®ŒæˆFeignçš„è°ƒç”¨åŸºç¡€ä¹‹ä¸Šï¼Œæ²¡æœ‰è®²è¿°Feignçš„ä½¿ç”¨ï¼Œå› ä¸ºæ­¤ç±»æ–‡ç« å¾ˆå¤šï¼Œåœ¨æ­¤å°±ä¸é‡å¤äº†ï¼Œæ›´å¤šçš„ä¿¡æ¯å¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ã€‚ å¿«é€Ÿä½¿ç”¨Spring Cloud Feignä½œä¸ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡æä¾›è€…spring cloud feignä½¿ç”¨okhttp3","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Feign","slug":"Spring-Cloud-Feign","permalink":"http://xujin.org/tags/Spring-Cloud-Feign/"}]},{"title":"åœ¨Spring Cloudä¸­å®ç°é™çº§ä¹‹æƒé‡è·¯ç”±å’Œæ ‡ç­¾è·¯ç”±","slug":"sc/sc-ribbon-demoted","date":"2017-06-03T06:00:00.000Z","updated":"2019-01-13T03:39:48.998Z","comments":true,"path":"sc/sc-ribbon-demoted/","link":"","permalink":"http://xujin.org/sc/sc-ribbon-demoted/","excerpt":"å‰è¨€ é™æµã€é™çº§ã€ç°åº¦æ˜¯æœåŠ¡æ²»ç†çš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ã€‚æœ¬æ–‡å‚è€ƒSpring Cloudä¸­å›½ç¤¾åŒºçš„VIPä¼šå‘˜-ä½•é¹°çš„åšå®¢-æ•´ç†Dubboè‡ªå¸¦æœåŠ¡é™çº§ã€é™æµåŠŸèƒ½ï¼Œspring cloudå¹¶æ²¡æœ‰æä¾›æ­¤åŠŸèƒ½ï¼Œåªèƒ½ç”±æˆ‘ä»¬è‡ªè¡Œå®ç°ã€‚è¿™é‡Œçš„é™æµã€é™çº§ã€ç°åº¦éƒ½æ˜¯é’ˆå¯¹æœåŠ¡å®ä¾‹çº§åˆ«ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªæœåŠ¡çº§åˆ«ï¼Œæ•´ä¸ªæœåŠ¡çº§åˆ«å¯ä»¥é€šè¿‡å®ä¾‹éƒ¨ç½²æ•°é‡æ¥å®ç°ã€‚ é™æµé™çº§è®¾è®¡åœºæ™¯æœåŠ¡Aï¼Œéƒ¨ç½²äº†3ä¸ªå®ä¾‹A1ã€A2ã€A3ã€‚spring cloudé»˜è®¤å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼ŒA1ã€A2ã€A3ä¸‰ä¸ªå®ä¾‹æµé‡å‡åˆ†ï¼Œå„1/3ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™éœ€è¦å°†æœåŠ¡Aç”±1.0ç‰ˆå‡çº§è‡³2.0ç‰ˆï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ­¥éª¤æ˜¯ï¼šå°†A1çš„æµé‡é™ä¸º0ï¼ŒæŸ”æ€§ä¸‹çº¿ï¼Œå…³é—­A1å®ä¾‹å¹¶å‡çº§åˆ°2.0ï¼Œå°†A1æµé‡æå‡ä¸º10%è§‚å¯Ÿ2.0çº¿ä¸Šè¿è¡Œæƒ…å†µï¼Œå¦‚æœæƒ…å†µç¨³å®šï¼Œåˆ™é€æ­¥å¼€æ”¾æµé‡è‡³ä¸é™åˆ¶åŠ1/3ã€‚ä¾æ¬¡åœ¨A2ï¼ŒA3ä¸Šæ‰§è¡Œä¸Šè¿°æ“ä½œã€‚åœ¨ä¸Šè¿°æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬æƒ³è®©ç‰¹åˆ«çš„äººä½¿ç”¨2.0ï¼Œå…¶ä»–äººè¿˜æ˜¯ä½¿ç”¨1.0ç‰ˆï¼Œç¨³å®šåå†å…¨å‘˜å¼€æ”¾ã€‚","text":"å‰è¨€ é™æµã€é™çº§ã€ç°åº¦æ˜¯æœåŠ¡æ²»ç†çš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ã€‚æœ¬æ–‡å‚è€ƒSpring Cloudä¸­å›½ç¤¾åŒºçš„VIPä¼šå‘˜-ä½•é¹°çš„åšå®¢-æ•´ç†Dubboè‡ªå¸¦æœåŠ¡é™çº§ã€é™æµåŠŸèƒ½ï¼Œspring cloudå¹¶æ²¡æœ‰æä¾›æ­¤åŠŸèƒ½ï¼Œåªèƒ½ç”±æˆ‘ä»¬è‡ªè¡Œå®ç°ã€‚è¿™é‡Œçš„é™æµã€é™çº§ã€ç°åº¦éƒ½æ˜¯é’ˆå¯¹æœåŠ¡å®ä¾‹çº§åˆ«ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªæœåŠ¡çº§åˆ«ï¼Œæ•´ä¸ªæœåŠ¡çº§åˆ«å¯ä»¥é€šè¿‡å®ä¾‹éƒ¨ç½²æ•°é‡æ¥å®ç°ã€‚ é™æµé™çº§è®¾è®¡åœºæ™¯æœåŠ¡Aï¼Œéƒ¨ç½²äº†3ä¸ªå®ä¾‹A1ã€A2ã€A3ã€‚spring cloudé»˜è®¤å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼ŒA1ã€A2ã€A3ä¸‰ä¸ªå®ä¾‹æµé‡å‡åˆ†ï¼Œå„1/3ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™éœ€è¦å°†æœåŠ¡Aç”±1.0ç‰ˆå‡çº§è‡³2.0ç‰ˆï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ­¥éª¤æ˜¯ï¼šå°†A1çš„æµé‡é™ä¸º0ï¼ŒæŸ”æ€§ä¸‹çº¿ï¼Œå…³é—­A1å®ä¾‹å¹¶å‡çº§åˆ°2.0ï¼Œå°†A1æµé‡æå‡ä¸º10%è§‚å¯Ÿ2.0çº¿ä¸Šè¿è¡Œæƒ…å†µï¼Œå¦‚æœæƒ…å†µç¨³å®šï¼Œåˆ™é€æ­¥å¼€æ”¾æµé‡è‡³ä¸é™åˆ¶åŠ1/3ã€‚ä¾æ¬¡åœ¨A2ï¼ŒA3ä¸Šæ‰§è¡Œä¸Šè¿°æ“ä½œã€‚åœ¨ä¸Šè¿°æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬æƒ³è®©ç‰¹åˆ«çš„äººä½¿ç”¨2.0ï¼Œå…¶ä»–äººè¿˜æ˜¯ä½¿ç”¨1.0ç‰ˆï¼Œç¨³å®šåå†å…¨å‘˜å¼€æ”¾ã€‚ æ€è·¯åˆ†æï¼ŒæœåŠ¡Açš„æµé‡äº§ç”Ÿæœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯å¤–éƒ¨æµé‡ï¼Œå¤–ç½‘é€šè¿‡zuulè¿‡æ¥çš„æµé‡ï¼Œä¸€ä¸ªæ˜¯å†…éƒ¨æµé‡ï¼ŒæœåŠ¡é—´è°ƒç”¨ï¼ŒæœåŠ¡Bè°ƒç”¨æœåŠ¡Açš„è¿™ç±»æµé‡ã€‚ä¸ç®¡æ˜¯zuulè¿˜æ˜¯å†…éƒ¨æœåŠ¡æ¥çš„ï¼Œéƒ½æ˜¯è¦é€šè¿‡ribbonåšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æ¥å®ç°ä¸Šè¿°é™æµã€é™çº§ã€ç°åº¦åŠŸèƒ½ã€‚ è¦å®ç°è¿™äº›æƒ³æ³•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹spring-cloudçš„å„ä¸ªç»„ä»¶ã€æ•°æ®æµéå¸¸ç†Ÿæ‚‰ï¼Œè¿™æ ·æ‰èƒ½çŸ¥é“è¯¥åœ¨å“ªé‡Œåšæ‰©å±•ã€‚ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨ï¼šå¤–ç½‘-ã€‹Zuulç½‘å…³-ã€‹æœåŠ¡A-ã€‹æœåŠ¡Bã€‚ã€‚ã€‚ spring-cloudè·Ÿdubboä¸€æ ·éƒ½æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæ‰€æœ‰è°ƒç”¨å‡ç”±Ribbonæ¥åšè´Ÿè½½å‡è¡¡é€‰æ‹©æœåŠ¡å™¨ï¼Œæ‰€æœ‰è°ƒç”¨å‰åä¼šå¥—ä¸€å±‚hystrixåšéš”ç¦»ã€ç†”æ–­ã€‚æœåŠ¡é—´è°ƒç”¨å‡ç”¨å¸¦LoadBalancedæ³¨è§£çš„RestTemplateå‘å‡ºã€‚RestTemplate-ã€‹Ribbon-ã€‹hystrix é€šè¿‡ä¸Šè¿°åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ‰©å±•ç‚¹å°±åœ¨Ribbonï¼ŒRibbonæ ¹æ®æˆ‘ä»¬çš„è§„åˆ™ï¼Œé€‰æ‹©æ­£ç¡®çš„æœåŠ¡å™¨å³å¯ã€‚ æˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªdubboè‡ªå¸¦çš„åŠŸèƒ½ï¼šåŸºäºæƒé‡çš„æµé‡æ§åˆ¶ã€‚dubboè‡ªå¸¦çš„æ§åˆ¶å°å¯ä»¥è®¾ç½®æœåŠ¡å®ä¾‹ç²’åº¦çš„åŠæƒï¼Œå€æƒã€‚å…¶å®å°±æ˜¯åœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ—¶ï¼Œé€‰æ‹©æœåŠ¡å™¨å¸¦ä¸Šæƒé‡å³å¯ï¼Œspring-cloudé»˜è®¤æ˜¯ZoneAvoidanceRuleï¼Œä¼˜å…ˆé€‰æ‹©ç›¸åŒZoneä¸‹çš„å®ä¾‹ï¼Œå®ä¾‹é—´é‡‡ç”¨è½®è¯¢æ–¹å¼åšè´Ÿè½½å‡è¡¡ã€‚æˆ‘ä»¬çš„æƒ³æŠŠåŸºäºè½®è¯¢æ”¹ä¸ºåŸºäºæƒé‡å³å¯ã€‚æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼Œæ¯ä¸ªå®ä¾‹çš„æƒé‡ä¿¡æ¯ä¿å­˜åœ¨å“ªé‡Œï¼Ÿä»å“ªé‡Œå–ï¼Ÿdubboæ”¾åœ¨zookeeperä¸­ï¼Œspring-cloudæ”¾åœ¨eurekaä¸­ã€‚æˆ‘ä»¬åªéœ€ä»eurekaæ‹¿æ¯ä¸ªå®ä¾‹çš„æƒé‡ä¿¡æ¯ï¼Œç„¶åæ ¹æ®æƒé‡æ¥é€‰æ‹©æœåŠ¡å™¨å³å¯ã€‚å…·ä½“ä»£ç LabelAndWeightMetadataRuleï¼ˆå…ˆå¿½ç•¥é‡Œé¢çš„ä¼˜å…ˆåŒ¹é…labelç›¸å…³ä»£ç ï¼‰ã€‚ å·¥ç¨‹æ¡ˆä¾‹æ¼”ç¤º https://github.com/SoftwareKing/spring-cloud-study/tree/master/sc-ribbon-demoted é¡¹ç›®ç»“æ„ config é…ç½®ä¸­å¿ƒç«¯å£ï¼š8888ï¼Œæ–¹ä¾¿èµ·è§ç›´æ¥è¯»å–é…ç½®æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥è¯»å–gitã€‚application-dev.propertiesä¸ºå…¨å±€é…ç½®ã€‚å…ˆå¯åŠ¨é…ç½®ä¸­å¿ƒï¼Œæ‰€æœ‰æœåŠ¡çš„é…ç½®ï¼ˆåŒ…æ‹¬æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼‰å‡ä»é…ç½®ä¸­å¿ƒè¯»å–ã€‚ consumer æœåŠ¡æ¶ˆè´¹è€…ç«¯å£ï¼š18090ï¼Œè°ƒç”¨æœåŠ¡æä¾›è€…ï¼Œä¸ºäº†æ¼”ç¤ºheaderä¼ é€’ã€‚ core æ¡†æ¶æ ¸å¿ƒåŒ…æ ¸å¿ƒjaråŒ…ï¼Œæ‰€æœ‰å¾®æœåŠ¡å‡å¼•ç”¨è¯¥åŒ…ï¼Œä½¿ç”¨AutoConfigå®ç°å…é…ç½®ï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸‹spring-cloudçš„ä½¿ç”¨ã€‚ eureka æ³¨å†Œä¸­å¿ƒç«¯å£ï¼š8761ï¼Œ/metadataç«¯ç‚¹å®ç°metadataä¿¡æ¯é…ç½®ã€‚ provider æœåŠ¡æä¾›è€…ç«¯å£ï¼š18090ï¼ŒæœåŠ¡æä¾›è€…ï¼Œæ— ç‰¹æ®Šé€»è¾‘ã€‚ zuul ç½‘å…³ç«¯å£ï¼š8080ï¼Œæ¼”ç¤ºè§£ætokenè·å¾—labelå¹¶æ”¾å…¥headerå¾€åä¼ é€’ æ¡ˆä¾‹å…·ä½“å®ç°åŸºäºæƒé‡çš„å®ç°æ€è·¯LabelAndWeightMetadataRuleå†™å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒï¼Œä½¿ä¹‹ç”Ÿæ•ˆå‘¢ï¼Ÿæœ‰3ç§æ–¹å¼ã€‚ 1ï¼‰å†™ä¸ªAutoConfigå°†LabelAndWeightMetadataRuleå£°æ˜æˆ@Beanï¼Œç”¨æ¥æ›¿æ¢é»˜è®¤çš„ZoneAvoidanceRuleã€‚è¿™ç§æ–¹å¼åœ¨æŠ€æœ¯éªŒè¯ã€å¼€å‘æµ‹è¯•é˜¶æ®µä½¿ç”¨çŸ­å¹³å¿«ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¯å¼ºåˆ¶å…¨å±€è®¾ç½®ï¼Œæ— æ³•ä¸ªæ€§åŒ–ã€‚ 2ï¼‰ç”±äºspring-cloudçš„Ribbonå¹¶æ²¡æœ‰å®ç°netflix Ribbonçš„æ‰€æœ‰é…ç½®é¡¹ã€‚netflixé…ç½®å…¨å±€ruleæ–¹å¼ä¸ºï¼šribbon.NFLoadBalancerRuleClassName=package.YourRuleï¼Œspring-cloudå¹¶ä¸æ”¯æŒï¼Œspring-cloudç›´æ¥åˆ°æœåŠ¡ç²’åº¦ï¼Œåªæ”¯æŒSERVICE_ID.ribbon.NFLoadBalancerRuleClassName=package.YourRuleã€‚ æˆ‘ä»¬å¯ä»¥æ‰©å±•org.springframework.cloud.netflix.ribbon.PropertiesFactoryä¿®æ­£spring cloud ribbonæœªèƒ½å®Œå…¨æ”¯æŒnetflix ribboné…ç½®çš„é—®é¢˜ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å°†å…¨å±€é…ç½®å†™åˆ°é…ç½®ä¸­å¿ƒçš„application-dev.propertieså…¨å±€é…ç½®ä¸­ï¼Œç„¶åå„ä¸ªå¾®æœåŠ¡è¿˜å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µåšä¸ªæ€§åŒ–å®šåˆ¶ã€‚ä½†æ˜¯PropertiesFactoryå±æ€§å‡ä¸ºç§æœ‰ï¼Œåº”è¯¥æ˜¯spring cloudä¸å»ºè®®åœ¨æ­¤æ‰©å±•ã€‚å‚è§https://github.com/spring-cloud/spring-cloud-netflix/issues/1741ã€‚ 3ï¼‰ä½¿ç”¨spring cloudå®˜æ–¹å»ºè®®çš„@RibbonClientæ–¹å¼ã€‚è¯¥æ–¹å¼ä»…å­˜åœ¨äºspring-cloudå•å…ƒæµ‹è¯•ä¸­ï¼ˆåœ¨æˆ‘æé—®åï¼Œç°åœ¨è¿˜å­˜åœ¨äºspring-cloud issue listï¼‰ã€‚å…·ä½“ä»£ç å‚è§DefaultRibbonConfiguration.javaã€CoreAutoConfiguration.javaã€‚ ç›®å‰é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹å¼å¤„ç† åŸºäºæƒé‡çš„è·¯ç”±æµ‹è¯•ä¾æ¬¡å¼€å¯ config eureka provideï¼ˆå¼€ä¸¤ä¸ªå®ä¾‹ï¼Œé€šè¿‡å¯åŠ¨å‚æ•°server.portæŒ‡å®šä¸åŒç«¯å£åŒºåˆ†ï¼‰ consumer zuulè®¿é—® http://localhost:8761/metadata.html è¿™æ˜¯æˆ‘æ‰‹å†™çš„ä¸€ä¸ªç®€å•çš„metadataç®¡ç†ç•Œé¢ï¼Œåˆ†åˆ«è®¾ç½®ä¸¤ä¸ªproviderå®ä¾‹çš„weightå€¼ï¼ˆè®¾ç½®å®Œéœ€è¦ä¸€æ®µ2åˆ†é’Ÿæ‰èƒ½ç”Ÿæ•ˆï¼‰ï¼Œç„¶åè®¿é—® http://localhost:8080/provider/user å¤šåˆ·å‡ æ¬¡æ¥æµ‹è¯•zuulæ˜¯å¦æŒ‰æƒé‡å‘é€è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥è®¿é—® http://localhost:8080/consumer/test å¤šåˆ·å‡ æ¬¡æ¥æµ‹è¯•consumeræ˜¯å¦æŒ‰æƒé‡æ¥è°ƒç”¨provideæœåŠ¡ã€‚ åŸºäºæ ‡ç­¾çš„è·¯ç”±å¤„ç†åŸºäºæƒé‡çš„æå®šä¹‹åï¼Œæ¥ä¸‹æ¥æ‰æ˜¯é‡å¤´æˆï¼šåŸºäºæ ‡ç­¾çš„è·¯ç”±ã€‚å…¥å£è¯·æ±‚å«æœ‰å„ç§æ ‡ç­¾ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ ¹æ®æ ‡ç­¾å¹»åŒ–å‡ºå„ç§å„æ ·çš„è·¯ç”±è§„åˆ™ã€‚ä¾‹å¦‚åªæœ‰æ ‡æ³¨ä¸ºç²‰ä¸çš„ç”¨æˆ·æ‰ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼ˆç°åº¦ã€ABã€é‡‘ä¸é›€ï¼‰ï¼Œä¾‹å¦‚æ ‡æ³¨ä¸ºä¸­å›½çš„ç”¨æˆ·è¯·æ±‚å¿…é¡»å‘é€åˆ°ä¸­å›½çš„æœåŠ¡å™¨ï¼ˆå…¨çƒéƒ¨ç½²ï¼‰ï¼Œä¾‹å¦‚æ ‡æ³¨ä¸ºå†™çš„è¯·æ±‚å¿…é¡»å‘é€åˆ°ä¸“é—¨çš„å†™æœåŠ¡å®ä¾‹ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰ï¼Œç­‰ç­‰ç­‰ç­‰ï¼Œå”¯ä¸€é™åˆ¶ä½ çš„å°±æ˜¯ä½ çš„æƒ³è±¡åŠ›ã€‚ åŸºäºæ ‡ç­¾çš„è·¯ç”±å®ç°æ€è·¯æ ¹æ®æ ‡ç­¾çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å½“ç„¶æ”¾åˆ°ä¹‹å‰å†™çš„Ribbonçš„ruleä¸­ï¼Œæ¯ä¸ªå®ä¾‹é…ç½®çš„ä¸åŒè§„åˆ™ä¹Ÿæ˜¯è·Ÿä¹‹å‰ä¸€æ ·æ”¾åˆ°æ³¨å†Œä¸­å¿ƒçš„metadataä¸­ã€‚éœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜: Q:å…³é”®æ˜¯æ ‡ç­¾æ•°æ®å¦‚ä½•ä¼ è¿‡æ¥? A:æƒé‡éšæœºçš„å®ç°æ€è·¯é‡Œé¢æœ‰ç­”æ¡ˆï¼Œè¯·æ±‚éƒ½é€šè¿‡zuulè¿›æ¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨zuulé‡Œé¢ç»™è¯·æ±‚æ‰“æ ‡ç­¾ï¼ŒåŸºäºç”¨æˆ·ï¼ŒIPæˆ–å…¶ä»–çœ‹ä½ çš„éœ€æ±‚ï¼Œç„¶åå°†æ ‡ç­¾ä¿¡æ¯æ”¾å…¥ThreadLocalä¸­ï¼Œç„¶ååœ¨Ribbon Ruleä¸­ä»ThreadLocalæ‹¿å‡ºæ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚ ç„¶è€Œï¼ŒæŒ‰ç…§è¿™ä¸ªæ–¹å¼å»å®éªŒæ—¶ï¼Œå‘ç°æœ‰é—®é¢˜ï¼Œæ‹¿ä¸åˆ°ThreadLocalã€‚åŸå› æ˜¯æœ‰hystrixè¿™ä¸ªä¸œè¥¿ï¼Œå›å¿†ä¸‹hystrixçš„åŸç†ï¼Œä¸ºäº†åšåˆ°æ•…éšœéš”ç¦»ï¼Œhystrixå¯ç”¨äº†è‡ªå·±çš„çº¿ç¨‹ï¼Œä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ThreadLocalå¤±æ•ˆã€‚ é‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿå°†æ ‡ç­¾ä¿¡æ¯ä¸€ä¼ åˆ°åº•å‘¢ï¼Œæƒ³æƒ³ä¹‹å‰æœ‰æ²¡æœ‰äººå®ç°è¿‡ç±»ä¼¼çš„ä¸œè¥¿ï¼Œæ²¡é”™sleuthï¼Œå®ƒçš„é“¾è·¯è·Ÿè¸ªå°±èƒ½å¤Ÿå°†spanä¼ é€’ä¸‹å»ï¼Œç¿»ç¿»sleuthæºç ï¼Œæ‰¾æ‰¾å…¶ä»–èµ„æ–™ï¼Œå‘ç°å¯ä»¥ä½¿ç”¨HystrixRequestVariableDefaultï¼Œè¿™é‡Œä¸å»ºè®®ç›´æ¥ä½¿ç”¨HystrixConcurrencyStrategyï¼Œä¼šå’Œsleuthçš„strategyå†²çªã€‚ä»£ç å‚è§CoreHeaderInterceptor.javaã€‚ç°åœ¨å¯ä»¥æµ‹è¯•zuulé‡Œé¢çš„ruleï¼Œçœ‹èƒ½å¦æ‹¿åˆ°æ ‡ç­¾å†…å®¹äº†ã€‚ æ ‡ç­¾ä¼ åˆ°HystrixRequestVariableDefaultè¿™é‡Œçš„ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ä½¿ç”¨Hystrixå°±ç”¨ä¸äº†äº†,è¿™ä¸ªæ—¶å€™éœ€è¦åšä¸€ä¸ªåˆ¤æ–­åœ¨restTempleé‡Œé¢åšä¸ªåˆ¤æ–­ï¼Œæ²¡æœ‰hystrixå°±ç›´æ¥threadlocalå–ã€‚ Q:è¿™é‡Œè¿˜ä¸æ˜¯ç»ˆç‚¹ï¼Œè§£å†³äº†zuulçš„è·¯ç”±ï¼ŒæœåŠ¡Aè°ƒæœåŠ¡Bè¿™é‡Œçš„è·¯ç”±æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿzuulç®—å‡ºæ¥çš„æ ‡ç­¾å¦‚ä½•å¾€åé¢ä¾æ¬¡ä¼ é€’ä¸‹å»å‘¢? æˆ‘ä»¬è¿˜æ˜¯æŠ„sleuthï¼šæŠŠæ ‡ç­¾æ”¾å…¥headerï¼ŒæœåŠ¡Aè°ƒæœåŠ¡Bæ—¶ï¼Œå°†æœåŠ¡A headeré‡Œé¢çš„æ ‡ç­¾æ”¾åˆ°æœåŠ¡Bçš„headeré‡Œï¼Œä¾æ¬¡ä¼ é€’ä¸‹å»ã€‚è¿™é‡Œçš„å…³é”®ç‚¹å°±æ˜¯ï¼šå†…éƒ¨çš„å¾®æœåŠ¡åœ¨æ¥æ”¶åˆ°å‘æ¥çš„è¯·æ±‚æ—¶(zuul-&gt;Aï¼ŒA-&gt;Bï¼‰æˆ‘ä»¬å°†è¯·æ±‚æ”¾å…¥ThreadLocalï¼Œå“¦ï¼Œä¸å¯¹ï¼Œæ˜¯HystrixRequestVariableDefaultï¼Œè¿˜è®°å¾—ä¸Šé¢è¯´çš„åŸå› ä¹ˆï¼šï¼‰ã€‚ è¿™ä¸ªå®¹æ˜“å¤„ç†ï¼Œå†™ä¸€ä¸ªspring mvcæ‹¦æˆªå™¨å³å¯ï¼Œä»£ç å‚è§CoreHeaderInterceptorã€‚ç„¶åå‘é€è¯·æ±‚æ—¶è‡ªåŠ¨å¸¦ä¸Šè¿™ä¸ªé‡Œé¢ä¿å­˜çš„æ ‡ç­¾ä¿¡æ¯ï¼Œå‚è§RestTemplateçš„æ‹¦æˆªå™¨CoreHttpRequestInterceptorã€‚åˆ°æ­¤ä¸ºæ­¢ï¼ŒæŠ€æœ¯ä¸Šå…¨éƒ¨èµ°é€šå®ç°ã€‚ æ€»ç»“ä¸€ä¸‹ï¼šzuulä¾æ®ç”¨æˆ·æˆ–IPç­‰è®¡ç®—æ ‡ç­¾ï¼Œå¹¶å°†æ ‡ç­¾æ”¾å…¥headeré‡Œå‘åä¼ é€’ï¼Œåç»­çš„å¾®æœåŠ¡é€šè¿‡æ‹¦æˆªå™¨ï¼Œå°†headeré‡Œçš„æ ‡ç­¾æ”¾å…¥RestTemplateè¯·æ±‚çš„headeré‡Œç»§ç»­å‘åæ¥åŠ›ä¼ é€’ã€‚æ ‡ç­¾çš„å†…å®¹é€šè¿‡æ”¾å…¥ç±»ä¼¼äºThreadLocalçš„å…¨å±€å˜é‡ï¼ˆHystrixRequestVariableDefaultï¼‰ï¼Œä½¿Ribbon Ruleå¯ä»¥ä½¿ç”¨ã€‚ åŸºäºæ ‡ç­¾è·¯ç”±çš„æµ‹è¯•å‚è§PreFilteræºç ï¼Œæ¨¡æ‹Ÿäº†å‡ ä¸ªç”¨æˆ·çš„æ ‡ç­¾ï¼Œå‚è§LabelAndWeightMetadataRuleæºç ï¼Œæ¨¡æ‹Ÿäº†OR ANDä¸¤ç§æ ‡ç­¾å¤„ç†ç­–ç•¥ã€‚ä¾æ¬¡å¼€å¯ config eureka provideï¼ˆå¼€ä¸¤ä¸ªå®ä¾‹ï¼Œé€šè¿‡å¯åŠ¨å‚æ•°server.portæŒ‡å®šä¸åŒç«¯å£åŒºåˆ†ï¼‰ consumer zuul. è®¿é—® http://localhost:8761/metadata.html è®¾ç½®ç¬¬ä¸€ä¸ªprovide å®ä¾‹ orLabelä¸º CN,Test å‘é€è¯·æ±‚å¤´å¸¦å…¥Authorization: emt è®¿é—®http://localhost:8080/provider/user å¤šåˆ·å‡ æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°zuulæ‰€æœ‰è¯·æ±‚å‡è·¯ç”±ç»™äº†ç¬¬ä¸€ä¸ªå®ä¾‹ã€‚è®¿é—®http://localhost:8080/consumer/test å¤šåˆ·å‡ æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œconsumerè°ƒç”¨å‡è·¯ç”±ç»™äº†ç¬¬ä¸€ä¸ªå®ä¾‹ã€‚ è®¾ç½®ç¬¬äºŒä¸ªprovide å®ä¾‹ andLabelä¸º EN,Male å‘é€è¯·æ±‚å¤´å¸¦å…¥Authorization: em è®¿é—®http://localhost:8080/provider/user å¤šåˆ·å‡ æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°zuulæ‰€æœ‰è¯·æ±‚å‡è·¯ç”±ç»™äº†ç¬¬äºŒä¸ªå®ä¾‹ã€‚è®¿é—®http://localhost:8080/consumer/test å¤šåˆ·å‡ æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œconsumerè°ƒç”¨å‡è·¯ç”±ç»™äº†ç¬¬äºŒä¸ªå®ä¾‹ã€‚ Authorizationå¤´è¿˜å¯ä»¥è®¾ç½®ä¸ºPreFilteré‡Œé¢çš„æ¨¡æ‹Ÿtokenæ¥åšæµ‹è¯•ï¼Œè‡³æ­¤æ‰€æœ‰å†…å®¹è®²è§£å®Œæ¯•ï¼ŒæŠ€æœ¯è·¯çº¿æ‹‰é€šï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®éœ€æ±‚æ¥å®Œå–„ä½ è‡ªå·±çš„è·¯ç”±ç­–ç•¥å•¦ã€‚ ä¼ªä»£ç åˆ†æå®ç°æµç¨‹ä¼ªä»£ç ç¤ºä¾‹Ribboné»˜è®¤é‡‡ç”¨ZoneAvoidanceRuleï¼Œä¼˜å…ˆé€‰æ‹©åŒzoneä¸‹çš„å®ä¾‹ã€‚æˆ‘ä»¬ç»§æ‰¿è¿™ä¸ªruleå¹¶æ‰©å±•æˆ‘ä»¬è‡ªå·±çš„é™æµåŠŸèƒ½ï¼Œä»”ç»†é˜…è¯»ZoneAvoidanceRuleåŠå…¶çˆ¶ç±»æºç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class WeightedMetadataRule extends ZoneAvoidanceRule &#123;public static final String META_DATA_KEY_WEIGHT = \"weight\";@Overridepublic Server choose(Object key) &#123; List&lt;Server&gt; serverList = this.getPredicate().getEligibleServers(this.getLoadBalancer().getAllServers(), key); if (CollectionUtils.isEmpty(serverList)) &#123; return null; &#125; // è®¡ç®—æ€»å€¼å¹¶å‰”é™¤0æƒé‡èŠ‚ç‚¹ int sum = 0; Map&lt;Server, Integer&gt; serverWeightMap = new HashMap&lt;&gt;(); for (Server server : serverList) &#123; String strWeight = ((DiscoveryEnabledServer) server).getInstanceInfo().getMetadata().get(META_DATA_KEY_WEIGHT); int weight = 100; try &#123; weight = Integer.parseInt(strWeight); &#125; catch (Exception e) &#123; // æ— éœ€å¤„ç† &#125; if (weight &lt;= 0) &#123; continue; &#125; serverWeightMap.put(server, weight); sum += weight; &#125; // æƒé‡éšæœº int random = (int) (Math.random() * sum); int current = 0; for (Map.Entry&lt;Server, Integer&gt; entry : serverWeightMap.entrySet()) &#123; current += entry.getValue(); if (random &lt; current) &#123; return entry.getKey(); &#125; &#125; return null;&#125;&#125; ä½¿ä¸Šè¿°ä»£ç ç”Ÿæ•ˆï¼Œåœ¨zuulç½‘å…³ä¸­åŠ å…¥ 1234@Beanpublic IRule weightedMetadataRule()&#123; return new WeightedMetadataRule();&#125; ä»£ç ç¤ºä¾‹æµ‹è¯•æ‰“æ–­ç‚¹æµ‹è¯•æ˜¯å¦è¿›å…¥WeightedMetadataRuleï¼Œå¼€å¯å¤šä¸ªæœåŠ¡Aå®ä¾‹ï¼Œé€šè¿‡zuulè®¿é—®æœåŠ¡Aã€‚æˆåŠŸè¿›å…¥æ–­ç‚¹ï¼Œä»£ç ç”Ÿæ•ˆåï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦‚ä½•æŒ‡å®šmetadataã€‚è®¿é—®eureka restful API ï¼ˆæˆ‘çš„eurekaæœåŠ¡å™¨ç«¯å£ä¸º8100ï¼Œä¿®æ”¹ä¸ºä½ è‡ªå·±çš„eurekaç«¯å£ï¼‰Get http://localhost:8100/eureka/appsè¿™ä¸ªapiå¯ä»¥çœ‹åˆ°æ‰€æœ‰æœåŠ¡Get http://localhost:8100/eureka/apps/YOUR_SERVICE_NAMEè¿™ä¸ªapiå¯ä»¥çœ‹åˆ°ä½ çš„æœåŠ¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬éƒ¨ç½²äº†å“ªäº›å®ä¾‹Get http://localhost:8100/eureka/apps/YOUR_SERVICE_NAME/INSTANCE_IDè¿™ä¸ªapiå¯ä»¥çœ‹åˆ°æœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼Œæ³¨æ„å…¶ä¸­çš„metadataèŠ‚ç‚¹ï¼Œç›®å‰ä¸ºemptyPut http://localhost:8100/eureka/apps/YOUR_SERVICE_NAME/INSTANCE_ID/metadata?weight=10é€šè¿‡putæ–¹å¼å¯ä»¥ä¿®æ”¹metadataçš„å†…å®¹ï¼Œæ”¾å…¥weightï¼Œè®¾ä¸º10 ç„¶åç¨ç­‰ä¸¤åˆ†é’Ÿï¼Œè®©zuulæ›´æ–°æ³¨å†Œä¸­å¿ƒä¸­çš„ä¿¡æ¯ï¼Œæ¥ç€é‡æ–°è®¿é—®ï¼Œè°ƒè¯•å°±å¯ä»¥çœ‹åˆ°metadataçš„å†…å®¹äº†ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒ‰ç…§æƒé‡éšæœºæ¥è¿›è¡Œæµé‡é™åˆ¶çš„ï¼Œè‡³æ­¤hello worldæå®šã€‚ ç”Ÿäº§ä¸Šä½¿ç”¨WeightedMetadataRuleæ¥ä¸‹æ¥ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•åº”ç”¨è¿™ä¸ªWeightedMetadataRuleå‘¢ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š æ‰‹åŠ¨æŒ‡å®šæœåŠ¡ç­–ç•¥ï¼Œspring cloud ribbonå¹¶æ²¡æœ‰å®Œæ•´å®ç°netflix ribbonçš„æ‰€æœ‰é…ç½®åŠŸèƒ½ï¼Œè´Ÿè½½ç­–ç•¥é»˜è®¤åªèƒ½é…ç½®å¾®æœåŠ¡çº§åˆ«ï¼Œæ— æ³•é…ç½®å…¨å±€é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼šåªèƒ½é…ç½® SOME_SERVICE_ID.ribbon.NFLoadBalancerRuleClassName=package.WeightedMetadataRuleè€Œä¸æ”¯æŒé…ç½®å…¨å±€é»˜è®¤å€¼ ribbon.NFLoadBalancerRuleClassName=package.WeightedMetadataRuleè¿™ç§æ–¹æ¡ˆæ˜æ˜¾ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ é€šè¿‡å£°æ˜Irule spring beané…ç½®å…¨å±€è´Ÿè½½ç­–ç•¥1234@Beanpublic IRule weightedMetadataRule()&#123; return new WeightedMetadataRule();&#125; è¿™ç§æ–¹å¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ç”¨çš„hello worldæ–¹å¼ï¼Œé…ç½®åå¼ºåˆ¶æ‰€æœ‰å¾®æœåŠ¡ä½¿ç”¨è¯¥ç­–ç•¥ï¼Œæ²¡æœ‰ä¾‹å¤–ï¼Œå¾®æœåŠ¡æ— æ³•ä¸ªæ€§åŒ–å®šåˆ¶ç­–ç•¥ï¼Œç¬¦åˆç›®å‰éœ€æ±‚ï¼Œä½†ä¸é€‚äºé•¿æœŸè§„åˆ’ã€‚ ç»§æ‰¿é‡å†™PropertiesFactoryç»§æ‰¿é‡å†™org.springframework.cloud.netflix.ribbon.PropertiesFactoryç±»ï¼Œä¿®æ­£spring cloud ribbonæœªèƒ½å®Œå…¨æ”¯æŒnetflix ribbonçš„é—®é¢˜ã€‚ä½†æ˜¯PropertiesFactoryå±æ€§å‡ä¸ºç§æœ‰ï¼Œåº”è¯¥æ˜¯spring cloudä¸å»ºè®®åœ¨æ­¤æ‰©å±•ã€‚å‚è§https://github.com/spring-cloud/spring-cloud-netflix/issues/1741 ä½¿ç”¨spring cloudå®˜æ–¹å»ºè®®çš„@RibbonClientæ–¹å¼1234567891011121314151617181920212223242526272829@Configuration@RibbonClients(defaultConfiguration = DefaultRibbonConfiguration.class)public class DefaultRibbonConfiguration &#123; @Value(\"$&#123;ribbon.client.name:#&#123;null&#125;&#125;\") private String name; @Autowired(required = false) private IClientConfig config; @Autowired private PropertiesFactory propertiesFactory; @Bean public IRule ribbonRule() &#123; if (StringUtils.isEmpty(name)) &#123; return null; &#125; if (this.propertiesFactory.isSet(IRule.class, name)) &#123; return this.propertiesFactory.get(IRule.class, config, name); &#125; // é»˜è®¤é…ç½® WeightedMetadataRule rule = new WeightedMetadataRule(); rule.initWithNiwsConfig(config); return rule; &#125;&#125; æ€»ç»“å…³äºæƒé‡éšæœºçš„æ€§èƒ½ï¼Œä¸Šè¿°ä»£ç ç”¨çš„æ•°ç»„åˆ†æ®µæŸ¥æ‰¾æ³•ï¼Œè¿˜å¯ä»¥é‡‡ç”¨TreeMapäºŒåˆ†æŸ¥æ‰¾æ³•ã€‚å¯ä»¥å°†æƒé‡æ•°ç»„æˆ–æƒé‡TreeMapç¼“å­˜èµ·æ¥ã€‚æ ¹æ®æµ‹è¯•ï¼Œåœ¨å®ä¾‹æ•°é‡ä¸º50ä¸ªæ—¶ ç¼“å­˜æƒé‡æ•°ç»„å’Œæƒé‡TreeMapï¼Œæ•°ç»„åˆ†æ®µæŸ¥æ‰¾ç™¾ä¸‡æ¬¡è€—æ—¶78-125msï¼ŒTreeMapäºŒåˆ†è€—æ—¶50-80msã€‚ è¿™ç¯‡æ–‡ç« åªæ˜¯æŠŠæŠ€æœ¯æ‰“é€šï¼Œè‡³äºå¦‚ä½•æ ¹æ®æœåŠ¡å™¨è´Ÿè½½æƒ…å†µï¼Œè‡ªåŠ¨é™çº§ï¼Œé™æµç­‰éœ€æ±‚ï¼Œåªéœ€è¦ç›‘æ§æœåŠ¡å™¨çŠ¶å†µï¼Œè°ƒç”¨eurekaæ¥å£è®¾ç½®metadataå³å¯ï¼ˆå…¶å®æˆ‘ä¸ªäººå»ºè®®è¿™æ–¹é¢éœ€æ±‚é€šè¿‡dockerçš„è‡ªåŠ¨æ‰©å®¹ç¼©å®¹å®Œæˆï¼Œåªæ˜¯æœ‰æœ‹å‹é—®åˆ°å¦‚ä½•é€šè¿‡spring cloudå®ç°ï¼‰ã€‚ ä¸‹ä¸€ç¯‡ä¼šå†™åŸºäºæ ‡ç­¾çš„æµé‡æ§åˆ¶ã€‚å¦‚ä½•æ§åˆ¶éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨æœåŠ¡A2.0ï¼Œå…¶ä»–ç”¨æˆ·ä½¿ç”¨æœåŠ¡A1.0ã€‚ å‚è€ƒæ–‡ç« æ±Ÿå—ç™½è¡£-æœåŠ¡åŒ–ä¹‹ï¼è·¯ç”±SpringCloud Ribbon é™çº§ã€é™æµã€ç°åº¦å‘å¸ƒ","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Ribbon","slug":"Spring-Cloud-Ribbon","permalink":"http://xujin.org/tags/Spring-Cloud-Ribbon/"}]},{"title":"å¿«é€Ÿä½¿ç”¨Spring Cloud Feignä½œä¸ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡æä¾›è€…","slug":"sc/sc-fegin01","date":"2017-05-13T06:00:00.000Z","updated":"2019-01-13T03:17:51.194Z","comments":true,"path":"sc/sc-fegin01/","link":"","permalink":"http://xujin.org/sc/sc-fegin01/","excerpt":"å‰è¨€ åœ¨ä½¿ç”¨Spring Cloudå¼€å‘å¾®æœåŠ¡åº”ç”¨æ—¶ä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡æœåŠ¡æä¾›è€…éƒ½æ˜¯ä»¥HTTPæ¥å£çš„å½¢å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œå› æ­¤æœåŠ¡æ¶ˆè´¹è€…åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æ—¶ï¼Œé€šè¿‡HTTP Clientçš„æ–¹å¼è®¿é—®ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JDKåŸç”Ÿçš„URLConnectionã€Apacheçš„Http Clientã€Nettyçš„å¼‚æ­¥HTTP Client, Springçš„RestTemplateå»å®ç°æœåŠ¡é—´çš„è°ƒç”¨ã€‚Spring Cloudå¯¹Feginè¿›è¡Œäº†å¢å¼ºï¼Œä½¿Feginæ”¯æŒäº†Spring MVCçš„æ³¨è§£ï¼Œå¹¶æ•´åˆäº†Ribbonå’ŒEurekaï¼Œä»è€Œè®©Feginçš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚ Feignç®€ä»‹Feignæ˜¯ä¸€ç§å£°æ˜å¼ã€æ¨¡æ¿åŒ–çš„HTTPå®¢æˆ·ç«¯ã€‚åœ¨Spring Cloudä¸­ä½¿ç”¨Feign, å¯ä»¥åšåˆ°ä½¿ç”¨HTTPè¯·æ±‚è¿œç¨‹æœåŠ¡æ—¶èƒ½å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·çš„ä½“éªŒï¼Œå¼€å‘è€…å®Œå…¨æ„ŸçŸ¥ä¸åˆ°è¿™æ˜¯è¿œç¨‹æ–¹æ³•ï¼Œæ›´æ„ŸçŸ¥ä¸åˆ°è¿™æ˜¯ä¸ªHTTPè¯·æ±‚ã€‚Feignçš„Githubç½‘å€,æ¯”å¦‚ï¼šFeignå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å¯æ’æ‹”çš„æ³¨è§£æ”¯æŒï¼ŒåŒ…æ‹¬Feignæ³¨è§£å’ŒJAX-RSæ³¨è§£ æ”¯æŒå¯æ’æ‹”çš„HTTPç¼–ç å™¨å’Œè§£ç å™¨ æ”¯æŒHystrixå’Œå®ƒçš„Fallback æ”¯æŒRibbonçš„è´Ÿè½½å‡è¡¡ æ”¯æŒHTTPè¯·æ±‚å’Œå“åº”çš„å‹ç¼©","text":"å‰è¨€ åœ¨ä½¿ç”¨Spring Cloudå¼€å‘å¾®æœåŠ¡åº”ç”¨æ—¶ä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡æœåŠ¡æä¾›è€…éƒ½æ˜¯ä»¥HTTPæ¥å£çš„å½¢å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œå› æ­¤æœåŠ¡æ¶ˆè´¹è€…åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æ—¶ï¼Œé€šè¿‡HTTP Clientçš„æ–¹å¼è®¿é—®ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JDKåŸç”Ÿçš„URLConnectionã€Apacheçš„Http Clientã€Nettyçš„å¼‚æ­¥HTTP Client, Springçš„RestTemplateå»å®ç°æœåŠ¡é—´çš„è°ƒç”¨ã€‚Spring Cloudå¯¹Feginè¿›è¡Œäº†å¢å¼ºï¼Œä½¿Feginæ”¯æŒäº†Spring MVCçš„æ³¨è§£ï¼Œå¹¶æ•´åˆäº†Ribbonå’ŒEurekaï¼Œä»è€Œè®©Feginçš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚ Feignç®€ä»‹Feignæ˜¯ä¸€ç§å£°æ˜å¼ã€æ¨¡æ¿åŒ–çš„HTTPå®¢æˆ·ç«¯ã€‚åœ¨Spring Cloudä¸­ä½¿ç”¨Feign, å¯ä»¥åšåˆ°ä½¿ç”¨HTTPè¯·æ±‚è¿œç¨‹æœåŠ¡æ—¶èƒ½å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·çš„ä½“éªŒï¼Œå¼€å‘è€…å®Œå…¨æ„ŸçŸ¥ä¸åˆ°è¿™æ˜¯è¿œç¨‹æ–¹æ³•ï¼Œæ›´æ„ŸçŸ¥ä¸åˆ°è¿™æ˜¯ä¸ªHTTPè¯·æ±‚ã€‚Feignçš„Githubç½‘å€,æ¯”å¦‚ï¼šFeignå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å¯æ’æ‹”çš„æ³¨è§£æ”¯æŒï¼ŒåŒ…æ‹¬Feignæ³¨è§£å’ŒJAX-RSæ³¨è§£ æ”¯æŒå¯æ’æ‹”çš„HTTPç¼–ç å™¨å’Œè§£ç å™¨ æ”¯æŒHystrixå’Œå®ƒçš„Fallback æ”¯æŒRibbonçš„è´Ÿè½½å‡è¡¡ æ”¯æŒHTTPè¯·æ±‚å’Œå“åº”çš„å‹ç¼© Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„Web Serviceå®¢æˆ·ç«¯ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯è®©Web Serviceè°ƒç”¨æ›´åŠ ç®€å•ã€‚å®ƒæ•´åˆäº†Ribbonå’ŒHystrixï¼Œä»è€Œä¸å†éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨è¿™ä¸¤ä¸ªç»„ä»¶ã€‚Feignè¿˜æä¾›äº†HTTPè¯·æ±‚çš„æ¨¡æ¿ï¼Œé€šè¿‡ç¼–å†™ç®€å•çš„æ¥å£å’Œæ³¨è§£ï¼Œå°±å¯ä»¥å®šä¹‰å¥½HTTPè¯·æ±‚çš„å‚æ•°ã€æ ¼å¼ã€åœ°å€ç­‰ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼ŒFeignä¼šå®Œå…¨ä»£ç†HTTPçš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦åƒè°ƒç”¨æ–¹æ³•ä¸€æ ·è°ƒç”¨å®ƒå°±å¯ä»¥å®ŒæˆæœåŠ¡è¯·æ±‚ã€‚Feign ç¤ºä¾‹å·¥ç¨‹ é“¾æ¥ï¼šhttps://github.com/SoftwareKing/spring-cloud-study/tree/master/sc-feign-first æœ¬æ–‡æœ€ç»ˆä¿®æ”¹æ—¶é—´ï¼š2017-05-20 18:47:23ï¼Œä¸ºäº†è§£å†³é—®é¢˜1å’Œ2æœ€ç»ˆä½¿ç”¨ç‰ˆæœ¬:Spring Bootçš„ç‰ˆæœ¬ä¸º1.5.3.RELEASEï¼ŒSpring Cloudç‰ˆæœ¬ä¸ºDalston.RELEASE æœåŠ¡æ¶ˆè´¹è€…ä¸­sc-feign-first-consumerçš„Feignçš„å®šä¹‰ä¸ºäº†è®©FeignçŸ¥é“åœ¨è°ƒç”¨æ–¹æ³•æ—¶åº”è¯¥å‘å“ªä¸ªåœ°å€å‘è¯·æ±‚ä»¥åŠè¯·æ±‚éœ€è¦å¸¦å“ªäº›å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š 123456789101112131415package org.xujin.sc.feign.user.service;import org.springframework.cloud.netflix.feign.FeignClient;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.xujin.sc.feign.user.model.OrderModel;@FeignClient(name = \"sc-feign-first-provider\")//ã€Aã€‘public interface UserFeignService &#123;@RequestMapping(value = \"/sc/order/&#123;id&#125;\", method = RequestMethod.GET)//ã€Bã€‘public OrderModel findOrderById(@PathVariable(\"id\") Long id); //ã€Cã€‘&#125; A: @FeignClientç”¨äºé€šçŸ¥Feignç»„ä»¶å¯¹è¯¥æ¥å£è¿›è¡Œä»£ç†(ä¸éœ€è¦ç¼–å†™æ¥å£å®ç°)ï¼Œä½¿ç”¨è€…å¯ç›´æ¥é€šè¿‡@Autowiredæ³¨å…¥ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚ 123 // æ³¨å…¥æœåŠ¡æä¾›è€…,è¿œç¨‹çš„HttpæœåŠ¡@Autowiredprivate UserFeignService userFeignService; B: @RequestMappingè¡¨ç¤ºåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶éœ€è¦å‘/sc/order/{id}å‘é€GETè¯·æ±‚ã€‚ C: @PathVariableä¸SpringMVCä¸­å¯¹åº”æ³¨è§£å«ä¹‰ç›¸åŒ æœåŠ¡æ¶ˆè´¹è€…ä¸­Feignçš„ä½¿ç”¨123456789101112131415161718192021222324252627282930package org.xujin.sc.feign.user.controller;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RestController;import org.xujin.sc.feign.user.model.OrderModel;import org.xujin.sc.feign.user.service.UserFeignService;/** * UserController * @author xujin */@RestControllerpublic class UserController &#123; private static final Logger logger = LoggerFactory.getLogger(UserController.class); // æ³¨å…¥æœåŠ¡æä¾›è€…,è¿œç¨‹çš„HttpæœåŠ¡ @Autowired private UserFeignService userFeignService; // æœåŠ¡æ¶ˆè´¹è€…å¯¹ä½æä¾›çš„æœåŠ¡ @GetMapping(\"/sc/user/&#123;id&#125;\") public OrderModel findByIdByEurekaServer(@PathVariable Long id) &#123; return userFeignService.findOrderById(id); &#125;&#125; å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œé€šè¿‡@Autowiredå°†å£°æ˜çš„Feignä¾èµ–æ³¨å…¥å³å¯ï¼Œè°ƒç”¨userFeignService.findOrderById(id)ä½¿ç”¨ã€‚å¼€å‘è€…é€šè¿‡userFeignService.findOrderById()å°±èƒ½å®Œæˆå‘é€HTTPè¯·æ±‚å’Œè§£ç HTTPè¿”å›ç»“æœå¹¶å°è£…æˆå¯¹è±¡çš„è¿‡ç¨‹ã€‚ å¯åŠ¨æµ‹è¯•ä¾æ¬¡æŒ‰é¡ºåºå¯åŠ¨å¦‚ä¸‹å·¥ç¨‹æ³¨å†Œä¸­å¿ƒ: sc-fegin-first-serveræœåŠ¡æä¾›è€…1:sc-fegin-first-provider01æœåŠ¡æä¾›è€…2:sc-fegin-first-provider02ä»¥ä¸Šå·¥ç¨‹èƒ½æ­£å¸¸å¯åŠ¨workï¼Œä½†æ˜¯å½“å¯åŠ¨æœåŠ¡æ¶ˆè´¹è€…: sc-fegin-first-consumeræŠ¥é”™å¦‚ä¸‹ã€‚ ä½¿ç”¨çš„ç¤ºä¾‹å·¥ç¨‹çš„Spring Bootçš„ç‰ˆæœ¬ä¸º1.5.2.RELEASEï¼ŒSpring Cloudç‰ˆæœ¬ä¸ºDalston.RELEASEä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ã€‚ 12345678910111213141516171819&lt;!-- å¼•å…¥spring bootçš„ä¾èµ– --&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.2.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;!-- å¼•å…¥spring cloudçš„ä¾èµ– --&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Dalston.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; è®¿é—®http://localhost:8010/sc/user/1 ,å‡ºç°ä»¥ä¸‹é”™è¯¯å³ï¼šã€é—®é¢˜ä¸€ã€‘feign/Feign$BuilderCaused by: java.lang.NoClassDefFoundError: feign/Feign$Builder12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273java.lang.IllegalStateException: ApplicationEventMulticaster not initialized - call &apos;refresh&apos; before multicasting events via the context: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@2d140a7: startup date [Sun May 14 22:44:43 CST 2017]; parent: org.springframework.context.annotation.AnnotationConfigApplicationContext@4bf48f6 at org.springframework.context.support.AbstractApplicationContext.getApplicationEventMulticaster(AbstractApplicationContext.java:404) [spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.ApplicationListenerDetector.postProcessBeforeDestruction(ApplicationListenerDetector.java:97) ~[spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:253) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:578) [spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:554) [spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingleton(DefaultListableBeanFactory.java:961) [spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:523) [spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingletons(DefaultListableBeanFactory.java:968) [spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:1033) [spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:555) [spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.boot.context.embedded.EmbeddedWebApplicationContext.refresh(EmbeddedWebApplicationContext.java:122) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:737) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:370) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:314) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:1162) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:1151) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.xujin.sc.feign.user.UserConsumerApplication.main(UserConsumerApplication.java:15) [classes/:na]2017-05-14 22:44:44.079 ERROR 2372 --- [ main] o.s.boot.SpringApplication : Application startup failedorg.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &apos;methodValidationPostProcessor&apos; defined in class path resource [org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.class]: Unsatisfied dependency expressed through method &apos;methodValidationPostProcessor&apos; parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;org.xujin.sc.feign.user.service.UserFeignService&apos;: Failed to introspect bean class [org.springframework.cloud.netflix.feign.FeignClientFactoryBean] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: feign/Feign$Builder at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:749) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:467) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1173) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1067) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.PostProcessorRegistrationDelegate.registerBeanPostProcessors(PostProcessorRegistrationDelegate.java:223) ~[spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.AbstractApplicationContext.registerBeanPostProcessors(AbstractApplicationContext.java:702) ~[spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:527) ~[spring-context-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.boot.context.embedded.EmbeddedWebApplicationContext.refresh(EmbeddedWebApplicationContext.java:122) ~[spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:737) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:370) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:314) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:1162) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.springframework.boot.SpringApplication.run(SpringApplication.java:1151) [spring-boot-1.5.2.RELEASE.jar:1.5.2.RELEASE] at org.xujin.sc.feign.user.UserConsumerApplication.main(UserConsumerApplication.java:15) [classes/:na]Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;org.xujin.sc.feign.user.service.UserFeignService&apos;: Failed to introspect bean class [org.springframework.cloud.netflix.feign.FeignClientFactoryBean] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: feign/Feign$Builder at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:269) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:923) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:804) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:558) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:432) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:395) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:220) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:1260) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1101) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] ... 19 common frames omittedCaused by: java.lang.NoClassDefFoundError: feign/Feign$Builder at java.lang.Class.getDeclaredMethods0(Native Method) ~[na:1.8.0_112] at java.lang.Class.privateGetDeclaredMethods(Class.java:2701) ~[na:1.8.0_112] at java.lang.Class.getDeclaredMethods(Class.java:1975) ~[na:1.8.0_112] at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:613) ~[spring-core-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:524) ~[spring-core-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:510) ~[spring-core-4.3.7.RELEASE.jar:4.3.7.RELEASE] at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:247) ~[spring-beans-4.3.7.RELEASE.jar:4.3.7.RELEASE] ... 32 common frames omittedCaused by: java.lang.ClassNotFoundException: feign.Feign$Builder at java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[na:1.8.0_112] at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[na:1.8.0_112] at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331) ~[na:1.8.0_112] at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[na:1.8.0_112] ... 39 common frames omitted ç»æŸ¥æ‰¾è§£å†³é—®é¢˜2å¤©æŸ¥çœ‹æ— æœ(æ‚è„¸ï¼Œåé¢å†™æºç åˆ†æå®šä½)ï¼Œå› æ­¤å†³å®šå°†Spring Bootçš„ç‰ˆæœ¬æ”¹å˜ä¸º1.4.3.RELEASEï¼ŒSpring Cloudç‰ˆæœ¬ä¸ºCamden.SR5ä¹‹å,æŒ‰ä¸Šé¢çš„é¡ºåºå¯åŠ¨ï¼Œä¹‹åæµ‹è¯•http://localhost:8010/sc/user/1 ,å¯ä»¥æ­£å¸¸workã€‚ Feginçš„workåŸç†Spring Cloudåº”ç”¨åœ¨å¯åŠ¨æ—¶ï¼ŒFeignä¼šæ‰«ææ ‡æœ‰@FeignClientæ³¨è§£çš„æ¥å£ï¼Œç”Ÿæˆä»£ç†ï¼Œå¹¶æ³¨å†Œåˆ°Springå®¹å™¨ä¸­ã€‚ç”Ÿæˆä»£ç†æ—¶Feignä¼šä¸ºæ¯ä¸ªæ¥å£æ–¹æ³•åˆ›å»ºä¸€ä¸ªRequetTemplateå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°è£…äº†HTTPè¯·æ±‚éœ€è¦çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè¯·æ±‚å‚æ•°åã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯éƒ½æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç¡®å®šçš„ï¼ŒFeignçš„æ¨¡æ¿åŒ–å°±ä½“ç°åœ¨è¿™é‡Œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†Feignä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ï¼Œ@FeignClient(name = â€œsc-feign-first-providerâ€)æ„ä¸ºé€šçŸ¥Feignåœ¨è°ƒç”¨è¯¥æ¥å£æ–¹æ³•æ—¶è¦å‘Eurekaä¸­æŸ¥è¯¢åä¸ºeaçš„æœåŠ¡ï¼Œä»è€Œå¾—åˆ°æœåŠ¡URLã€‚ Feginçš„å¸¸è§åº”ç”¨Feignçš„Encoderã€Decoderå’ŒErrorDecoderFeignå°†æ–¹æ³•ç­¾åä¸­æ–¹æ³•å‚æ•°å¯¹è±¡åºåˆ—åŒ–ä¸ºè¯·æ±‚å‚æ•°æ”¾åˆ°HTTPè¯·æ±‚ä¸­çš„è¿‡ç¨‹ï¼Œæ˜¯ç”±ç¼–ç å™¨(Encoder)å®Œæˆçš„ã€‚åŒç†ï¼Œå°†HTTPå“åº”æ•°æ®ååºåˆ—åŒ–ä¸ºjavaå¯¹è±¡æ˜¯ç”±è§£ç å™¨(Decoder)å®Œæˆçš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒFeignä¼šå°†æ ‡æœ‰@RequestParamæ³¨è§£çš„å‚æ•°è½¬æ¢æˆå­—ç¬¦ä¸²æ·»åŠ åˆ°URLä¸­ï¼Œå°†æ²¡æœ‰æ³¨è§£çš„å‚æ•°é€šè¿‡Jacksonè½¬æ¢æˆjsonæ”¾åˆ°è¯·æ±‚ä½“ä¸­ã€‚ æ³¨æ„ï¼Œå¦‚æœåœ¨@RequetMappingä¸­çš„methodå°†è¯·æ±‚æ–¹å¼æŒ‡å®šä¸ºGETï¼Œé‚£ä¹ˆæ‰€æœ‰æœªæ ‡æ³¨è§£çš„å‚æ•°å°†ä¼šè¢«å¿½ç•¥ï¼Œä¾‹å¦‚ï¼š 12@RequestMapping(value = \"/group/&#123;groupId&#125;\", method = RequestMethod.GET)void update(@PathVariable(\"groupId\") Integer groupId, @RequestParam(\"groupName\") String groupName, DataObject obj); æ­¤æ—¶å› ä¸ºå£°æ˜çš„æ˜¯GETè¯·æ±‚æ²¡æœ‰è¯·æ±‚ä½“ï¼Œæ‰€ä»¥objå‚æ•°å°±ä¼šè¢«å¿½ç•¥ã€‚ åœ¨Spring Cloudç¯å¢ƒä¸‹ï¼ŒFeignçš„Encoderåªä¼šç”¨æ¥ç¼–ç æ²¡æœ‰æ·»åŠ æ³¨è§£çš„å‚æ•°ã€‚å¦‚æœä½ è‡ªå®šä¹‰äº†Encoder, é‚£ä¹ˆåªæœ‰åœ¨ç¼–ç objå‚æ•°æ—¶æ‰ä¼šè°ƒç”¨ä½ çš„Encoderã€‚ å¯¹äºDecoder, é»˜è®¤ä¼šå§”æ‰˜ç»™SpringMVCä¸­çš„MappingJackson2HttpMessageConverterç±»è¿›è¡Œè§£ç ã€‚åªæœ‰å½“çŠ¶æ€ç ä¸åœ¨200 ~ 300ä¹‹é—´æ—¶ErrorDecoderæ‰ä¼šè¢«è°ƒç”¨ã€‚ ErrorDecoderçš„ä½œç”¨æ˜¯å¯ä»¥æ ¹æ®HTTPå“åº”ä¿¡æ¯è¿”å›ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¯ä»¥åœ¨è°ƒç”¨Feignæ¥å£çš„åœ°æ–¹è¢«æ•è·åˆ°ã€‚æˆ‘ä»¬ç›®å‰å°±é€šè¿‡ErrorDecoderæ¥ä½¿Feignæ¥å£æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ä»¥ä¾›è°ƒç”¨è€…å¤„ç†ã€‚ æ›´æ¢Feigné»˜è®¤ä½¿ç”¨çš„HTTP ClientFeignåœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯JDKåŸç”Ÿçš„URLConnectionå‘é€HTTPè¯·æ±‚ï¼Œæ²¡æœ‰è¿æ¥æ± ï¼Œä½†æ˜¯å¯¹æ¯ä¸ªåœ°å€ä¼šä¿æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå³åˆ©ç”¨HTTPçš„persistence connection ã€‚æˆ‘ä»¬å¯ä»¥ç”¨Apacheçš„HTTP Clientæ›¿æ¢FeignåŸå§‹çš„http client, ä»è€Œè·å–è¿æ¥æ± ã€è¶…æ—¶æ—¶é—´ç­‰ä¸æ€§èƒ½æ¯æ¯ç›¸å…³çš„æ§åˆ¶èƒ½åŠ›ã€‚Spring Cloudä»Brixtion.SR5ç‰ˆæœ¬å¼€å§‹æ”¯æŒè¿™ç§æ›¿æ¢ï¼Œé¦–å…ˆåœ¨é¡¹ç›®ä¸­å£°æ˜Apache HTTP Clientå’Œfeign-httpclientä¾èµ–ï¼š 12345678910&lt;!-- ä½¿ç”¨Apache HttpClientæ›¿æ¢FeignåŸç”Ÿhttpclient --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.netflix.feign&lt;/groupId&gt; &lt;artifactId&gt;feign-httpclient&lt;/artifactId&gt; &lt;version&gt;8.17.0&lt;/version&gt; &lt;/dependency&gt; ç„¶ååœ¨application.ymlä¸­æ·»åŠ å¦‚ä¸‹ï¼š123feign: httpclient: enabled: true spring cloud feignä½¿ç”¨okhttp3å‚è€ƒ spring cloud feignå¸¸è§é—®é¢˜å‚æ•°ä¸ä¼šè‡ªåŠ¨ä¼ é€’æœåŠ¡æ¶ˆè´¹è€…ç«¯è°ƒç”¨1234@RequestMapping(value = \"/test\", method = RequestMethod.GET) public String hello(@RequestParam(\"name\") String name, @RequestParam(\"age\") int age) &#123; return userFeignService.hello(name, age); &#125; æœåŠ¡æä¾›è€…Controllerå¯¹å¤–æœåŠ¡1234@RequestMapping(value = \"/hello\", method = RequestMethod.GET) public String hello(@RequestParam(\"name\") String name, @RequestParam(\"age\") int age) &#123; return name + age; &#125; Feginå®¢æˆ·ç«¯å®šä¹‰è°ƒç”¨12@RequestMapping(value = \"/hello\", method = RequestMethod.GET) public String hello(String name, @RequestParam(\"age\") int age); å¯åŠ¨çš„æ—¶å€™sc-fegin-first-consumerå·¥ç¨‹ä¸æŠ¥é”™ã€‚ä½†æ˜¯å½“è®¿é—®http://localhost:8010/test?name=xujin&amp;age=25 ,æŠ¥é”™å¦‚ä¸‹123feign.FeignException: status 405 reading UserFeignService#hello(String,int); content:&#123;&quot;timestamp&quot;:1494856464666,&quot;status&quot;:405,&quot;error&quot;:&quot;Method Not Allowed&quot;,&quot;exception&quot;:&quot;org.springframework.web.HttpRequestMethodNotSupportedException&quot;,&quot;message&quot;:&quot;Request method &apos;POST&apos; not supported&quot;,&quot;path&quot;:&quot;/hello&quot;&#125; at feign.FeignException.errorStatus(FeignException.java:62) ~[feign-core-9.3.1.jar:na] Feginå®¢æˆ·ç«¯å®šä¹‰ä¿®æ”¹å¦‚ä¸‹OKï¼ŒåŸå› æ˜¯nameè¢«è‡ªåŠ¨æ”¾åˆ°request bodyã€‚åªè¦æœ‰bodyï¼Œå°±ä¼šè¢«feignè®¤ä¸ºæ˜¯postè¯·æ±‚ï¼Œæ‰€ä»¥æ•´ä¸ªhelloæ˜¯è¢«å½“ä½œå¸¦æœ‰request parameterå’Œbodyçš„postè¯·æ±‚å‘é€å‡ºå»äº†ï¼Œå› æ­¤å‡ºç°ä¸Šé¢çš„é”™è¯¯æç¤ºã€‚ 12@RequestMapping(value = \"/hello\", method = RequestMethod.GET) public String hello(@RequestParam(\"name\") String name, @RequestParam(\"age\") int age); POSTå¤šå‚æ•°è°ƒç”¨ POSTå¤šå‚æ•° Feignç«¯å®šä¹‰ï¼š 12@RequestMapping(value = \"/test/post\", method = RequestMethod.POST)public OrderModel post(OrderModel orderModel); 12@RequestMapping(value = \"/test/post\", method = RequestMethod.POST)public OrderModel post(@RequestBody OrderModel orderModel); ä»¥ä¸Šä¸¤ç§å®šä¹‰æ–¹å¼ç­‰ä»· æœåŠ¡æä¾›è€…çš„å®šä¹‰ 12345@PostMapping(\"/test/post\")public OrderModel testPost(@RequestBody OrderModel orderModel) &#123; orderModel.setOrderNo(2222222L); return orderModel;&#125; ä¿®æ”¹è®¢å•å·è¿”å›è¯æ˜ï¼ŒæœåŠ¡æä¾›è€…æ¥åˆ°ä»Feign POSTè¯·æ±‚è¿‡æ¥çš„æ•°æ®ã€‚ æœåŠ¡æ¶ˆè´¹è€…ç«¯çš„ä½¿ç”¨ 1234@PostMapping(\"/test/post\")public OrderModel testPost(@RequestBody OrderModel orderModel) &#123; return userFeignService.post(orderModel);&#125; æµ‹è¯•å½“ä¿®æ”¹äº†Feigné»˜è®¤çš„http Clientä¹‹åï¼Œå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå…·ä½“å‡ºé”™åŸå› è¿˜åœ¨æ’æŸ¥ä¹‹ä¸­ï¼Œæœ¬æ–‡ä¼šéšæ—¶æ›´æ”¹ã€‚ã€é—®é¢˜äºŒã€‘æ›´æ¢äº†Feigné»˜è®¤çš„Clientå‡ºç°HystrixRuntimeException12345678&#123; \"timestamp\": 1494947172990, \"status\": 500, \"error\": \"Internal Server Error\", \"exception\": \"com.netflix.hystrix.exception.HystrixRuntimeException\", \"message\": \"UserFeignService#post(OrderModel) failed and no fallback available.\", \"path\": \"/test/post\"&#125; 1234567java.lang.IllegalArgumentException: MIME type may not contain reserved characters at org.apache.http.util.Args.check(Args.java:36) ~[httpcore-4.4.5.jar:4.4.5] at org.apache.http.entity.ContentType.create(ContentType.java:182) ~[httpcore-4.4.5.jar:4.4.5] at feign.httpclient.ApacheHttpClient.getContentType(ApacheHttpClient.java:159) ~[feign-httpclient-8.17.0.jar:8.17.0] at feign.httpclient.ApacheHttpClient.toHttpUriRequest(ApacheHttpClient.java:140) ~[feign-httpclient-8.17.0.jar:8.17.0] at feign.httpclient.ApacheHttpClient.execute(ApacheHttpClient.java:83) ~[feign-httpclient-8.17.0.jar:8.17.0] å½“å…³é—­ä¹‹åï¼Œè®¿é—®æ­£å¸¸å¦‚ä¸‹æ‰€ç¤ºï¼Œé†‰äº†åŒæ ·çš„ä»£ç (PS:æ‚è„¸) 123feign: httpclient: enabled: false 1&#123;\"createTime\":1494944311023,\"orderNo\":33333,\"payTime\":1494944311023&#125; GETå¤šå‚æ•°è°ƒç”¨å½“æœåŠ¡ä¹‹é—´GETè°ƒç”¨ä¸ºå¤šå‚æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Mapæ¥æ„å»ºå‚æ•°ä¼ é€’Feignæ¥å£ä¸­çš„ç¤ºä¾‹å®šä¹‰12@RequestMapping(value = \"/test/get\", method = RequestMethod.GET)public String testGet(@RequestParam Map&lt;String, Object&gt; map); æœåŠ¡æ¶ˆè´¹è€…çš„è°ƒç”¨ 12345678@GetMapping(\"/test/get\")public String testGet() &#123; HashMap&lt;String, Object&gt; map = Maps.newHashMap(); map.put(\"orderNo\", \"1\"); map.put(\"createTime\", new Date()); map.put(\"payTime\", new Date()); return userFeignService.testGet(map);&#125; ä¸ªäººçœ‹æ¥ï¼Œå¦‚æœæ˜¯GETçš„å¤šå‚æ•°é€šè¿‡Mapè¿›è¡Œä¼ é€’ï¼Œå½“å‚æ•°æ¯”è¾ƒå¤šæ—¶ï¼Œä¸ªäººå»ºè®®ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´ï¼Œé€šè¿‡POSTçš„æ–¹å¼ä¼ é€’å¯¹è±¡ç›¸å¯¹è¾ƒå¥½ã€‚ æœåŠ¡æä¾›è€…çš„ä½¿ç”¨ 1234@RequestMapping(value = \"/test/get\", method = RequestMethod.GET)public String testGet(@RequestParam Map&lt;String, Object&gt; map) &#123; return String.valueOf(map);&#125; è®¿é—®URL:http://localhost:8010/test/get ,æµ‹è¯•OK. 1&#123;orderNo=1, createTime=Sat May 20 19:47:38 CST 2017, payTime=Sat May 20 19:47:38 CST 2017&#125; æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Feignçš„åŸºæœ¬çš„å®šä¹‰ï¼Œä»¥åŠFeignçš„workåŸç†å’Œä½¿ç”¨Feignçš„æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜ã€‚æœ€åä»‹ç»äº†ä¸€ä¸‹æ›´æ¢Feigné»˜è®¤ä½¿ç”¨çš„HTTP Clientã€‚ä¸»è¦æ˜¯é‡åˆ°ä¸€ä¸ªå¥‡è‘©çš„é—®é¢˜ï¼Œæœ€ç»ˆæ²¡è§£å†³æ›´æ¢ç‰ˆæœ¬ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°†ä»‹ç»Feignçš„å…¶å®ƒçš„ä½¿ç”¨ï¼Œä¾‹å¦‚Feignçš„ç»§æ‰¿ï¼Œæ—¥å¿—çº§åˆ«ï¼Œä»¥åŠFeignæºç åˆ†æç­‰ å‚è€ƒæ–‡çŒ®å¸Œæœ›Feignèƒ½å¤Ÿæ”¯æŒå‚æ•°è¯·æ±‚ä½¿ç”¨POJOçš„Issueå»ºè®®ä½¿ç”¨FeignåŸç”Ÿçš„æ³¨è§£çš„Issueå»ºè®®å¢å¼ºFeignçš„åŠŸèƒ½å»ºè®®æ”¯æŒå¯é€‰çš„Request Bodyï¼ˆç›®å‰Feignå½“POSTä¸€ä¸ªnullæ—¶ï¼Œä¼šæŠ¥å¼‚å¸¸ï¼‰","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Fegin","slug":"Spring-Cloud-Fegin","permalink":"http://xujin.org/tags/Spring-Cloud-Fegin/"}]},{"title":"Java8ç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§-å‚æ•°åå­—ä¿ç•™åœ¨å­—èŠ‚ç ä¸­","slug":"ex/jdk8-parameters","date":"2017-04-25T06:00:00.000Z","updated":"2019-01-13T05:21:03.596Z","comments":true,"path":"ex/jdk8-parameters/","link":"","permalink":"http://xujin.org/ex/jdk8-parameters/","excerpt":"æ‘˜è¦:å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼ŒJavaç¨‹åºå‘˜ä¸€ç›´åœ¨å‘æ˜ä¸åŒçš„æ–¹å¼ä½¿å¾—æ–¹æ³•å‚æ•°çš„åå­—èƒ½ä¿ç•™åœ¨Javaå­—èŠ‚ç ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è·å–å®ƒä»¬ï¼ˆæ¯”å¦‚ï¼ŒParanamerç±»åº“ï¼‰ã€‚æœ€ç»ˆï¼Œåœ¨Java 8ä¸­æŠŠè¿™ä¸ªå¼ºçƒˆè¦æ±‚çš„åŠŸèƒ½æ·»åŠ åˆ°è¯­è¨€å±‚é¢ï¼ˆé€šè¿‡åå°„APIä¸Parameter.getName()æ–¹æ³•ï¼‰ä¸å­—èŠ‚ç æ–‡ä»¶ï¼ˆé€šè¿‡æ–°ç‰ˆçš„javacçš„â€“parametersé€‰é¡¹ï¼‰ä¸­ã€‚ç”±äºä¸­é—´ä»¶æ¡†æ¶ä½¿ç”¨jdk8çš„æ–°ç‰¹æ€§checkå‚æ•°é¡ºåºå’Œç­¾åï¼Œå› æ­¤åœ¨ä½¿ç”¨RPCæ¡†æ¶ä¸­ï¼ŒRPCæœåŠ¡ç«¯æ¥å£å®šä¹‰ç¼–è¯‘åçš„Classæ–‡ä»¶ä¸­åŠ å…¥äº†å‚æ•°,ä½†æ˜¯åœ¨webAppä¸­ä½¿ç”¨RPC Clientåœ¨Eclipseç­‰IDEä¸­å¼€å‘è°ƒè¯•ï¼Œç”±äºç”Ÿæˆclassçš„æ—¶å€™Ideä¸ä¼šè‡ªåŠ¨å‚æ•°å¸¦è¿›å»ã€‚å› æ­¤éœ€è¦å¯¹IDEè¿›è¡Œè®¾ç½®ã€‚ Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§å‚æ•°åå­—å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼ŒJavaç¨‹åºå‘˜ä¸€ç›´åœ¨å‘æ˜ä¸åŒçš„æ–¹å¼ä½¿å¾—æ–¹æ³•å‚æ•°çš„åå­—èƒ½ä¿ç•™åœ¨Javaå­—èŠ‚ç ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è·å–å®ƒä»¬ï¼ˆæ¯”å¦‚ï¼ŒParanamerç±»åº“ï¼‰ã€‚æœ€ç»ˆï¼Œåœ¨Java 8ä¸­æŠŠè¿™ä¸ªå¼ºçƒˆè¦æ±‚çš„åŠŸèƒ½æ·»åŠ åˆ°è¯­è¨€å±‚é¢ï¼ˆé€šè¿‡åå°„APIä¸Parameter.getName()æ–¹æ³•ï¼‰ä¸å­—èŠ‚ç æ–‡ä»¶ï¼ˆé€šè¿‡æ–°ç‰ˆçš„javacçš„â€“parametersé€‰é¡¹ï¼‰ä¸­ã€‚123456789101112131415161718package org.xujin.jdk.parameter;import java.lang.reflect.Method;import java.lang.reflect.Parameter;/** * @author xujin */public class ParameterNames &#123; public static void main(String[] args) throws Exception &#123; Method method = ParameterNames.class.getMethod(\"main\", String[].class); for (final Parameter parameter : method.getParameters()) &#123; System.out.println(\"Parameter: \" + parameter.getName()); &#125; &#125;&#125;","text":"æ‘˜è¦:å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼ŒJavaç¨‹åºå‘˜ä¸€ç›´åœ¨å‘æ˜ä¸åŒçš„æ–¹å¼ä½¿å¾—æ–¹æ³•å‚æ•°çš„åå­—èƒ½ä¿ç•™åœ¨Javaå­—èŠ‚ç ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è·å–å®ƒä»¬ï¼ˆæ¯”å¦‚ï¼ŒParanamerç±»åº“ï¼‰ã€‚æœ€ç»ˆï¼Œåœ¨Java 8ä¸­æŠŠè¿™ä¸ªå¼ºçƒˆè¦æ±‚çš„åŠŸèƒ½æ·»åŠ åˆ°è¯­è¨€å±‚é¢ï¼ˆé€šè¿‡åå°„APIä¸Parameter.getName()æ–¹æ³•ï¼‰ä¸å­—èŠ‚ç æ–‡ä»¶ï¼ˆé€šè¿‡æ–°ç‰ˆçš„javacçš„â€“parametersé€‰é¡¹ï¼‰ä¸­ã€‚ç”±äºä¸­é—´ä»¶æ¡†æ¶ä½¿ç”¨jdk8çš„æ–°ç‰¹æ€§checkå‚æ•°é¡ºåºå’Œç­¾åï¼Œå› æ­¤åœ¨ä½¿ç”¨RPCæ¡†æ¶ä¸­ï¼ŒRPCæœåŠ¡ç«¯æ¥å£å®šä¹‰ç¼–è¯‘åçš„Classæ–‡ä»¶ä¸­åŠ å…¥äº†å‚æ•°,ä½†æ˜¯åœ¨webAppä¸­ä½¿ç”¨RPC Clientåœ¨Eclipseç­‰IDEä¸­å¼€å‘è°ƒè¯•ï¼Œç”±äºç”Ÿæˆclassçš„æ—¶å€™Ideä¸ä¼šè‡ªåŠ¨å‚æ•°å¸¦è¿›å»ã€‚å› æ­¤éœ€è¦å¯¹IDEè¿›è¡Œè®¾ç½®ã€‚ Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§å‚æ•°åå­—å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼ŒJavaç¨‹åºå‘˜ä¸€ç›´åœ¨å‘æ˜ä¸åŒçš„æ–¹å¼ä½¿å¾—æ–¹æ³•å‚æ•°çš„åå­—èƒ½ä¿ç•™åœ¨Javaå­—èŠ‚ç ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è·å–å®ƒä»¬ï¼ˆæ¯”å¦‚ï¼ŒParanamerç±»åº“ï¼‰ã€‚æœ€ç»ˆï¼Œåœ¨Java 8ä¸­æŠŠè¿™ä¸ªå¼ºçƒˆè¦æ±‚çš„åŠŸèƒ½æ·»åŠ åˆ°è¯­è¨€å±‚é¢ï¼ˆé€šè¿‡åå°„APIä¸Parameter.getName()æ–¹æ³•ï¼‰ä¸å­—èŠ‚ç æ–‡ä»¶ï¼ˆé€šè¿‡æ–°ç‰ˆçš„javacçš„â€“parametersé€‰é¡¹ï¼‰ä¸­ã€‚123456789101112131415161718package org.xujin.jdk.parameter;import java.lang.reflect.Method;import java.lang.reflect.Parameter;/** * @author xujin */public class ParameterNames &#123; public static void main(String[] args) throws Exception &#123; Method method = ParameterNames.class.getMethod(\"main\", String[].class); for (final Parameter parameter : method.getParameters()) &#123; System.out.println(\"Parameter: \" + parameter.getName()); &#125; &#125;&#125; å¦‚æœä¸ä½¿ç”¨â€“parameterså‚æ•°æ¥ç¼–è¯‘è¿™ä¸ªç±»ï¼Œç„¶åè¿è¡Œè¿™ä¸ªç±»ï¼Œä¼šå¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š1Parameter: arg0 å¦‚æœä½¿ç”¨â€“parameterså‚æ•°æ¥ç¼–è¯‘è¿™ä¸ªç±»ï¼Œç¨‹åºçš„ç»“æ„ä¼šæœ‰æ‰€ä¸åŒï¼ˆå‚æ•°çš„çœŸå®åå­—å°†ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼‰ï¼š1Parameter: args Mavenå’ŒGradleä½¿ç”¨æ–¹å¼Mavenä½¿ç”¨ä»‹ç»å¯¹äºæœ‰ç»éªŒçš„Mavenç”¨æˆ·ï¼Œé€šè¿‡maven-compiler-pluginçš„é…ç½®å¯ä»¥å°†-parameterså‚æ•°æ·»åŠ åˆ°ç¼–è¯‘å™¨ä¸­å»ã€‚12345678910&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;compilerArgument&gt;-parameters&lt;/compilerArgument&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt;&lt;/plugin&gt; é’ˆå¯¹Java 8æœ€æ–°å‘å¸ƒçš„Eclipse Kepler SR2ï¼ˆè¯·æ£€æŸ¥è¿™é‡Œçš„ä¸‹è½½è¯´æ˜ï¼‰æä¾›äº†éå¸¸å®ç”¨çš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡ä¸‹å›¾çš„é…ç½®æ–¹å¼æ¥æ§åˆ¶ç¼–è¯‘å™¨è¡Œä¸º Gradleä½¿ç”¨ä»‹ç»åœ¨build.gradleä¸­é…ç½®å¦‚ä¸‹å³å¯1234567compileJava &#123; sourceCompatibility = 1.8 targetCompatibility = 1.8 options.compilerArgs &lt;&lt; &apos;-parameters&apos; options.fork = true options.forkOptions.executable = &apos;javac&apos;&#125; åœ¨IDEä¸­çš„é…ç½® æœ‰ä¸€ç§æƒ…å†µéœ€è¦IDEç¼–è¾‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œéœ€è¦é IDEè‡ªåŠ¨çš„æŠŠå‚æ•°ç­‰ä¿¡æ¯åŠ åˆ°classæ–‡ä»¶ä¸­ã€‚ Eclipseä¸­çš„é…ç½® ä½¿ç”¨Eclipseè¿›è¡Œæœ¬åœ°è°ƒè¯•æ—¶ï¼Œéœ€è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š Preferences -&gt; Java -&gt; Compiler JDK Compiliance -&gt; â€œCompiler compliance levelâ€è®¾ç½®ä¸º1.8 Classfile Generation -&gt; â€œStore information about method parameters (usable via reflection)â€è®¾ç½®ä¸ºå‹¾é€‰ åœ¨IdeAä¸­çš„é…ç½® ä½¿ç”¨IDEAè¿›è¡Œæœ¬åœ°è°ƒè¯•æ—¶ï¼Œéœ€è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š Preferences -&gt; â€œBuild, Execution, Deploymentâ€ -&gt; Compiler -&gt; â€œJava Compilerâ€ â€œProject bytecode versionâ€è®¾ç½®ä¸º1.8 â€œAdditional command line parametersâ€æ·»åŠ â€-parametersâ€","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]},{"title":"Elastic Search javaå®¢æˆ·ç«¯å°è£…ä½¿ç”¨","slug":"ex/es-client","date":"2017-04-21T06:00:00.000Z","updated":"2019-01-13T05:19:31.540Z","comments":true,"path":"ex/es-client/","link":"","permalink":"http://xujin.org/ex/es-client/","excerpt":"æ‘˜è¦:ESæ‰€æä¾›çš„HttpæœåŠ¡é€‚åˆç”¨ä½œé›†ç¾¤çŠ¶æ€å’Œæ•°æ®çš„ç›‘æ§ï¼Œè€Œä¸é€‚åˆç›´æ¥ç”¨äºæ•°æ®æ“ä½œã€‚ESæä¾›äº†å¤šç§è¯­è¨€ï¼ˆåŒ…æ‹¬Javaã€Pythonã€PHPã€Rubyç­‰ï¼‰ç‰ˆæœ¬çš„Client APIï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›Client APIç¼–ç¨‹å®ç°æ•°æ®æ“ä½œåŠŸèƒ½ã€‚åœ¨è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨Javaç‰ˆæœ¬çš„Clientæ¥æ“ä½œæ•°æ®ã€‚ESä¸­æ‰€æœ‰çš„Java APIè°ƒç”¨éƒ½è¦ä½¿ç”¨Clientå¯¹è±¡ï¼ŒESä¸ºAPIè°ƒç”¨è€…æä¾›äº†ä¸¤ç±»Clientå¯¹è±¡ï¼šNodeClientå’ŒTransportClientã€‚TransportClienté€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»TransportClientã€‚ ä½¿ç”¨TransportClientè¿æ¥ESä½¿ç”¨elastic search Client ä¸º5.2.2ç‰ˆæœ¬ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ã€‚12345&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;transport&lt;/artifactId&gt; &lt;version&gt;5.2.2&lt;/version&gt;&lt;/dependency&gt; Tips: å»ºè®®APIçš„ç‰ˆæœ¬ä¸ESé›†ç¾¤æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œä»¥å…å‡ºç°å› ç‰ˆæœ¬ä¸ä¸€è‡´è€Œå¯¼è‡´çš„å†²çªã€‚ç”±äºorg.elasticsearch.clientä¾èµ–Log4jï¼Œå› æ­¤è¿˜éœ€è¦é…ç½®å¦‚ä¸‹ä¾èµ–","text":"æ‘˜è¦:ESæ‰€æä¾›çš„HttpæœåŠ¡é€‚åˆç”¨ä½œé›†ç¾¤çŠ¶æ€å’Œæ•°æ®çš„ç›‘æ§ï¼Œè€Œä¸é€‚åˆç›´æ¥ç”¨äºæ•°æ®æ“ä½œã€‚ESæä¾›äº†å¤šç§è¯­è¨€ï¼ˆåŒ…æ‹¬Javaã€Pythonã€PHPã€Rubyç­‰ï¼‰ç‰ˆæœ¬çš„Client APIï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›Client APIç¼–ç¨‹å®ç°æ•°æ®æ“ä½œåŠŸèƒ½ã€‚åœ¨è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨Javaç‰ˆæœ¬çš„Clientæ¥æ“ä½œæ•°æ®ã€‚ESä¸­æ‰€æœ‰çš„Java APIè°ƒç”¨éƒ½è¦ä½¿ç”¨Clientå¯¹è±¡ï¼ŒESä¸ºAPIè°ƒç”¨è€…æä¾›äº†ä¸¤ç±»Clientå¯¹è±¡ï¼šNodeClientå’ŒTransportClientã€‚TransportClienté€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»TransportClientã€‚ ä½¿ç”¨TransportClientè¿æ¥ESä½¿ç”¨elastic search Client ä¸º5.2.2ç‰ˆæœ¬ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ã€‚12345&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;transport&lt;/artifactId&gt; &lt;version&gt;5.2.2&lt;/version&gt;&lt;/dependency&gt; Tips: å»ºè®®APIçš„ç‰ˆæœ¬ä¸ESé›†ç¾¤æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œä»¥å…å‡ºç°å› ç‰ˆæœ¬ä¸ä¸€è‡´è€Œå¯¼è‡´çš„å†²çªã€‚ç”±äºorg.elasticsearch.clientä¾èµ–Log4jï¼Œå› æ­¤è¿˜éœ€è¦é…ç½®å¦‚ä¸‹ä¾èµ– 12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.7&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.7&lt;/version&gt;&lt;/dependency&gt; Tips https://www.elastic.co/guide/en/elasticsearch/client/java-api/5.2/_maven_repository.html å°è£…ES Clientå·¥å…·ç±»1.åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠESçš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼ŒæŠ½å–åˆ°elasticsearch.yamlä¸­ 12345port: 9300#address: \"192.168.67.200,192.168.67.149,192.168.67.215,192.168.67.156,192.168.67.178,192.168.67.240,192.168.67.153,192.168.67.90,192.168.67.228,192.168.67.125\"address: \"192.168.113.250\"cluster: \"elasticsearch\"index: \"mt-apm-*\" æ ¹æ®Java SDKçš„å†™æ³•ï¼Œéœ€è¦åšå†™å¦‚ä¸‹ç¡¬ç¼–ç æ“ä½œçš„Codeã€‚1234567891011121314151617181920212223String deviceId = \"23566d22-6a30-30a9-a874-e1bf75ab688b\"; Settings settings =Settings.builder().put(\"cluster.name\",\"vpc-ops-elk-elastic-cluster\").build(); Client client = new PreBuiltTransportClient(settings) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.200\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.149\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.215\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.156\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.178\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.240\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.153\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.90\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.228\"), 9300)) .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"192.168.67.125\"), 9300)); QueryBuilder qb = matchQuery( \"@message.deviceInfo.deviceId\", deviceId ); SearchResponse response = client.prepareSearch(\"mt-apm-*\") .setQuery(qb) .execute() .actionGet(); System.out.println(response); client.close(); ä¸Šè¿°å†™æ³•å­˜åœ¨å¾ˆå¤šç¡¬ç¼–ç ï¼Œæ— æ³•åšåˆ°é…ç½®å’Œç¨‹åºä»£ç åˆ†ç¦»ï¼Œå› æ­¤éœ€è¦è®¾è®¡ä¸€ä¸ªESå·¥å…·ç±»ç”¨äºç”Ÿæˆè°ƒç”¨Client,ä¸‹é¢ESClientHelperå·¥å…·ç±»å¦‚ä¸‹ã€‚ è®¾è®¡ESClientHelperESClientHelper.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384/** * * ESClientHelper æŒ‰ç…§Elasticsearch APIï¼Œåœ¨Javaç«¯ä½¿ç”¨æ˜¯ESæœåŠ¡éœ€è¦åˆ›å»ºJava * Clientï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è¿æ¥éƒ½å®ä¾‹åŒ–ä¸€ä¸ªclientï¼Œå¯¹ç³»ç»Ÿçš„æ¶ˆè€—å¾ˆå¤§ï¼Œ å³ä½¿åœ¨ä½¿ç”¨å®Œæ¯•ä¹‹åå°†client * closeæ‰ï¼Œç”±äºæœåŠ¡å™¨ä¸èƒ½åŠæ—¶å›æ”¶socketèµ„æºï¼Œæç«¯æƒ…å†µä¸‹ä¼šå¯¼è‡´æœåŠ¡å™¨è¾¾åˆ°æœ€å¤§è¿æ¥æ•°ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜å¹¶æé«˜clientåˆ©ç”¨ç‡ï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨æ± åŒ–æŠ€æœ¯å¤ç”¨clientã€‚ * * @author xujin * */public class ESClientHelper &#123; private static final Log logger = LogFactory.getLog(ESClientHelper.class); private static ESClientHelper instance; private Settings setting; private Map&lt;String, Client&gt; clientMap = new ConcurrentHashMap&lt;String, Client&gt;(); // HostNameä¸Port private Map&lt;String, Integer&gt; ips = new HashMap&lt;String, Integer&gt;(); private String clusterName = Configs.ES_CONFIG.getCluster(); public static synchronized ESClientHelper getInstance() &#123; if (instance == null) &#123; instance = new ESClientHelper(); &#125; return instance; &#125; private ESClientHelper() &#123; init(); &#125; /** * åˆå§‹åŒ–é»˜è®¤çš„client */ public void init() &#123; String address = Configs.ES_CONFIG.getAddress(); if (StringUtils.isNotEmpty(address)) &#123; StringTokenizer stokenizer = new StringTokenizer(address, \",\"); while (stokenizer.hasMoreTokens()) &#123; String ip = stokenizer.nextToken(); ips.put(ip, Configs.ES_CONFIG.getPort()); &#125; &#125; setting = Settings.builder().put(\"cluster.name\", Configs.ES_CONFIG.getCluster()).build(); addClient(setting, getAllAddress(ips)); &#125; /** * è·å¾—æ‰€æœ‰çš„åœ°å€ç«¯å£ * * @return */ public List&lt;InetSocketTransportAddress&gt; getAllAddress(Map&lt;String, Integer&gt; ips) &#123; List&lt;InetSocketTransportAddress&gt; addressList = new ArrayList&lt;InetSocketTransportAddress&gt;(); for (String ip : ips.keySet()) &#123; try &#123; addressList.add(new InetSocketTransportAddress(InetAddress.getByName(ip), ips.get(ip))); &#125; catch (UnknownHostException e) &#123; logger.error(\" add InetSocketTransportAddress exception:[&#123;&#125;],ip:[&#123;&#125;]\", e.getMessage(), ip); &#125; &#125; return addressList; &#125; public Client getClient() &#123; return getClient(clusterName); &#125; public Client getClient(String clusterName) &#123; return clientMap.get(clusterName); &#125; public void addClient(Settings setting, List&lt;InetSocketTransportAddress&gt; transportAddress) &#123; Client client = new PreBuiltTransportClient(setting).addTransportAddresses( transportAddress.toArray(new InetSocketTransportAddress[transportAddress.size()])); clientMap.put(setting.get(\"cluster.name\"), client); &#125;&#125; ç›¸å¯¹äº java API 2.4.4 ç‰ˆæœ¬æ¥è¯´ï¼Œå‡çº§ä¾èµ–ä¹‹åï¼Œéœ€è¦åšå¦‚ä¸‹æ”¹åŠ¨ã€‚å°†ä¸‹é¢çš„ä»£ç ä¿®æ”¹ä¸Šè¿°ä¸­çš„ä»£ç ã€‚12Client client = TransportClient.builder().settings(setting).build().addTransportAddresses( transportAddress.toArray(new InetSocketTransportAddress[transportAddress.size()])); ä½¿ç”¨ESClientHelperä½¿ç”¨ESClientHelper.getInstance()è·å–ESClient1Client client = ESClientHelper.getInstance().getClient(Configs.ES_CONFIG.getCluster()); 1.åŒ¹é…æŸ¥è¯¢123456789Client client = ESClientHelper.getInstance().getClient(Configs.ES_CONFIG.getCluster()); String index = Configs.ES_CONFIG.getIndex(); QueryBuilder qb = matchQuery(\"@message.deviceInfo.deviceId\", deviceId); SearchResponse response = client .prepareSearch(index).setQuery(qb) .setPostFilter( QueryBuilders.rangeQuery(\"@message.apmLog.network.time.beginTime\") .gte(DateUtils.StringToDate(beginTime)).lte(DateUtils.StringToDate(endTime))) .execute().actionGet(); 2.æ ¹æ®æ—¶é—´æ®µèšåˆæŸ¥è¯¢123456789101112131415161718192021222324252627282930313233343536373839404142434445@Override public AppReqHistoryInfo getAppReqHistoryInfoByDeviceIdAndTime(String deviceId, int hourNum) throws ServiceException &#123; String day = \"now-\" + String.valueOf(hourNum) + \"h\"; String index = Configs.ES_CONFIG.getIndex(); Client client = ESClientHelper.getInstance().getClient(Configs.ES_CONFIG.getCluster()); QueryBuilder qb = matchQuery(\"@message.deviceInfo.deviceId\", deviceId); MultiSearchRequestBuilder req = client.prepareMultiSearch().add(client.prepareSearch(index) .setPostFilter(boolQuery().must(qb).must(QueryBuilders.rangeQuery(\"@timestamp\").gt(day).lt(\"now\"))) .addAggregation(AggregationBuilders.sum(\"REQ_SUM\").field(\"@message.apmLog.network.reqLength\")) .addAggregation(AggregationBuilders.sum(\"RSP_SUM\").field(\"@message.apmLog.network.complete.respLength\")) .setSize(0)) .add(client.prepareSearch(index) .setPostFilter( boolQuery().must(qb).must(QueryBuilders.rangeQuery(\"@timestamp\").gt(day).lt(\"now\")) .must(QueryBuilders.rangeQuery(\"@message.apmLog.network.complete.statusCode\") .gt(399).lt(999))) .setSize(0)) .add(client.prepareSearch(index).setPostFilter( boolQuery().must(qb).must(QueryBuilders.rangeQuery(\"@timestamp\").gt(day).lt(\"now\")) .must(QueryBuilders.existsQuery(\"@message.apmLog.network.netError.errorDomain\"))) .setSize(0)); AppReqHistoryInfo appReqHisInfo = new AppReqHistoryInfo(); MultiSearchResponse rsp; try &#123; rsp = req.execute().get(); MultiSearchResponse.Item[] items = rsp.getResponses(); MultiSearchResponse.Item totalItem = items[0]; long total = totalItem.getResponse().getHits().getTotalHits(); appReqHisInfo.setRequestNum(total); Double REQ_SUM = (Double) (totalItem.getResponse().getAggregations().get(\"REQ_SUM\").getProperty(\"value\")); Double RSP_SUM = (Double) (totalItem.getResponse().getAggregations().get(\"RSP_SUM\").getProperty(\"value\")); Double totalFlow = REQ_SUM + RSP_SUM; appReqHisInfo.setTotalFlow(totalFlow.longValue()); MultiSearchResponse.Item statusCodeItem = items[1]; appReqHisInfo.setHttpError(statusCodeItem.getResponse().getHits().getTotalHits()); MultiSearchResponse.Item errorDomainItem = items[2]; appReqHisInfo.setNetError(errorDomainItem.getResponse().getHits().getTotalHits()); &#125; catch (InterruptedException | ExecutionException e) &#123; logger.info(\"getAppReqHistoryInfoByDeviceIdAndTime exception:[&#123;&#125;]\", e.getMessage()); throw new ServiceException(\"500\", \"getAppVisitTraceInfo exception\", e.getCause()); &#125; return appReqHisInfo; &#125;","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]},{"title":"SCä¸­Eureka Serverçš„HAå’Œå®‰å…¨èº«ä»½éªŒè¯","slug":"sc/sc-eureka-02","date":"2017-03-25T06:00:00.000Z","updated":"2019-01-12T03:48:16.249Z","comments":true,"path":"sc/sc-eureka-02/","link":"","permalink":"http://xujin.org/sc/sc-eureka-02/","excerpt":"æ‘˜è¦:åœ¨ã€Šè·Ÿæˆ‘å­¦Spring Cloudã€‹ä¸­çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç®€å•ä»‹ç»äº†ä½¿ç”¨Eurekaå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦ä»‹ç»ä¸€ä¸‹Eureka Serveræ³¨å†Œä¸­å¿ƒçš„HAä»¥åŠEureka Serverçš„èº«ä»½éªŒè¯ã€‚","text":"æ‘˜è¦:åœ¨ã€Šè·Ÿæˆ‘å­¦Spring Cloudã€‹ä¸­çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç®€å•ä»‹ç»äº†ä½¿ç”¨Eurekaå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦ä»‹ç»ä¸€ä¸‹Eureka Serveræ³¨å†Œä¸­å¿ƒçš„HAä»¥åŠEureka Serverçš„èº«ä»½éªŒè¯ã€‚ ä»€ä¹ˆæ˜¯é«˜å¯ç”¨é«˜å¯ç”¨ High Availabilityï¼Œå³é«˜å¯ç”¨HAã€‚åœ¨åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç»å¸¸è¯´4ä¸ª9(99.99%)æˆ–è€…5ä¸ª9(99.999%)ã€‚ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªå¾®æœåŠ¡åˆ†å¸ƒå¼ç³»ç»Ÿä¾èµ–äº30ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡å¯ç”¨æ€§æ˜¯99.99%ï¼Œé‚£ä¹ˆæ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿçš„å¯ç”¨æ€§å°±æ˜¯99.99%çš„30æ¬¡æ–¹ â‰ˆ 99.7% ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰0.3%ç³»ç»Ÿæ˜¯ä¸å¯ç”¨çš„ï¼Œ0.3%æ„å‘³ç€å¦‚æœQpså¾ˆé«˜ï¼Œæœ‰ä¸€äº¿æ¬¡è¯·æ±‚çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰30ä¸‡æ¬¡å¤±è´¥ã€‚æ¢ç®—æˆæ—¶é—´å¤§çº¦æ¯æœˆæœ‰2ä¸ªå°æ—¶æœåŠ¡ä¸ç¨³å®šã€‚ç‰¹åˆ«æ˜¯éšç€æœåŠ¡ä¾èµ–æ•°é‡çš„å˜å¤šï¼Œå¾®æœåŠ¡ä¸ç¨³å®šçš„æ¦‚ç‡ä¼šæˆæŒ‡æ•°æ€§ä¸Šå‡ã€‚å› æ­¤è¦ä¿è¯å¾®æœåŠ¡åº”ç”¨çš„HAéœ€è¦ä»å„æ–¹é¢å…¥æ‰‹ï¼Œä¸‹é¢ä¼šä»‹ç»ä¸€ä¸‹å¦‚ä½•å®ç°Eureka Serverçš„HAã€‚å‚è€ƒå·¥ç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚ Tipsï¼šä»£ç ç¤ºä¾‹:https://github.com/SoftwareKing/spring-cloud-study/tree/master/sc-eureka-ha Eureka Serverçš„HAEureka Serverçš„HAä¸¤ä¸ªå·¥ç¨‹æ¼”ç¤ºHA å¦‚ç¤ºä¾‹å·¥ç¨‹æ‰€ç¤ºï¼Œæˆ‘æ–°å»ºäº†ä¸¤ä¸ªProjectåˆ†åˆ«ä¸ºsc-eureka-ha-server1ï¼Œsc-eureka-ha-server2ï¼Œ æˆ‘ä»¬çŸ¥é“åœ¨Eureka Serverçš„Standaloneæ¨¡å¼ä¸‹é¢ï¼Œç”±äºåªæœ‰ä¸€ä¸ªEureka Serverï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡é…ç½®å¦‚ä¸‹ä¿¡æ¯å…³é—­Eureka Serverçš„è‡ªæˆ‘æ³¨å†Œå’ŒæŠ“å–æ³¨å†Œä¿¡æ¯ï¼Œä½†æ˜¯ä¸¤ä¸ªEureka Serverä¹‹é—´éœ€è¦è®¾ç½®ä¸ºTrueï¼Œç›¸äº’æ³¨å†Œç›¸äº’æ„ŸçŸ¥å¯¹æ–¹æ³¨å†Œä¿¡æ¯çš„å˜åŒ–ï¼Œä»è€Œå®ç°ä¿¡æ¯åŒæ­¥ã€‚ 1.sc-eureka-ha-server1çš„application.ymlé…ç½®Info å¦‚ä¸‹ï¼š 123456789spring: application: name: sc-eureka-ha-server1server: port: 8761 # æŒ‡å®šè¯¥Eurekaå®ä¾‹çš„ç«¯å£eureka: client: serviceUrl: defaultZone: http://localhost:8762/eureka/ 2.sc-eureka-ha-server2çš„application.ymlé…ç½®Info å¦‚ä¸‹ 12345678910spring: application: name: sc-eureka-ha-server2 server: port: 8762 # æŒ‡å®šè¯¥Eurekaå®ä¾‹çš„ç«¯å£eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ 3.ä¸»ç¨‹åºå…¥å£ä»£ç æ²¡ä»€ä¹ˆåŒºåˆ«å¦‚ä¸‹: 1234567@EnableEurekaServer@SpringBootApplicationpublic class EurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaServerApplication.class, args); &#125;&#125; 4.åˆ†åˆ«å¯åŠ¨sc-eureka-ha-server1å’Œsc-eureka-ha-server2ï¼Œè®¿é—®http://localhost:8761/ ,http://localhost:8762/ ï¼Œå¦‚ä¸‹: 5.æœåŠ¡æä¾›è€…sc-eureka-ha-providerå…¶å®ƒä»£ç è§å·¥ç¨‹,application.ymlå¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011 server: port: 8000 spring: application: name: sc-eureka-ha-provider eureka: client: service-url: defaultZone: http://localhost:8761/eureka/ tips: æŠŠæœåŠ¡æä¾›è€…çš„æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œæ³¨å†Œåˆ°Eureka Server 01ä¸Šã€‚ å¯åŠ¨æœåŠ¡æä¾›è€…ï¼Œè§å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç‰‡åˆ»æœåŠ¡æä¾›è€…çš„ä¿¡æ¯ä¹ŸåŒæ­¥åˆ°Eureka Server02ä¸Šé¢ Jaræ–¹å¼æ¼”ç¤ºHA Eureka Serverçš„HAï¼Œå…¶å®å¯ä»¥é€šè¿‡jarçš„æ–¹å¼æŒ‡å®šä½¿ç”¨ä¸åŒçš„profileé…ç½®çš„æ–¹å¼ï¼Œåœ¨æœ¬åœ°è¿è¡Œä¸¤ä¸ªEureka Serverã€‚åªéœ€å°†Eureka serverçš„application.ymlä¿®æ”¹å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425spring: application: name: sc-eureka-ha-server --- spring: profiles: peer1 server: port: 8761 eureka: instance: hostname: peer1.xujin.org client: serviceUrl: defaultZone: http://peer2.xujin.org:8762/eureka/ --- spring: profiles: peer2 server: port: 8762 eureka: instance: hostname: peer2.xujin.org client: serviceUrl: defaultZone: http://peer1.xujin.org:8761/eureka/ é€šè¿‡é…ç½®switcHostsæˆ–è€…è‡ªè¡Œé…ç½®HostNameå¯¹åº”çš„IPåœ°å€,æŠŠå·¥ç¨‹æ‰“æˆjarä¹‹åï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤123 java -jar sc-eureka-ha-server1-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer2java -jar sc-eureka-ha-server1-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer1 æµ‹è¯•å¦‚ä¸‹: å®‰å…¨èº«ä»½éªŒè¯ å¦‚æœå®¢æˆ·ç«¯çš„eureka.client.serviceUrl.defaultZoneå‚æ•°å€¼(å³Eureka Serverçš„åœ°å€)ä¸­åŒ…å«HTTP Basic Authenticationä¿¡æ¯ï¼Œå¦‚http://user:password@localhost:8761/eurekaï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥ç”¨æˆ·åã€å¯†ç ä¿¡æ¯ä¸EurekaæœåŠ¡ç«¯è¿›è¡ŒéªŒè¯ã€‚å¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„éªŒè¯é€»è¾‘ï¼Œä½ å¿…é¡»æ³¨å†Œä¸€ä¸ªDiscoveryClientOptionalArgsç»„ä»¶ï¼Œå¹¶å°†ClientFilterç»„ä»¶æ³¨å…¥ï¼Œåœ¨è¿™é‡Œå®šä¹‰çš„é€»è¾‘ä¼šåœ¨æ¯æ¬¡å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ—¶æ‰§è¡Œã€‚ Tipsï¼šä»£ç ç¤ºä¾‹:https://github.com/SoftwareKing/spring-cloud-study/tree/master/sc-eureka-security è®¿é—®Eureka Serverå®‰å…¨èº«ä»½éªŒè¯ å¦‚å·¥ç¨‹sc-eureka-securitä¸­çš„sc-eureka-security-serverå·¥ç¨‹æ‰€ç¤ºï¼Œåœ¨pom.xmlä¸­å¢åŠ ä¾èµ–å¦‚ä¸‹: 1234 &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; application.ymlå¦‚ä¸‹ 123456789101112131415161718 server: port: 8761 # æŒ‡å®šè¯¥Eurekaå®ä¾‹çš„ç«¯å£eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverä¸Šï¼Œé»˜è®¤ä¸ºtrueï¼Œå½“å‰åº”ç”¨ä¸ºEureka Serveræ‰€ä»¥æ— éœ€æ³¨å†Œ registerWithEureka: false #è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå•ç‚¹çš„Eureka Serverï¼Œä¸éœ€è¦åŒæ­¥å…¶ä»–çš„Eureka ServerèŠ‚ç‚¹çš„æ•°æ®ï¼Œæ•…è€Œè®¾ä¸ºfalseã€‚ fetchRegistry: false #Eureka Serverçš„è®¿é—®åœ°å€ï¼ŒæœåŠ¡æ³¨å†Œå’Œclientè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯å‡é€šè¿‡è¯¥URLï¼Œå¤šä¸ªæœåŠ¡æ³¨å†Œåœ°å€ç”¨,éš”å¼€ serviceUrl: defaultZone: http://localhost:8761/eureka/ security: basic: enabled: true user: name: xujin password: 123 3.å¯åŠ¨Eureka serveræµ‹è¯•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º æœåŠ¡æä¾›è€…æ³¨å†ŒEureka Serverå®‰å…¨èº«ä»½éªŒè¯1.æœåŠ¡æä¾›è€…åªéœ€æ³¨å†Œæ—¶ä¿®æ”¹application.yml 1234567891011 server: port: 8000 spring: application: name: sc-eureka-security-provider eureka: client: service-url: defaultZone: http://xujin:123@localhost:8761/eureka/ Tips:å¦‚ä¸Šæ‰€ç¤º:http://ç”¨æˆ·å:å¯†ç @localhost:8761/eureka/","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"}]},{"title":"ä½¿ç”¨Spring Cloud Eurekaå®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"sc/sc-eureka-01","date":"2017-03-23T06:00:00.000Z","updated":"2019-01-12T03:48:54.822Z","comments":true,"path":"sc/sc-eureka-01/","link":"","permalink":"http://xujin.org/sc/sc-eureka-01/","excerpt":"æ‘˜è¦:ç”±äºç›®å‰ï¼Œç½‘ä¸Šçš„Spring Cloudçš„å­¦ä¹ çš„æ¡ˆåˆ—ï¼Œæ¯”è¾ƒå‡Œä¹±è€Œä¸”æ²¡æœ‰å½¢æˆæ•´ä¸ªä½“ç³»ï¼Œå› æ­¤ç‰¹å¼€ä¸€ä¸ªä¸“é¢˜ä¸ºè·Ÿæˆ‘å­¦Spring Cloudï¼Œå¸Œæœ›å¸®åŠ©åˆ°æœ‰éœ€è¦çš„äººã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨Spring Cloudä¸­çš„Eurekaç»„ä»¶å¿«é€Ÿå®ç°å¾®æœåŠ¡çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚è‡³äºå®‰å…¨æ¨¡å¼å’ŒEureka Serverçš„HA,åé¢çš„æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ã€‚å¦‚æœæ‚¨è§‰å¾—ï¼Œæœ‰æƒ³äº†è§£çš„å†…å®¹ï¼Œå‚ä¸è¯„è®ºç•™è¨€ã€‚","text":"æ‘˜è¦:ç”±äºç›®å‰ï¼Œç½‘ä¸Šçš„Spring Cloudçš„å­¦ä¹ çš„æ¡ˆåˆ—ï¼Œæ¯”è¾ƒå‡Œä¹±è€Œä¸”æ²¡æœ‰å½¢æˆæ•´ä¸ªä½“ç³»ï¼Œå› æ­¤ç‰¹å¼€ä¸€ä¸ªä¸“é¢˜ä¸ºè·Ÿæˆ‘å­¦Spring Cloudï¼Œå¸Œæœ›å¸®åŠ©åˆ°æœ‰éœ€è¦çš„äººã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨Spring Cloudä¸­çš„Eurekaç»„ä»¶å¿«é€Ÿå®ç°å¾®æœåŠ¡çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚è‡³äºå®‰å…¨æ¨¡å¼å’ŒEureka Serverçš„HA,åé¢çš„æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ã€‚å¦‚æœæ‚¨è§‰å¾—ï¼Œæœ‰æƒ³äº†è§£çš„å†…å®¹ï¼Œå‚ä¸è¯„è®ºç•™è¨€ã€‚ ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°æœåŠ¡æ³¨å†Œä¸å‘ç° åœ¨æœåŠ¡åŒ–çš„æ—©æœŸï¼ŒæœåŠ¡ä¸æ˜¯å¾ˆå¤šï¼ŒæœåŠ¡çš„æ³¨å†Œä¸å‘ç°å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œçš„åè¯ï¼ŒNginx+å†…éƒ¨åŸŸåæœåŠ¡å™¨æ–¹å¼ï¼Œç”šè‡³Nginx+hostæ–‡ä»¶é…ç½®æ–¹å¼ä¹Ÿèƒ½å®ŒæˆæœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚æœåŠ¡ä¸Šä¸‹çº¿éœ€è¦åœ¨nginx,æœåŠ¡å™¨åšç›¸åº”çš„é…ç½®ï¼Œä¸€æ—¦æœåŠ¡çš„IPç«¯å£å‘ç”Ÿå˜åŒ–ï¼Œéƒ½éœ€è¦åœ¨nginxä¸Šåšç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¼•å…¥æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ æœåŠ¡æ³¨å†Œ,å³æœåŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°±å°†æœåŠ¡çš„IP,ç«¯å£,ç‰ˆæœ¬å·ç­‰EndPointæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ(Eueka,Zookeeper,Consul)å¯¹æœåŠ¡è¿›è¡Œç»Ÿä¸€ç®¡ç†. æœåŠ¡å‘ç°,ç®€å•çš„å°±æ˜¯è¯´ï¼Œä¸ç®¡æœåŠ¡ä¸Šä¸‹çº¿ï¼Œå½“å¯¹æŸä¸ªæœåŠ¡å‘èµ·è¯·æ±‚æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„ä»æœ¬åœ°ç¼“å­˜æˆ–è€…æ³¨å†Œä¸­å¿ƒçš„æ³¨å†Œåˆ—è¡¨ä¸­ï¼Œå¿«é€Ÿæ‰¾åˆ°æœåŠ¡æä¾›è€…ã€‚ æœåŠ¡åŒ–æ—©æœŸçš„åšæ³•ç¤ºä¾‹å·¥ç¨‹è¯´æ˜ Tipsï¼šä»£ç ç¤ºä¾‹:https://github.com/SoftwareKing/spring-cloud-study/tree/master/sc-eureka-first Spring MVCä¸­åŸºäºæ— çŠ¶æ€çš„REST å·¥ç¨‹å¯ä»¥å‚è€ƒsc-rest-demoä¸‹é¢çš„sc-rest-providerå’Œsc-rest-consumerï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š123456789101112131415161718192021@RestController@RequestMapping(\"/sc\")public class ConsumerController &#123; @Autowired private RestTemplate restTemplate; // ä»å±æ€§æ–‡ä»¶ä¸­è¯»å–æœåŠ¡æä¾›çš„URL @Value(\"$&#123;order.orderServiceUrl&#125;\") private String orderServiceUrl; @GetMapping(\"/consumer/&#123;id&#125;\") public OrderModel getOrderInfo(@PathVariable Long id) &#123; // this.restTemplate.getForObject(\"http://localhost:8000/sc/order/\" + // id,OrderModel.class); return this.restTemplate.getForObject(this.orderServiceUrl + \"/sc/order/\" + id, OrderModel.class); &#125;&#125; å¤§å®¶æ³¨æ„åˆ°æ²¡ï¼ŒæŠŠhttp://localhost:8000 ,ç¡¬ç¼–ç åˆ°ç¨‹åºä¸­ï¼Œæ˜¯ä¸æ˜¯æ¯”è¾ƒlowã€‚å¯ä»¥é‡‡ç”¨ä¸Šé¢ä»£ç ä¸­çš„æ–¹å¼ï¼šorderServiceUrlè§£å†³ã€‚ä½†æ˜¯è¿™æ ·è¿˜æ˜¯æ¯”è¾ƒlow,ä¸‹é¢ä»‹ç»ä¸€ä¸‹å¼•å…¥Eurekaå®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°çš„å¤„ç†ã€‚ ä½¿ç”¨Eurekaå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°æ­å»ºæ³¨å†Œä¸­å¿ƒ-Eureka Server 1.å¼•å…¥ä¾èµ–123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?xml version=\"1.0\"?&gt;&lt;project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!-- å¼•å…¥spring bootçš„ä¾èµ– --&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.4.3.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;artifactId&gt;sc-eureka-first-server-HA01&lt;/artifactId&gt; &lt;name&gt;sc-eureka-first-server-HA01&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- å¼•å…¥Spring Cloud Eurekaä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- å¼•å…¥spring cloudçš„ä¾èµ– --&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Camden.SR5&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; &lt;!-- æ·»åŠ spring-bootçš„mavenæ’ä»¶--&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; åœ¨Resourcesç›®å½•ä¸‹åˆ›å»ºapplication.yml123456789101112131415server: port: 8761 # æŒ‡å®šè¯¥Eurekaå®ä¾‹çš„ç«¯å£eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverä¸Šï¼Œé»˜è®¤ä¸ºtrueï¼Œå½“å‰åº”ç”¨ä¸ºEureka Serveræ‰€ä»¥æ— éœ€æ³¨å†Œ registerWithEureka: false #è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå•ç‚¹çš„Eureka Serverï¼Œä¸éœ€è¦åŒæ­¥å…¶ä»–çš„Eureka ServerèŠ‚ç‚¹çš„æ•°æ®ï¼Œæ•…è€Œè®¾ä¸ºfalseã€‚ fetchRegistry: false #Eureka Serverçš„è®¿é—®åœ°å€ï¼ŒæœåŠ¡æ³¨å†Œå’Œclientè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯å‡é€šè¿‡è¯¥URLï¼Œå¤šä¸ªæœåŠ¡æ³¨å†Œåœ°å€ç”¨,éš”å¼€ serviceUrl: defaultZone: http://localhost:8761/eureka/# å‚è€ƒæ–‡æ¡£ï¼šhttp://projects.spring.io/spring-cloud/docs/1.0.3/spring-cloud.html#_standalone_mode# å‚è€ƒæ–‡æ¡£ï¼šhttp://my.oschina.net/buwei/blog/618756 3.åˆ›å»ºSpring Bootä¸»åº”ç”¨ç¨‹åºå¯åŠ¨ä»£ç 12345678910111213141516171819package org.xujin.sc.eureka.server;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;/** * Eureka Server * @author xujin */@SpringBootApplication@EnableEurekaServerpublic class SpringCloudEurekaServer &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudEurekaServer.class, args); &#125;&#125; å¯åŠ¨Eureka serveræµ‹è¯•ï¼š å¯åŠ¨sc-eureka-first-server-HA01ï¼Œè®¿é—®http://localhost:8761/ ,å¦‚ä¸‹å›¾æ‰€ç¤º: åˆ›å»ºæœåŠ¡æä¾›è€… 1.æœåŠ¡æä¾›è€…ï¼Œä¸ºäº†æ¼”ç¤ºåœ¨è¿™é‡Œæä¾›ä¸€ä¸ªç®€å•çš„è®¢å•æŸ¥è¯¢æœåŠ¡ï¼Œå¦‚å·¥ç¨‹sc-eureka-first-provider01å’Œsc-eureka-first-provider02æ‰€ç¤ºã€‚ 2.ä¸»ç¨‹åºå…¥å£ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415161718192021package org.xujin.sc.eureka.first.order;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;/** * æœåŠ¡æä¾›è€…ç«¯ï¼ŒåŠ ä¸Š@EnableDiscoveryClientæ³¨è§£ï¼Œå®ŒæˆæœåŠ¡æ³¨å†Œã€‚ * @author xujin * @site http://xujin.org */@SpringBootApplication@EnableDiscoveryClient// @EnableEurekaClientpublic class OrderProviderSpringBootAppliaction &#123; public static void main(String[] args) &#123; SpringApplication.run(OrderProviderSpringBootAppliaction.class, args); &#125;&#125; Tips:å¦‚æœä½¿ç”¨Eureka, å¯ä»¥ä½¿ç”¨@EnableEurekaClientæ³¨è§£ï¼Œä½†æ˜¯æ¨èä½¿ç”¨@EnableDiscoveryClientä»£æ›¿@EnableEurekaClientæ³¨è§£ï¼Œå› ä¸º@EnableDiscoveryClientæ˜¯ä¸€ä¸ªé«˜åº¦çš„æŠ½è±¡ï¼Œ æ¥è‡ªäºspring-cloud-commonsï¼Œ ç”±äºSpring Cloudé€‰å‹æ˜¯ä¸­ç«‹çš„å› æ­¤æŠ½è±¡å‡ºè¯¥æ¥å£ï¼Œ å½“æœåŠ¡æ³¨å†Œä¸­å¿ƒé€‰å‹æ”¹å˜ä¸ºEurekaï¼ŒZKï¼ŒConsulæ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç ä¸­çš„æ³¨è§£ã€‚ 3.æœåŠ¡æä¾›è€…æš´éœ²çš„æœåŠ¡-OrderController.java12345678910111213@RestControllerpublic class OrderController &#123; @Autowired private OrderService orderService; @GetMapping(\"/sc/order/&#123;id&#125;\") public OrderModel findOrderById(@PathVariable Long id) &#123; OrderModel orderModel = orderService.findOrderByOrderId(id); return orderModel; &#125;&#125; å¯åŠ¨æœåŠ¡æä¾›è€…ï¼ŒæŠŠæœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œæ³¨å†Œåˆ°Eureka Serveræ³¨å†Œä¸­å¿ƒå¯åŠ¨sc-eureka-first-provider01,å½“å¯åŠ¨å…¶ä¸­ä¸€ä¸ªæœåŠ¡ååˆ·æ–°Eureka Serverä¼šå‡ºç°å®‰å…¨æ¨¡å¼,å¦‚ä¸‹å›¾æ‰€ç¤º: å¯åŠ¨sc-eureka-first-provider02ï¼Œåˆ·æ–°Eureka Serverå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€… æœåŠ¡æ¶ˆè´¹è€…ä¸»è¦æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æœåŠ¡ï¼Œç”¨æˆ·æœåŠ¡æŸ¥è¯¢è®¢å•æœåŠ¡çš„è®¢å•ä¿¡æ¯ã€‚ 1.å¼•å…¥ç›¸åº”çš„ä¾èµ– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869 &lt;?xml version=\"1.0\"?&gt;&lt;project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;org.xujin.sc&lt;/groupId&gt; &lt;artifactId&gt;sc-eureka-first-consumer&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;sc-eureka-first-consumer&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;!-- å¼•å…¥spring bootçš„ä¾èµ– --&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.4.3.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.6&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- å¼•å…¥spring cloudçš„ä¾èµ– --&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Camden.SR4&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;!-- æ·»åŠ spring-bootçš„mavenæ’ä»¶ --&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 2.ä¸»ç¨‹åºå…¥å£ä»£ç 12345678910111213141516171819202122package org.xujin.sc.eureka.user;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;import org.springframework.context.annotation.Bean;import org.springframework.web.client.RestTemplate;//æ¶ˆè´¹è€…ç«¯åŠ å…¥æœåŠ¡å‘ç°æ³¨è§£@EnableDiscoveryClient@SpringBootApplicationpublic class UserConsumerApplication &#123; @Bean public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125; public static void main(String[] args) &#123; SpringApplication.run(UserConsumerApplication.class, args); &#125;&#125; æ¶ˆè´¹è€…è°ƒç”¨Controllerã€‚ 12345678910111213141516171819202122232425262728@RestControllerpublic class UserController &#123; private static final Logger logger = LoggerFactory.getLogger(UserController.class); @Autowired private RestTemplate restTemplate; @Autowired private DiscoveryClient discoveryClient; // discoveryClientè·å–æœåŠ¡åˆ—è¡¨ä¸­ï¼Œåº”ç”¨åä¸ºsc-eureka-first-providerä¸€ä¸ªæœåŠ¡æ³¨å†Œä¿¡æ¯ public String serviceUrl() &#123; List&lt;ServiceInstance&gt; list = discoveryClient .getInstances(\"sc-eureka-first-provider\"); if (list != null &amp;&amp; list.size() &gt; 0) &#123; return String.valueOf(list.get(0).getUri()); &#125; return null; &#125; @GetMapping(\"/sc/user/&#123;id&#125;\") public Order findByIdByEurekaServer(@PathVariable Long id) &#123; String providerServiceUrl = serviceUrl(); return this.restTemplate.getForObject(providerServiceUrl + \"sc/order/\" + id, Order.class); &#125;&#125; å¦‚ä¸Šè¿°ä»£ç ï¼Œæ‰€ç¤ºä½¿ç”¨discoveryClient.getInstances(&quot;sc-eureka-first-provider&quot;)è·å–æœåŠ¡åä¸ºsc-eureka-first-providerçš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¿¡æ¯ã€‚ æµ‹è¯•å…ˆåå¯åŠ¨sc-eureka-first-consumer,å¦‚æ²¡æœ‰å¼‚å¸¸ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®:http://localhost:8010/sc/user/2 ,debugå¦‚ä¸‹æ‰€ç¤ºå¯ä»¥çœ‹åˆ° åœ¨åˆ·æ–°ä¸€ä¸‹Eureka Serverï¼Œå¦‚å›¾ä¸‹æ‰€ç¤º,æ­¤æ—¶å®‰å…¨æ¨¡å¼å…³é—­ã€‚ å…³äºå®‰å…¨æ¨¡å¼ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæš‚ä¸è®¨è®ºï¼Œåé¢å°†ä¼šä¸“å†™ä¸€ç¯‡æ–‡ç« ä»‹ç»ï¼Œè¯·æš‚æ—¶å¿½ç•¥ã€‚ è·å–æ¶ˆè´¹è€…è·å–æœåŠ¡ç«¯æ¶ˆè´¹åˆ—è¡¨ ä½¿ç”¨EurekaClientè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯ 1234567 @Autowiredprivate EurekaClient discoveryClient;public String serviceUrl() &#123; InstanceInfo instance = discoveryClient.getNextServerFromEureka(\"STORES\", false); return instance.getHomePageUrl();&#125; ä½¿ç”¨DiscoveryClientè·å–æœåŠ¡æ³¨å†Œä¿¡æ¯ 12345678910 @Autowiredprivate DiscoveryClient discoveryClient;public String serviceUrl() &#123; List&lt;ServiceInstance&gt; list = discoveryClient.getInstances(\"STORES\"); if (list != null &amp;&amp; list.size() &gt; 0 ) &#123; return list.get(0).getUri(); &#125; return null;&#125; å‚è€ƒé“¾æ¥ï¼šhttps://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/asciidoc/spring-cloud-netflix.adoc å°ç»“ ä¸Šé¢è¿™ä¸ªä¾‹å­ä½¿ç”¨Eurekaå®ç°äº†æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯è·å–æœåŠ¡æ³¨å†Œåˆ—è¡¨çš„æ–¹å¼æ¯”è¾ƒlowå¹¶ä¸”å¤ªæ–¹ä¾¿ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ²¡æœ‰ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼ˆLoad Balance)ï¼Œè¿™æ ·å°±æ²¡æ³•å®ç°å¾®æœåŠ¡çš„HAã€‚åœ¨åé¢çš„æ–‡ç« å°†ä¼šä»‹ç»Eureka Serverçš„HAå’Œä½¿ç”¨Robbinå®ç°LBã€‚ã€‚","categories":[{"name":"è·Ÿæˆ‘å­¦Spring Cloud","slug":"è·Ÿæˆ‘å­¦Spring-Cloud","permalink":"http://xujin.org/categories/è·Ÿæˆ‘å­¦Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"}]},{"title":"HashMapå¤šçº¿ç¨‹æ­»å¾ªç¯é—®é¢˜","slug":"java/hm02","date":"2017-03-11T06:00:00.000Z","updated":"2019-01-13T05:23:46.988Z","comments":true,"path":"java/hm02/","link":"","permalink":"http://xujin.org/java/hm02/","excerpt":"æ‘˜è¦ï¼šä¸€ç›´éƒ½çŸ¥é“Java HashMapä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´CPU è¾¾åˆ°100%çš„çº¿ä¸Šæ•…éšœï¼Œä»¥åŠæ€ä¹ˆé€ æˆçš„ï¼Œæ€ä¹ˆåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿›è¡Œè§„é¿ï¼Œç”±äºæ—¶é—´çš„å…³ç³»ã€‚æœ€è¿‘æ•´ç†å¦‚æœ¬æ–‡æ‰€ç¤ºã€‚ ä¸€.HashMapå‡ºç°æ­»å¾ªç¯åŸå› 1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸€ä¸ªç±»(å¯¹è±¡å’Œæ–¹æ³•)æ—¶ï¼Œè¿™ä¸ªç±»çš„å¯¹è±¡æˆ–æ–¹æ³•éƒ½èƒ½å§‹ç»ˆè¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºæˆ–è€…æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå…¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦åˆ™éçº¿ç¨‹å®‰å…¨ã€‚æˆ‘ä»¬éƒ½çŸ¥é“HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£æ€ä¹ˆä½¿ç”¨HashMapä¼šå¯¼è‡´CPUå ç”¨ç‡è¾¾åˆ°100%ã€‚","text":"æ‘˜è¦ï¼šä¸€ç›´éƒ½çŸ¥é“Java HashMapä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´CPU è¾¾åˆ°100%çš„çº¿ä¸Šæ•…éšœï¼Œä»¥åŠæ€ä¹ˆé€ æˆçš„ï¼Œæ€ä¹ˆåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿›è¡Œè§„é¿ï¼Œç”±äºæ—¶é—´çš„å…³ç³»ã€‚æœ€è¿‘æ•´ç†å¦‚æœ¬æ–‡æ‰€ç¤ºã€‚ ä¸€.HashMapå‡ºç°æ­»å¾ªç¯åŸå› 1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸€ä¸ªç±»(å¯¹è±¡å’Œæ–¹æ³•)æ—¶ï¼Œè¿™ä¸ªç±»çš„å¯¹è±¡æˆ–æ–¹æ³•éƒ½èƒ½å§‹ç»ˆè¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºæˆ–è€…æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå…¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦åˆ™éçº¿ç¨‹å®‰å…¨ã€‚æˆ‘ä»¬éƒ½çŸ¥é“HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£æ€ä¹ˆä½¿ç”¨HashMapä¼šå¯¼è‡´CPUå ç”¨ç‡è¾¾åˆ°100%ã€‚ ä¹‹æ‰€ä»¥ä¼šå¯¼è‡´HashMapå‡ºç°æ­»å¾ªç¯æ˜¯å› ä¸ºå¤šçº¿ç¨‹ä¼šå¯¼è‡´HashMapçš„EntryèŠ‚ç‚¹å½¢æˆç¯é“¾ï¼Œè¿™æ ·å½“éå†é›†åˆæ—¶Entryçš„nextèŠ‚ç‚¹ç”±äºä¸ä¸ºç©ºï¼Œä»è€Œå½¢æˆæ­»å¾ªç¯ï¼Œä»è€Œå¯¼è‡´CPUè¾¾åˆ°100% 1.2 ä¸ºä½•å‡ºç°æ­»å¾ªç¯ç®€è¦è¯´æ˜HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸èƒ½ä¿æŒè¶³å¤Ÿçš„åŒæ­¥ï¼Œå°±æœ‰å¯èƒ½åœ¨æ‰§è¡ŒHashMap.getæ—¶è¿›å…¥æ­»å¾ªç¯ï¼Œå°†CPUçš„æ¶ˆè€—åˆ°100%ã€‚ HashMapé‡‡ç”¨é“¾è¡¨è§£å†³Hashå†²çªã€‚å› ä¸ºæ˜¯é“¾è¡¨ç»“æ„ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å½¢æˆé—­åˆçš„é“¾è·¯ï¼Œè¿™æ ·åœ¨å¾ªç¯çš„æ—¶å€™åªè¦æœ‰çº¿ç¨‹å¯¹è¿™ä¸ªHashMapè¿›è¡Œgetæ“ä½œå°±ä¼šäº§ç”Ÿæ­»å¾ªç¯ï¼Œ å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹HashMapçš„æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œï¼Œæ˜¯ä¸å¯èƒ½äº§ç”Ÿé—­åˆçš„å›è·¯çš„ã€‚ åªæœ‰åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œé‚£å°±æ˜¯åœ¨putæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœsize&gt;initialCapacity*loadFactorï¼Œhashè¡¨è¿›è¡Œæ‰©å®¹ï¼Œé‚£ä¹ˆè¿™æ—¶å€™HashMapå°±ä¼šè¿›è¡Œrehashæ“ä½œï¼Œéšä¹‹HashMapçš„ç»“æ„å°±ä¼šå¾ˆå¤§çš„å˜åŒ–ã€‚å¾ˆæœ‰å¯èƒ½å°±æ˜¯åœ¨ä¸¤ä¸ªçº¿ç¨‹åœ¨è¿™ä¸ªæ—¶å€™åŒæ—¶è§¦å‘äº†rehashæ“ä½œï¼Œäº§ç”Ÿäº†é—­åˆçš„å›è·¯ã€‚ äºŒ.HashMapæ­»å¾ªç¯åŸå› åˆ†æ2.1 é—®é¢˜çš„ç—‡çŠ¶åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨HashMapï¼Œåˆ°äº†çº¿ä¸Šä¹‹åï¼Œæˆ‘ä»¬å‘ç°ç¨‹åºç»å¸¸å äº†100%çš„CPUï¼ŒæŸ¥çœ‹å †æ ˆï¼Œä½ ä¼šå‘ç°ç¨‹åºéƒ½Hangåœ¨äº†HashMap.get()è¿™ä¸ªæ–¹æ³•ä¸Šäº†ï¼Œé‡å¯ç¨‹åºåé—®é¢˜æ¶ˆå¤±ã€‚ä½†æ˜¯è¿‡æ®µæ—¶é—´åˆä¼šæ¥ã€‚è€Œä¸”ï¼Œè¿™ä¸ªé—®é¢˜åœ¨æµ‹è¯•ç¯å¢ƒé‡Œå¯èƒ½å¾ˆéš¾é‡ç°ã€‚ 2.2 ä¸ºä»€ä¹ˆä¼šé€ æˆæ­»å¾ªç¯HashMapé‡‡ç”¨é“¾è¡¨è§£å†³Hashå†²çªï¼Œå› ä¸ºæ˜¯é“¾è¡¨ç»“æ„ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å½¢æˆé—­åˆçš„é“¾è·¯ï¼Œè¿™æ ·åœ¨å¾ªç¯çš„æ—¶å€™åªè¦æœ‰çº¿ç¨‹å¯¹è¿™ä¸ªHashMapè¿›è¡Œgetæ“ä½œå°±ä¼šäº§ç”Ÿæ­»å¾ªç¯ã€‚ä½†æ˜¯ï¼Œæˆ‘å¥½å¥‡çš„æ˜¯ï¼Œè¿™ç§é—­åˆçš„é“¾è·¯æ˜¯å¦‚ä½•å½¢æˆçš„å‘¢ã€‚åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹HashMapçš„æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œï¼Œæ˜¯ä¸å¯èƒ½äº§ç”Ÿé—­åˆçš„å›è·¯çš„ã€‚é‚£å°±åªæœ‰åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œé‚£å°±æ˜¯åœ¨putæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœsize&gt;initialCapacity*loadFactorï¼Œé‚£ä¹ˆè¿™æ—¶å€™HashMapå°±ä¼šè¿›è¡Œrehashæ“ä½œï¼Œéšä¹‹HashMapçš„ç»“æ„å°±ä¼šå‘ç”Ÿç¿»å¤©è¦†åœ°çš„å˜åŒ–ã€‚å¾ˆæœ‰å¯èƒ½å°±æ˜¯åœ¨ä¸¤ä¸ªçº¿ç¨‹åœ¨è¿™ä¸ªæ—¶å€™åŒæ—¶è§¦å‘äº†rehashæ“ä½œï¼Œäº§ç”Ÿäº†é—­åˆçš„å›è·¯ã€‚ ä¸‰.å‚è€ƒæ–‡ç« http://blog.csdn.net/xuefeng0707/article/details/40797085 http://coolshell.cn/articles/9606.html http://firezhfox.iteye.com/blog/2241043 http://www.cnblogs.com/kxdblog/p/4323892.html http://www.cnblogs.com/ITtangtang/p/3966467.html http://blog.csdn.net/xuefeng0707/article/details/40797085http://blog.csdn.net/zhuqiuhui/article/details/51849692","categories":[{"name":"java","slug":"java","permalink":"http://xujin.org/categories/java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"Jdk","slug":"Jdk","permalink":"http://xujin.org/tags/Jdk/"}]},{"title":"Eclipse for Mac å¿«æ·é”®","slug":"ex/eclipse-for-mac","date":"2017-01-04T06:00:00.000Z","updated":"2019-01-13T05:20:25.692Z","comments":true,"path":"ex/eclipse-for-mac/","link":"","permalink":"http://xujin.org/ex/eclipse-for-mac/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Macä¸‹Eclipseçš„å¸¸ç”¨å¿«æ·é”®ï¼Œå¼€å‘ç¯å¢ƒåˆ‡æ¢åˆ°Macä¸‹ååŸæ¥Windowä¸‹çš„å¿«æ·é”®å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä¸ç›¸å®¹çš„ï¼Œä¸€æ–¹é¢ä¸ç†Ÿæ‚‰å¿«æ·é”®ä¼šå¯¼è‡´å¼€å‘æ•ˆç‡æ˜æ˜¾é™ä½ï¼Œå¦ä¸€æ–¹é¢é¢‘ç¹å½•å…¥é”™è¯¯çš„å¿«æ·é”®IDEä¹Ÿä¸€è„¸æ‡µé€¼ï¼Œæ–¹ä¾¿é€ŸæŸ¥è®°å½•å¦‚ä¸‹ï¼Œå°¤å…¶åƒæˆ‘ä¹ æƒ¯äº†Eclipse IDEã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Macä¸‹Eclipseçš„å¸¸ç”¨å¿«æ·é”®ï¼Œå¼€å‘ç¯å¢ƒåˆ‡æ¢åˆ°Macä¸‹ååŸæ¥Windowä¸‹çš„å¿«æ·é”®å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä¸ç›¸å®¹çš„ï¼Œä¸€æ–¹é¢ä¸ç†Ÿæ‚‰å¿«æ·é”®ä¼šå¯¼è‡´å¼€å‘æ•ˆç‡æ˜æ˜¾é™ä½ï¼Œå¦ä¸€æ–¹é¢é¢‘ç¹å½•å…¥é”™è¯¯çš„å¿«æ·é”®IDEä¹Ÿä¸€è„¸æ‡µé€¼ï¼Œæ–¹ä¾¿é€ŸæŸ¥è®°å½•å¦‚ä¸‹ï¼Œå°¤å…¶åƒæˆ‘ä¹ æƒ¯äº†Eclipse IDEã€‚ æœ€å¸¸ç”¨ å¿«æ·é”® è¯´æ˜ Option+â†“ å‘ä¸‹ç§»åŠ¨ä»£ç  Option+â†‘ å‘ä¸Šç§»åŠ¨ä»£ç  Option+/ ä»£ç æ™ºèƒ½æç¤º Option+Command+C ä¿®æ”¹å‡½æ•°ç»“æ„ï¼Œé€‚ç”¨é‡æ„ Command+Option+R æ‰¹é‡é‡å‘½å Option+Command+L æŠ½å–æœ¬åœ°å˜é‡ Command+Option+S å¿«é€Ÿç”Ÿæˆä»£ç ï¼ŒGetter&amp;Setterï¼ŒConstructorç­‰ Option+å›è½¦ æ˜¾ç¤ºå½“å‰é€‰æ‹©èµ„æºçš„å±æ€§ Command+Shift+O æ•´ç†åŒ…å»æ‰å¤šä½™çš„importè¯­å¥ æ–‡æœ¬ä½ç½®è·³è½¬å¿«æ·é”® å¿«æ·é”® è¯´æ˜ Command+å·¦ç®­å¤´ è·³è½¬åˆ°ä¸€è¡Œçš„å¼€å¤´ Command+å³ç®­å¤´ è·³è½¬åˆ°ä¸€è¡Œçš„æœ«å°¾ Command+ä¸Šç®­å¤´ è·³è½¬åˆ°æ–‡æœ¬çš„å¼€å¤´ Command+ä¸‹ç®­å¤´ è·³è½¬åˆ°æ–‡æœ¬çš„æœ«å°¾ Option+å·¦ç®­å¤´ è·³è½¬åˆ°å½“å‰å•è¯çš„å¼€å¤´ Option+å³ç®­å¤´ è·³è½¬åˆ°å½“å‰å•è¯çš„æœ«å°¾ æ–‡æœ¬é€‰ä¸­å¿«æ·é”® å¿«æ·é”® è¯´æ˜ Shift+Command+å·¦ç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°æœ¬è¡Œå¼€å¤´çš„æ–‡æœ¬ Shift+Command+å³ç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°æœ¬è¡Œæœ«å°¾çš„æ–‡æœ¬ Shift+Command+ä¸Šç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°å…¨éƒ¨æ–‡æœ¬çš„å¼€å¤´ Shift+Command+ä¸‹ç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°å…¨éƒ¨æ–‡æœ¬çš„æœ«å°¾ Shift+Option+å·¦ç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°å½“å‰å•è¯çš„å¼€å¤´ Shift+Option+å³ç®­å¤´ é€‰ä¸­å…‰æ ‡åˆ°å½“å‰å•è¯çš„æœ«å°¾ Commandç±»","categories":[{"name":"tools","slug":"tools","permalink":"http://xujin.org/categories/tools/"}],"tags":[{"name":"å¼€å‘å·¥å…·","slug":"å¼€å‘å·¥å…·","permalink":"http://xujin.org/tags/å¼€å‘å·¥å…·/"}]},{"title":"çˆ±æ²¹ç§‘æŠ€åŸºäºSpringCloudçš„å¾®æœåŠ¡å®è·µ","slug":"sc/sc-fx1","date":"2016-11-22T06:00:00.000Z","updated":"2019-01-13T03:15:35.368Z","comments":true,"path":"sc/sc-fx1/","link":"","permalink":"http://xujin.org/sc/sc-fx1/","excerpt":"çˆ±æ²¹ç§‘æŠ€åŸºäºSpringCloudçš„å¾®æœåŠ¡å®è·µä¸ªäººç®€ä»‹åˆ˜æ€è´¤ï¼ˆå¾®åš@starlight36ï¼‰ï¼Œçˆ±æ²¹ç§‘æŠ€æ¶æ„å¸ˆã€PMPã€‚ä¸»è¦è´Ÿè´£ä¸šåŠ¡å¹³å°æ¶æ„è®¾è®¡ï¼ŒDevOpså®æ–½å’Œç ”å‘è¿‡ç¨‹æŒç»­æ”¹è¿›ç­‰ï¼Œå…³æ³¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸å¾®æœåŠ¡ã€å»ºè®¾é«˜æ•ˆå›¢é˜Ÿå’Œå·¥ç¨‹å¸ˆæ–‡åŒ–åŸ¹å…»ã€‚ æ‘˜è¦æœ¬æ¬¡åˆ†äº«ä¸»è¦ä»‹ç»äº†çˆ±æ²¹ç§‘æŠ€åŸºäºDockerå’ŒSpring Cloudå°†æ•´ä½“ä¸šåŠ¡å¾®æœåŠ¡åŒ–çš„ä¸€äº›å®è·µç»éªŒï¼Œä¸»è¦åŒ…æ‹¬ï¼š å¾®æœåŠ¡æ¶æ„çš„åˆ†å±‚å’Œæ¡†æ¶é€‰å‹ æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç† æœåŠ¡é›†æˆå’ŒæœåŠ¡è´¨é‡ä¿è¯ åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ å®æ–½DevOps","text":"çˆ±æ²¹ç§‘æŠ€åŸºäºSpringCloudçš„å¾®æœåŠ¡å®è·µä¸ªäººç®€ä»‹åˆ˜æ€è´¤ï¼ˆå¾®åš@starlight36ï¼‰ï¼Œçˆ±æ²¹ç§‘æŠ€æ¶æ„å¸ˆã€PMPã€‚ä¸»è¦è´Ÿè´£ä¸šåŠ¡å¹³å°æ¶æ„è®¾è®¡ï¼ŒDevOpså®æ–½å’Œç ”å‘è¿‡ç¨‹æŒç»­æ”¹è¿›ç­‰ï¼Œå…³æ³¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸å¾®æœåŠ¡ã€å»ºè®¾é«˜æ•ˆå›¢é˜Ÿå’Œå·¥ç¨‹å¸ˆæ–‡åŒ–åŸ¹å…»ã€‚ æ‘˜è¦æœ¬æ¬¡åˆ†äº«ä¸»è¦ä»‹ç»äº†çˆ±æ²¹ç§‘æŠ€åŸºäºDockerå’ŒSpring Cloudå°†æ•´ä½“ä¸šåŠ¡å¾®æœåŠ¡åŒ–çš„ä¸€äº›å®è·µç»éªŒï¼Œä¸»è¦åŒ…æ‹¬ï¼š å¾®æœåŠ¡æ¶æ„çš„åˆ†å±‚å’Œæ¡†æ¶é€‰å‹ æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç† æœåŠ¡é›†æˆå’ŒæœåŠ¡è´¨é‡ä¿è¯ åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ å®æ–½DevOps ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡ å•ä½“åº”ç”¨ä¼˜ç‚¹ å°è€Œç¾ï¼Œç»“æ„ç®€å•æ˜“äºå¼€å‘å®ç° éƒ¨ç½²é—¨æ§›ä½ï¼Œå•ä¸ªJaråŒ…æˆ–è€…ç½‘ç«™æ‰“åŒ…å³å¯éƒ¨ç½² å¯å¿«é€Ÿå®ç°å¤šå®ä¾‹éƒ¨ç½² ç¼ºç‚¹ éšç€ä¸šåŠ¡å‘å±•æ›´å¤šçš„éœ€æ±‚è¢«å¡è¿›ç³»ç»Ÿï¼Œä½“ç³»ç»“æ„é€æ¸è¢«ä¾µèš€ååº”å †æ—ç«‹ è¢«æŠ€æœ¯ç»‘æ¶ï¼Œéš¾ä»¥ä¸ºç‰¹å®šä¸šåŠ¡é€‰æ‹©å¹³å°æˆ–æ¡†æ¶ï¼Œå°½ç®¡å¯èƒ½æœ‰æ›´é€‚å®œçš„æŠ€æœ¯åšè¿™ä»¶äº‹ åä½œå›°éš¾ï¼Œä¸åŒä¸šåŠ¡çš„å›¢é˜Ÿåœ¨ä¸€ä¸ªç³»ç»Ÿä¸Šè¿›è¡Œå¼€å‘ç›¸äº’å†²çª éš¾ä»¥æ‰©å±•ï¼Œä¸ºäº†çƒ­ç‚¹ä¸šåŠ¡è€Œä¸å¾—ä¸åŒæ—¶æ‰©å®¹å…¨éƒ¨ä¸šåŠ¡ï¼Œæˆ–è€…éš¾ä»¥ç»§ç»­æ‰©å®¹ æ¶æ„æ‹†åˆ†æ‹†åˆ†ï¼šæŒ‰è¡Œåˆ†å±‚ï¼ŒæŒ‰åˆ—åˆ†ä¸šåŠ¡ åœ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ä½“ç³»ä¸­ï¼Œæ‰€æœ‰çš„æœåŠ¡è¢«åˆ’åˆ†ä¸ºäº†ä¸‰ä¸ªå±‚æ¬¡ï¼š åŸºç¡€è®¾æ–½å±‚ï¼šä¸ºæ‰€æœ‰ä¸šåŠ¡æä¾›åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬æœåŠ¡æ³¨å†Œã€æ•°æ®åº“å’ŒNoSQLã€å¯¹è±¡å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰åŸºç¡€è®¾æ–½æœåŠ¡ï¼Œè¿™ä¸€å±‚é€šå¸¸æ˜¯ç”±æˆç†Ÿç»„ä»¶ã€ç¬¬ä¸‰æ–¹æœåŠ¡ç»„æˆã€‚ ä¸šåŠ¡æœåŠ¡å±‚ï¼šä¸šåŠ¡å¾®æœåŠ¡ï¼Œæ ¹æ®ä¸šåŠ¡é¢†åŸŸæ¯ä¸ªå­åŸŸå•ç‹¬ä¸€ä¸ªå¾®æœåŠ¡ï¼Œåˆ†è€Œæ²»ä¹‹ã€‚ æ¥å…¥å±‚ï¼šç›´æ¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾‹å¦‚ç½‘ç«™ã€APIæ¥å£ç­‰ã€‚æ¥å…¥å±‚ä¸åŒ…å«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œåªåšå‘ˆç°å’Œè½¬æ¢ã€‚ é¡¹ç›®ä¸­æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸šåŠ¡æœåŠ¡å±‚å’Œæ¥å…¥å±‚ï¼Œå¯¹äºæ²¡æœ‰è¶³å¤Ÿè¿ç»´åŠ›é‡çš„æˆ‘ä»¬ï¼ŒåŸºç¡€è®¾æ–½ä½¿ç”¨äº‘æœåŠ¡æ˜¯çœäº‹çœåŠ›çš„é€‰æ‹©ã€‚ ä¸šåŠ¡æœåŠ¡å±‚æˆ‘ä»¬ç»™ä»–èµ·åå«ä½œEpicï¼Œæ¥å…¥å±‚æˆ‘ä»¬èµ·åRuneï¼Œå»ºç«‹ä¹‹åˆä¾¿è®¢ç«‹äº†å¦‚ä¸‹åŸåˆ™ï¼š ä¸šåŠ¡é€»è¾‘å±‚å†…æ‰€æœ‰æœåŠ¡å®Œå…¨å¯¹ç­‰ï¼Œå¯ç›¸äº’è°ƒç”¨ ä¸šåŠ¡é€»è¾‘å±‚æ‰€æœ‰æœåŠ¡å¿…é¡»æ˜¯æ— çŠ¶æ€çš„ æ¥å…¥å±‚æ‰€æœ‰æœåŠ¡å¯è°ƒç”¨ä¸šåŠ¡é€»è¾‘å±‚æ‰€æœ‰æœåŠ¡ï¼Œä½†æ¥å…¥å±‚å†…éƒ¨åŒå±‚æœåŠ¡ä¹‹é—´ä¸å¯è°ƒç”¨ æ¥å…¥å±‚ä¸èƒ½åŒ…å«ä¸šåŠ¡é€»è¾‘ä»£ç  æ‰€æœ‰å¾®æœåŠ¡å¿…é¡»è¿è¡Œåœ¨Dockerå®¹å™¨é‡Œ ä¸šåŠ¡é€»è¾‘å±‚æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ä½¿ç”¨Javaï¼Œæ¥å…¥å±‚æˆ‘ä»¬ä¸»è¦ä½¿ç”¨PHPæˆ–Nodeã€‚åæ¥éšç€å›¢é˜Ÿçš„æˆé•¿ï¼Œé€æ­¥å°†æ¥å…¥å±‚å…¨éƒ¨è¿ç§»è‡³Nodeã€‚ æ¡†æ¶é€‰å‹çˆ±æ²¹ç§‘æŠ€ä½œä¸ºä¸€å®¶æˆå“æ²¹è¡Œä¸šçš„åˆåˆ›å‹å…¬å¸ï¼Œéœ€è¦é¢å¯¹éå¸¸å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œè€Œä¸”éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå˜åŒ–çš„å¯èƒ½æ€§éå¸¸é«˜ã€‚æ‰€ä»¥åœ¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¹‹åˆï¼Œæˆ‘ä»¬å°±æœŸæœ›æˆ‘ä»¬çš„å¾®æœåŠ¡ä½“ç³»èƒ½ï¼š ä¸ç»‘å®šåˆ°ç‰¹å®šçš„æ¡†æ¶ã€è¯­è¨€ æœåŠ¡æœ€å¥½æ˜¯Restfulé£æ ¼ è¶³å¤Ÿç®€å•ï¼Œå®¹æ˜“è½åœ°ï¼Œå°†æ¥èƒ½æ‰©å±• å’ŒDockerç›¸å®¹æ€§å¥½ ç›®å‰å¸¸è§çš„å¾®æœåŠ¡ç›¸å…³æ¡†æ¶ï¼š Dubboã€DubboX Spring Cloud Motan Thriftã€gRPC è¿™äº›å¸¸è§çš„æ¡†æ¶ä¸­ï¼ŒDubboå‡ ä¹æ˜¯å”¯ä¸€èƒ½è¢«ç§°ä½œå…¨æ ˆå¾®æœåŠ¡æ¡†æ¶çš„â€œæ¡†æ¶â€ï¼Œå®ƒåŒ…å«äº†å¾®æœåŠ¡æ‰€éœ€çš„å‡ ä¹æ‰€æœ‰å†…å®¹ï¼Œè€ŒDubboXä½œä¸ºå®ƒçš„å¢å¼ºï¼Œå¢åŠ äº†RESTæ”¯æŒã€‚ å®ƒä¼˜ç‚¹å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š å…¨æ ˆï¼ŒæœåŠ¡æ²»ç†çš„æ‰€æœ‰é—®é¢˜å‡ ä¹éƒ½æœ‰ç°æˆç­”æ¡ˆ å¯é ï¼Œç»è¿‡é˜¿é‡Œå®è·µæ£€éªŒçš„äº§å“ å®è·µå¤šï¼Œç¤¾åŒºæœ‰è®¸å¤šæˆåŠŸåº”ç”¨Dubboçš„ç»éªŒ ä¸è¿‡é—æ†¾çš„æ˜¯ï¼š å·²ç»åœæ­¢ç»´æŠ¤ ä¸åˆ©äºè£å‰ªä½¿ç”¨ â€œè¿‡äºJavaâ€ï¼Œä¸å…¶ä»–è¯­è¨€ç›¸å®¹æ€§ä¸€èˆ¬ Motanæ˜¯å¾®åšå¹³å°å¾®æœåŠ¡æ¡†æ¶ï¼Œæ‰¿è½½äº†å¾®åšå¹³å°åƒäº¿æ¬¡è°ƒç”¨ä¸šåŠ¡ã€‚ ä¼˜ç‚¹æ˜¯ï¼š æ€§èƒ½å¥½ï¼Œæºè‡ªäºå¾®åšå¯¹é«˜å¹¶å‘å’Œå®æ—¶æ€§çš„è¦æ±‚ æ¨¡å—åŒ–ï¼Œç»“æ„ç®€å•ï¼Œæ˜“äºä½¿ç”¨ ä¸å…¶ä»–è¯­è¨€ç›¸å®¹æ€§å¥½ ä¸è¿‡ï¼š ä¸ºâ€œçŸ­å¹³å¿«â€ä¸šåŠ¡è€Œç”Ÿï¼Œå³ä¸šåŠ¡ç®€å•ï¼Œè¿½æ±‚é«˜æ€§èƒ½é«˜å¹¶å‘ã€‚ Apache Thriftã€gRPCç­‰è™½ç„¶ä¼˜ç§€ï¼Œå¹¶ä¸èƒ½ç®—ä½œå¾®æœåŠ¡æ¡†æ¶ï¼Œè‡ªèº«å¹¶ä¸åŒ…æ‹¬æœåŠ¡å‘ç°ç­‰å¿…è¦ç‰¹æ€§ã€‚ å¦‚æœè¯´å¾®æœåŠ¡å°‘ä¸äº†Javaï¼Œé‚£ä¹ˆä¸€å®šå°‘ä¸äº†Springï¼Œå¦‚æœè¯´å°‘ä¸äº†Springï¼Œé‚£ä¹ˆå¾®æœåŠ¡â€œå®˜é…â€Spring Cloudå½“ç„¶æ˜¯å€¼å¾—æ–Ÿé…Œçš„é€‰æ‹©ã€‚ ä¼˜ç‚¹ï¼š â€œä¸åšç”Ÿäº§è€…ï¼Œåªåšæ¬è¿å·¥â€ ç®€å•æ–¹ä¾¿ï¼Œå‡ ä¹é›¶é…ç½® æ¨¡å—åŒ–ï¼Œæ¾æ•£è€¦åˆï¼ŒæŒ‰éœ€å–ç”¨ ç¤¾åŒºèƒŒé Springå¤§æ ‘ ä¸è¶³ï¼š è½»é‡å¹¶éå…¨æ ˆ æ²¡è§£å†³RPCçš„é—®é¢˜ å®è·µæ¡ˆä¾‹å°‘ æ ¹æ®æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†Spring Cloudä½œä¸ºæˆ‘ä»¬çš„å¾®æœåŠ¡æ¡†æ¶ï¼ŒåŸå› æœ‰4ç‚¹ï¼š è™½ç„¶DubboåŸºç¡€è®¾æ–½æ›´åŠ å®Œå–„ï¼Œä½†ç»“æ„å¤æ‚ï¼Œæˆ‘ä»¬å¾ˆéš¾åƒå¾—ä¸‹ï¼Œå®¹æ˜“å‡ºå‘ åŸºäºApache Thriftå’ŒgRPCè‡ªç ”ï¼ŒæŠ•å…¥äº§å‡ºæ¯”å¾ˆå·® ä¸æƒ³è¿‡æ—©å¼•å…¥RPCä»¥é˜²æ»¥ç”¨ï¼ŒRestfulé£æ ¼æœ¬èº«å°±æ˜¯ä¸€ç§çº¦æŸã€‚ åšé€‰æ‹©æ—¶ï¼ŒMotanè¿˜æ²¡æœ‰å‘å¸ƒ Spring CloudSpring Cloudæ˜¯ä¸€ä¸ªé›†æˆæ¡†æ¶ï¼Œå°†å¼€æºç¤¾åŒºä¸­çš„æ¡†æ¶é›†æˆåˆ°Springä½“ç³»ä¸‹ï¼Œå‡ ä¸ªé‡è¦çš„å®¶æ—é¡¹ç›®ï¼š spring-bootï¼Œä¸€æ”¹Javaåº”ç”¨ç¨‹åºè¿è¡Œéš¾ã€éƒ¨ç½²éš¾ï¼Œç”šè‡³æ— éœ€Webå®¹å™¨ï¼Œåªä¾èµ–JREå³å¯ spring-cloud-netflixï¼Œé›†æˆNetflixä¼˜ç§€çš„ç»„ä»¶Eurekaã€Hystrixã€Ribbonã€Zuulï¼Œæä¾›æœåŠ¡å‘ç°ã€é™æµã€å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒAPIç½‘å…³ç­‰ç‰¹æ€§æ”¯æŒ spring-cloud-configï¼Œå¾®æœåŠ¡é…ç½®ç®¡ç† spring-cloud-consulï¼Œé›†æˆConsulæ”¯æŒ æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†Spring Cloud Netflixæä¾›äº†EurekaæœåŠ¡æ³¨å†Œçš„é›†æˆæ”¯æŒï¼Œä¸è¿‡æ²¡é€‰å®ƒæ˜¯å› ä¸ºï¼š æ›´é€‚åˆçº¯Javaå¹³å°çš„æœåŠ¡æ³¨å†Œå’Œå‘ç° ä»ç„¶éœ€è¦å…¶ä»–åˆ†å¸ƒå¼KVæœåŠ¡åšåç«¯ï¼Œæ²¡è§£å†³æˆ‘ä»¬çš„æ ¸å¿ƒé—®é¢˜ Dockerä½œä¸ºæ”¯æ’‘å¹³å°çš„é‡è¦æŠ€æœ¯ä¹‹ä¸€ï¼ŒConsulå‡ ä¹ä¹Ÿæ˜¯æˆ‘ä»¬çš„å¿…é€‰æœåŠ¡ã€‚å› æ­¤æˆ‘ä»¬è§‰å¾—ä¸€äº‹ä¸çƒ¦äºŒä¸»ï¼Œç†æ‰€åº”å½“çš„Consulæˆä¸ºæˆ‘ä»¬çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ Consulçš„ä¼˜åŠ¿ï¼š ä½¿ç”¨Raftä¸€è‡´æ€§ç®—æ³•ï¼Œèƒ½ä¿è¯åˆ†å¸ƒå¼é›†ç¾¤å†…å„èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ æä¾›æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡çŠ¶æ€æ£€æŸ¥ æ”¯æŒHTTPã€DNSç­‰åè®® æä¾›åˆ†å¸ƒå¼ä¸€è‡´æ€§KVå­˜å‚¨ ä¹Ÿå°±æ˜¯è¯´ï¼ŒConsulå¯ä»¥ä¸€æ¬¡æ€§è§£å†³æˆ‘ä»¬å¯¹æœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ç®¡ç†çš„éœ€æ±‚ï¼Œè€Œä¸”é•¿æœŸæ¥çœ‹ä¹Ÿæ›´é€‚åˆè·Ÿä¸åŒå¹³å°çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬å’ŒDockerè°ƒåº¦ç³»ç»Ÿè¿›è¡Œæ•´åˆã€‚ æœ€åˆæ‰“ç®—è‡ªå·±å¼€å‘ä¸€ä¸ªConsulå’ŒSpring Cloudæ•´åˆçš„ç»„ä»¶ï¼Œä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬åšå‡ºè¿™ä¸ªå†³å®šçš„æ—¶å€™ï¼Œspring-cloud-consulåˆšåˆšå‘å¸ƒäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿æ¥å³ç”¨ï¼Œè¿™èŠ‚çº¦äº†å¾ˆå¤šçš„å·¥ä½œé‡ã€‚ å› æ­¤å€ŸåŠ©Consulå’Œspring-cloud-consulï¼Œæˆ‘ä»¬å®ç°äº† æœåŠ¡æ³¨å†Œï¼Œå¼•ç”¨äº†srping-cloud-consulçš„é¡¹ç›®å¯ä»¥è‡ªåŠ¨æ³¨å†ŒæœåŠ¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡HTTPæ¥å£æ‰‹åŠ¨æ³¨å†Œï¼ŒDockerå®¹å™¨ä¹Ÿå¯ä»¥è‡ªåŠ¨æ³¨å†Œ æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ï¼ŒConsulå¯ä»¥è‡ªåŠ¨ç»´æŠ¤å¥åº·çš„æœåŠ¡åˆ—è¡¨ å¼‚æ„ç³»ç»Ÿå¯ä»¥ç›´æ¥é€šè¿‡Consulçš„HTTPæ¥å£æ‹‰å–å¹¶ç›‘è§†æœåŠ¡åˆ—è¡¨ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨DNSè§£ææœåŠ¡ é€šè¿‡åˆ†å¸ƒå¼ä¸€è‡´æ€§KVå­˜å‚¨è¿›è¡Œå¾®æœåŠ¡çš„é…ç½®ä¸‹å‘ ä¸ºä¸€äº›ä¸šåŠ¡æä¾›é€‰ä¸»å’Œåˆ†å¸ƒå¼é”æœåŠ¡ å½“ç„¶ä¹Ÿè¸©åˆ°äº†ä¸€äº›å‘ï¼š spring-cloud-consulæœåŠ¡æ³¨å†Œæ—¶ä¸èƒ½æ­£ç¡®é€‰åˆ¤æœ¬åœ°ipåœ°å€ã€‚å¯¹äºæˆ‘ä»¬çš„ç¯å¢ƒæ¥è¯´ï¼Œæ— è®ºæ˜¯åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿˜æ˜¯Dockerå®¹å™¨é‡Œï¼Œéƒ½æœ‰å¤šä¸ªç½‘ç»œæ¥å£åŒæ—¶å­˜åœ¨ï¼Œè€Œspring-cloud-consulåœ¨æ³¨å†ŒæœåŠ¡æ—¶ï¼Œéœ€è¦å…ˆé€‰åˆ¤æœ¬åœ°æœåŠ¡çš„IPåœ°å€ï¼Œåˆ¤æ–­é€»è¾‘æ˜¯ä»¥ç¬¬ä¸€ä¸ªéæœ¬åœ°åœ°å€ä¸ºå‡†ï¼Œå¸¸å¸¸é”™åˆ¤ã€‚å› æ­¤åœ¨å®¹å™¨ä¸­æˆ‘ä»¬åˆ©ç”¨entrypointè„šæœ¬è·å–å†é€šè¿‡ç¯å¢ƒå˜é‡å¼ºåˆ¶æŒ‡å®šã€‚ 12345678910111213141516171819202122#!/usr/bin/env bashset -e# If service runs as Rancher service, auto set advertise ip address# from Rancher metadata service.if [ -n \"$RUN_IN_RANCHER\" ]; then echo \"Waiting for ip address...\" # Waiting for ip address sleep 5 RANCHER_MS_BASE=http://rancher-metadata/2015-12-19 PRIMARY_IP=`curl -sSL $RANCHER_MS_BASE/self/container/primary_ip` SERVICE_INDEX=`curl -sSL $RANCHER_MS_BASE/self/container/service_index` if [ -n \"$PRIMARY_IP\" ]; then export SPRING_CLOUD_CONSUL_DISCOVERY_HOSTNAME=$PRIMARY_IP fi echo \"Starting service #$&#123;SERVICE_INDEX-1&#125; at $PRIMARY_IP.\"fiexec \"$@\" æˆ‘ä»¬çš„å®¹å™¨è¿è¡Œåœ¨Rancherä¸­ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨Rancherçš„metadataæœåŠ¡æ¥è·å–å®¹å™¨çš„IPåœ°å€ï¼Œå†é€šè¿‡SPRING_CLOUD_CONSUL_DISCOVERY_HOSTNAMEç¯å¢ƒå˜é‡æ¥è®¾ç½®æœåŠ¡å‘ç°çš„æ³¨å†Œåœ°å€ã€‚åŸºäºå…¶ä»–å®¹å™¨è°ƒåº¦å¹³å°ä¹Ÿä¼šå¾ˆç›¸ä¼¼ã€‚ å¦å¤–ä¸€äº›æœåŠ¡ä¸­å†…ç½®äº†å®šæ—¶è°ƒåº¦ä»»åŠ¡ç­‰ï¼Œå¤šå®ä¾‹å¯åŠ¨æ—¶éœ€è¦å•èŠ‚ç‚¹è¿è¡Œè°ƒåº¦ä»»åŠ¡ã€‚é€šè¿‡Consulçš„åˆ†å¸ƒå¼é”æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è®©è·å–åˆ°é”çš„èŠ‚ç‚¹å¯ç”¨è°ƒåº¦ä»»åŠ¡ï¼Œæ²¡è·å–åˆ°çš„èŠ‚ç‚¹ç­‰å¾…è·å–é”ã€‚ æœåŠ¡é›†æˆä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œå¾®æœåŠ¡æ¡†æ¶åº”å½“ç®€å•å®¹æ˜“ä½¿ç”¨ã€‚å¯¹äºå¾ˆå¤šå¾®æœåŠ¡æ¡†æ¶å’ŒRPCæ¡†æ¶æ¥è¯´ï¼Œéƒ½æä¾›äº†å¾ˆå¥½çš„æœºåˆ¶ã€‚åœ¨Spring Cloudä¸­é€šè¿‡OpenFeignå®ç°å¾®æœåŠ¡ä¹‹é—´çš„å¿«é€Ÿé›†æˆï¼š æœåŠ¡æ–¹å£°æ˜ä¸€ä¸ªRestfulçš„æœåŠ¡æ¥å£ï¼Œå’Œæ™®é€šçš„Spring MVCæ§åˆ¶å™¨å‡ ä¹åˆ«æ— äºŒè‡´ï¼š 1234567891011121314@RestController@RequestMapping(\"/users\")public class UserResource &#123; @RequestMapping(value = \"&#123;id&#125;\", method = RequestMethod.GET, produces = \"application/json\") public UserRepresentation findOne(@PathVariable(\"id\") String id) &#123; User user = this.userRepository.findByUserId(new UserId(id)); if (user == null || user.getDeleted()) &#123; throw new NotFoundException(\"æŒ‡å®šIDçš„ç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…å·²è¢«åˆ é™¤ã€‚\"); &#125; return new UserRepresentation(user); &#125;&#125; å®¢æˆ·æ–¹ä½¿ç”¨ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š 1234567@FeignClient(\"epic-member-microservice\")public interface UserClient &#123; @Override @RequestMapping(value = \"/users/&#123;id&#125;\", method = RequestMethod.GET, produces = \"application/json\") User findOne(@PathVariable(\"id\") String id);&#125; åœ¨éœ€è¦ä½¿ç”¨UserClientçš„Beanä¸­ï¼Œç›´æ¥æ³¨å…¥UserClientç±»å‹å³å¯ã€‚äº‹å®ä¸Šï¼ŒUserClientå’Œç›¸å…³VOç±»ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºå…¬å…±æ¥å£å°è£…åœ¨å…¬å…±é¡¹ç›®ä¸­ï¼Œä¾›ä»»æ„éœ€è¦ä½¿ç”¨çš„å¾®æœåŠ¡å¼•ç”¨ï¼ŒæœåŠ¡æ–¹Restful Controllerç›´æ¥å®ç°è¿™ä¸€æ¥å£å³å¯ã€‚ OpenFeignæä¾›äº†è¿™ç§ç®€å•çš„æ–¹å¼æ¥ä½¿ç”¨RestfulæœåŠ¡ï¼Œè¿™å¤§å¤§é™ä½äº†è¿›è¡Œæ¥å£è°ƒç”¨çš„å¤æ‚ç¨‹åº¦ã€‚ å¯¹äºé”™è¯¯çš„å¤„ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨HTTPçŠ¶æ€ç ä½œä¸ºé”™è¯¯æ ‡è¯†ï¼Œå¹¶åšäº†å¦‚ä¸‹è§„å®šï¼š 4xxç”¨æ¥è¡¨ç¤ºç”±äºå®¢æˆ·æ–¹å‚æ•°é”™è¯¯ã€çŠ¶æ€ä¸æ­£ç¡®ã€æ²¡æœ‰æƒé™ã€æ“ä½œå†²çªç­‰ç§ç§åŸå› å¯¼è‡´çš„ä¸šåŠ¡é”™è¯¯ã€‚ 5xxç”¨æ¥è¡¨ç¤ºç”±äºæœåŠ¡æ–¹ç³»ç»Ÿå¼‚å¸¸ã€æ— æ³•æœåŠ¡ç­‰åŸå› æœåŠ¡ä¸å¯ç”¨çš„é”™è¯¯ã€‚ å¯¹äºæœåŠ¡å™¨ç«¯ï¼Œåªéœ€è¦åœ¨ä¸€ä¸ªå¼‚å¸¸ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå³å¯æŒ‡å®šè¯¥å¼‚å¸¸çš„HTTPå“åº”çŠ¶æ€ç ï¼Œä¾‹å¦‚ï¼š 123456789101112131415@ResponseStatus(HttpStatus.NOT_FOUND)public class NotFoundException extends RuntimeException &#123; public NotFoundException() &#123; super(\"æŸ¥æ‰¾çš„èµ„æºä¸å­˜åœ¨æˆ–è€…å·²è¢«åˆ é™¤ã€‚\"); &#125; public NotFoundException(String message) &#123; super(message); &#125; public NotFoundException(String message, Throwable cause) &#123; super(message, cause); &#125;&#125; å¯¹äºå®¢æˆ·ç«¯æˆ‘ä»¬å®ç°äº†è‡ªå·±çš„FeignClientExceptionErrorDecoderæ¥å°†è¯·æ±‚å¼‚å¸¸è½¬æ¢ä¸ºå¯¹äºçš„å¼‚å¸¸ç±»ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627@Componentpublic class FeignClientExceptionErrorDecoder implements ErrorDecoder &#123; private final ErrorDecoder delegate = new ErrorDecoder.Default(); @Override public Exception decode(String methodKey, Response response) &#123; // Only decode 4xx errors. if (response.status() &gt;= 500) &#123; return delegate.decode(methodKey, response); &#125; // Response content type must be json if (response.headers().getOrDefault(\"Content-Type\", Lists.newArrayList()).stream() .filter(s -&gt; s.toLowerCase().contains(\"json\")).count() &gt; 0) &#123; try &#123; String body = Util.toString(response.body().asReader()); // è½¬æ¢å¹¶è¿”å›å¼‚å¸¸å¯¹è±¡ ... &#125; catch (IOException ex) &#123; throw new RuntimeException(\"Failed to process response body.\", ex); &#125; &#125; return delegate.decode(methodKey, response); &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdecodeæ–¹æ³•è¿”å›çš„4xxçŠ¶æ€ç å¼‚å¸¸åº”å½“æ˜¯HystrixBadRequestExceptionçš„å­ç±»å¯¹è±¡ï¼ŒåŸå› åœ¨äºï¼Œæˆ‘ä»¬æŠŠ4xxå¼‚å¸¸è§†ä½œä¸šåŠ¡å¼‚å¸¸ï¼Œè€Œä¸æ˜¯ç”±äºæ•…éšœå¯¼è‡´çš„å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸åº”å½“è¢«Hystrixè®¡ç®—ä¸ºå¤±è´¥è¯·æ±‚ï¼Œå¹¶å¼•å‘æ–­è·¯å™¨åŠ¨ä½œï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ åœ¨UserClient.findOneæ–¹æ³•çš„è°ƒç”¨ä»£ç ä¸­ï¼Œå³å¯ç›´æ¥æ•è·ç›¸åº”çš„å¼‚å¸¸äº†ï¼š 12345try &#123; User user = this.userClient.findOne(new UserId(id));&#125; catch(NotFoundException ex) &#123; ...&#125; é€šè¿‡OpenFeignï¼Œæˆ‘ä»¬å¤§å¤§é™ä½äº†Restfulæ¥å£è¿›è¡ŒæœåŠ¡é›†æˆçš„éš¾åº¦ï¼Œå‡ ä¹åšåˆ°äº†æ— é¢å¤–å·¥ä½œé‡çš„æœåŠ¡é›†æˆã€‚ æœåŠ¡è´¨é‡ä¿è¯å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œç”±äºè°ƒç”¨éœ€è¦è·¨ç³»ç»Ÿè¿›è¡Œè¿œç¨‹æ“ä½œï¼Œå„å¾®æœåŠ¡ç‹¬ç«‹è¿ç»´ï¼Œæ‰€ä»¥åœ¨è®¾è®¡æ¶æ„æ—¶è¿˜å¿…é¡»è€ƒè™‘ä¼¸ç¼©æ€§å’Œå®¹é”™æ€§ï¼Œå…·ä½“åœ°è¯´ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹è¦æ±‚ï¼š æœåŠ¡å®ä¾‹å¯ä»¥å¹³æ»‘åœ°åŠ å…¥ã€ç§»é™¤ æµé‡å¯ä»¥å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸åŒçš„å®ä¾‹ä¸Š æ¥å£åº”å½“èµ„æºéš”ç¦»ï¼Œé˜²æ­¢å› ä¸ºä¸ªåˆ«æ¥å£è°ƒç”¨æ—¶é—´è¿‡é•¿å¯¼è‡´çº¿ç¨‹æ± è¢«å æ»¡è€Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ èƒ½æ”¯æŒæ¥å£é™çº§å¹¶éš”ç¦»æ•…éšœèŠ‚ç‚¹ï¼Œé˜²æ­¢é›†ç¾¤é›ªå´© æœåŠ¡èƒ½è¿›è¡Œå¹³æ»‘å‡çº§ Spring Cloudä¸­å†…ç½®çš„spring-cloud-netflixçš„å…¶ä»–ç»„ä»¶ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼š Hystrix - å®ç°äº†æ–­è·¯å™¨æ¨¡å¼ï¼Œå¸®åŠ©æ§æµå’Œé™çº§ï¼Œé˜²æ­¢é›†ç¾¤é›ªå´©ï¼Œå°±åƒæ±½è½¦çš„é¿éœ‡å™¨ Ribbon - æä¾›äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ Zuul - APIç½‘å…³æ¨¡å¼ï¼Œå¸®åŠ©å®ç°æ¥å£çš„è·¯ç”±ã€è®¤è¯ç­‰ ä¸‹é¢ä¸»è¦ä»‹ç»ä¸€ä¸‹ï¼Œå„ä¸ªç»„ä»¶åœ¨è¿›è¡ŒæœåŠ¡è´¨é‡ä¿è¯ä¸­æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„ã€‚ ConsulConsulä¸­æ³¨å†Œäº†ä¸€è‡´æ€§çš„å¯ç”¨çš„æœåŠ¡åˆ—è¡¨ï¼Œå¹¶é€šè¿‡å¥åº·æ£€æŸ¥ä¿è¯è¿™äº›å®ä¾‹éƒ½æ˜¯å­˜æ´»çš„ï¼ŒæœåŠ¡æ³¨å†Œå’Œæ£€æŸ¥çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š æœåŠ¡å¯åŠ¨å®Œæˆï¼ŒæœåŠ¡ç«¯å£å¼€å§‹ç›‘å¬æ—¶ï¼Œspring-cloud-consulé€šè¿‡Consulæ¥å£å‘èµ·æœåŠ¡æ³¨å†Œï¼Œå°†æœåŠ¡çš„/healthä½œä¸ºå¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼› Consulæ¯éš”5ç§’è®¿é—®/healthï¼Œæ£€æŸ¥å½“å‰å¾®æœåŠ¡æ˜¯å¦ä¸ºUPçŠ¶æ€ï¼› /healthå°†ä¼šæ”¶é›†å¾®æœåŠ¡å†…å„ä¸ªä»ªè¡¨æ”¶é›†ä¸Šæ¥çš„çŠ¶æ€æ•°æ®ï¼Œä¸»è¦åŒ…æ‹¬æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦è¿é€šç­‰ï¼› å¦‚æœä¸ºUPçŠ¶æ€ï¼Œåˆ™å¾®æœåŠ¡å®ä¾‹è¢«æ ‡è®°ä¸ºå¥åº·å¯ç”¨ï¼Œå¦åˆ™è¢«æ ‡è®°æˆå¤±è´¥ï¼› å½“æœåŠ¡å…³é—­æ—¶ï¼Œå…ˆä»Consulä¸­å–æ¶ˆæœåŠ¡æ³¨å†Œï¼Œå†ä¼˜é›…åœæœºã€‚ è¿™æ ·èƒ½å¤Ÿä¿è¯Consulä¸­åˆ—å‡ºçš„æ‰€æœ‰å¾®æœåŠ¡çŠ¶æ€éƒ½æ˜¯å¥åº·å¯ç”¨çš„ï¼Œå„ä¸ªå¾®æœåŠ¡ä¼šç›‘è§†å¾®æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œè‡ªåŠ¨åŒæ­¥æ›´æ–°ä»–ä»¬ã€‚ HystrixHystrixæä¾›äº†æ–­è·¯å™¨æ¨¡å¼çš„å®ç°ï¼Œä¸»è¦åœ¨ä¸‰ä¸ªæ–¹é¢å¯ä»¥è¯´æ˜ï¼š å›¾ç‰‡æ¥è‡ªHystrixé¡¹ç›®æ–‡æ¡£ é¦–å…ˆHystrixæä¾›äº†é™çº§æ–¹æ³•ï¼Œæ–­è·¯å™¨å¼€å¯æ—¶ï¼Œæ“ä½œè¯·æ±‚ä¼šå¿«é€Ÿå¤±è´¥ä¸å†å‘åæŠ•é€’ï¼Œç›´æ¥è°ƒç”¨fallbackæ–¹æ³•æ¥è¿”å›æ“ä½œï¼›å½“æ“ä½œå¤±è´¥ã€è¢«æ‹’æˆ–è€…è¶…æ—¶åï¼Œä¹Ÿä¼šç›´æ¥è°ƒç”¨fallbackæ–¹æ³•è¿”å›æ“ä½œã€‚è¿™å¯ä»¥ä¿è¯åœ¨ç³»ç»Ÿè¿‡è½½æ—¶ï¼Œèƒ½æœ‰åå¤‡æ–¹æ¡ˆæ¥è¿”å›ä¸€ä¸ªæ“ä½œï¼Œæˆ–è€…ä¼˜é›…çš„æç¤ºé”™è¯¯ä¿¡æ¯ã€‚æ–­è·¯å™¨çš„å­˜åœ¨èƒ½è®©æ•…éšœä¸šåŠ¡è¢«éš”ç¦»ï¼Œé˜²æ­¢è¿‡è½½çš„æµé‡æ¶Œå…¥æ‰“æ­»åç«¯æ•°æ®åº“ç­‰ã€‚ ç„¶åæ˜¯åŸºäºè¯·æ±‚æ•°æ®ç»Ÿè®¡çš„æ–­è·¯å¼€å…³ï¼Œåœ¨Hystrixä¸­ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚ç»Ÿè®¡äº†åˆ—è¡¨ï¼ˆé»˜è®¤æœ€å¤š10æ¡ï¼‰ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ªæ¡¶ã€‚æ¯ä¸ªæ¡¶è®°å½•äº†åœ¨è¿™ä¸ªæ¡¶çš„æ—¶é—´èŒƒå›´å†…ï¼ˆé»˜è®¤æ˜¯1ç§’ï¼‰ï¼Œè¯·æ±‚çš„æˆåŠŸæ•°ã€å¤±è´¥æ•°ã€è¶…æ—¶æ•°ã€è¢«æ‹’æ•°ã€‚å…¶ä¸­å½“å¤±è´¥è¯·æ±‚çš„æ¯”ä¾‹é«˜äºæŸä¸€å€¼æ—¶ï¼Œå°†ä¼šè§¦å‘æ–­è·¯å™¨å·¥ä½œã€‚ æœ€åæ˜¯ä¸åŒçš„è¯·æ±‚å‘½ä»¤ï¼ˆHystrixCommandï¼‰å¯ä»¥ä½¿ç”¨å½¼æ­¤éš”ç¦»çš„èµ„æºæ± ï¼Œä¸ä¼šå‘ç”Ÿç›¸äº’çš„æŒ¤å ã€‚åœ¨Hystrixä¸­æä¾›äº†ä¸¤ç§éš”ç¦»æœºåˆ¶ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± å’Œä¿¡å·é‡ã€‚çº¿ç¨‹æ± æ¨¡å¼ä¸‹ï¼Œé€šè¿‡çº¿ç¨‹æ± çš„å¤§å°æ¥é™åˆ¶åŒæ—¶å ç”¨èµ„æºçš„è¯·æ±‚å‘½ä»¤æ•°ç›®ï¼›ä¿¡å·é‡æ¨¡å¼ä¸‹é€šè¿‡æ§åˆ¶è¿›å…¥ä¸´ç•ŒåŒºçš„æ“ä½œæ•°ç›®æ¥è¾¾åˆ°é™æµçš„ç›®çš„ã€‚ è¿™é‡ŒåŒ…æ‹¬äº†Hystrixçš„ä¸€äº›é‡è¦å‚æ•°çš„é…ç½®é¡¹ï¼š å‚æ•° è¯´æ˜ circuitBreaker.requestVolumeThreshold è‡³å°‘åœ¨ä¸€ä¸ªç»Ÿè®¡çª—å£å†…æœ‰å¤šå°‘ä¸ªè¯·æ±‚åï¼Œæ‰æ‰§è¡Œæ–­è·¯å™¨çš„å¼€å…³ï¼Œé»˜è®¤20 circuitBreaker.sleepWindowInMilliseconds æ–­è·¯å™¨è§¦å‘åå¤šä¹…åæ‰è¿›è¡Œä¸‹ä¸€æ¬¡åˆ¤å®šï¼Œé»˜è®¤5000æ¯«ç§’ circuitBreaker.errorThresholdPercentage ä¸€ä¸ªç»Ÿè®¡çª—å£å†…ç™¾åˆ†ä¹‹å¤šå°‘çš„è¯·æ±‚å¤±è´¥æ‰è§¦å‘ç†”æ–­ï¼Œé»˜è®¤æ˜¯50% execution.isolation.strategy è¿è¡Œéš”ç¦»ç­–ç•¥ï¼Œæ”¯æŒThreadï¼ŒSemaphoreï¼Œå‰è€…é€šè¿‡çº¿ç¨‹æ± æ¥æ§åˆ¶åŒæ—¶è¿è¡Œçš„å‘½ä»¤ï¼Œåè€…é€šè¿‡ä¿¡å·æ¥æ§åˆ¶ï¼Œé»˜è®¤æ˜¯Thread execution.isolation.thread.interruptOnTimeout å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤1000æ¯«ç§’ coreSize çº¿ç¨‹æ± å¤§å°ï¼Œé»˜è®¤10 keepAliveTimeMinutes çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œé»˜è®¤ä¸º1åˆ†é’Ÿ maxQueueSize æœ€å¤§é˜Ÿåˆ—é•¿åº¦ï¼Œ-1ä½¿ç”¨SynchronousQueueï¼Œé»˜è®¤-1ã€‚ queueSizeRejectionThreshold å…è®¸é˜Ÿåˆ—å †ç§¯çš„æœ€å¤§æ•°é‡ RibbonRibbonä½¿ç”¨Consulæä¾›çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡åé€‰å–ä¸€ä¸ªåç«¯æœåŠ¡å®ä¾‹è¿æ¥ï¼Œå¹¶ä¿è¯åç«¯æµé‡å‡åŒ€åˆ†å¸ƒã€‚spring-cloud-netflixæ•´åˆäº†OpenFeignã€Hystrixå’ŒRibbonçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼ˆè¿”å›å€¼è·¯å¾„å·²ç»çœç•¥ï¼‰ï¼š åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªç»„ä»¶æ‰®æ¼”çš„è§’è‰²å¦‚ä¸‹ï¼š Feignä½œä¸ºå®¢æˆ·ç«¯å·¥å‚ï¼Œè´Ÿè´£ç”Ÿæˆå®¢æˆ·ç«¯å¯¹è±¡ï¼Œè¯·æ±‚å’Œåº”ç­”çš„ç¼–è§£ç  Hystrixæä¾›é™æµã€æ–­è·¯å™¨ã€é™çº§ã€æ•°æ®ç»Ÿè®¡ Ribbonæä¾›è´Ÿè½½å‡è¡¡å™¨ Feignè´Ÿè´£æä¾›å®¢æˆ·ç«¯æ¥å£æ”¶è°ƒç”¨ï¼ŒæŠŠå‘èµ·è¯·æ±‚æ“ä½œï¼ˆåŒ…æ‹¬ç¼–ç ã€è§£ç å’Œè¯·æ±‚æ•°æ®ï¼‰å°è£…æˆä¸€ä¸ªHystrixå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤åŒ…è£¹çš„è¯·æ±‚å¯¹è±¡ï¼Œä¼šè¢«Ribbonçš„è´Ÿè½½å‡è¡¡å™¨å¤„ç†ï¼ŒæŒ‰ç…§è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªä¸»æœºï¼Œç„¶åäº¤ç»™è¯·æ±‚å¯¹è±¡ç»‘å®šçš„HTTPå®¢æˆ·ç«¯å¯¹è±¡å‘è¯·æ±‚ï¼Œå“åº”æˆåŠŸæˆ–è€…ä¸æˆåŠŸçš„ç»“æœï¼Œè¿”å›ç»™Hystrixã€‚ spring-cloud-netflixä¸­é»˜è®¤ä½¿ç”¨äº†Ribbonçš„ZoneAwareLoadBalancerè´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥çš„æ ¸å¿ƒæŒ‡æ ‡æ˜¯å¹³å‡æ´»è·ƒè¯·æ±‚æ•°ï¼ˆAverage Active Requestsï¼‰ã€‚ZoneAwareLoadBalancerä¼šæ‹‰å–æ‰€æœ‰å½“å‰å¯ç”¨çš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œç„¶åå°†ç›®å‰ç”±äºç§ç§åŸå› ï¼ˆæ¯”å¦‚ç½‘ç»œå¼‚å¸¸ï¼‰å“åº”è¿‡æ…¢çš„å®ä¾‹æš‚æ—¶ä»å¯ç”¨æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿™æ ·çš„æœºåˆ¶å¯ä»¥ä¿è¯æ•…éšœå®ä¾‹è¢«éš”ç¦»ï¼Œä»¥å…ç»§ç»­å‘å…¶å‘é€æµé‡å¯¼è‡´é›†ç¾¤çŠ¶æ€è¿›ä¸€æ­¥æ¶åŒ–ã€‚ä¸è¿‡ç”±äºç›®å‰spring-cloud-consulè¿˜ä¸æ”¯æŒé€šè¿‡consulæ¥æŒ‡å®šæœåŠ¡å®ä¾‹çš„æ‰€åœ¨åŒºï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›å°†è¿™ä¸€åŠŸèƒ½å®Œå–„ã€‚é™¤äº†é€‰åŒºç­–ç•¥å¤–ï¼ŒRibbonä¸­è¿˜æä¾›äº†å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰åˆé€‚çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ æ€»çš„æ¥çœ‹ï¼Œspring-cloud-netflixå’ŒRibbonä¸­æä¾›äº†åŸºæœ¬çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´å·²ç»è¶³å¤Ÿç”¨äº†ã€‚ä½†å®è·µä¸­ï¼Œå¦‚æœéœ€è¦è¿›è¡Œç°åº¦å‘å¸ƒæˆ–è€…éœ€è¦è¿›è¡Œæµé‡å‹æµ‹ï¼Œç›®å‰æ¥çœ‹è¿˜å¾ˆéš¾ç›´æ¥å®ç°ã€‚è€Œè¿™äº›ç‰¹æ€§åœ¨Dubboåˆ™å¼€ç®±å³ç”¨ã€‚ ZuulZuulä¸ºä½¿ç”¨Javaè¯­è¨€çš„æ¥å…¥å±‚æœåŠ¡æä¾›APIç½‘å…³æœåŠ¡ï¼Œæ—¢å¯ä»¥æ ¹æ®é…ç½®åå‘ä»£ç†æŒ‡å®šçš„æ¥å£ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å‘ç°è‡ªåŠ¨é…ç½®ã€‚Zuulæä¾›äº†ç±»ä¼¼äºiptablesçš„å¤„ç†æœºåˆ¶ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å®ç°éªŒè¯æƒé‰´ã€æ—¥å¿—ç­‰ï¼Œè¯·æ±‚å·¥ä½œæµå¦‚ä¸‹æ‰€ç¤ºï¼š å›¾ç‰‡æ¥è‡ªZuulå®˜æ–¹æ–‡æ¡£ã€‚ ä½¿ç”¨Zuulè¿›è¡Œåå‘ä»£ç†æ—¶ï¼ŒåŒæ ·ä¼šèµ°ä¸OpenFeignç±»ä¼¼çš„è¯·æ±‚è¿‡ç¨‹ï¼Œç¡®ä¿APIçš„è°ƒç”¨è¿‡ç¨‹ä¹Ÿèƒ½é€šè¿‡Hystrixã€Ribbonæä¾›çš„é™çº§ã€æ§æµæœºåˆ¶ã€‚ Hystrix DashboardHystrixä¼šç»Ÿè®¡æ¯ä¸ªè¯·æ±‚æ“ä½œçš„æƒ…å†µæ¥å¸®åŠ©æ§åˆ¶æ–­è·¯å™¨ï¼Œè¿™äº›æ•°æ®æ˜¯å¯ä»¥æš´éœ²å‡ºæ¥ä¾›ç›‘æ§ç³»ç»Ÿçƒ­ç‚¹ã€‚Hystrix Dashboardå¯ä»¥å°†å½“å‰æ¥å£è°ƒç”¨çš„æƒ…å†µä»¥å›¾å½¢å½¢å¼å±•ç¤ºå‡ºæ¥ï¼š å›¾ç‰‡æ¥è‡ªHystrix Dashboardå®˜æ–¹ç¤ºä¾‹ Hystrix Dashboardæ—¢å¯ä»¥é›†æˆåœ¨å…¶ä»–é¡¹ç›®ä¸­ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨Dockerå¯åŠ¨ä¸€ä¸ªHystrix DashboardæœåŠ¡å³å¯ï¼š 1docker run --rm -ti -p 7979:7979 kennedyoliveira/hystrix-dashboard ä¸ºäº†å®ç°èƒ½å¯¹æ•´ä¸ªå¾®æœåŠ¡é›†ç¾¤çš„æ¥å£è°ƒç”¨æƒ…å†µæ±‡æ€»ï¼Œå¯ä»¥ä½¿ç”¨spring-cloud-netflix-turbineæ¥å°†æ•´ä¸ªé›†ç¾¤çš„è°ƒç”¨æƒ…å†µæ±‡é›†èµ·æ¥ï¼Œä¾›Hystrix Dashboardå±•ç¤ºã€‚ æ—¥å¿—ç›‘æ§å¾®æœåŠ¡çš„æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯ä¸­ï¼Œå†ç”±Dockeré€šè¿‡syslogæ—¥å¿—é©±åŠ¨å°†æ—¥å¿—å†™å…¥è‡³èŠ‚ç‚¹æœºå™¨æœºçš„rsyslogä¸­ã€‚rsyslogåœ¨æœ¬åœ°æš‚å­˜å¹¶è½¬å‘è‡³æ—¥å¿—ä¸­å¿ƒèŠ‚ç‚¹çš„Logstashä¸­ï¼Œæ—¢å½’æ¡£å­˜å‚¨ï¼Œåˆé€šè¿‡ElasticSearchè¿›è¡Œç´¢å¼•ï¼Œæ—¥å¿—å¯ä»¥é€šè¿‡Kibanaå±•ç¤ºæŠ¥è¡¨ã€‚ åœ¨rsyslogçš„æ—¥å¿—æ”¶é›†æ—¶ï¼Œéœ€è¦å°†å®¹å™¨ä¿¡æ¯å’Œé•œåƒä¿¡æ¯åŠ å…¥åˆ°tagä¸­ï¼Œé€šè¿‡Dockerå¯åŠ¨å‚æ•°æ¥è¿›è¡Œé…ç½®ï¼š 1--log-driver syslog --log-opt tag=&quot;&#123;&#123;.ImageName&#125;&#125;/&#123;&#123;.Name&#125;&#125;/&#123;&#123;.ID&#125;&#125;&quot; ä¸è¿‡rsyslogé»˜è®¤åªå…è®¸tagä¸è¶…è¿‡32ä¸ªå­—ç¬¦ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰äº†æ—¥å¿—æ¨¡æ¿ï¼š 1template (name=&quot;LongTagForwardFormat&quot; type=&quot;string&quot; string=&quot;&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg%&quot;) åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ï¼Œå½“ä¸»æœºå†…å­˜è´Ÿè½½æ¯”è¾ƒé«˜æ—¶ï¼Œrsyslogä¼šå‘ç”Ÿæ—¥å¿—æ— æ³•æ”¶é›†çš„æƒ…å†µï¼ŒæŠ¥æ—¥å¿—æ•°æ®æ–‡ä»¶æŸåã€‚åæ¥åœ¨Redhatå®˜æ–¹æ‰¾åˆ°äº†ç›¸å…³çš„é—®é¢˜ï¼Œç¡®è®¤æ˜¯rsyslogä¸­çš„ä¸€ä¸ªBugå¯¼è‡´çš„ï¼Œå½“å¼€å¯æ—¥å¿—å‹ç¼©æ—¶ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€‰æ‹©æš‚æ—¶æŠŠå®ƒç¦ç”¨æ‰ã€‚ é¢†åŸŸé©±åŠ¨è®¾è®¡æˆ‘ä»¬ä½¿ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„æ–¹æ³•æ¥æ„å»ºå¾®æœåŠ¡ï¼Œå› ä¸ºå¾®æœåŠ¡æ¶æ„å’ŒDDDæœ‰ä¸€ç§å¤©ç„¶çš„å¥‘åˆã€‚æŠŠæ‰€æœ‰ä¸šåŠ¡åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­é¢†åŸŸï¼Œæœ‰å¼ºå†…åœ¨å…³è”å…³ç³»çš„é¢†åŸŸï¼ˆç•Œé™ä¸Šä¸‹æ–‡ï¼‰åº”å½“è¢«æ”¾åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡ã€‚æœ€åå½¢æˆäº†ç•Œé™ä¸Šä¸‹æ–‡-å·¥ä½œå›¢é˜Ÿ-å¾®æœåŠ¡ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼š èº«ä»½ä¸è®¿é—® - å›¢é˜ŸA - æˆå‘˜å¾®æœåŠ¡ å•†å“ä¸ä¿ƒé”€ - å›¢é˜ŸB - å•†å“å¾®æœåŠ¡ è®¢å•äº¤æ˜“ - å›¢é˜ŸC - äº¤æ˜“å¾®æœåŠ¡ â€¦ å¾®æœåŠ¡è®¾è®¡åœ¨è®¾è®¡å•ä¸ªå¾®æœåŠ¡ï¼ˆEpicå±‚çš„å¾®æœåŠ¡ï¼‰æ—¶ï¼Œæˆ‘ä»¬è¿™æ ·åšï¼š ä½¿ç”¨OODæ–¹æ³•å¯¹ä¸šåŠ¡è¿›è¡Œé¢†åŸŸå»ºæ¨¡ï¼Œé¢†åŸŸæ¨¡å‹åº”å½“æ˜¯å……è¡€æ¨¡å‹ é¢†åŸŸæœåŠ¡å¸®åŠ©å®Œæˆå¤šä¸ªé¢†åŸŸå¯¹è±¡åä½œ äº‹ä»¶é©±åŠ¨ï¼Œæä¾›é¢†åŸŸäº‹ä»¶ï¼Œä¾›å†…éƒ¨æˆ–è€…å…¶ä»–å¾®æœåŠ¡ä½¿ç”¨ ä¾èµ–å€’ç½®ï¼Œåœ¨é€‚é…å™¨æ¥å£ä¸­å®ç°å’Œæ¡†æ¶ã€ç»„ä»¶ã€SDKçš„æ•´åˆ è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†æ˜¾è‘—çš„å¥½å¤„ï¼š æœåŠ¡å¼€å‘æ—¶å…³æ³¨äºä¸šåŠ¡ï¼Œè¾¹ç•Œåˆç†æ¸…æ™° å®¹æ˜“ç›´æ¥å¯¹é¢†åŸŸæ¨¡å‹è¿›è¡Œå•å…ƒæµ‹è¯• ä¸ä¾èµ–ç‰¹å®šç»„ä»¶æˆ–è€…å¹³å° äº‹åŠ¡é—®é¢˜ä»å•ä½“åº”ç”¨è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„æ—¶ï¼Œä¸å¾—ä¸é¢ä¸´çš„é—®é¢˜ä¹‹ä¸€å°±æ˜¯äº‹åŠ¡ã€‚åœ¨å•ä½“åº”ç”¨æ—¶ä»£ï¼Œæ‰€æœ‰ä¸šåŠ¡å…±äº«åŒä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€æ¬¡è¯·æ±‚æ“ä½œå¯æ”¾ç½®åœ¨åŒä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­ï¼›åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œè¿™ä»¶äº‹å˜å¾—éå¸¸å›°éš¾ã€‚ç„¶è€Œäº‹åŠ¡é—®é¢˜ä¸å¯é¿å…ï¼Œéå¸¸å…³é”®ã€‚ è§£å†³äº‹åŠ¡é—®é¢˜æ—¶ï¼Œæœ€å…ˆæƒ³åˆ°çš„è§£å†³æ–¹æ³•é€šå¸¸æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åˆ†å¸ƒå¼äº‹åŠ¡åœ¨ä¼ ç»Ÿç³»ç»Ÿä¸­åº”ç”¨çš„æ¯”è¾ƒå¹¿æ³›ï¼Œä¸»è¦åŸºäºä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼å®ç°ã€‚ç„¶è€Œåˆ†å¸ƒå¼äº‹åŠ¡åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¯è¡Œæ€§å¹¶ä¸é«˜ï¼Œä¸»è¦åŸºäºè¿™äº›è€ƒè™‘ï¼š åˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦äº‹åŠ¡ç®¡ç†å™¨ï¼Œå¯¹äºä¸åŒè¯­è¨€å¹³å°æ¥è¯´ï¼Œå‡ ä¹æ²¡æœ‰æœ‰ä¸€è‡´çš„å®ç°æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼› å¹¶éæ‰€æœ‰çš„æŒä¹…åŒ–åŸºæ–½éƒ½æä¾›å®Œæ•´ACIDçš„äº‹åŠ¡ï¼Œæ¯”å¦‚ç°åœ¨å¹¿æ³›ä½¿ç”¨çš„NoSQLï¼› åˆ†å¸ƒå¼äº‹åŠ¡å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ æ ¹æ®CAPç†è®ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯å…¼å¾—ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆå¯é æ€§ï¼‰ä¸‰è€…ï¼Œå¯¹äºå¾®æœåŠ¡æ¶æ„æ¥è®²ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¿è¯å¯ç”¨æ€§ã€å®¹é”™æ€§ï¼Œç‰ºç‰²ä¸€éƒ¨åˆ†ä¸€è‡´æ€§ï¼Œè¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§ã€‚æ‰€ä»¥å¯¹äºå¾®æœåŠ¡æ¶æ„æ¥è¯´ï¼Œä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥è§£å†³äº‹åŠ¡é—®é¢˜æ— è®ºæ˜¯ä»æˆæœ¬è¿˜æ˜¯æ”¶ç›Šä¸Šæ¥çœ‹ï¼Œéƒ½ä¸åˆ’ç®—ã€‚ å¯¹å¾®æœåŠ¡ç³»ç»Ÿæ¥è¯´è§£å†³äº‹åŠ¡é—®é¢˜ï¼ŒCQRS+Event Sourcingæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ CQRSæ˜¯å‘½ä»¤å’ŒæŸ¥è¯¢èŒè´£åˆ†ç¦»çš„ç¼©å†™ã€‚CQRSçš„æ ¸å¿ƒè§‚ç‚¹æ˜¯ï¼ŒæŠŠæ“ä½œåˆ†ä¸ºä¿®æ”¹çŠ¶æ€çš„å‘½ä»¤ï¼ˆCommandï¼‰ï¼Œå’Œè¿”å›æ•°æ®çš„æŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå‰è€…å¯¹åº”äºâ€œå†™â€çš„æ“ä½œï¼Œä¸èƒ½è¿”å›æ•°æ®ï¼Œåè€…å¯¹åº”äºâ€œè¯»â€çš„æ“ä½œï¼Œä¸é€ æˆä»»ä½•å½±å“ï¼Œç”±æ­¤é¢†åŸŸæ¨¡å‹è¢«ä¸€åˆ†ä¸ºäºŒï¼Œåˆ†è€Œæ²»ä¹‹ã€‚ Event Sourcingé€šå¸¸è¢«ç¿»è¯‘æˆäº‹ä»¶æº¯æºï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯æŸä¸€å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—çš„äº‹ä»¶å åŠ åäº§ç”Ÿçš„ï¼Œå­˜å‚¨è¿™äº›äº‹ä»¶å³å¯é€šè¿‡é‡æ”¾è·å¾—å¯¹è±¡åœ¨ä»»ä¸€æ—¶é—´èŠ‚ç‚¹ä¸Šçš„çŠ¶æ€ã€‚ é€šè¿‡CQRS+Event Sourcingï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è·å¾—æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¾‹å¦‚å¯¹äºä¸€ä¸ªè·¨ç³»ç»Ÿçš„äº¤æ˜“è¿‡ç¨‹è€Œè¨€ï¼š ç”¨æˆ·åœ¨äº¤æ˜“å¾®æœåŠ¡æäº¤ä¸‹å•å‘½ä»¤ï¼Œäº§ç”Ÿé¢†åŸŸäº‹ä»¶PlaceOrderEventï¼Œè®¢å•çŠ¶æ€PENDINGï¼› æ”¯ä»˜å¾®æœåŠ¡æ”¶åˆ°é¢†åŸŸäº‹ä»¶è¿›è¡Œæ‰£æ¬¾ï¼Œæ‰£æ¬¾æˆåŠŸäº§ç”Ÿé¢†åŸŸäº‹ä»¶PaidEventï¼› äº¤æ˜“å¾®æœåŠ¡æ”¶åˆ°é¢†åŸŸäº‹ä»¶PaidEventï¼Œå°†è®¢å•æ ‡è®°ä¸ºCREATEDï¼› è‹¥æ”¯ä»˜å¾®æœåŠ¡å‘ç°é¢åº¦ä¸è¶³æ‰£æ¬¾å¤±è´¥ï¼Œäº§ç”Ÿé¢†åŸŸäº‹ä»¶InsufficientEventï¼Œäº¤æ˜“å¾®æœåŠ¡æ¶ˆè´¹å°†è®¢å•æ ‡è®°ä¸ºCANCELEDã€‚ æˆ‘ä»¬åªè¦ä¿è¯é¢†åŸŸäº‹ä»¶èƒ½è¢«æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå³ä½¿å‡ºç°ç½‘ç»œå»¶è¿Ÿæˆ–éƒ¨åˆ†ç³»ç»Ÿå¤±æ•ˆï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ å®è·µä¸Šï¼Œæˆ‘ä»¬åˆ©ç”¨Springä»4.2ç‰ˆæœ¬å¼€å§‹æ”¯æŒçš„è‡ªå®šä¹‰åº”ç”¨äº‹ä»¶æœºåˆ¶å°†æœ¬åœ°äº‹åŠ¡å’Œäº‹ä»¶æŠ•é€’ç»“åˆèµ·æ¥è¿›è¡Œï¼š é¢†åŸŸå†…ä¸šåŠ¡è¿‡ç¨‹ä¼šäº§ç”Ÿé¢†åŸŸäº‹ä»¶ï¼Œé€šè¿‡Springçš„åº”ç”¨äº‹ä»¶æœºåˆ¶è¿›è¡Œåº”ç”¨å†…æŠ•é€’ï¼› ç›‘å¬ç›¸åº”çš„é¢†åŸŸäº‹ä»¶ï¼Œåœ¨äº‹åŠ¡æäº¤å‰æŠ•é€’è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼› ä»¥ä¸Šå…¨éƒ½æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™æœ¬åœ°äº‹åŠ¡æäº¤ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œæœ¬åœ°äº‹åŠ¡å›æ»šã€‚ ä¸€äº›å°ç»éªŒ ä½¿ç”¨Spring Configuredå®ç°éSpring Beançš„ä¾èµ–æ³¨å…¥ï¼ˆè‡ªå·±newçš„å¯¹è±¡ä¹Ÿå¯ä»¥æ³¨å…¥äº†ï¼Œå¯¹å……è¡€æ¨¡å‹éå¸¸æœ‰ç”¨ï¼‰ ä½¿ç”¨Swagger UIå®ç°è‡ªæ–‡æ¡£çš„å¾®æœåŠ¡ï¼Œå†™å¥½æ¥å£å³æœ‰æ–‡æ¡£ï¼Œå³å¯è°ƒè¯• DevOpsåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æœ‰æ•°åä¸ªå¾®æœåŠ¡è¿è¡Œäºçº¿ä¸Šäº†ï¼Œå¾®æœåŠ¡æ•°ç›®ç”šè‡³å¤šè¿‡äº†å›¢é˜Ÿäººæ•°ã€‚å¦‚æœæ²¡æœ‰DevOpsæ”¯æŒï¼Œè¿ç»´è¿™äº›å¾®æœåŠ¡å°†æ˜¯ä¸€åœºç¾éš¾ã€‚æˆ‘ä»¬ä½¿ç”¨Dockeré•œåƒä½œä¸ºå¾®æœåŠ¡äº¤ä»˜çš„æ ‡å‡†ä»¶ï¼š Gitlabç®¡ç†å›¢é˜Ÿé¡¹ç›®ä»£ç  Gitlab-CIæä¾›æ„å»ºæ‰“åŒ…ï¼Œå¤§å®¶æäº¤çš„é¡¹ç›®éƒ½è¦æ„å»ºå¹¶è·‘é€šæµ‹è¯• ä½¿ç”¨Rancherä½œä¸ºDockerè°ƒåº¦å¹³å°ï¼ŒMergeåRCåˆ†æ”¯è‡ªåŠ¨éƒ¨ç½² æµ‹è¯•é€šè¿‡åç»Ÿä¸€ä¸Šçº¿å‘å¸ƒ ç”±äºæ—¶é—´æ‰€é™ï¼Œè¿™é‡Œå°±ä¸å±•å¼€èµ˜è¿°äº†ã€‚ æ°¸ä¸å®Œç¾åŸºäºspring-cloud-consulçš„é…ç½®ç®¡ç†ä»ç„¶éœ€è¦å®Œå–„ï¼Œå¯¹äºå¤§è§„æ¨¡åº”ç”¨çš„ç¯å¢ƒä¸­ï¼Œé…ç½®çš„ç‰ˆæœ¬æ§åˆ¶ã€ç°åº¦ã€å›æ»šç­‰éå¸¸é‡è¦ã€‚SpringCloudæä¾›äº†ä¸€ä¸ªæ ¸ï¼Œä½†æ˜¯å…·ä½“çš„ä½¿ç”¨è¿˜è¦ç»“åˆåœºæ™¯ã€éœ€æ±‚å’Œç¯å¢ƒç­‰ï¼Œå†åšä¸€äº›å·¥ä½œã€‚ å¯¹äºéJVMè¯­è¨€çš„å¾®æœåŠ¡å’ŒåŸºäºSpringCloudçš„å¾®æœåŠ¡å¦‚ä½•ååŒæ²»ç†ï¼Œè¿™ä¸€é—®é¢˜ä»ç„¶å€¼å¾—æ¢ç´¢ã€‚åŒ…æ‹¬åƒä¸Dockerç¼–æ’å¹³å°ï¼Œç‰¹åˆ«æ˜¯ä¸MesosååŒè¿›è¡Œä¼¸ç¼©çš„æœåŠ¡æ²»ç†ï¼Œè¿˜éœ€è¦æ›´å¤šçš„å®è·µæ¥æ”¯æŒã€‚ æ€»ç»“ æ˜¯å¦é€‰ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œåº”å½“æ ¹æ®ä¸šåŠ¡å®é™…æƒ…å†µè¿›è¡Œåˆ¤æ–­ï¼Œåˆ‡å‹¿è·Ÿé£ä¸ºäº†å¾®æœåŠ¡è€Œå¾®æœåŠ¡ï¼› ç›®å‰æ¥çœ‹è¿˜æ²¡æœ‰å¾®æœåŠ¡å…¨æ ˆæ¡†æ¶ï¼ŒSpring Cloudä¹Ÿæœªå¿…æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼ŒæŠ€æœ¯é€‰å‹è¿˜æ˜¯åº”å½“åŠ¡å®ï¼› å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¯¹äºä¸šåŠ¡çš„ç†è§£æ‹†åˆ†ã€é¢†åŸŸå»ºæ¨¡ç­‰æå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼Œç›¸æ¯”æ¡†æ¶ï¼Œå®ƒä»¬æ‰æ˜¯å¾®æœåŠ¡æ¶æ„çš„åŸºçŸ³ï¼› DevOpsæ˜¯å¾®æœåŠ¡å®è·µä¸­çš„é‡è¦ä¸€ç¯ï¼Œä¸å®¹å°è§†ã€‚","categories":[{"name":"ç¤¾åŒº","slug":"ç¤¾åŒº","permalink":"http://xujin.org/categories/ç¤¾åŒº/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"},{"name":"å®è·µåˆ†äº«","slug":"å®è·µåˆ†äº«","permalink":"http://xujin.org/tags/å®è·µåˆ†äº«/"}]},{"title":"Spring Cloud EurekaæœåŠ¡ä¸‹çº¿(Cancel)æºç åˆ†æ","slug":"sc/sc-eureka-cancle","date":"2016-11-19T06:00:00.000Z","updated":"2019-01-12T04:25:00.258Z","comments":true,"path":"sc/sc-eureka-cancle/","link":"","permalink":"http://xujin.org/sc/sc-eureka-cancle/","excerpt":"æ‘˜è¦:åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦å¯¹Eurekaçš„Cancel(æœåŠ¡ä¸‹çº¿)è¿›è¡Œæºç åˆ†æï¼Œåœ¨Service ProvideræœåŠ¡shut downçš„æ—¶å€™ï¼Œéœ€è¦åŠæ—¶é€šçŸ¥Eureka ServeræŠŠè‡ªå·±å‰”é™¤ï¼Œä»è€Œé¿å…å…¶å®ƒå®¢æˆ·ç«¯è°ƒç”¨å·²ç»ä¸‹çº¿çš„æœåŠ¡ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚ Cancel(æœåŠ¡ä¸‹çº¿)æ¦‚è¿°åœ¨Service ProvideræœåŠ¡shut downçš„æ—¶å€™ï¼Œéœ€è¦åŠæ—¶é€šçŸ¥Eureka ServeræŠŠè‡ªå·±å‰”é™¤ï¼Œä»è€Œé¿å…å®¢æˆ·ç«¯è°ƒç”¨å·²ç»ä¸‹çº¿çš„æœåŠ¡ã€‚ æœåŠ¡æä¾›è€…ç«¯æºç åˆ†æ åœ¨eureka-client-1.4.1ä¸­çš„com.netflix.discovery.DiscoveryClientä¸­shutdown()çš„867è¡Œã€‚","text":"æ‘˜è¦:åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦å¯¹Eurekaçš„Cancel(æœåŠ¡ä¸‹çº¿)è¿›è¡Œæºç åˆ†æï¼Œåœ¨Service ProvideræœåŠ¡shut downçš„æ—¶å€™ï¼Œéœ€è¦åŠæ—¶é€šçŸ¥Eureka ServeræŠŠè‡ªå·±å‰”é™¤ï¼Œä»è€Œé¿å…å…¶å®ƒå®¢æˆ·ç«¯è°ƒç”¨å·²ç»ä¸‹çº¿çš„æœåŠ¡ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚ Cancel(æœåŠ¡ä¸‹çº¿)æ¦‚è¿°åœ¨Service ProvideræœåŠ¡shut downçš„æ—¶å€™ï¼Œéœ€è¦åŠæ—¶é€šçŸ¥Eureka ServeræŠŠè‡ªå·±å‰”é™¤ï¼Œä»è€Œé¿å…å®¢æˆ·ç«¯è°ƒç”¨å·²ç»ä¸‹çº¿çš„æœåŠ¡ã€‚ æœåŠ¡æä¾›è€…ç«¯æºç åˆ†æ åœ¨eureka-client-1.4.1ä¸­çš„com.netflix.discovery.DiscoveryClientä¸­shutdown()çš„867è¡Œã€‚ 123456789101112131415161718192021222324252627282930313233/** * Shuts down Eureka Client. Also sends a deregistration request to the * eureka server. */ @PreDestroy @Override public synchronized void shutdown() &#123; if (isShutdown.compareAndSet(false, true)) &#123; logger.info(\"Shutting down DiscoveryClient ...\"); if (statusChangeListener != null &amp;&amp; applicationInfoManager != null) &#123; applicationInfoManager.unregisterStatusChangeListener(statusChangeListener.getId()); &#125; cancelScheduledTasks(); // If APPINFO was registered if (applicationInfoManager != null &amp;&amp; clientConfig.shouldRegisterWithEureka()) &#123; applicationInfoManager.setInstanceStatus(InstanceStatus.DOWN); //è°ƒç”¨ä¸‹çº¿æ¥å£ unregister(); &#125; if (eurekaTransport != null) &#123; eurekaTransport.shutdown(); &#125; heartbeatStalenessMonitor.shutdown(); registryStalenessMonitor.shutdown(); logger.info(\"Completed shut down of DiscoveryClient\"); &#125; &#125; Tips @PreDestroyæ³¨è§£æˆ–shutdown()çš„æ–¹æ³•æ˜¯æœåŠ¡ä¸‹çº¿çš„å…¥å£ åœ¨eureka-client-1.4.1ä¸­çš„com.netflix.discovery.DiscoveryClientä¸­unregisterï¼ˆï¼‰çš„897è¡Œ12345678910111213141516 /** * unregister w/ the eureka service. */ void unregister() &#123; // It can be null if shouldRegisterWithEureka == false if(eurekaTransport != null &amp;&amp; eurekaTransport.registrationClient != null) &#123; try &#123; logger.info(\"Unregistering ...\"); //å‘é€æœåŠ¡ä¸‹çº¿è¯·æ±‚ EurekaHttpResponse&lt;Void&gt; httpResponse = eurekaTransport.registrationClient.cancel(instanceInfo.getAppName(), instanceInfo.getId()); logger.info(PREFIX + appPathIdentifier + \" - deregister status: \" + httpResponse.getStatusCode()); &#125; catch (Exception e) &#123; logger.error(PREFIX + appPathIdentifier + \" - de-registration failed\" + e.getMessage(), e); &#125; &#125;&#125; Eureka ServeræœåŠ¡ä¸‹çº¿å®ç°ç»†èŠ‚ åœ¨com.netflix.eureka.resources.InstanceResourceä¸­çš„280è¡Œä¸­çš„cancelLease()æ–¹æ³• 123456789101112131415@DELETEpublic Response cancelLease( @HeaderParam(PeerEurekaNode.HEADER_REPLICATION) String isReplication) &#123; //è°ƒç”¨cancel boolean isSuccess = registry.cancel(app.getName(), id, \"true\".equals(isReplication)); if (isSuccess) &#123; logger.debug(\"Found (Cancel): \" + app.getName() + \" - \" + id); return Response.ok().build(); &#125; else &#123; logger.info(\"Not Found (Cancel): \" + app.getName() + \" - \" + id); return Response.status(Status.NOT_FOUND).build(); &#125;&#125; åœ¨org.springframework.cloud.netflix.eureka.server.InstanceRegistryä¸­çš„95è¡Œçš„cancel()æ–¹æ³•ï¼Œ 123456@Overridepublic boolean cancel(String appName, String serverId, boolean isReplication) &#123; handleCancelation(appName, serverId, isReplication); //è°ƒç”¨çˆ¶ç±»ä¸­çš„cancel return super.cancel(appName, serverId, isReplication);&#125; åœ¨com.netflix.eureka.registry.PeerAwareInstanceRegistryImplä¸­çš„376è¡Œ 123456789101112131415161718 @Override public boolean cancel(final String appName, final String id, final boolean isReplication) &#123; if (super.cancel(appName, id, isReplication)) &#123; //æœåŠ¡ä¸‹çº¿æˆåŠŸåï¼ŒåŒæ­¥æ›´æ–°ä¿¡æ¯åˆ°å…¶å®ƒEureka ServerèŠ‚ç‚¹ replicateToPeers(Action.Cancel, appName, id, null, null, isReplication); synchronized (lock) &#123; if (this.expectedNumberOfRenewsPerMin &gt; 0) &#123; // Since the client wants to cancel it, reduce the threshold (1 for 30 seconds, 2 for a minute) this.expectedNumberOfRenewsPerMin = this.expectedNumberOfRenewsPerMin - 2; this.numberOfRenewsPerMinThreshold = (int) (this.expectedNumberOfRenewsPerMin * serverConfig.getRenewalPercentThreshold()); &#125; &#125; return true; &#125; return false;&#125; 4.åœ¨com.netflix.eureka.registry.PeerAwareInstanceRegistryImplä¸­çš„618è¡Œï¼Œä¸»è¦æ¥å£å®ç°æ–¹å¼å’ŒregisteråŸºæœ¬ä¸€è‡´ï¼šé¦–å…ˆæ›´æ–°è‡ªèº«Eureka Serverä¸­æœåŠ¡çš„çŠ¶æ€ï¼Œå†åŒæ­¥åˆ°å…¶å®ƒEureka Serverä¸­ã€‚12345678910111213141516171819202122232425private void replicateToPeers(Action action, String appName, String id, InstanceInfo info /* optional */, InstanceStatus newStatus /* optional */, boolean isReplication) &#123; Stopwatch tracer = action.getTimer().start(); try &#123; if (isReplication) &#123; numberOfReplicationsLastMin.increment(); &#125; // If it is a replication already, do not replicate again as this will create a poison replication if (peerEurekaNodes == Collections.EMPTY_LIST || isReplication) &#123; return; &#125; // åŒæ­¥æŠŠæœåŠ¡ä¿¡æ¯åŒæ­¥åˆ°å…¶å®ƒçš„Eureka Serverä¸­ for (final PeerEurekaNode node : peerEurekaNodes.getPeerEurekaNodes()) &#123; // If the url represents this host, do not replicate to yourself. if (peerEurekaNodes.isThisMyUrl(node.getServiceUrl())) &#123; continue; &#125; //æ ¹æ®actionåšç›¸åº”æ“ä½œçš„åŒæ­¥ replicateInstanceActionsToPeers(action, appName, id, info, newStatus, node); &#125; &#125; finally &#123; tracer.stop(); &#125; &#125; è‡³æ­¤ï¼ŒEurekaæœåŠ¡ç»­çº¦æºç åˆ†æç»“æŸï¼Œå¤§å®¶æœ‰å…´è¶£å¯è‡ªè¡Œé˜…è¯»ã€‚ æºç åˆ†æé“¾æ¥ å…¶å®ƒæºç åˆ†æé“¾æ¥: Spring Cloudä¸­@EnableEurekaClientæºç åˆ†æ: http://xujin.org/sc/sc-enableEurekaClient-annonation/ Spring Cloud EurekaæœåŠ¡æ³¨å†Œæºç åˆ†æï¼š http://xujin.org/sc/sc-eureka-register/ Spring Cloud EurekaæœåŠ¡ç»­çº¦(Renew)æºç åˆ†æ http://xujin.org/sc/sc-eureka-renew/","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"}]},{"title":"Spring Cloud EurekaæœåŠ¡ç»­çº¦(Renew)æºç åˆ†æ","slug":"sc/sc-eureka-renew","date":"2016-11-13T06:00:00.000Z","updated":"2019-01-12T04:36:27.970Z","comments":true,"path":"sc/sc-eureka-renew/","link":"","permalink":"http://xujin.org/sc/sc-eureka-renew/","excerpt":"æ‘˜è¦:åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦å¯¹Eurekaçš„Renew(æœåŠ¡ç»­çº¦)ï¼Œä»æœåŠ¡æä¾›è€…å‘èµ·ç»­çº¦è¯·æ±‚å¼€å§‹åˆ†æï¼Œé€šè¿‡é˜…è¯»æºç å’Œç”»æ—¶åºå›¾çš„æ–¹å¼ï¼Œå±•ç¤ºEurekaæœåŠ¡ç»­çº¦çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚æœåŠ¡ç»­çº¦ä¸»è¦æ˜¯æŠŠæœåŠ¡ç»­çº¦çš„ä¿¡æ¯æ›´æ–°åˆ°è‡ªèº«çš„Eureka Serverä¸­ï¼Œç„¶åå†åŒæ­¥åˆ°å…¶å®ƒEureka Serverä¸­ã€‚ 1. Renew(æœåŠ¡ç»­çº¦)1.1 æ¦‚è¿°Renewï¼ˆæœåŠ¡ç»­çº¦ï¼‰æ“ä½œç”±Service Providerå®šæœŸè°ƒç”¨ï¼Œç±»ä¼¼äºheartbeatã€‚ç›®çš„æ˜¯éš”ä¸€æ®µæ—¶é—´Service Providerè°ƒç”¨æ¥å£ï¼Œå‘Šè¯‰Eureka Serverå®ƒè¿˜æ´»ç€æ²¡æŒ‚ï¼Œä¸è¦æŠŠå®ƒTäº†ã€‚é€šä¿—çš„è¯´å°±æ˜¯å®ƒä»¬ä¸¤ä¹‹é—´çš„å¿ƒè·³æ£€æµ‹ï¼Œé¿å…æœåŠ¡æä¾›è€…è¢«å‰”é™¤æ‰ã€‚è¯·å‚è€ƒ:Spring Cloud Eurekaåè¯è§£é‡Š","text":"æ‘˜è¦:åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦å¯¹Eurekaçš„Renew(æœåŠ¡ç»­çº¦)ï¼Œä»æœåŠ¡æä¾›è€…å‘èµ·ç»­çº¦è¯·æ±‚å¼€å§‹åˆ†æï¼Œé€šè¿‡é˜…è¯»æºç å’Œç”»æ—¶åºå›¾çš„æ–¹å¼ï¼Œå±•ç¤ºEurekaæœåŠ¡ç»­çº¦çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚æœåŠ¡ç»­çº¦ä¸»è¦æ˜¯æŠŠæœåŠ¡ç»­çº¦çš„ä¿¡æ¯æ›´æ–°åˆ°è‡ªèº«çš„Eureka Serverä¸­ï¼Œç„¶åå†åŒæ­¥åˆ°å…¶å®ƒEureka Serverä¸­ã€‚ 1. Renew(æœåŠ¡ç»­çº¦)1.1 æ¦‚è¿°Renewï¼ˆæœåŠ¡ç»­çº¦ï¼‰æ“ä½œç”±Service Providerå®šæœŸè°ƒç”¨ï¼Œç±»ä¼¼äºheartbeatã€‚ç›®çš„æ˜¯éš”ä¸€æ®µæ—¶é—´Service Providerè°ƒç”¨æ¥å£ï¼Œå‘Šè¯‰Eureka Serverå®ƒè¿˜æ´»ç€æ²¡æŒ‚ï¼Œä¸è¦æŠŠå®ƒTäº†ã€‚é€šä¿—çš„è¯´å°±æ˜¯å®ƒä»¬ä¸¤ä¹‹é—´çš„å¿ƒè·³æ£€æµ‹ï¼Œé¿å…æœåŠ¡æä¾›è€…è¢«å‰”é™¤æ‰ã€‚è¯·å‚è€ƒ:Spring Cloud Eurekaåè¯è§£é‡Š 1.2 æœåŠ¡ç»­çº¦é…ç½® Renewæ“ä½œä¼šåœ¨Service Providerå®šæ—¶å‘èµ·ï¼Œç”¨æ¥é€šçŸ¥Eureka Serverè‡ªå·±è¿˜æ´»ç€ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®éœ€è¦å¦‚ä¸‹ï¼Œå¯ä»¥åœ¨Runä¹‹å‰é…ç½®ã€‚1eureka.instance.leaseRenewalIntervalInSeconds Renewé¢‘ç‡ã€‚é»˜è®¤æ˜¯30ç§’ï¼Œä¹Ÿå°±æ˜¯æ¯30ç§’ä¼šå‘Eureka Serverå‘èµ·Renewæ“ä½œã€‚1eureka.instance.leaseExpirationDurationInSeconds æœåŠ¡å¤±æ•ˆæ—¶é—´ã€‚é»˜è®¤æ˜¯90ç§’ï¼Œä¹Ÿå°±æ˜¯å¦‚æœEureka Serveråœ¨90ç§’å†…æ²¡æœ‰æ¥æ”¶åˆ°æ¥è‡ªService Providerçš„Renewæ“ä½œï¼Œå°±ä¼šæŠŠService Providerå‰”é™¤ã€‚ 2. Renewæºç åˆ†æ2.1 æœåŠ¡æä¾›è€…å®ç°ç»†èŠ‚ æœåŠ¡æä¾›è€…å‘å‘èµ·æœåŠ¡ç»­çº¦çš„æ—¶åºå›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º,å¤§å®¶å…ˆç›´è§‚çš„çœ‹ä¸€ä¸‹æ—¶åºå›¾ï¼Œç­‰é˜…è¯»å®Œæºç å†å›é¡¾ä¸€ä¸‹ã€‚ åœ¨com.netflix.discovery.DiscoveryClient.initScheduledTasks()ä¸­çš„1272è¡Œï¼ŒTimedSupervisorTaskä¼šå®šæ—¶å‘èµ·æœåŠ¡ç»­çº¦ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º:123456789101112// Heartbeat timer scheduler.schedule( new TimedSupervisorTask( \"heartbeat\", scheduler, heartbeatExecutor, renewalIntervalInSecs, TimeUnit.SECONDS, expBackOffBound, new HeartbeatThread() ), renewalIntervalInSecs, TimeUnit.SECONDS); 2.åœ¨com.netflix.discovery.DiscoveryClientä¸­çš„1393è¡Œï¼Œæœ‰ä¸€ä¸ªHeartbeatThreadçº¿ç¨‹å‘èµ·ç»­çº¦æ“ä½œ123456789 private class HeartbeatThread implements Runnable &#123; public void run() &#123; //è°ƒç”¨eureka-clientä¸­çš„renew if (renew()) &#123; lastSuccessfulHeartbeatTimestamp = System.currentTimeMillis(); &#125; &#125;&#125; renew()è°ƒç”¨eureka-client-1.4.11.jarcom.netflix.discovery.DiscoveryClientä¸­829è¡Œrenew()å‘èµ·PUT Resetè¯·æ±‚ï¼Œè°ƒç”¨com.netflix.eureka.resources.InstanceResourceä¸­çš„renewLease()ç»­çº¦ã€‚12345678910111213141516171819/** * Renew with the eureka service by making the appropriate REST call */ boolean renew() &#123; EurekaHttpResponse&lt;InstanceInfo&gt; httpResponse; try &#123; httpResponse = eurekaTransport.registrationClient.sendHeartBeat(instanceInfo.getAppName(), instanceInfo.getId(), instanceInfo, null); logger.debug(\"&#123;&#125; - Heartbeat status: &#123;&#125;\", PREFIX + appPathIdentifier, httpResponse.getStatusCode()); if (httpResponse.getStatusCode() == 404) &#123; REREGISTER_COUNTER.increment(); logger.info(\"&#123;&#125; - Re-registering apps/&#123;&#125;\", PREFIX + appPathIdentifier, instanceInfo.getAppName()); return register(); &#125; return httpResponse.getStatusCode() == 200; &#125; catch (Throwable e) &#123; logger.error(\"&#123;&#125; - was unable to send heartbeat!\", PREFIX + appPathIdentifier, e); return false; &#125; &#125; 2.2 Netflixä¸­çš„Eureka Coreå®ç°ç»†èŠ‚ NetFlixä¸­Eureka Coreä¸­çš„æœåŠ¡ç»­çº¦æ—¶åºå›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ‰“å¼€com.netflix.eureka.resources.InstanceResourceä¸­çš„106è¡Œçš„renewLease()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹: 123456789101112private final PeerAwareInstanceRegistry registry@PUTpublic Response renewLease( @HeaderParam(PeerEurekaNode.HEADER_REPLICATION) String isReplication, @QueryParam(\"overriddenstatus\") String overriddenStatus, @QueryParam(\"status\") String status, @QueryParam(\"lastDirtyTimestamp\") String lastDirtyTimestamp) &#123; boolean isFromReplicaNode = \"true\".equals(isReplication); //è°ƒç”¨ boolean isSuccess = registry.renew(app.getName(), id, isFromReplicaNode); //å…¶ä½™çœç•¥&#125; ç‚¹å¼€registry.renew(app.getName(), id, isFromReplicaNode);æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨äº†org.springframework.cloud.netflix.eureka.server.InstanceRegistryä¸­çš„renewï¼ˆï¼‰æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹: 1234567891011121314151617181920212223 @Override public boolean renew(final String appName, final String serverId, boolean isReplication) &#123; log(\"renew \" + appName + \" serverId \" + serverId + \", isReplication &#123;&#125;\" + isReplication); List&lt;Application&gt; applications = getSortedApplications(); for (Application input : applications) &#123; if (input.getName().equals(appName)) &#123; InstanceInfo instance = null; for (InstanceInfo info : input.getInstances()) &#123; if (info.getHostName().equals(serverId)) &#123; instance = info; break; &#125; &#125; publishEvent(new EurekaInstanceRenewedEvent(this, appName, serverId, instance, isReplication)); break; &#125; &#125; //è°ƒç”¨com.netflix.eureka.registry.PeerAwareInstanceRegistryImplä¸­çš„renewæ–¹æ³• return super.renew(appName, serverId, isReplication);&#125; 3.ä»super.renew()çœ‹åˆ°è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„com.netflix.eureka.registry.PeerAwareInstanceRegistryImplä¸­420è¡Œçš„renew()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹:123456789 public boolean renew(final String appName, final String id, final boolean isReplication) &#123; //æœåŠ¡ç»­çº¦æˆåŠŸï¼Œ if (super.renew(appName, id, isReplication)) &#123; //ç„¶åreplicateToPeersåŒæ­¥å…¶å®ƒEureka Serverä¸­çš„æ•°æ® replicateToPeers(Action.Heartbeat, appName, id, null, null, isReplication); return true; &#125; return false;&#125; 3.1 ä»ä¸Šé¢ä»£ç ä¸­super.renew(appName, id, isReplication)å¯ä»¥çœ‹å‡ºè°ƒç”¨çš„æ˜¯com.netflix.eureka.registry.AbstractInstanceRegistryä¸­345è¡Œçš„renew()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º12345678910111213141516171819202122232425262728293031323334353637383940public boolean renew(String appName, String id, boolean isReplication) &#123; RENEW.increment(isReplication); Map&lt;String, Lease&lt;InstanceInfo&gt;&gt; gMap = registry.get(appName); Lease&lt;InstanceInfo&gt; leaseToRenew = null; if (gMap != null) &#123; leaseToRenew = gMap.get(id); &#125; if (leaseToRenew == null) &#123; RENEW_NOT_FOUND.increment(isReplication); logger.warn(\"DS: Registry: lease doesn't exist, registering resource: &#123;&#125; - &#123;&#125;\", appName, id); return false; &#125; else &#123; InstanceInfo instanceInfo = leaseToRenew.getHolder(); if (instanceInfo != null) &#123; // touchASGCache(instanceInfo.getASGName()); InstanceStatus overriddenInstanceStatus = this.getOverriddenInstanceStatus( instanceInfo, leaseToRenew, isReplication); if (overriddenInstanceStatus == InstanceStatus.UNKNOWN) &#123; logger.info(\"Instance status UNKNOWN possibly due to deleted override for instance &#123;&#125;\" + \"; re-register required\", instanceInfo.getId()); RENEW_NOT_FOUND.increment(isReplication); return false; &#125; if (!instanceInfo.getStatus().equals(overriddenInstanceStatus)) &#123; Object[] args = &#123; instanceInfo.getStatus().name(), instanceInfo.getOverriddenStatus().name(), instanceInfo.getId() &#125;; logger.info( \"The instance status &#123;&#125; is different from overridden instance status &#123;&#125; for instance &#123;&#125;. \" + \"Hence setting the status to overridden status\", args); instanceInfo.setStatus(overriddenInstanceStatus); &#125; &#125; renewsLastMin.increment(); leaseToRenew.renew(); return true; &#125; &#125; å…¶ä¸­ leaseToRenew.renew()æ˜¯è°ƒç”¨com.netflix.eureka.lease.Leaseä¸­çš„62è¡Œçš„renew()æ–¹æ³•123456789/** * Renew the lease, use renewal duration if it was specified by the * associated &#123;@link T&#125; during registration, otherwise default duration is * &#123;@link #DEFAULT_DURATION_IN_SECS&#125;. */public void renew() &#123; lastUpdateTimestamp = System.currentTimeMillis() + duration;&#125; 3.2 replicateToPeers(Action.Heartbeat, appName, id, null, null, isReplication);è°ƒç”¨è‡ªèº«çš„replicateToPeers()æ–¹æ³•ï¼Œåœ¨com.netflix.eureka.registry.PeerAwareInstanceRegistryImplä¸­çš„618è¡Œï¼Œä¸»è¦æ¥å£å®ç°æ–¹å¼å’ŒregisteråŸºæœ¬ä¸€è‡´ï¼šé¦–å…ˆæ›´æ–°è‡ªèº«Eureka Serverä¸­æœåŠ¡çš„çŠ¶æ€ï¼Œå†åŒæ­¥åˆ°å…¶å®ƒEureka Serverä¸­ã€‚12345678910111213141516171819202122232425private void replicateToPeers(Action action, String appName, String id, InstanceInfo info /* optional */, InstanceStatus newStatus /* optional */, boolean isReplication) &#123; Stopwatch tracer = action.getTimer().start(); try &#123; if (isReplication) &#123; numberOfReplicationsLastMin.increment(); &#125; // If it is a replication already, do not replicate again as this will create a poison replication if (peerEurekaNodes == Collections.EMPTY_LIST || isReplication) &#123; return; &#125; // åŒæ­¥æŠŠç»­çº¦ä¿¡æ¯åŒæ­¥åˆ°å…¶å®ƒçš„Eureka Serverä¸­ for (final PeerEurekaNode node : peerEurekaNodes.getPeerEurekaNodes()) &#123; // If the url represents this host, do not replicate to yourself. if (peerEurekaNodes.isThisMyUrl(node.getServiceUrl())) &#123; continue; &#125; //æ ¹æ®actionåšç›¸åº”æ“ä½œçš„åŒæ­¥ replicateInstanceActionsToPeers(action, appName, id, info, newStatus, node); &#125; &#125; finally &#123; tracer.stop(); &#125; &#125; è‡³æ­¤ï¼ŒEurekaæœåŠ¡ç»­çº¦æºç åˆ†æç»“æŸï¼Œå¤§å®¶æœ‰å…´è¶£å¯è‡ªè¡Œé˜…è¯»ã€‚ 2.3 æºç åˆ†æé“¾æ¥ å…¶å®ƒæºç åˆ†æé“¾æ¥: Spring Cloudä¸­@EnableEurekaClientæºç åˆ†æ: http://blog.xujin.org/sc/sc-enableEurekaClient-annonation/ Spring Cloud EurekaæœåŠ¡æ³¨å†Œæºç åˆ†æï¼š http://blog.xujin.org/sc/sc-eureka-register/","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"},{"name":"Spring Cloud æºç åˆ†æ","slug":"Spring-Cloud-æºç åˆ†æ","permalink":"http://xujin.org/tags/Spring-Cloud-æºç åˆ†æ/"}]},{"title":"Spring Cloudä¸­@EnableEurekaClientæºç åˆ†æ","slug":"sc/sc-enableEurekaClient-annonation","date":"2016-11-06T06:00:00.000Z","updated":"2019-01-12T04:01:26.567Z","comments":true,"path":"sc/sc-enableEurekaClient-annonation/","link":"","permalink":"http://xujin.org/sc/sc-enableEurekaClient-annonation/","excerpt":"æ‘˜è¦:åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦ä»‹ç»ä¸€ä¸‹Spring Cloudä¸­çš„@EnableEurekaClientæ³¨è§£ï¼Œä»æºç çš„è§’åº¦åˆ†ææ˜¯å¦‚ä½•workçš„ï¼Œè®©å¤§å®¶èƒ½äº†è§£Spring Cloudå¦‚ä½•é€šè¿‡@EnableEurekaClientæ³¨è§£å¯¹NetFlix Eureka Clientè¿›è¡Œå°è£…ä¸ºå®ƒæ‰€ç”¨ã€‚ NetFlix Eureka clientç®€ä»‹NetFlix Eureka clientEureka client è´Ÿè´£ä¸Eureka Server é…åˆå‘å¤–æä¾›æ³¨å†Œä¸å‘ç°æœåŠ¡æ¥å£ã€‚é¦–å…ˆçœ‹ä¸‹eureka clientæ˜¯æ€ä¹ˆå®šä¹‰ï¼ŒNetflixçš„ eureka clientçš„è¡Œä¸ºåœ¨LookupServiceä¸­å®šä¹‰ï¼ŒLookup service for finding active instancesï¼Œå®šä¹‰äº†ï¼Œä»outlineä¸­èƒ½çœ‹åˆ°èµ·â€œè§„å®šâ€äº†å¦‚ä¸‹å‡ ä¸ªæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚æœåŠ¡å‘ç°å¿…é¡»å®ç°çš„åŸºæœ¬ç±»ï¼šcom.netflix.discovery.shared.LookupServiceï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚ Eureka clientä¸Spring Cloudç±»å…³ç³» Eureka clientä¸Spring Cloud Eureka Clientç±»å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤º:åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘åŠ äº†å‰ç¼€ï¼Œå¸¦æœ‰Sçš„æ˜¯Spring Cloudå°è£…çš„ï¼Œå¸¦æœ‰Næ˜¯NetFlixåŸç”Ÿçš„ã€‚","text":"æ‘˜è¦:åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦ä»‹ç»ä¸€ä¸‹Spring Cloudä¸­çš„@EnableEurekaClientæ³¨è§£ï¼Œä»æºç çš„è§’åº¦åˆ†ææ˜¯å¦‚ä½•workçš„ï¼Œè®©å¤§å®¶èƒ½äº†è§£Spring Cloudå¦‚ä½•é€šè¿‡@EnableEurekaClientæ³¨è§£å¯¹NetFlix Eureka Clientè¿›è¡Œå°è£…ä¸ºå®ƒæ‰€ç”¨ã€‚ NetFlix Eureka clientç®€ä»‹NetFlix Eureka clientEureka client è´Ÿè´£ä¸Eureka Server é…åˆå‘å¤–æä¾›æ³¨å†Œä¸å‘ç°æœåŠ¡æ¥å£ã€‚é¦–å…ˆçœ‹ä¸‹eureka clientæ˜¯æ€ä¹ˆå®šä¹‰ï¼ŒNetflixçš„ eureka clientçš„è¡Œä¸ºåœ¨LookupServiceä¸­å®šä¹‰ï¼ŒLookup service for finding active instancesï¼Œå®šä¹‰äº†ï¼Œä»outlineä¸­èƒ½çœ‹åˆ°èµ·â€œè§„å®šâ€äº†å¦‚ä¸‹å‡ ä¸ªæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚æœåŠ¡å‘ç°å¿…é¡»å®ç°çš„åŸºæœ¬ç±»ï¼šcom.netflix.discovery.shared.LookupServiceï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚ Eureka clientä¸Spring Cloudç±»å…³ç³» Eureka clientä¸Spring Cloud Eureka Clientç±»å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤º:åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘åŠ äº†å‰ç¼€ï¼Œå¸¦æœ‰Sçš„æ˜¯Spring Cloudå°è£…çš„ï¼Œå¸¦æœ‰Næ˜¯NetFlixåŸç”Ÿçš„ã€‚ org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientä¸­49è¡Œçš„eurekaClientå°±æ˜¯com.netflix.discovery.EurekaClientï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º:12345678@RequiredArgsConstructorpublic class EurekaDiscoveryClient implements DiscoveryClient &#123; public static final String DESCRIPTION = \"Spring Cloud Eureka Discovery Client\"; private final EurekaInstanceConfig config; // Netflixä¸­çš„Eureka Client private final EurekaClient eurekaClient; //å…¶ä½™çœç•¥&#125; Tips:org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientå®ç°äº†DiscoveryClientï¼Œå¹¶ä¾èµ–äºcom.netflix.discovery.EurekaClient ç‚¹å¼€com.netflix.discovery.EurekaClientæŸ¥çœ‹ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºEurekaClientç»§æ‰¿äº†LookupServiceå¹¶å®ç°äº†EurekaClientæ¥å£ã€‚ 1234@ImplementedBy(DiscoveryClient.class)public interface EurekaClient extends LookupService &#123; //å…¶ä½™çœç•¥&#125; com.netflix.discovery.DiscoveryClientæ˜¯netflixä½¿ç”¨çš„å®¢æˆ·ç«¯ï¼Œä»å…¶classçš„æ³¨é‡Šå¯ä»¥çœ‹åˆ°ä»–ä¸»è¦åšè¿™å‡ ä»¶äº‹æƒ…ï¼ša) Registering the instance with Eureka Serverb) Renewalof the lease with Eureka Serverc) Cancellation of the lease from Eureka Server during shutdown å…¶ä¸­com.netflix.discovery.DiscoveryClientå®ç°äº†com.netflix.discovery.EurekaClient,è€Œspring Cloudä¸­çš„org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientï¼Œä¾èµ–äºcom.netflix.discovery.EurekaClientï¼Œå› æ­¤Spring Cloudä¸NetFlixçš„å…³ç³»ç”±æ­¤è”ç³»åˆ°ä¸€èµ·ã€‚12345678@Singletonpublic class DiscoveryClient implements EurekaClient &#123; private static final Logger logger = LoggerFactory.getLogger(DiscoveryClient.class); // Constants public static final String HTTP_X_DISCOVERY_ALLOW_REDIRECT = \"X-Discovery-AllowRedirect\"; //å…¶ä½™çœç•¥&#125; @EnableEurekaClientæ³¨è§£å…¥å£åˆ†æ åœ¨ä¸Šé¢å°èŠ‚ä¸­ï¼Œç†æ¸…äº†NetFlix Eurekaä¸Spring cloudä¸­ç±»çš„ä¾èµ–å…³ç³»ï¼Œä¸‹é¢å°†ä»¥@EnableEurekaClientä¸ºå…¥å£ï¼Œåˆ†æä¸»è¦è°ƒç”¨é“¾ä¸­çš„ç±»å’Œæ–¹æ³•ã€‚ @EnableEurekaClientä½¿ç”¨ ç”¨è¿‡spring cloudçš„åŒå­¦éƒ½çŸ¥é“ï¼Œä½¿ç”¨@EnableEurekaClientå°±èƒ½ç®€å•çš„å¼€å¯Eureka Clientä¸­çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚123456789@EnableEurekaClient@SpringBootApplicationpublic class CloudEurekaClientApplication &#123; public static void main(String[] args) &#123; new SpringApplicationBuilder(CloudEurekaClientApplication.class).web(true).run(args); &#125;&#125; é€šè¿‡@EnableEurekaClientè¿™ä¸ªç®€å•çš„æ³¨è§£ï¼Œåœ¨spring cloudåº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠEurekaDiscoveryClientæ³¨å…¥ï¼Œç»§è€Œä½¿ç”¨NetFlixæä¾›çš„Eureka clientã€‚ æ‰“å¼€EnableEurekaClientè¿™ä¸ªç±»ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè‡ªå®šä¹‰çš„annotation @EnableEurekaClienté‡Œé¢æ²¡æœ‰å†…å®¹ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¼€å¯Eureka discoveryçš„é…ç½®ï¼Œæ­£æ˜¯é€šè¿‡è¿™ä¸ªæ ‡è®°ï¼Œautoconfigurationå°±å¯ä»¥åŠ è½½ç›¸å…³çš„Eurekaç±»ã€‚é‚£æˆ‘ä»¬çœ‹ä¸‹å®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚ 12345678@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@EnableDiscoveryClientpublic @interface EnableEurekaClient &#123;&#125; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒEnableEurekaClientä¸Šé¢åŠ å…¥äº†å¦å¤–ä¸€ä¸ªæ³¨è§£@EnableDiscoveryClientï¼Œçœ‹çœ‹è¿™ä¸ªæ³¨è§£çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º: 123456789101112/** * Annotation to enable a DiscoveryClient implementation. * @author Spencer Gibb */@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@Import(EnableDiscoveryClientImportSelector.class)public @interface EnableDiscoveryClient &#123;&#125; è¿™ä¸ªæ³¨è§£importäº†EnableDiscoveryClientImportSelector.classè¿™æ ·ä¸€ä¸ªç±»ï¼Œå…¶å®å°±æ˜¯é€šè¿‡è¿™ä¸ªç±»æ¥åŠ è½½éœ€è¦ç”¨åˆ°çš„beanã€‚ç‚¹å¼€EnableDiscoveryClientImportSelectorç±»ï¼Œå¦‚ä¸‹ä»£ç : 12345678910111213141516@Order(Ordered.LOWEST_PRECEDENCE - 100)public class EnableDiscoveryClientImportSelector extends SpringFactoryImportSelector&lt;EnableDiscoveryClient&gt; &#123; @Override protected boolean isEnabled() &#123; return new RelaxedPropertyResolver(getEnvironment()).getProperty( \"spring.cloud.discovery.enabled\", Boolean.class, Boolean.TRUE); &#125; @Override protected boolean hasDefaultFactory() &#123; return true; &#125;&#125; çœ‹åˆ°è¿™é‡Œæœ‰è¦†ç›–äº†çˆ¶ç±»SpringFactoryImportSelectorçš„ä¸€ä¸ªæ–¹æ³•isEnabledï¼Œæ³¨æ„ï¼Œé»˜è®¤æ˜¯TRUEï¼Œä¹Ÿå°±æ˜¯åªè¦importäº†è¿™ä¸ªé…ç½®ï¼Œå°±ä¼šenableã€‚ åœ¨å…¶çˆ¶ç±»org.springframework.cloud.commons.util.SpringFactoryImportSelectorçš„String[] selectImports(AnnotationMetadata metadata)æ–¹æ³•ä¸­æ­£æ˜¯æ ¹æ®è¿™ä¸ªæ ‡è®°ç±»åˆ¤å®šæ˜¯å¦åŠ è½½å¦‚ä¸‹å®šä¹‰çš„ç±»ã€‚åœ¨æºç ç¬¬59è¡Œï¼Œå±€éƒ¨ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚1234567891011121314151617181920212223242526272829@Override public String[] selectImports(AnnotationMetadata metadata) &#123; if (!isEnabled()) &#123; return new String[0]; &#125; AnnotationAttributes attributes = AnnotationAttributes.fromMap( metadata.getAnnotationAttributes(this.annotationClass.getName(), true)); Assert.notNull(attributes, \"No \" + getSimpleName() + \" attributes found. Is \" + metadata.getClassName() + \" annotated with @\" + getSimpleName() + \"?\"); // Find all possible auto configuration classes, filtering duplicates List&lt;String&gt; factories = new ArrayList&lt;&gt;(new LinkedHashSet&lt;&gt;(SpringFactoriesLoader .loadFactoryNames(this.annotationClass, this.beanClassLoader))); if (factories.isEmpty() &amp;&amp; !hasDefaultFactory()) &#123; throw new IllegalStateException(\"Annotation @\" + getSimpleName() + \" found, but there are no implementations. Did you forget to include a starter?\"); &#125; if (factories.size() &gt; 1) &#123; // there should only ever be one DiscoveryClient, but there might be more than // one factory log.warn(\"More than one implementation \" + \"of @\" + getSimpleName() + \" (now relying on @Conditionals to pick one): \" + factories); &#125; return factories.toArray(new String[factories.size()]); &#125; åœ¨æºç ä¸­70-71è¡Œï¼Œå³åœ¨org.springframework.core.io.support.SpringFactoriesLoader ä¸­çš„109è¡Œçš„loadFactoryNames(Class&lt;?&gt; factoryClass, ClassLoader classLoader)æ–¹æ³•12345678910111213141516171819 public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, ClassLoader classLoader) &#123; String factoryClassName = factoryClass.getName(); try &#123; Enumeration&lt;URL&gt; urls = (classLoader != null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) : ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION)); List&lt;String&gt; result = new ArrayList&lt;String&gt;(); while (urls.hasMoreElements()) &#123; URL url = urls.nextElement(); Properties properties = PropertiesLoaderUtils.loadProperties(new UrlResource(url)); String factoryClassNames = properties.getProperty(factoryClassName); result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames))); &#125; return result; &#125; catch (IOException ex) &#123; throw new IllegalArgumentException(\"Unable to load [\" + factoryClass.getName() + \"] factories from location [\" + FACTORIES_RESOURCE_LOCATION + \"]\", ex); &#125;&#125; å®é™…è°ƒç”¨loadFactoryNameså…¶å®åŠ è½½META-INF/spring.factoriesä¸‹çš„classã€‚12345 /*** The location to look for factories.* &lt;p&gt;Can be present in multiple JAR files. */ public static final String FACTORIES_RESOURCE_LOCATION = \"META-INF/spring.factories\"; è€Œåœ¨spring-cloud-netflix-eureka-client\\src\\main\\resources\\META-INF\\spring.factoriesä¸­é…ç½®ï¼Œç”¨äºåŠ è½½ä¸€ç³»åˆ—é…ç½®ä¿¡æ¯å’ŒDependences Beanå¯ä»¥çœ‹åˆ°EnableAutoConfigurationçš„åŒ…å«äº†EurekaClientConfigServerAutoConfigurationã€‚1234567891011org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\org.springframework.cloud.netflix.eureka.config.EurekaClientConfigServerAutoConfiguration,\\org.springframework.cloud.netflix.eureka.config.EurekaDiscoveryClientConfigServiceAutoConfiguration,\\org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration,\\org.springframework.cloud.netflix.ribbon.eureka.RibbonEurekaAutoConfigurationorg.springframework.cloud.bootstrap.BootstrapConfiguration=\\org.springframework.cloud.netflix.eureka.config.EurekaDiscoveryClientConfigServiceBootstrapConfigurationorg.springframework.cloud.client.discovery.EnableDiscoveryClient=\\org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientConfiguration æ‰“å¼€org.springframework.cloud.netflix.eureka.config.EurekaClientConfigServerAutoConfigurationå¯ä»¥çœ‹åˆ°EurekaClientAutoConfigurationå…·ä½“çš„æ³¨å…¥ä¿¡æ¯ã€‚ å…·ä½“@EnableEurekaClienæ³¨è§£å¼€å¯ä¹‹åï¼ŒæœåŠ¡å¯åŠ¨åï¼Œæ˜¯æœåŠ¡æ€ä¹ˆæ³¨å†Œçš„è¯·å‚è€ƒï¼Œä¸‹é¢é“¾æ¥ï¼šhttp://blog.xujin.org/sc/sc-eureka-register/ å…¶å®ƒæºç åˆ†æé“¾æ¥ Spring Cloudä¸­@EnableEurekaClientæºç åˆ†æ: http://blog.xujin.org/sc/sc-enableEurekaClient-annonation/ Spring Cloud EurekaæœåŠ¡æ³¨å†Œæºç åˆ†æï¼š http://blog.xujin.org/sc/sc-eureka-register/ Spring Cloud EurekaæœåŠ¡ç»­çº¦(Renew)æºç åˆ†æ http://blog.xujin.org/sc/sc-eureka-renew/ Spring Cloud EurekaæœåŠ¡ä¸‹çº¿(Cancel)æºç åˆ†æ http://blog.xujin.org/sc/sc-eureka-cancle/","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"},{"name":"Spring Cloud æºç åˆ†æ","slug":"Spring-Cloud-æºç åˆ†æ","permalink":"http://xujin.org/tags/Spring-Cloud-æºç åˆ†æ/"}]},{"title":"ä½¿ç”¨Java Signalå°†åº”ç”¨ç¨‹åºä»LVSä¸­æ‘˜é™¤","slug":"ex/java-singal-linux","date":"2016-11-04T06:00:00.000Z","updated":"2019-01-13T05:22:22.628Z","comments":true,"path":"ex/java-singal-linux/","link":"","permalink":"http://xujin.org/ex/java-singal-linux/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ï¼Œå¦‚ä½•ä½¿ç”¨Java Signalå’ŒSignalHandlerå®ç°ï¼Œé€šè¿‡Linux å‘½ä»¤å®ç°kill -s BUS pidå’Œkill -s USR2 pidå®ç°ä¸killåº”ç”¨è¿›ç¨‹ï¼ŒæŠŠåº”ç”¨ç¨‹åºä»LVSä¸­æ‘˜é™¤ã€‚è€Œä¸æ˜¯é€šè¿‡Reset è¯·æ±‚è°ƒç”¨ã€‚ç”±äºåªå…è®¸æœ¬æœºæ“ä½œï¼Œæ‰€ä»¥å¯é€‰æ–¹æ¡ˆä¸‰ç§:1.reset è°ƒç”¨æ›´æ”¹Statusï¼Œ2.Linux ä¿¡å·é‡ä¼ é€’ç»™Javaç¨‹åº 3.é…ç½®ä¸­å¿ƒæˆ–è€…XXç®¡ç†ç³»ç»Ÿåå°æƒé™ç®¡ç†ï¼Œè°ƒç”¨resetæœåŠ¡ã€‚ä»å®‰å…¨æ€§å’Œå¿«é€Ÿè§£å†³éœ€æ±‚çš„è§’åº¦è€ƒè™‘ä½¿ç”¨Linux ä¿¡å·é‡ä¼ é€’ç»™Javaç¨‹åºæ–¹æ¡ˆã€‚ Java Signal æ¦‚è¿°ä¿¡å·ç®€ä»‹ä¿¡å·æ˜¯åœ¨è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿï¼Œåœ¨åŸç†ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¸å¤„ç†å™¨æ”¶åˆ°ä¸€ä¸ªä¸­æ–­è¯·æ±‚å¯ä»¥è¯´æ˜¯ä¸€æ ·çš„ã€‚é€šä¿—æ¥è®²ï¼Œä¿¡å·å°±æ˜¯è¿›ç¨‹é—´çš„ä¸€ç§å¼‚æ­¥é€šä¿¡æœºåˆ¶ã€‚å…¸å‹çš„ä¾‹å­:kill -s SIGKILL pid (å³kill -9 pid) ç«‹å³æ€æ­»æŒ‡å®špidçš„è¿›ç¨‹ã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSIGKILLå°±æ˜¯å¾€pidè¿›ç¨‹å‘é€çš„ä¿¡å·ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ï¼Œå¦‚ä½•ä½¿ç”¨Java Signalå’ŒSignalHandlerå®ç°ï¼Œé€šè¿‡Linux å‘½ä»¤å®ç°kill -s BUS pidå’Œkill -s USR2 pidå®ç°ä¸killåº”ç”¨è¿›ç¨‹ï¼ŒæŠŠåº”ç”¨ç¨‹åºä»LVSä¸­æ‘˜é™¤ã€‚è€Œä¸æ˜¯é€šè¿‡Reset è¯·æ±‚è°ƒç”¨ã€‚ç”±äºåªå…è®¸æœ¬æœºæ“ä½œï¼Œæ‰€ä»¥å¯é€‰æ–¹æ¡ˆä¸‰ç§:1.reset è°ƒç”¨æ›´æ”¹Statusï¼Œ2.Linux ä¿¡å·é‡ä¼ é€’ç»™Javaç¨‹åº 3.é…ç½®ä¸­å¿ƒæˆ–è€…XXç®¡ç†ç³»ç»Ÿåå°æƒé™ç®¡ç†ï¼Œè°ƒç”¨resetæœåŠ¡ã€‚ä»å®‰å…¨æ€§å’Œå¿«é€Ÿè§£å†³éœ€æ±‚çš„è§’åº¦è€ƒè™‘ä½¿ç”¨Linux ä¿¡å·é‡ä¼ é€’ç»™Javaç¨‹åºæ–¹æ¡ˆã€‚ Java Signal æ¦‚è¿°ä¿¡å·ç®€ä»‹ä¿¡å·æ˜¯åœ¨è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿï¼Œåœ¨åŸç†ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¸å¤„ç†å™¨æ”¶åˆ°ä¸€ä¸ªä¸­æ–­è¯·æ±‚å¯ä»¥è¯´æ˜¯ä¸€æ ·çš„ã€‚é€šä¿—æ¥è®²ï¼Œä¿¡å·å°±æ˜¯è¿›ç¨‹é—´çš„ä¸€ç§å¼‚æ­¥é€šä¿¡æœºåˆ¶ã€‚å…¸å‹çš„ä¾‹å­:kill -s SIGKILL pid (å³kill -9 pid) ç«‹å³æ€æ­»æŒ‡å®špidçš„è¿›ç¨‹ã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSIGKILLå°±æ˜¯å¾€pidè¿›ç¨‹å‘é€çš„ä¿¡å·ã€‚ å¹³å°ç›¸å…³æ€§ ä¿¡å·å…·æœ‰å¹³å°ç›¸å…³æ€§ï¼Œä¸åŒå¹³å°ä¸‹èƒ½ä½¿ç”¨çš„ä¿¡å·ç§ç±»æ˜¯æœ‰å·®å¼‚çš„ã€‚åœ¨Linuxä¸‹æ”¯æŒçš„ä¿¡å·(å¯¹æ¯”ä¿¡å·åˆ—è¡¨æŸ¥çœ‹æè¿°) SEGV, ILL, FPE, BUS, SYS, CPU, FSZ, ABRT, INT, TERM, HUP, USR1, USR2, QUIT, BREAK, TRAP, PIPEåœ¨Windowsä¸‹æ”¯æŒçš„ä¿¡å· SEGV, ILL, FPE, ABRT, INT, TERM, BREAK ä¿¡å·é€‰æ‹© ä¸ºäº†ä¸å¹²æ‰°æ­£å¸¸ä¿¡å·çš„è¿ä½œï¼Œåˆèƒ½æ¨¡æ‹ŸJavaå¼‚æ­¥é€šçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé€‰å®šä¸€ç§ç‰¹æ®Šçš„ä¿¡å·ã€‚é€šè¿‡æŸ¥çœ‹ä¿¡å·åˆ—è¡¨ä¸Šçš„æè¿°ï¼Œå‘ç° SIGUSR1 å’Œ SIGUSR2 æ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡å·ã€‚é‚£ä¹ˆé€‰æ‹©å®ƒä»¬ï¼Œç†è®ºä¸Šå°±ä¸ä¼šå½±å“æ­£å¸¸åŠŸèƒ½äº†ã€‚è¿™é‡Œæˆ‘é€‰ç”¨äº†BUSå’ŒUSR2ä½œä¸ºä¼ é€’ä¿¡å·ã€‚åŸå› æ˜¯USR1åœ¨Linuxç³»ç»Ÿä¸‹é¢ï¼Œå¾ˆå¤§å¯èƒ½æ€§ä¼šè¢«å…¶å®ƒåº”ç”¨å ç”¨ã€‚åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œå°±æ˜¯è¢«å ç”¨å¯¼è‡´handleå‡ºç°å¼‚å¸¸ã€‚ å®ç°ä»£ç JDK APIå®ç°è°ƒç ” Sunä¸ºæˆ‘ä»¬æä¾›äº†2ä¸ªæ–¹ä¾¿å®‰è£…å’Œæ›¿æ¢ä¿¡å·å¤„ç†å™¨çš„å·¥å…·ç±»ã€‚é€šè¿‡ä¸‹é¢çš„apiå¯ä»¥å¿«é€Ÿå®ç°ã€‚ sun.misc.Signal sun.misc.SignalHandler JanusSignalHandlerçš„code1234567891011121314151617181920public class JanusSignalHandler implements SignalHandler &#123; private static Logger logger = LoggerFactory.getLogger(JanusSignalHandler.class); @Override public void handle(Signal signal) &#123; if (null != signal) &#123; signalHandle(signal); &#125; &#125; private void signalHandle(Signal sn) &#123; if (sn.getName().equals(\"BUS\")) &#123; JanusNettyServer.online = false; logger.info(\"Signal name is:SIGBUS,online is:false\"); &#125; else if (sn.getName().equals(\"USR2\")) &#123; JanusNettyServer.online = true; logger.info(\"Signal name is:SIGUSR2,online is:true\"); &#125; else &#123; return; &#125; &#125;&#125; addSingalHookçš„Code åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œè°ƒç”¨æ­¤æ–¹æ³•install signals12345678910private void addSingalHook() &#123; try &#123; JanusSignalHandler janusSignalHandler = new JanusSignalHandler(); // install signals Signal.handle(new Signal(\"BUS\"), janusSignalHandler); Signal.handle(new Signal(\"USR2\"), janusSignalHandler); &#125; catch (IllegalArgumentException e) &#123; logger.error(\"exception:[&#123;&#125;]\", e.getMessage()); &#125; &#125; éƒ¨ç½²åˆ°Linuxç¨‹åºä¸­Testæ‰§è¡Œ kill -s BUS pid ä»LVSä¸­æ‘˜é™¤æ‰§è¡Œ kill -s USR2 pid åŠ å…¥LVSä¸­ å¥åº·æ£€æŸ¥result: æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ï¼Œå¦‚ä½•ä½¿ç”¨Java Signaå’ŒSignalHandlerå®ç°ï¼Œé€šè¿‡Linux å‘½ä»¤å®ç°kill -s BUS pidå’Œkill -s USR2 pidå®ç°ä¸killåº”ç”¨è¿›ç¨‹ï¼ŒæŠŠåº”ç”¨ç¨‹åºä»LVSä¸­æ‘˜é™¤ã€‚ä½†æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œéœ€è¦é€‰å¯¹ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„ä¿¡å·é‡ã€‚ä¸ç„¶ï¼Œä¼šè¯¯æ€åº”ç”¨ç¨‹åºæœ¬èº«ã€‚","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]},{"title":"Spring Cloud EurekaæœåŠ¡æ³¨å†Œæºç åˆ†æ","slug":"sc/sc-eureka-register","date":"2016-11-01T06:00:00.000Z","updated":"2019-01-12T04:30:38.822Z","comments":true,"path":"sc/sc-eureka-register/","link":"","permalink":"http://xujin.org/sc/sc-eureka-register/","excerpt":"æ‘˜è¦:åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œä»‹ç»äº†Eurekaçš„ç›¸å…³çš„çŸ¥è¯†ï¼Œè§£é‡Šäº†Eurekaä¸ºä»€ä¹ˆé€‚åˆåšæœåŠ¡å‘ç°å’Œæ³¨å†Œã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« å°†é€šè¿‡æºç åˆ†æçš„æ–¹å¼ï¼Œçœ‹ä¸€ä¸‹Eurekaæ˜¯æ€ä¹ˆworkçš„ã€‚æœ¬ç« ä¸»è¦ä»‹ç»Eurekaçš„æœåŠ¡æ³¨å†Œã€‚é‚£eureka clientå¦‚ä½•å°†æœ¬åœ°æœåŠ¡çš„æ³¨å†Œä¿¡æ¯å‘é€åˆ°è¿œç«¯çš„æ³¨å†ŒæœåŠ¡å™¨eureka serverä¸Šã€‚é€šè¿‡ä¸‹é¢çš„æºç åˆ†æï¼Œçœ‹å‡ºEureka Clientçš„å®šæ—¶ä»»åŠ¡è°ƒç”¨Eureka Serverçš„RESTæ¥å£ï¼Œè€ŒEurekaæ¥æ”¶åˆ°è°ƒç”¨è¯·æ±‚åä¼šå¤„ç†æœåŠ¡çš„æ³¨å†Œä»¥åŠEureka Serverä¸­çš„æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚ æœåŠ¡æ³¨å†Œ æœåŠ¡æ³¨å†Œï¼Œæƒ³å¿…å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œå°±æ˜¯æœåŠ¡æä¾›è€…å¯åŠ¨çš„æ—¶å€™ï¼ŒæŠŠè‡ªå·±æä¾›çš„æœåŠ¡ä¿¡æ¯ï¼Œä¾‹å¦‚ æœåŠ¡åï¼ŒIPï¼Œç«¯å£å·ï¼Œç‰ˆæœ¬å·ç­‰ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ¯”å¦‚æ³¨å†Œåˆ°ZKä¸­ã€‚é‚£eureka clientå¦‚ä½•å°†æœ¬åœ°æœåŠ¡çš„æ³¨å†Œä¿¡æ¯å‘é€åˆ°è¿œç«¯çš„æ³¨å†ŒæœåŠ¡å™¨eureka serverä¸Šã€‚é€šè¿‡ä¸‹é¢çš„æºç åˆ†æï¼Œçœ‹å‡ºæœåŠ¡æ³¨å†Œå¯ä»¥è®¤ä¸ºæ˜¯Eureka clientè‡ªå·±å®Œæˆï¼Œä¸éœ€è¦æœåŠ¡æœ¬èº«æ¥å…³å¿ƒã€‚ Eureka Clientçš„å®šæ—¶ä»»åŠ¡è°ƒç”¨Eureka Serverçš„æä¾›æ¥å£å®ç°æ€è·¯å…¶å®ä¹ŸæŒºç®€å•ï¼Œåœ¨com.netflix.discovery.DiscoveryClientå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶çš„æŠŠæœ¬åœ°çš„æœåŠ¡é…ç½®ä¿¡æ¯ï¼Œå³éœ€è¦æ³¨å†Œåˆ°è¿œç«¯çš„æœåŠ¡ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°åˆ°æ³¨å†ŒæœåŠ¡å™¨ä¸Šã€‚é¦–å…ˆçœ‹ä¸€ä¸‹Eurekaçš„ä»£ç ï¼Œåœ¨spring-cloud-netflix-eureka-serverå·¥ç¨‹ä¸­å¯ä»¥æ‰¾åˆ°è¿™ä¸ªä¾èµ–eureka-client-1.4.11.jaræŸ¥çœ‹ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œcom.netflix.discovery.DiscoveryClient.javaä¸­çš„1240è¡Œå¯ä»¥çœ‹åˆ°Initializes all scheduled tasksï¼Œåœ¨1277è¡Œï¼Œå¯ä»¥çœ‹åˆ°InstanceInfoReplicatorå®šæ—¶ä»»åŠ¡ã€‚","text":"æ‘˜è¦:åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œä»‹ç»äº†Eurekaçš„ç›¸å…³çš„çŸ¥è¯†ï¼Œè§£é‡Šäº†Eurekaä¸ºä»€ä¹ˆé€‚åˆåšæœåŠ¡å‘ç°å’Œæ³¨å†Œã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« å°†é€šè¿‡æºç åˆ†æçš„æ–¹å¼ï¼Œçœ‹ä¸€ä¸‹Eurekaæ˜¯æ€ä¹ˆworkçš„ã€‚æœ¬ç« ä¸»è¦ä»‹ç»Eurekaçš„æœåŠ¡æ³¨å†Œã€‚é‚£eureka clientå¦‚ä½•å°†æœ¬åœ°æœåŠ¡çš„æ³¨å†Œä¿¡æ¯å‘é€åˆ°è¿œç«¯çš„æ³¨å†ŒæœåŠ¡å™¨eureka serverä¸Šã€‚é€šè¿‡ä¸‹é¢çš„æºç åˆ†æï¼Œçœ‹å‡ºEureka Clientçš„å®šæ—¶ä»»åŠ¡è°ƒç”¨Eureka Serverçš„RESTæ¥å£ï¼Œè€ŒEurekaæ¥æ”¶åˆ°è°ƒç”¨è¯·æ±‚åä¼šå¤„ç†æœåŠ¡çš„æ³¨å†Œä»¥åŠEureka Serverä¸­çš„æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚ æœåŠ¡æ³¨å†Œ æœåŠ¡æ³¨å†Œï¼Œæƒ³å¿…å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œå°±æ˜¯æœåŠ¡æä¾›è€…å¯åŠ¨çš„æ—¶å€™ï¼ŒæŠŠè‡ªå·±æä¾›çš„æœåŠ¡ä¿¡æ¯ï¼Œä¾‹å¦‚ æœåŠ¡åï¼ŒIPï¼Œç«¯å£å·ï¼Œç‰ˆæœ¬å·ç­‰ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ¯”å¦‚æ³¨å†Œåˆ°ZKä¸­ã€‚é‚£eureka clientå¦‚ä½•å°†æœ¬åœ°æœåŠ¡çš„æ³¨å†Œä¿¡æ¯å‘é€åˆ°è¿œç«¯çš„æ³¨å†ŒæœåŠ¡å™¨eureka serverä¸Šã€‚é€šè¿‡ä¸‹é¢çš„æºç åˆ†æï¼Œçœ‹å‡ºæœåŠ¡æ³¨å†Œå¯ä»¥è®¤ä¸ºæ˜¯Eureka clientè‡ªå·±å®Œæˆï¼Œä¸éœ€è¦æœåŠ¡æœ¬èº«æ¥å…³å¿ƒã€‚ Eureka Clientçš„å®šæ—¶ä»»åŠ¡è°ƒç”¨Eureka Serverçš„æä¾›æ¥å£å®ç°æ€è·¯å…¶å®ä¹ŸæŒºç®€å•ï¼Œåœ¨com.netflix.discovery.DiscoveryClientå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶çš„æŠŠæœ¬åœ°çš„æœåŠ¡é…ç½®ä¿¡æ¯ï¼Œå³éœ€è¦æ³¨å†Œåˆ°è¿œç«¯çš„æœåŠ¡ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°åˆ°æ³¨å†ŒæœåŠ¡å™¨ä¸Šã€‚é¦–å…ˆçœ‹ä¸€ä¸‹Eurekaçš„ä»£ç ï¼Œåœ¨spring-cloud-netflix-eureka-serverå·¥ç¨‹ä¸­å¯ä»¥æ‰¾åˆ°è¿™ä¸ªä¾èµ–eureka-client-1.4.11.jaræŸ¥çœ‹ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œcom.netflix.discovery.DiscoveryClient.javaä¸­çš„1240è¡Œå¯ä»¥çœ‹åˆ°Initializes all scheduled tasksï¼Œåœ¨1277è¡Œï¼Œå¯ä»¥çœ‹åˆ°InstanceInfoReplicatorå®šæ—¶ä»»åŠ¡ã€‚ åœ¨DiscoveryClientä¸­åˆå§‹åŒ–ä¸€ä¸ªInstanceInfoReplicatorï¼Œå…¶å®é‡Œé¢å°è£…äº†ä»¥å®šæ—¶ä»»åŠ¡ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475/** * Initializes all scheduled tasks. */ private void initScheduledTasks() &#123; if (clientConfig.shouldFetchRegistry()) &#123; // registry cache refresh timer int registryFetchIntervalSeconds = clientConfig.getRegistryFetchIntervalSeconds(); int expBackOffBound = clientConfig.getCacheRefreshExecutorExponentialBackOffBound(); scheduler.schedule( new TimedSupervisorTask( \"cacheRefresh\", scheduler, cacheRefreshExecutor, registryFetchIntervalSeconds, TimeUnit.SECONDS, expBackOffBound, new CacheRefreshThread() ), registryFetchIntervalSeconds, TimeUnit.SECONDS); &#125; if (clientConfig.shouldRegisterWithEureka()) &#123; int renewalIntervalInSecs = instanceInfo.getLeaseInfo().getRenewalIntervalInSecs(); int expBackOffBound = clientConfig.getHeartbeatExecutorExponentialBackOffBound(); logger.info(\"Starting heartbeat executor: \" + \"renew interval is: \" + renewalIntervalInSecs); // Heartbeat timer scheduler.schedule( new TimedSupervisorTask( \"heartbeat\", scheduler, heartbeatExecutor, renewalIntervalInSecs, TimeUnit.SECONDS, expBackOffBound, new HeartbeatThread() ), renewalIntervalInSecs, TimeUnit.SECONDS); // InstanceInfo replicator /**************************å°è£…äº†å®šæ—¶ä»»åŠ¡**********************************/ instanceInfoReplicator = new InstanceInfoReplicator( this, instanceInfo, clientConfig.getInstanceInfoReplicationIntervalSeconds(), 2); // burstSize statusChangeListener = new ApplicationInfoManager.StatusChangeListener() &#123; @Override public String getId() &#123; return \"statusChangeListener\"; &#125; @Override public void notify(StatusChangeEvent statusChangeEvent) &#123; if (InstanceStatus.DOWN == statusChangeEvent.getStatus() || InstanceStatus.DOWN == statusChangeEvent.getPreviousStatus()) &#123; // log at warn level if DOWN was involved logger.warn(\"Saw local status change event &#123;&#125;\", statusChangeEvent); &#125; else &#123; logger.info(\"Saw local status change event &#123;&#125;\", statusChangeEvent); &#125; instanceInfoReplicator.onDemandUpdate(); &#125; &#125;; if (clientConfig.shouldOnDemandUpdateStatusChange()) &#123; applicationInfoManager.registerStatusChangeListener(statusChangeListener); &#125; //ç‚¹å‡»å¯ä»¥æŸ¥çœ‹startæ–¹æ³• instanceInfoReplicator.start(clientConfig.getInitialInstanceInfoReplicationIntervalSeconds()); &#125; else &#123; logger.info(\"Not registering with Eureka server per configuration\"); &#125; &#125; 2.ä»¥initialDelayMsä¸ºé—´éš”è°ƒç”¨ã€‚1234567public void start(int initialDelayMs) &#123; if (started.compareAndSet(false, true)) &#123; instanceInfo.setIsDirty(); // for initial register Future next = scheduler.schedule(this, initialDelayMs, TimeUnit.SECONDS); scheduledPeriodicRef.set(next); &#125;&#125; 3.ScheduledExecutorServiceçš„taskçš„å…·ä½“ä¸šåŠ¡å®šä¹‰åœ¨com.netflix.discovery.InstanceInfoReplicator.run()ä¸­ï¼Œä¹Ÿå°±æ˜¯InstanceInfoReplicatorä¸­çš„98-113è¡Œï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†äº†clientçš„registeræ–¹æ³•ã€‚1234567891011121314151617 public void run() &#123; try &#123; discoveryClient.refreshInstanceInfo(); Long dirtyTimestamp = instanceInfo.isDirtyWithTime(); if (dirtyTimestamp != null) &#123; //å®¢æˆ·ç«¯å‘é€hhtpæ³¨å†Œè¯·æ±‚çš„çœŸæ­£å…¥å£ discoveryClient.register(); instanceInfo.unsetIsDirty(dirtyTimestamp); &#125; &#125; catch (Throwable t) &#123; logger.warn(\"There was a problem with the instance info replicator\", t); &#125; finally &#123; Future next = scheduler.schedule(this, replicationIntervalSeconds, TimeUnit.SECONDS); scheduledPeriodicRef.set(next); &#125;&#125; 4.com.netflix.discovery.DiscoveryClientä¸­çš„ register()æ–¹æ³•ï¼Œå¤§æ¦‚åœ¨811è¡Œã€‚123456789101112131415161718/** * Register with the eureka service by making the appropriate REST call. */boolean register() throws Throwable &#123; logger.info(PREFIX + appPathIdentifier + \": registering service...\"); EurekaHttpResponse&lt;Void&gt; httpResponse; try &#123; //Eureka Clientå®¢æˆ·ç«¯ï¼Œè°ƒç”¨EurekaæœåŠ¡ç«¯çš„å…¥å£ httpResponse = eurekaTransport.registrationClient.register(instanceInfo); &#125; catch (Exception e) &#123; logger.warn(\"&#123;&#125; - registration failed &#123;&#125;\", PREFIX + appPathIdentifier, e.getMessage(), e); throw e; &#125; if (logger.isInfoEnabled()) &#123; logger.info(\"&#123;&#125; - registration status: &#123;&#125;\", PREFIX + appPathIdentifier, httpResponse.getStatusCode()); &#125; return httpResponse.getStatusCode() == 204;&#125; Eureka serverç«¯æ¥åˆ°è¯·æ±‚åçš„å¤„ç†æ‰“å¼€spring-cloud-netflix-eureka-serverå·¥ç¨‹æˆ–spring-cloud-netflix-eureka-clientè¿‡ç¨‹ï¼Œæ‰¾åˆ°ç›¸åº”çš„mavenä¾èµ–jarï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º 1.Eureka serveræœåŠ¡ç«¯è¯·æ±‚å…¥å£ApplicationResource.javaæ–‡ä»¶ä¸­ç¬¬183è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºEurekaæ˜¯é€šè¿‡http postçš„æ–¹å¼å»æœåŠ¡æ³¨å†Œ1234567891011121314151617181920212223242526272829303132333435363738394041424344@POST @Consumes(&#123;\"application/json\", \"application/xml\"&#125;) public Response addInstance(InstanceInfo info, @HeaderParam(PeerEurekaNode.HEADER_REPLICATION) String isReplication) &#123; logger.debug(\"Registering instance &#123;&#125; (replication=&#123;&#125;)\", info.getId(), isReplication); // validate that the instanceinfo contains all the necessary required fields if (isBlank(info.getId())) &#123; return Response.status(400).entity(\"Missing instanceId\").build(); &#125; else if (isBlank(info.getHostName())) &#123; return Response.status(400).entity(\"Missing hostname\").build(); &#125; else if (isBlank(info.getAppName())) &#123; return Response.status(400).entity(\"Missing appName\").build(); &#125; else if (!appName.equals(info.getAppName())) &#123; return Response.status(400).entity(\"Mismatched appName, expecting \" + appName + \" but was \" + info.getAppName()).build(); &#125; else if (info.getDataCenterInfo() == null) &#123; return Response.status(400).entity(\"Missing dataCenterInfo\").build(); &#125; else if (info.getDataCenterInfo().getName() == null) &#123; return Response.status(400).entity(\"Missing dataCenterInfo Name\").build(); &#125; // handle cases where clients may be registering with bad DataCenterInfo with missing data DataCenterInfo dataCenterInfo = info.getDataCenterInfo(); if (dataCenterInfo instanceof UniqueIdentifier) &#123; String dataCenterInfoId = ((UniqueIdentifier) dataCenterInfo).getId(); if (isBlank(dataCenterInfoId)) &#123; boolean experimental = \"true\".equalsIgnoreCase(serverConfig.getExperimental(\"registration.validation.dataCenterInfoId\")); if (experimental) &#123; String entity = \"DataCenterInfo of type \" + dataCenterInfo.getClass() + \" must contain a valid id\"; return Response.status(400).entity(entity).build(); &#125; else if (dataCenterInfo instanceof AmazonInfo) &#123; AmazonInfo amazonInfo = (AmazonInfo) dataCenterInfo; String effectiveId = amazonInfo.get(AmazonInfo.MetaDataKey.instanceId); if (effectiveId == null) &#123; amazonInfo.getMetadata().put(AmazonInfo.MetaDataKey.instanceId.getName(), info.getId()); &#125; &#125; else &#123; logger.warn(\"Registering DataCenterInfo of type &#123;&#125; without an appropriate id\", dataCenterInfo.getClass()); &#125; &#125; &#125; //InstanceRegistry.javaæ–‡ä»¶ä¸­çš„88è¡Œçš„405è¡Œregisteræ–¹æ³• registry.register(info, \"true\".equals(isReplication)); return Response.status(204).build(); // 204 to be backwards compatible &#125; 2.å¦‚ä¸‹å›¾æ‰€ç¤ºå¯ä»¥çœ‹åˆ°ï¼Œä»ApplicationResource.javaæ€ä¹ˆè¿›å…¥åˆ°PeerAwareInstanceRegistryImplä¸­çš„registeræ–¹æ³•InstanceRegistry.javaæ–‡ä»¶ä¸­çš„88è¡Œï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨PeerAwareInstanceRegistryImplä¸­çš„405è¡Œregisteræ–¹æ³•123456@Overridepublic void register(final InstanceInfo info, final boolean isReplication) &#123; handleRegistration(info, resolveInstanceLeaseDuration(info), isReplication); //è°ƒç”¨PeerAwareInstanceRegistryImplä¸­çš„405è¡Œregisteræ–¹æ³• super.register(info, isReplication); &#125; 3.PeerAwareInstanceRegistryImplä¸­çš„405è¡Œregisteræ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚é˜…è¯»æ–¹æ³•ä¸Šé¢çš„æ³¨é‡Šï¼Œå°±çŸ¥é“è¯¥æ–¹æ³•æ˜¯æ³¨å†ŒæœåŠ¡ä¿¡æ¯å¹¶æŠŠEureka Serverä¸­çš„é…ç½®ä¿¡æ¯åŒæ­¥ã€‚æ‰§è¡Œæ³¨å†Œçš„åŠ¨ä½œåœ¨com.netflix.eureka.registry.PeerAwareInstanceRegistryImpl.register(InstanceInfo info, boolean isReplication)ä¸­ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122/** * Registers the information about the &#123;@link InstanceInfo&#125; and replicates * this information to all peer eureka nodes. If this is replication event * from other replica nodes then it is not replicated. * * @param info * the &#123;@link InstanceInfo&#125; to be registered and replicated. * @param isReplication * true if this is a replication event from other replica nodes, * false otherwise. */ @Override public void register(final InstanceInfo info, final boolean isReplication) &#123; int leaseDuration = Lease.DEFAULT_DURATION_IN_SECS; if (info.getLeaseInfo() != null &amp;&amp; info.getLeaseInfo().getDurationInSecs() &gt; 0) &#123; leaseDuration = info.getLeaseInfo().getDurationInSecs(); &#125; //è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ³¨å†Œ super.register(info, leaseDuration, isReplication); // åŒæ­¥Eurekaä¸­çš„æœåŠ¡ä¿¡æ¯ replicateToPeers(Action.Register, info.getAppName(), info.getId(), info, null, isReplication); &#125; 4.AbstractInstanceRegistry.javaä¸­192è¡Œï¼Œå¯ä»¥çœ‹åˆ°EurekaçœŸæ­£çš„æœåŠ¡æ³¨å†Œå®ç°çš„ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * Registers a new instance with a given duration. * * @see com.netflix.eureka.lease.LeaseManager#register(java.lang.Object, int, boolean) */ public void register(InstanceInfo registrant, int leaseDuration, boolean isReplication) &#123; try &#123; read.lock(); Map&lt;String, Lease&lt;InstanceInfo&gt;&gt; gMap = registry.get(registrant.getAppName()); REGISTER.increment(isReplication); if (gMap == null) &#123; final ConcurrentHashMap&lt;String, Lease&lt;InstanceInfo&gt;&gt; gNewMap = new ConcurrentHashMap&lt;String, Lease&lt;InstanceInfo&gt;&gt;(); gMap = registry.putIfAbsent(registrant.getAppName(), gNewMap); if (gMap == null) &#123; gMap = gNewMap; &#125; &#125; Lease&lt;InstanceInfo&gt; existingLease = gMap.get(registrant.getId()); // Retain the last dirty timestamp without overwriting it, if there is already a lease if (existingLease != null &amp;&amp; (existingLease.getHolder() != null)) &#123; Long existingLastDirtyTimestamp = existingLease.getHolder().getLastDirtyTimestamp(); Long registrationLastDirtyTimestamp = registrant.getLastDirtyTimestamp(); logger.debug(\"Existing lease found (existing=&#123;&#125;, provided=&#123;&#125;\", existingLastDirtyTimestamp, registrationLastDirtyTimestamp); if (existingLastDirtyTimestamp &gt; registrationLastDirtyTimestamp) &#123; logger.warn(\"There is an existing lease and the existing lease's dirty timestamp &#123;&#125; is greater\" + \" than the one that is being registered &#123;&#125;\", existingLastDirtyTimestamp, registrationLastDirtyTimestamp); logger.warn(\"Using the existing instanceInfo instead of the new instanceInfo as the registrant\"); registrant = existingLease.getHolder(); &#125; &#125; else &#123; // The lease does not exist and hence it is a new registration synchronized (lock) &#123; if (this.expectedNumberOfRenewsPerMin &gt; 0) &#123; // Since the client wants to cancel it, reduce the threshold // (1 // for 30 seconds, 2 for a minute) this.expectedNumberOfRenewsPerMin = this.expectedNumberOfRenewsPerMin + 2; this.numberOfRenewsPerMinThreshold = (int) (this.expectedNumberOfRenewsPerMin * serverConfig.getRenewalPercentThreshold()); &#125; &#125; logger.debug(\"No previous lease information found; it is new registration\"); &#125; Lease&lt;InstanceInfo&gt; lease = new Lease&lt;InstanceInfo&gt;(registrant, leaseDuration); if (existingLease != null) &#123; lease.setServiceUpTimestamp(existingLease.getServiceUpTimestamp()); &#125; gMap.put(registrant.getId(), lease); synchronized (recentRegisteredQueue) &#123; recentRegisteredQueue.add(new Pair&lt;Long, String&gt;( System.currentTimeMillis(), registrant.getAppName() + \"(\" + registrant.getId() + \")\")); &#125; // This is where the initial state transfer of overridden status happens if (!InstanceStatus.UNKNOWN.equals(registrant.getOverriddenStatus())) &#123; logger.debug(\"Found overridden status &#123;&#125; for instance &#123;&#125;. Checking to see if needs to be add to the \" + \"overrides\", registrant.getOverriddenStatus(), registrant.getId()); if (!overriddenInstanceStatusMap.containsKey(registrant.getId())) &#123; logger.info(\"Not found overridden id &#123;&#125; and hence adding it\", registrant.getId()); overriddenInstanceStatusMap.put(registrant.getId(), registrant.getOverriddenStatus()); &#125; &#125; InstanceStatus overriddenStatusFromMap = overriddenInstanceStatusMap.get(registrant.getId()); if (overriddenStatusFromMap != null) &#123; logger.info(\"Storing overridden status &#123;&#125; from map\", overriddenStatusFromMap); registrant.setOverriddenStatus(overriddenStatusFromMap); &#125; // Set the status based on the overridden status rules InstanceStatus overriddenInstanceStatus = getOverriddenInstanceStatus(registrant, existingLease, isReplication); registrant.setStatusWithoutDirty(overriddenInstanceStatus); // If the lease is registered with UP status, set lease service up timestamp if (InstanceStatus.UP.equals(registrant.getStatus())) &#123; lease.serviceUp(); &#125; registrant.setActionType(ActionType.ADDED); recentlyChangedQueue.add(new RecentlyChangedItem(lease)); registrant.setLastUpdatedTimestamp(); invalidateCache(registrant.getAppName(), registrant.getVIPAddress(), registrant.getSecureVipAddress()); logger.info(\"Registered instance &#123;&#125;/&#123;&#125; with status &#123;&#125; (replication=&#123;&#125;)\", registrant.getAppName(), registrant.getId(), registrant.getStatus(), isReplication); &#125; finally &#123; read.unlock(); &#125; &#125; æ›´å¤šçš„ç»†èŠ‚æºç å†…å®¹ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±é˜…è¯»ã€‚ æ€»ç»“ApplicationResourceç±»æ¥æ”¶HttpæœåŠ¡è¯·æ±‚ï¼Œè°ƒç”¨PeerAwareInstanceRegistryImplçš„registeræ–¹æ³•ï¼ŒPeerAwareInstanceRegistryImplå®ŒæˆæœåŠ¡æ³¨å†Œåï¼Œè°ƒç”¨replicateToPeerså‘å…¶å®ƒEureka ServerèŠ‚ç‚¹ï¼ˆPeerï¼‰åšçŠ¶æ€åŒæ­¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"},{"name":"Spring Cloud æºç åˆ†æ","slug":"Spring-Cloud-æºç åˆ†æ","permalink":"http://xujin.org/tags/Spring-Cloud-æºç åˆ†æ/"}]},{"title":"Cornè¡¨è¾¾å¼ä¸æ—¶é—´æ•´ç‚¹åŠç‚¹ä»£ç ç‰‡","slug":"ex/get-hfs","date":"2016-10-30T06:00:00.000Z","updated":"2019-01-13T05:21:50.300Z","comments":true,"path":"ex/get-hfs/","link":"","permalink":"http://xujin.org/ex/get-hfs/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Cornè¡¨è¾¾å¼å’Œåˆ¤æ–­æ—¶é—´æ˜¯å¦åŠç‚¹æˆ–è€…æ•´ç‚¹æ‰§è¡Œçš„ä»£ç ç‰‡ã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Cornè¡¨è¾¾å¼å’Œåˆ¤æ–­æ—¶é—´æ˜¯å¦åŠç‚¹æˆ–è€…æ•´ç‚¹æ‰§è¡Œçš„ä»£ç ç‰‡ã€‚ Cornè¡¨è¾¾å¼1234567891011String exp=\"0/3 * * * * ? \";//åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æœ‰æ•ˆboolean valid = CronExpression.isValidExpression(exp); //ä½¿ç”¨CronExpressionç”Ÿæˆæ—¶é—´åºåˆ— CronExpression cronExpression = new CronExpression(exp);System.out.println(cronExpression.getNextValidTimeAfter(new Date()));//ä½¿ç”¨CronSequenceGeneratorç”Ÿæˆæ—¶é—´åºåˆ— CronSequenceGenerator cronSequenceGenerator = new CronSequenceGenerator(exp); Date nextTimePoint = cronSequenceGenerator.next(new Date()); åˆ¤æ–­æ—¶é—´æ˜¯å¦æ•´ç‚¹æˆ–è€…åŠç‚¹æ‰§è¡Œ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package com.xxx.xxx.utils;import java.util.Calendar;import java.util.Date;import java.util.GregorianCalendar;/** * @Author xujin */public class DateUtil &#123; /** * åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯åŠç‚¹ * @return */ public static Boolean judgeTimeIsHalf() &#123; Boolean judgeTimeIsHalf=false; Date date = new Date(); GregorianCalendar gc = new GregorianCalendar(); gc.setTime(date); if (gc.get(gc.MINUTE)==30) &#123; judgeTimeIsHalf= true; &#125; return judgeTimeIsHalf; &#125; /** * åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯åŠç‚¹ * @return */ public static boolean judgeTimeIsWhole() &#123; Boolean judgeTimeIsWhole=false; Date date = new Date(); GregorianCalendar gc = new GregorianCalendar(); gc.setTime(date); if ( gc.get(gc.MINUTE)==0 ) &#123; judgeTimeIsWhole= true; &#125; return judgeTimeIsWhole; &#125; public static int getMinute() &#123; Date date = new Date(); GregorianCalendar gc = new GregorianCalendar(); gc.setTime(date); return gc.get(gc.MINUTE); &#125; public static boolean quarztTime(int h,int m) &#123; Boolean isQuarztTime=false; Date date = new Date(); GregorianCalendar gc = new GregorianCalendar(); gc.setTime(date); if((gc.get(gc.HOUR_OF_DAY)==h&amp;&amp;gc.get(gc.MINUTE)==m)) &#123; isQuarztTime= true; &#125; return isQuarztTime; &#125; public static String getHourAndMinute() &#123; Date date = new Date(); GregorianCalendar gc = new GregorianCalendar(); gc.setTime(date); String hour=String.valueOf(gc.get(gc.HOUR_OF_DAY)); String minute=String.valueOf(gc.get(gc.MINUTE)); return hour+minute; &#125; public static void main(String[] args) &#123; System.out.println(getHourAndMinute()); Calendar calendar=Calendar.getInstance(); System.out.println( \"ç°åœ¨æ˜¯ï¼š\"+ calendar.get(GregorianCalendar.YEAR)+\"å¹´\"+ (calendar.get(GregorianCalendar.MONTH)+1)+\"æœˆ\"+ calendar.get(GregorianCalendar.DAY_OF_MONTH)+\"æ—¥\"+ calendar.get(GregorianCalendar.HOUR)+\"æ—¶\"+ calendar.get(GregorianCalendar.MINUTE)+\"åˆ†\"+ calendar.get(GregorianCalendar.SECOND)+\"ç§’\" ); &#125;&#125;","categories":[{"name":"ä»£ç ç‰‡","slug":"ä»£ç ç‰‡","permalink":"http://xujin.org/categories/ä»£ç ç‰‡/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"ä»£ç ç‰‡","slug":"ä»£ç ç‰‡","permalink":"http://xujin.org/tags/ä»£ç ç‰‡/"}]},{"title":"Spring Cloud Netflixä¹‹Eurekaä¸‹ç¯‡åŸç†","slug":"sc/sc-eureka-mid","date":"2016-10-25T06:00:00.000Z","updated":"2019-01-12T04:04:14.487Z","comments":true,"path":"sc/sc-eureka-mid/","link":"","permalink":"http://xujin.org/sc/sc-eureka-mid/","excerpt":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»Eurekaçš„å·¥ä½œåŸç†ï¼ŒEureka ç»„ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šEureka serverå’Œ Eureka clientã€‚è€Œå®¢æˆ·ç«¯åˆåˆ†ä¸º Application Service å®¢æˆ·ç«¯å’Œ Application Client å®¢æˆ·ç«¯ä¸¤ç§ã€‚Eureka çš„å·¥ä½œæœºåˆ¶æ¯ä¸ª region éƒ½æœ‰è‡ªå·±çš„ Eureka æœåŠ¡å™¨é›†ç¾¤ï¼Œæ¯ä¸ª zone è‡³å°‘è¦æœ‰ä¸€ä¸ª Eureka æœåŠ¡å™¨ä»¥åº”å¯¹ zone ç˜«ç—ªã€‚","text":"æ‘˜è¦:æœ¬æ–‡ä¸»è¦ä»‹ç»Eurekaçš„å·¥ä½œåŸç†ï¼ŒEureka ç»„ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šEureka serverå’Œ Eureka clientã€‚è€Œå®¢æˆ·ç«¯åˆåˆ†ä¸º Application Service å®¢æˆ·ç«¯å’Œ Application Client å®¢æˆ·ç«¯ä¸¤ç§ã€‚Eureka çš„å·¥ä½œæœºåˆ¶æ¯ä¸ª region éƒ½æœ‰è‡ªå·±çš„ Eureka æœåŠ¡å™¨é›†ç¾¤ï¼Œæ¯ä¸ª zone è‡³å°‘è¦æœ‰ä¸€ä¸ª Eureka æœåŠ¡å™¨ä»¥åº”å¯¹ zone ç˜«ç—ªã€‚ æ¦‚è¿°åè¯è§£é‡Š Renew:æˆ‘çš„ç†è§£æ˜¯ç»­çº¦ï¼Œä¸ºä»€ä¹ˆå«ç»­çº¦å‘¢ï¼ŸRenewï¼ˆæœåŠ¡ç»­çº¦ï¼‰æ“ä½œç”±Service Providerå®šæœŸè°ƒç”¨ï¼Œç±»ä¼¼äºheartbeatã€‚ç›®çš„æ˜¯éš”ä¸€æ®µæ—¶é—´Service Providerè°ƒç”¨æ¥å£ï¼Œå‘Šè¯‰Eureka Serverå®ƒè¿˜æ´»ç€æ²¡æŒ‚ï¼Œä¸è¦æŠŠå®ƒè¸¢æ‰ã€‚é€šä¿—çš„è¯´å°±æ˜¯å®ƒä»¬ä¸¤ä¹‹é—´çš„å¿ƒè·³æ£€æµ‹ï¼Œé¿å…æœåŠ¡æä¾›è€…è¢«å‰”é™¤æ‰ã€‚ Cancelï¼ˆæœåŠ¡ä¸‹çº¿ï¼‰ä¸€èˆ¬åœ¨Service ProvideræŒ‚äº†æˆ–shut downçš„æ—¶å€™è°ƒç”¨ï¼Œç”¨æ¥æŠŠè‡ªèº«çš„æœåŠ¡ä»Eureka Serverä¸­åˆ é™¤ï¼Œä»¥é˜²å®¢æˆ·ç«¯è°ƒç”¨åˆ°ä¸å­˜åœ¨çš„æœåŠ¡ã€‚ Fetch Registries(è·å–æ³¨å†Œä¿¡æ¯)ï¼ŒFetch Registriesç”±Service Consumer(æœåŠ¡æ¶ˆè´¹è€…)è°ƒç”¨ï¼Œç”¨æ¥è·å–Eureka Serverä¸Šæ³¨å†Œçš„æœåŠ¡infoã€‚ Eviction(å‰”é™¤)Evictionï¼ˆå¤±æ•ˆæœåŠ¡å‰”é™¤ï¼‰ç”¨æ¥å®šæœŸåœ¨Eureka Serveræ£€æµ‹å¤±æ•ˆçš„æœåŠ¡ï¼Œæ£€æµ‹æ ‡å‡†å°±æ˜¯è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰Renewçš„æœåŠ¡ã€‚å›é¡¾Eurekaæ¶æ„å›¾Eurekaæ¶æ„å›¾Eurekaæ¶æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œgithubåœ°å€:https://github.com/netflix/eurekadocumentåœ°å€:https://github.com/Netflix/eureka/wiki/Eureka-at-a-glance&ensp; ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒEureka ç»„ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šEureka serverå’Œ Eureka clientã€‚è€Œå®¢æˆ·ç«¯åˆåˆ†ä¸º Application Service å®¢æˆ·ç«¯å’Œ Application Client å®¢æˆ·ç«¯ä¸¤ç§ã€‚Eureka çš„å·¥ä½œæœºåˆ¶æ¯ä¸ª region éƒ½æœ‰è‡ªå·±çš„ Eureka æœåŠ¡å™¨é›†ç¾¤ï¼Œæ¯ä¸ª zone è‡³å°‘è¦æœ‰ä¸€ä¸ª Eureka æœåŠ¡å™¨ä»¥åº”å¯¹ zone ç˜«ç—ªã€‚&ensp; Application Service åœ¨å¯åŠ¨æ—¶æ³¨å†Œåˆ° Eureka æœåŠ¡å™¨ï¼Œä¹‹åæ¯ 30 ç§’é’Ÿå‘é€å¿ƒè·³ä»¥æ›´æ–°è‡ªèº«çŠ¶æ€,å³Renew(ç»­çº¦)ã€‚å¦‚æœè¯¥å®¢æˆ·ç«¯æ²¡èƒ½å‘é€å¿ƒè·³æ›´æ–°ï¼Œå®ƒå°†åœ¨ 90 ç§’ä¹‹åè¢«å…¶æ³¨å†Œçš„ Eureka æœåŠ¡å™¨å‰”é™¤ï¼Œå³Eviction(å‰”é™¤)ã€‚æ¥è‡ªä»»æ„ zone çš„ Application Client å¯ä»¥è·å–è¿™äº›æ³¨å†Œä¿¡æ¯(æ¯éš” 30 ç§’æŸ¥çœ‹ä¸€æ¬¡)å¹¶ä¾æ­¤å®šä½åˆ°åœ¨ä»»ä½•åŒºåŸŸå¯ä»¥ç»™è‡ªå·±æä¾›æœåŠ¡çš„æä¾›è€…(å³Fetch Registries)ï¼Œè¿›è€Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚ æœåŠ¡æä¾›è€…æœ¬èº«æºå¸¦çš„Eureka Clientæ—¢èƒ½æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡ç»­çº¦ï¼Œä¹Ÿèƒ½é€šè¿‡clientå®šä½æœåŠ¡å’Œè°ƒç”¨å…¶å®ƒçš„æœåŠ¡ã€‚ æœåŠ¡æ³¨å†ŒæœåŠ¡æ³¨å†Œ æœåŠ¡æ³¨å†Œæºç åˆ†æï¼Œè¯·å‚è€ƒ:http://blog.xujin.org/sc/sc-eureka-register/ Renew(æœåŠ¡ç»­çº¦)æœåŠ¡ç»­çº¦ Renewæ“ä½œä¼šåœ¨Service Providerç«¯å®šæœŸå‘èµ·ï¼Œç”¨æ¥é€šçŸ¥Eureka Serverè‡ªå·±è¿˜æ´»ç€ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š1eureka.instance.leaseRenewalIntervalInSeconds Renewé¢‘ç‡ã€‚é»˜è®¤æ˜¯30ç§’ï¼Œä¹Ÿå°±æ˜¯æ¯30ç§’ä¼šå‘Eureka Serverå‘èµ·Renewæ“ä½œã€‚1eureka.instance.leaseExpirationDurationInSeconds æœåŠ¡å¤±æ•ˆæ—¶é—´ã€‚é»˜è®¤æ˜¯90ç§’ï¼Œä¹Ÿå°±æ˜¯å¦‚æœEureka Serveråœ¨90ç§’å†…æ²¡æœ‰æ¥æ”¶åˆ°æ¥è‡ªService Providerçš„Renewæ“ä½œï¼Œå°±ä¼šæŠŠService Providerå‰”é™¤ã€‚","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/tags/Spring-Cloud-Eureka/"}]},{"title":"Spring Cloud Netflixä¹‹Eurekaä¸Šç¯‡","slug":"sc/sc-netflix-eureka","date":"2016-10-23T06:00:00.000Z","updated":"2019-01-13T03:24:13.383Z","comments":true,"path":"sc/sc-netflix-eureka/","link":"","permalink":"http://xujin.org/sc/sc-netflix-eureka/","excerpt":"å‰è¨€:Spring Cloud NetFlixè¿™ä¸ªé¡¹ç›®å¯¹NetFlixä¸­ä¸€äº›ä¹…ç»è€ƒéªŒé è°±çš„æœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œç½‘å…³ï¼Œæ™ºèƒ½è·¯ç”±ï¼Œä»¥åŠè´Ÿè½½å‡è¡¡ç­‰åšäº†å°è£…ï¼Œå¹¶é€šè¿‡æ³¨è§£çš„æˆ–ç®€å•é…ç½®çš„æ–¹å¼æä¾›ç»™Spring Cloudç”¨æˆ·ç”¨ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloudä¸­çš„Eurekaç»„ä»¶ã€‚ç”±äºSpring CloudåšæŠ€æœ¯é€‰å‹æ—¶ä¸­ç«‹çš„ï¼Œå› æ­¤Spring Cloudä¹Ÿæä¾›äº†Spring Cloud Zookeeper,Spring Cloud Consulç”¨äºæœåŠ¡æ²»ç†æˆ–æœåŠ¡å‘ç°ä¾›å¤§å®¶é€‰æ‹©ä½¿ç”¨ï¼Œå¦å¤–æˆ‘è¿˜å‘ç°Spring Cloud etcdè¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°","text":"å‰è¨€:Spring Cloud NetFlixè¿™ä¸ªé¡¹ç›®å¯¹NetFlixä¸­ä¸€äº›ä¹…ç»è€ƒéªŒé è°±çš„æœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œç½‘å…³ï¼Œæ™ºèƒ½è·¯ç”±ï¼Œä»¥åŠè´Ÿè½½å‡è¡¡ç­‰åšäº†å°è£…ï¼Œå¹¶é€šè¿‡æ³¨è§£çš„æˆ–ç®€å•é…ç½®çš„æ–¹å¼æä¾›ç»™Spring Cloudç”¨æˆ·ç”¨ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloudä¸­çš„Eurekaç»„ä»¶ã€‚ç”±äºSpring CloudåšæŠ€æœ¯é€‰å‹æ—¶ä¸­ç«‹çš„ï¼Œå› æ­¤Spring Cloudä¹Ÿæä¾›äº†Spring Cloud Zookeeper,Spring Cloud Consulç”¨äºæœåŠ¡æ²»ç†æˆ–æœåŠ¡å‘ç°ä¾›å¤§å®¶é€‰æ‹©ä½¿ç”¨ï¼Œå¦å¤–æˆ‘è¿˜å‘ç°Spring Cloud etcdè¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç° ä»€ä¹ˆæ˜¯ Spring Cloud Netflix ?å…¶å®˜æ–¹æ–‡æ¡£ä¸­å¯¹è‡ªå·±çš„å®šä¹‰æ˜¯å¦‚ä¸‹ï¼Œå®˜ç½‘è¿æ¥,Githubåœ°å€ This project provides Netflix OSS integrations for Spring Boot apps through autoconfiguration and binding to the Spring Environment and other Spring programming model idioms. With a few simple annotations you can quickly enable and configure the common patterns inside your application and build large distributed systems with battle-tested Netflix components. The patterns provided include Service Discovery (Eureka), Circuit Breaker (Hystrix), Intelligent Routing (Zuul) and Client Side Load Balancing (Ribbon). Spring Cloud Netflixè¿™ä¸ªé¡¹ç›®å¯¹äºSpring Bootåº”ç”¨æ¥è¯´ï¼Œå®ƒé›†æˆäº†NetFlix OSSçš„ä¸€äº›ç»„ä»¶ï¼Œåªéœ€é€šè¿‡æ³¨è§£é…ç½®å’ŒSpringç¯å¢ƒçš„é€šç”¨ç®€å•çš„ä½¿ç”¨æ³¨è§£ï¼Œä½ å¯ä»¥å¿«é€Ÿçš„å¯ç”¨å’Œé…ç½®è¿™äº›ä¹…ç»æµ‹è¯•è€ƒéªŒçš„NetFlixçš„ç»„ä»¶äºä½ çš„åº”ç”¨å’Œç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚è¿™äº›ç»„ä»¶åŒ…å«çš„åŠŸèƒ½æœ‰æœåŠ¡å‘ç°ï¼ˆEurekaï¼‰ï¼Œç†”æ–­å™¨ï¼ˆHystrixï¼‰ï¼Œæ™ºèƒ½è·¯ç”±(Zuul)ä»¥åŠå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆRibbonï¼‰ ç®€å•çš„æ¥è¯´ï¼ŒSpring Cloud NetFlixè¿™ä¸ªé¡¹ç›®å¯¹NetFlixä¸­ä¸€äº›ä¹…ç»è€ƒéªŒé è°±çš„æœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œç½‘å…³ï¼Œæ™ºèƒ½è·¯ç”±ï¼Œä»¥åŠè´Ÿè½½å‡è¡¡ç­‰åšäº†å°è£…ï¼Œå¹¶é€šè¿‡æ³¨è§£çš„æˆ–ç®€å•é…ç½®çš„æ–¹å¼æä¾›ç»™Spring Cloudç”¨æˆ·ç”¨ã€‚ ä»€ä¹ˆæ˜¯ Eureka?å®˜ç½‘å®šä¹‰æ˜¯: Eureka is a REST (Representational State Transfer) based service that is primarily used in the AWS cloud for locating services for the purpose of load balancing and failover of middle-tier servers. We call this service, the Eureka Server. Eureka also comes with a Java-based client component,the Eureka Client, which makes interactions with the service much easier. The client also has a built-in load balancer that does basic round-robin load balancing. ç®€å•æ¥è¯´Eurekaå°±æ˜¯Netflixå¼€æºçš„ä¸€æ¬¾æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„äº§å“ï¼Œå¹¶ä¸”æä¾›äº†ç›¸åº”çš„Javaå®¢æˆ·ç«¯ã€‚ ä¸ºä»€ä¹ˆè¦é€‰æ‹© Eureka?é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†Eurekaå‘¢ï¼Ÿä¸»è¦åŸå› å¦‚ä¸‹: å®ƒæä¾›äº†å®Œæ•´çš„Service Registryå’ŒService Discoveryå®ç° é¦–å…ˆæ˜¯æä¾›äº†å®Œæ•´çš„å®ç°ï¼Œå¹¶ä¸”ä¹Ÿç»å—ä½äº†Netflixçš„ç”Ÿäº§ç¯å¢ƒè€ƒéªŒï¼Œä½¿ç”¨æ¯”è¾ƒæ–¹ä¾¿åªéœ€é€šè¿‡æ³¨è§£æˆ–ç®€å•é…ç½®çš„æ–¹å¼å³å¯ã€‚ å’ŒSpring Cloudæ— ç¼é›†æˆ Spring Cloudå¯¹Eurekaåšäº†æ— ç¼é›†æˆï¼Œæä¾›äº†ä¸€å¥—å®Œå–„çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚ å¦å¤–ï¼ŒEurekaæ”¯æŒåµŒå…¥åˆ°åº”ç”¨è‡ªèº«çš„å®¹å™¨ä¸­å¯åŠ¨ï¼Œåº”ç”¨å¯åŠ¨å®Œä¹‹åï¼Œæ—¢å……å½“äº†Eurekaçš„è§’è‰²ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡çš„æä¾›è€…ã€‚è¿™æ ·å°±æå¤§çš„æé«˜äº†æœåŠ¡çš„å¯ç”¨æ€§ã€‚ å¼€æº å¼€æºä»£ç ï¼Œæ–¹ä¾¿å­¦ä¹ æŒæ¡å…¶æºç å¹¶é©¾é©­å®ƒã€‚ å‚è€ƒé˜…è¯»ï¼šä¸ºä»€ä¹ˆä¸åº”è¯¥ä½¿ç”¨ZooKeeperåšæœåŠ¡å‘ç°è‹±æ–‡é“¾æ¥:Eureka! Why You Shouldnâ€™t Use ZooKeeper for Service Discovery:http://www.knewton.com/tech/blog/2014/12/eureka-shouldnt-use-zookeeper-service-discovery/ä¸­æ–‡é“¾æ¥:http://blog.csdn.net/jenny8080/article/details/52448403Eureka vs. Zookeeperï¼šhttps://groups.google.com/forum/#%21topic/eureka_netflix/LXKWoD14RFY è¿›ä¸€æ­¥äº†è§£ EurekaEurekaåŸºæœ¬æ¶æ„å›¾ ä¸Šå›¾ç®€è¦æè¿°äº†Eurekaçš„åŸºæœ¬æ¶æ„ï¼Œç”±3ä¸ªè§’è‰²ç»„æˆï¼š Eureka Server æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç° Service Provider æœåŠ¡æä¾›è€…ï¼ŒæœåŠ¡å¯åŠ¨çš„æ—¶å€™ä¼šå°†è‡ªå·±çš„æœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°Eureka Service Consumer æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»Eurekaä¸­è·å–å·²æ³¨çš„æœåŠ¡ä¿¡æ¯ï¼Œç”¨äºè°ƒç”¨æœåŠ¡ç”Ÿäº§è€… éœ€è¦æ³¨æ„ä¸€ç‚¹æ˜¯ï¼šä¸€ä¸ªService Provideræ—¢å¯ä»¥æ˜¯Service Consumerï¼Œä¹Ÿå¯ä»¥æ˜¯Service Providerã€‚ é›†ç¾¤æ¨¡å¼ä¸‹çš„Eureka ä¸Šå›¾æ›´è¿›ä¸€æ­¥çš„å±•ç¤ºäº†3ä¸ªè§’è‰²ä¹‹é—´çš„äº¤äº’ã€‚ Service Providerä¼šå‘Eureka ServeråšRegisterï¼ˆæœåŠ¡æ³¨å†Œï¼‰ã€Renewï¼ˆæœåŠ¡ç»­çº¦ï¼‰ã€Cancelï¼ˆæœåŠ¡ä¸‹çº¿ï¼‰ç­‰æ“ä½œã€‚ Eureka Serverä¹‹é—´ä¼šåšæ³¨å†ŒæœåŠ¡çš„åŒæ­¥ï¼Œä»è€Œä¿è¯çŠ¶æ€ä¸€è‡´ Service Consumerä¼šå‘Eureka Serverè·å–æ³¨å†ŒæœåŠ¡åˆ—è¡¨ï¼Œå¹¶æ¶ˆè´¹æœåŠ¡","categories":[{"name":"Spring Cloud Eureka","slug":"Spring-Cloud-Eureka","permalink":"http://xujin.org/categories/Spring-Cloud-Eureka/"}],"tags":[{"name":"Spring Cloud Netflix","slug":"Spring-Cloud-Netflix","permalink":"http://xujin.org/tags/Spring-Cloud-Netflix/"},{"name":"Eureka","slug":"Eureka","permalink":"http://xujin.org/tags/Eureka/"}]},{"title":"Spring Cloud Sleuth-å…¨é“¾è·¯ç›‘æ§è°ƒç ”","slug":"sc/sc-sleuth","date":"2016-10-21T06:00:00.000Z","updated":"2019-01-13T03:36:14.996Z","comments":true,"path":"sc/sc-sleuth/","link":"","permalink":"http://xujin.org/sc/sc-sleuth/","excerpt":"å‰è¨€:åšè¿‡è½¯ä»¶å¼€å‘çš„éƒ½çŸ¥é“ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œå…¨é“¾è·¯çš„ç›‘æ§æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯è½¯ä»¶å¼€å‘è€…ï¼Œé€šè¿‡è‡ªå®šä¹‰æ—¥å¿—çš„levelï¼Œæ—¥å¿—æ–‡ä»¶çš„æ–¹å¼è®°å½•å•ä½“åº”ç”¨çš„è¿è¡Œæ—¥å¿—ã€‚ä»è€Œæ’æŸ¥çº¿ä¸Šç³»ç»Ÿå‡ºç°è¿è¡Œè¿‡æ…¢ï¼Œå‡ºç°æ•…éšœï¼Œå¼‚å¸¸ç­‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç³»ç»Ÿè¢«æ‹†åˆ†æˆäº†Aã€Bã€Cã€Dã€Eç­‰å¤šä¸ªæœåŠ¡ï¼Œè€Œæ¯ä¸ªæœåŠ¡å¯èƒ½åˆæœ‰å¤šä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼Œé‡‡ç”¨ä¸Šè¯‰å®šä½é—®é¢˜çš„æ–¹å¼å°±è¡Œä¸é€šäº†ï¼Œä½ å……å…¶é‡å°±çŸ¥é“æŸä¸ªæœåŠ¡æ˜¯åº”ç”¨çš„ç“¶é¢ˆï¼Œä½†ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆä½ å®Œå…¨ä¸çŸ¥é“ã€‚è€Œä¸”é—®é¢˜çš„æŸ¥è¯¢ï¼Œå› ä¸ºæœ‰æµ·é‡å„ç§å„æ ·çš„æ—¥å¿—ç­‰æ–‡ä»¶ï¼Œå¯¼è‡´è¿½æº¯å®šä½é—®é¢˜ç­‰æå…¶ä¸æ–¹ä¾¿ã€‚å› æ­¤éœ€è¦å…¨é“¾è·¯ç›‘æ§ç³»ç»Ÿçš„æ”¶é›†ï¼Œä¸ŠæŠ¥ï¼Œå¯¹æµ·é‡æ—¥å¿—å®æ—¶è®¡ç®—ç”Ÿæˆï¼Œç›‘æ§å‘Šè­¦ï¼Œè§†å›¾æŠ¥è¡¨ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½é—®é¢˜ã€‚ æœåŠ¡è¿½è¸ªåˆ†æä¸€ä¸ªç”±å¾®æœåŠ¡æ„æˆçš„åº”ç”¨ç³»ç»Ÿç”±Nä¸ªæœåŠ¡å®ä¾‹ç»„æˆï¼Œé€šè¿‡RESTè¯·æ±‚æˆ–è€…RPCåè®®ç­‰æ¥é€šè®¯å®Œæˆä¸€ä¸ªä¸šåŠ¡æµç¨‹çš„è°ƒç”¨ã€‚å¯¹äºå…¥å£çš„ä¸€ä¸ªè°ƒç”¨å¯èƒ½éœ€è¦æœ‰å¤šä¸ªåå°æœåŠ¡ååŒå®Œæˆï¼Œé“¾è·¯ä¸Šä»»ä½•ä¸€ä¸ªè°ƒç”¨è¶…æ—¶æˆ–å‡ºé”™éƒ½å¯èƒ½é€ æˆå‰ç«¯è¯·æ±‚çš„å¤±è´¥ã€‚æœåŠ¡çš„è°ƒç”¨é“¾ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ï¼Œå¹¶å½¢æˆä¸€ä¸ªæ ‘å½¢çš„è°ƒç”¨é“¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:","text":"å‰è¨€:åšè¿‡è½¯ä»¶å¼€å‘çš„éƒ½çŸ¥é“ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œå…¨é“¾è·¯çš„ç›‘æ§æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯è½¯ä»¶å¼€å‘è€…ï¼Œé€šè¿‡è‡ªå®šä¹‰æ—¥å¿—çš„levelï¼Œæ—¥å¿—æ–‡ä»¶çš„æ–¹å¼è®°å½•å•ä½“åº”ç”¨çš„è¿è¡Œæ—¥å¿—ã€‚ä»è€Œæ’æŸ¥çº¿ä¸Šç³»ç»Ÿå‡ºç°è¿è¡Œè¿‡æ…¢ï¼Œå‡ºç°æ•…éšœï¼Œå¼‚å¸¸ç­‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç³»ç»Ÿè¢«æ‹†åˆ†æˆäº†Aã€Bã€Cã€Dã€Eç­‰å¤šä¸ªæœåŠ¡ï¼Œè€Œæ¯ä¸ªæœåŠ¡å¯èƒ½åˆæœ‰å¤šä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼Œé‡‡ç”¨ä¸Šè¯‰å®šä½é—®é¢˜çš„æ–¹å¼å°±è¡Œä¸é€šäº†ï¼Œä½ å……å…¶é‡å°±çŸ¥é“æŸä¸ªæœåŠ¡æ˜¯åº”ç”¨çš„ç“¶é¢ˆï¼Œä½†ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆä½ å®Œå…¨ä¸çŸ¥é“ã€‚è€Œä¸”é—®é¢˜çš„æŸ¥è¯¢ï¼Œå› ä¸ºæœ‰æµ·é‡å„ç§å„æ ·çš„æ—¥å¿—ç­‰æ–‡ä»¶ï¼Œå¯¼è‡´è¿½æº¯å®šä½é—®é¢˜ç­‰æå…¶ä¸æ–¹ä¾¿ã€‚å› æ­¤éœ€è¦å…¨é“¾è·¯ç›‘æ§ç³»ç»Ÿçš„æ”¶é›†ï¼Œä¸ŠæŠ¥ï¼Œå¯¹æµ·é‡æ—¥å¿—å®æ—¶è®¡ç®—ç”Ÿæˆï¼Œç›‘æ§å‘Šè­¦ï¼Œè§†å›¾æŠ¥è¡¨ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½é—®é¢˜ã€‚ æœåŠ¡è¿½è¸ªåˆ†æä¸€ä¸ªç”±å¾®æœåŠ¡æ„æˆçš„åº”ç”¨ç³»ç»Ÿç”±Nä¸ªæœåŠ¡å®ä¾‹ç»„æˆï¼Œé€šè¿‡RESTè¯·æ±‚æˆ–è€…RPCåè®®ç­‰æ¥é€šè®¯å®Œæˆä¸€ä¸ªä¸šåŠ¡æµç¨‹çš„è°ƒç”¨ã€‚å¯¹äºå…¥å£çš„ä¸€ä¸ªè°ƒç”¨å¯èƒ½éœ€è¦æœ‰å¤šä¸ªåå°æœåŠ¡ååŒå®Œæˆï¼Œé“¾è·¯ä¸Šä»»ä½•ä¸€ä¸ªè°ƒç”¨è¶…æ—¶æˆ–å‡ºé”™éƒ½å¯èƒ½é€ æˆå‰ç«¯è¯·æ±‚çš„å¤±è´¥ã€‚æœåŠ¡çš„è°ƒç”¨é“¾ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ï¼Œå¹¶å½¢æˆä¸€ä¸ªæ ‘å½¢çš„è°ƒç”¨é“¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:ä½†æ˜¯éšç€æœåŠ¡çš„å¢å¤šï¼Œå¯¹è°ƒç”¨é“¾çš„åˆ†æä¹Ÿä¼šè¶Šæ¥è¶Šè´Ÿè´£ã€‚è®¾æƒ³ä½ åœ¨è´Ÿè´£ä¸‹é¢è¿™ä¸ªç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸ªå°ç‚¹éƒ½æ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œä»–ä»¬ä¹‹é—´çš„è°ƒç”¨å…³ç³»å½¢æˆäº†å¤æ‚çš„ç½‘ç»œã€‚å¦‚ä¸‹å›¾æ‰€ç¤º: é€šè¿‡è¯¥å›¾ï¼Œå¯ä»¥çœ‹å‡ºé”™ç»¼å¤æ‚çš„è°ƒç”¨ç½‘è·¯å›¾ã€‚é’ˆå¯¹æœåŠ¡åŒ–åº”ç”¨å…¨é“¾è·¯è¿½è¸ªçš„é—®é¢˜ï¼ŒGoogleå‘è¡¨äº†Dapperè®ºæ–‡ï¼Œä»‹ç»äº†ä»–ä»¬å¦‚ä½•è¿›è¡ŒæœåŠ¡è¿½è¸ªåˆ†æã€‚å…¶åŸºæœ¬æ€è·¯æ˜¯åœ¨æœåŠ¡è°ƒç”¨çš„è¯·æ±‚å’Œå“åº”ä¸­åŠ å…¥IDï¼Œæ ‡æ˜ä¸Šä¸‹æ¸¸è¯·æ±‚çš„å…³ç³»ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥å¯è§†åŒ–åœ°åˆ†ææœåŠ¡è°ƒç”¨é“¾è·¯å’ŒæœåŠ¡é—´çš„ä¾èµ–å…³ç³»ã€‚ ä»€ä¹ˆæ˜¯ Spring Cloud Sleuth ?Spring Cloud Sleuthä¸ºSpring Cloudæä¾›äº†åˆ†å¸ƒå¼è¿½è¸ªæ–¹æ¡ˆï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸ªé¢†åŸŸä¸­çš„ä¸€äº›æ¦‚å¿µï¼Œå»ºè®®å…ˆè‡ªè¡Œæœç´¢å­¦ä¹ ä¸€ä¸‹Google Dapperç›¸å…³çš„è®ºæ–‡ï¼Œhttp://research.google.com/pubs/pub36356.htmlï¼Œgithub Codeè¿æ¥:Spring Cloud Sleuth Codeã€‚å®˜æ–¹æ–‡æ¡£åœ°å€:http://cloud.spring.io/spring-cloud-sleuth/spring-cloud-sleuth.html. å…¶å®˜æ–¹æ–‡æ¡£ä¸­å¯¹è‡ªå·±çš„å®šä¹‰æ˜¯å¦‚ä¸‹ï¼š Spring Cloud Sleuth implements a distributed tracing solution for Spring Cloud, borrowing heavily from Dapper, Zipkin and HTrace. For most users Sleuth should be invisible, and all your interactions with external systems should be instrumented automatically. You can capture data simply in logs, or by sending it to a remote collector service. ç®€å•æ¥è¯´ï¼ŒSpring Cloud Sleuthå°±æ˜¯APM(Application Performance Monitor),å…¨é“¾è·¯ç›‘æ§çš„APMçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœè¦å®Œæ•´çš„ä½¿ç”¨è¯¥ç»„ä»¶éœ€è¦è‡ªå·±å®šåˆ¶åŒ–æˆ–è€…å’Œå¼€æºçš„ç³»ç»Ÿé›†æˆï¼Œä¾‹å¦‚:ZipKinã€‚ APMï¼ˆApplication Performance Monitorï¼‰è¿™ä¸ªé¢†åŸŸæœ€è¿‘å¼‚å¸¸ç«çƒ­ã€‚å›½å¤–è¯¥é¢†åŸŸçŸ¥åå…¬å¸åŒ…æ‹¬New Relicï¼ŒAppdynamicsï¼ŒSplunkã€‚å…¶ä¸­New Relicå·²ç»æˆåŠŸIPOï¼Œä¼°å€¼è¶…è¿‡20äº¿ç¾å…ƒã€‚å›½å†…å¤–çš„ä¸ªå¤§äº’è”ç½‘å…¬å¸ä¹Ÿéƒ½æœ‰ç±»ä¼¼å¤§åé¼é¼çš„APMäº§å“ï¼Œä¾‹å¦‚æ·˜å®é¹°çœ¼Eagle Eyesï¼Œç‚¹è¯„çš„CATï¼Œå¾®åšçš„Watchmanï¼Œtwitterçš„Zipkinã€‚ä»–ä»¬çš„äº§å“è™½æœªåƒä¸“ä¸šAPMå…¬å¸çš„äº§å“è¿™æ ·åŠŸèƒ½å¼ºå¤§ï¼Œä½†ç»“åˆå„è‡ªå…¬å¸çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œè¿™äº›äº§å“åœ¨æ”¯æ’‘ä¸šåŠ¡ç³»ç»Ÿçš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢ï¼Œå‘æŒ¥äº†æ˜¾è‘—çš„ä½œç”¨ã€‚ Spring Cloud Sleuthå’ŒZipkinå¯¹åº”Dpperçš„å¼€æºå®ç°æ˜¯Zipkinï¼Œæ”¯æŒå¤šç§è¯­è¨€åŒ…æ‹¬JavaScriptï¼ŒPythonï¼ŒJava, Scala, Ruby, C#, Goç­‰ã€‚å…¶ä¸­Javaç”±å¤šç§ä¸åŒçš„åº“æ¥æ”¯æŒã€‚ SpringCloudSleuth å€Ÿç”¨äº† Dapper çš„æœ¯è¯­ Span åŸºæœ¬å·¥ä½œå•å…ƒï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–°å»ºçš„spanä¸­å‘é€ä¸€ä¸ªRPCç­‰åŒäºå‘é€ä¸€ä¸ªå›åº”è¯·æ±‚ç»™RPCï¼Œspané€šè¿‡ä¸€ä¸ª64ä½IDå”¯ä¸€æ ‡è¯†ï¼Œtraceä»¥å¦ä¸€ä¸ª64ä½IDè¡¨ç¤ºï¼Œspanè¿˜æœ‰å…¶ä»–æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚æ‘˜è¦ã€æ—¶é—´æˆ³äº‹ä»¶ã€å…³é”®å€¼æ³¨é‡Š(tags)ã€spançš„IDã€ä»¥åŠè¿›åº¦ID(é€šå¸¸æ˜¯IPåœ°å€) spanåœ¨ä¸æ–­çš„å¯åŠ¨å’Œåœæ­¢ï¼ŒåŒæ—¶è®°å½•äº†æ—¶é—´ä¿¡æ¯ï¼Œå½“ä½ åˆ›å»ºäº†ä¸€ä¸ªspanï¼Œä½ å¿…é¡»åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»åœæ­¢å®ƒã€‚ Trace ä¸€ç³»åˆ—spansç»„æˆçš„ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ è¦åœ¨åˆ†å¸ƒå¼ä¸­å¤§æ•°æ®å­˜å‚¨ä¸­ä½¿ç”¨ï¼ŒTraceå°†ä¼šç”±ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œè°ƒç”¨é“¾å½¢æˆã€‚ Annotation ç”¨æ¥åŠæ—¶è®°å½•ä¸€ä¸ªäº‹ä»¶çš„å­˜åœ¨ï¼Œä¸€äº›æ ¸å¿ƒannotationsç”¨æ¥å®šä¹‰ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹å’Œç»“æŸã€‚csï¼šClient Sent - å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªannotionæè¿°äº†è¿™ä¸ªspançš„å¼€å§‹ srï¼šServer Received - æœåŠ¡ç«¯è·å¾—è¯·æ±‚å¹¶å‡†å¤‡å¼€å§‹å¤„ç†å®ƒï¼Œå¦‚æœå°†å…¶srå‡å»csæ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°ç½‘ç»œå»¶è¿Ÿssï¼šServer Sent - æ³¨è§£è¡¨æ˜è¯·æ±‚å¤„ç†çš„å®Œæˆ(å½“è¯·æ±‚è¿”å›å®¢æˆ·ç«¯)ï¼Œå¦‚æœsså‡å»sræ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°æœåŠ¡ç«¯éœ€è¦çš„å¤„ç†è¯·æ±‚æ—¶é—´ crï¼šClient Received - è¡¨æ˜spançš„ç»“æŸï¼Œå®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶åˆ°æœåŠ¡ç«¯çš„å›å¤ï¼Œå¦‚æœcrå‡å»csæ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è·å–å›å¤çš„æ‰€æœ‰æ‰€éœ€æ—¶é—´å°†Spanå’ŒTraceåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨Zipkinæ³¨è§£çš„è¿‡ç¨‹å›¾å½¢åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:","categories":[{"name":"Spring Cloud Sleuth","slug":"Spring-Cloud-Sleuth","permalink":"http://xujin.org/categories/Spring-Cloud-Sleuth/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"},{"name":"Spring Cloud Sleuth","slug":"Spring-Cloud-Sleuth","permalink":"http://xujin.org/tags/Spring-Cloud-Sleuth/"},{"name":"å…¨é“¾è·¯ç›‘æ§","slug":"å…¨é“¾è·¯ç›‘æ§","permalink":"http://xujin.org/tags/å…¨é“¾è·¯ç›‘æ§/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"http://xujin.org/tags/å¾®æœåŠ¡/"}]},{"title":"ä»€ä¹ˆæ˜¯Spring Cloud Configï¼Ÿ","slug":"sc/sc-config","date":"2016-10-19T06:00:00.000Z","updated":"2019-01-12T03:44:13.973Z","comments":true,"path":"sc/sc-config/","link":"","permalink":"http://xujin.org/sc/sc-config/","excerpt":"å‰è¨€:åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬çš„åšæ³•æ˜¯æŠŠPropertyå’ŒCodeæ”¾åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºå­˜åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œéœ€è¦åˆ†åˆ«ç®¡ç†åˆ°æ¯ä¸ªå…·ä½“çš„æœåŠ¡å·¥ç¨‹ä¸­çš„é…ç½®ï¼Œä¸Šçº¿éœ€è¦å‡†å¤‡check list å¹¶é€ä¸ªæ£€æŸ¥æ¯ä¸ªä¸Šçº¿çš„æœåŠ¡æ˜¯å¦æ­£ç¡®ã€‚åœ¨ç³»ç»Ÿä¸Šçº¿ä¹‹åä¿®æ”¹æŸä¸ªé…ç½®ï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚è¿™æ ·å¼€å‘å°±ç›¸å½“éº»çƒ¦ã€‚å› æ­¤æˆ‘ä»¬æ€¥éœ€éœ€è¦æŠŠåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é…ç½®ä¿¡æ¯æŠ½å–å‡ºæ¥ç»Ÿä¸€ç®¡ç†ï¼ŒæœåŠ¡è·å–ç³»ç»Ÿä¿¡æ¯æ—¶æœ‰ä¸€ä¸ªè¦†ç›–é¡ºåº:propertyâ€“&gt; Evnâ€”-&gt;é…ç½®ä¸­å¿ƒã€‚è¿™æ ·ä¿®æ”¹ç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹é…ç½®ä¸­å¿ƒçš„é…ç½®å°±èƒ½å–åˆ°æœ€æ–°çš„é…ç½®ä¿¡æ¯ã€‚åœ¨å”¯å“ä¼š Venus Frameworkä¸­æˆ‘ä»¬ä¸“é—¨è®¾è®¡äº†è¿™ä¸ªåŠŸèƒ½ã€‚Spring cloudå‡ºç°ä¹‹åï¼Œé¿å…äº†å¤§å®¶é‡å¤é€ è½®å­ã€‚ ä»€ä¹ˆæ˜¯ Spring Cloud Config ?å…¶å®˜æ–¹æ–‡æ¡£ä¸­å¯¹è‡ªå·±çš„å®šä¹‰æ˜¯å¦‚ä¸‹ï¼Œå®˜ç½‘è¿æ¥:Spring Cloud Configã€‚ Spring Cloud Config provides server and client-side support for externalized configuration in a distributed system.With the Config Server you have a central place to manage external properties for applications across all environments. ç®€å•æ¥è¯´ï¼ŒSpring Cloud Configå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šçš„é…ç½®ä¸­å¿ƒ - æŠŠåº”ç”¨åŸæœ¬æ”¾åœ¨æœ¬åœ°æ–‡ä»¶çš„é…ç½®æŠ½å–å‡ºæ¥æ”¾åœ¨ä¸­å¿ƒæœåŠ¡å™¨ï¼Œä»è€Œèƒ½å¤Ÿæä¾›æ›´å¥½çš„ç®¡ç†ã€å‘å¸ƒèƒ½åŠ›ã€‚","text":"å‰è¨€:åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬çš„åšæ³•æ˜¯æŠŠPropertyå’ŒCodeæ”¾åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºå­˜åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œéœ€è¦åˆ†åˆ«ç®¡ç†åˆ°æ¯ä¸ªå…·ä½“çš„æœåŠ¡å·¥ç¨‹ä¸­çš„é…ç½®ï¼Œä¸Šçº¿éœ€è¦å‡†å¤‡check list å¹¶é€ä¸ªæ£€æŸ¥æ¯ä¸ªä¸Šçº¿çš„æœåŠ¡æ˜¯å¦æ­£ç¡®ã€‚åœ¨ç³»ç»Ÿä¸Šçº¿ä¹‹åä¿®æ”¹æŸä¸ªé…ç½®ï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚è¿™æ ·å¼€å‘å°±ç›¸å½“éº»çƒ¦ã€‚å› æ­¤æˆ‘ä»¬æ€¥éœ€éœ€è¦æŠŠåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é…ç½®ä¿¡æ¯æŠ½å–å‡ºæ¥ç»Ÿä¸€ç®¡ç†ï¼ŒæœåŠ¡è·å–ç³»ç»Ÿä¿¡æ¯æ—¶æœ‰ä¸€ä¸ªè¦†ç›–é¡ºåº:propertyâ€“&gt; Evnâ€”-&gt;é…ç½®ä¸­å¿ƒã€‚è¿™æ ·ä¿®æ”¹ç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹é…ç½®ä¸­å¿ƒçš„é…ç½®å°±èƒ½å–åˆ°æœ€æ–°çš„é…ç½®ä¿¡æ¯ã€‚åœ¨å”¯å“ä¼š Venus Frameworkä¸­æˆ‘ä»¬ä¸“é—¨è®¾è®¡äº†è¿™ä¸ªåŠŸèƒ½ã€‚Spring cloudå‡ºç°ä¹‹åï¼Œé¿å…äº†å¤§å®¶é‡å¤é€ è½®å­ã€‚ ä»€ä¹ˆæ˜¯ Spring Cloud Config ?å…¶å®˜æ–¹æ–‡æ¡£ä¸­å¯¹è‡ªå·±çš„å®šä¹‰æ˜¯å¦‚ä¸‹ï¼Œå®˜ç½‘è¿æ¥:Spring Cloud Configã€‚ Spring Cloud Config provides server and client-side support for externalized configuration in a distributed system.With the Config Server you have a central place to manage external properties for applications across all environments. ç®€å•æ¥è¯´ï¼ŒSpring Cloud Configå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šçš„é…ç½®ä¸­å¿ƒ - æŠŠåº”ç”¨åŸæœ¬æ”¾åœ¨æœ¬åœ°æ–‡ä»¶çš„é…ç½®æŠ½å–å‡ºæ¥æ”¾åœ¨ä¸­å¿ƒæœåŠ¡å™¨ï¼Œä»è€Œèƒ½å¤Ÿæä¾›æ›´å¥½çš„ç®¡ç†ã€å‘å¸ƒèƒ½åŠ›ã€‚ å¦å¤–ï¼ŒSpring Cloud Configæä¾›åŸºäºä»¥ä¸‹3ä¸ªç»´åº¦çš„é…ç½®ç®¡ç†ï¼š åº”ç”¨ è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œæ¯ä¸ªé…ç½®éƒ½æ˜¯å±äºæŸä¸€ä¸ªåº”ç”¨çš„ ç¯å¢ƒ æ¯ä¸ªé…ç½®éƒ½æ˜¯åŒºåˆ†ç¯å¢ƒçš„ï¼Œå¦‚dev, test, prodç­‰ ç‰ˆæœ¬ è¿™ä¸ªå¯èƒ½æ˜¯ä¸€èˆ¬çš„é…ç½®ä¸­å¿ƒæ‰€ç¼ºä¹çš„ï¼Œå°±æ˜¯å¯¹åŒä¸€ä»½é…ç½®çš„ä¸åŒç‰ˆæœ¬ç®¡ç†ï¼Œæ¯”å¦‚:å¯ä»¥é€šè¿‡Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚ Spring Cloud Configæä¾›ç‰ˆæœ¬çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªåº”ç”¨çš„ä¸åŒéƒ¨ç½²å®ä¾‹ï¼Œå¯ä»¥ä»æœåŠ¡ç«¯è·å–åˆ°ä¸åŒç‰ˆæœ¬çš„é…ç½®ï¼Œè¿™å¯¹äºä¸€äº›ç‰¹æ®Šåœºæ™¯å¦‚ï¼šç°åº¦å‘å¸ƒï¼ŒA/Bæµ‹è¯•ç­‰æä¾›äº†å¾ˆå¥½çš„æ”¯æŒã€‚ ä¸ºä»€ä¹ˆä¼šè¯ç”ŸSpring Cloud Config? é…ç½®ä¸­å¿ƒç›®å‰ç°çŠ¶:ä¸ç®¡æ˜¯å¼€æºçš„(ç™¾åº¦çš„disconf)ï¼Œè¿˜æ˜¯ä¸€äº›å…¬å¸è‡ªå·±é—­æºæŠ•å…¥ä½¿ç”¨çš„äº§å“å·²ç»ä¸å°‘äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ä¼šè¯ç”ŸSpring Cloud Configå‘¢ï¼Ÿ åœ¨æˆ‘çœ‹æ¥ï¼ŒSpring Cloud Configåœ¨ä»¥ä¸‹å‡ æ–¹é¢è¿˜æ˜¯æœ‰æ¯”è¾ƒç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå¦‚ä¸‹ï¼š åŸºäºåº”ç”¨ã€ç¯å¢ƒã€ç‰ˆæœ¬ä¸‰ä¸ªç»´åº¦ç®¡ç† è¿™ä¸ªåœ¨å‰é¢æè¿‡äº†ï¼Œä¸»è¦æ˜¯æœ‰ç‰ˆæœ¬çš„æ”¯æŒ é…ç½®å­˜å‚¨æ”¯æŒGit è¿™ä¸ªå°±æ¯”è¾ƒæœ‰ç‰¹è‰²äº†ï¼Œåç«¯åŸºäºGitå­˜å‚¨ï¼Œä¸€æ–¹é¢ç¨‹åºå‘˜éå¸¸ç†Ÿæ‚‰ï¼Œå¦ä¸€æ–¹é¢åœ¨éƒ¨ç½²ä¸Šä¼šéå¸¸ç®€å•ï¼Œè€Œä¸”å€ŸåŠ©äºGitï¼Œå¤©ç”Ÿå°±èƒ½éå¸¸å¥½çš„æ”¯æŒç‰ˆæœ¬ å½“ç„¶ï¼Œå®ƒè¿˜æ”¯æŒå…¶å®ƒçš„å­˜å‚¨å¦‚æœ¬åœ°æ–‡ä»¶ã€SVNç­‰ å’ŒSpringæ— ç¼é›†æˆ å®ƒæ— ç¼æ”¯æŒSpringé‡Œé¢Environmentå’ŒPropertySourceçš„æ¥å£ æ‰€ä»¥å¯¹äºå·²æœ‰çš„Springåº”ç”¨ç¨‹åºçš„è¿ç§»æˆæœ¬éå¸¸ä½ï¼Œåœ¨é…ç½®è·å–çš„æ¥å£ä¸Šæ˜¯å®Œå…¨ä¸€è‡´çš„ Spring Cloud Config å…¥é—¨ä¾‹å­ä¸Šè¿°èŠ‚ç‚¹ä¸»è¦ä»‹ç»äº†Spring cloudçš„ç›¸å…³ç†è®ºï¼Œå¤§å®¶å¯¹Spring Cloud Configæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œæ¥ä¸‹æ¥ä¾‹å­è®©å¤§å®¶æ„Ÿå—ä¸€ä¸‹Spring cloud configçš„é­…åŠ›ã€‚ Overview ä¸Šå›¾ç®€è¦æè¿°äº†ä¸€ä¸ªæ™®é€šSpring Cloud Configåº”ç”¨çš„åœºæ™¯ã€‚å…¶ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç»„ä»¶ï¼š Config Client Clientå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ä½¿ç”¨äº†Spring Cloud Configçš„åº”ç”¨ Spring Cloud Configæä¾›äº†åŸºäºSpringçš„å®¢æˆ·ç«¯ï¼Œåº”ç”¨åªè¦åœ¨ä»£ç ä¸­å¼•å…¥Spring Cloud Config Clientçš„jaråŒ…å³å¯å·¥ä½œ Config Server Config Serveræ˜¯éœ€è¦ç‹¬ç«‹éƒ¨ç½²çš„ä¸€ä¸ªwebåº”ç”¨ï¼Œå®ƒè´Ÿè´£æŠŠgitä¸Šçš„é…ç½®è¿”å›ç»™å®¢æˆ·ç«¯ Remote Git Repository è¿œç¨‹Gitä»“åº“ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä¼šæŠŠé…ç½®æ”¾åœ¨ä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼Œé€šè¿‡ç°æˆçš„gitå®¢æˆ·ç«¯æ¥ç®¡ç†é…ç½® Local Git Repostiory Config Serverçš„æœ¬åœ°Gitä»“åº“ Config Serveræ¥åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„é…ç½®è·å–è¯·æ±‚åï¼Œä¼šå…ˆæŠŠè¿œç¨‹ä»“åº“çš„é…ç½®cloneåˆ°æœ¬åœ°çš„ä¸´æ—¶ç›®å½•ï¼Œç„¶åä»ä¸´æ—¶ç›®å½•è¯»å–é…ç½®å¹¶è¿”å›","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud Config","slug":"Spring-Cloud-Config","permalink":"http://xujin.org/tags/Spring-Cloud-Config/"}]},{"title":"Spring Cloudå¾®æœåŠ¡æ¡†æ¶ä¸»è¦å­é¡¹ç›®å’ŒRPCæ¡†æ¶çš„å¯¹æ¯”","slug":"sc/sc-introduce","date":"2016-10-18T02:00:00.000Z","updated":"2019-01-13T03:27:26.811Z","comments":true,"path":"sc/sc-introduce/","link":"","permalink":"http://xujin.org/sc/sc-introduce/","excerpt":"æ‘˜è¦:Spring Cloudæ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ–°çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä»Šå¹´(2016)æ¨å‡º1.0çš„releaseç‰ˆæœ¬ï¼Œç›®å‰Githubä¸Šæ›´æ–°é€Ÿåº¦å¾ˆå¿«. è™½ç„¶Spring Cloudæ—¶é—´æœ€çŸ­, ä½†æ˜¯ç›¸æ¯”Dubboç­‰RPCæ¡†æ¶, Spring Cloudæä¾›çš„å…¨å¥—çš„åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆã€‚spring cloud ä¸ºå¼€å‘è€…æä¾›äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ï¼ŒæœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œè·¯ç”±ï¼Œå¾®ä»£ç†ï¼Œæ§åˆ¶æ€»çº¿ï¼Œä¸€æ¬¡æ€§tokenï¼Œå…¨å±€çï¼Œleaderé€‰ä¸¾ï¼Œåˆ†å¸ƒå¼sessionï¼Œé›†ç¾¤çŠ¶æ€ï¼‰ä¸­å¿«é€Ÿæ„å»ºçš„å·¥å…·ï¼Œä½¿ç”¨Spring Cloudçš„å¼€å‘è€…å¯ä»¥å¿«é€Ÿçš„å¯åŠ¨æœåŠ¡æˆ–æ„å»ºåº”ç”¨ï¼å®ƒä»¬å°†åœ¨ä»»ä½•åˆ†å¸ƒå¼ç¯å¢ƒä¸­å·¥ä½œï¼ŒåŒ…æ‹¬å¼€å‘äººå‘˜è‡ªå·±çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œè£¸ç‰©ç†æœºçš„æ•°æ®ä¸­å¿ƒï¼Œå’ŒåƒCloud Foundryäº‘ç®¡ç†å¹³å°ã€‚åœ¨æœªæ¥å¼•é¢†è¿™å¾®æœåŠ¡æ¶æ„çš„å‘å±•ï¼Œæä¾›ä¸šç•Œæ ‡å‡†çš„ä¸€å¥—å¾®æœåŠ¡æ¶æ„è§£å†³æ–¹æ¡ˆã€‚","text":"æ‘˜è¦:Spring Cloudæ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ–°çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä»Šå¹´(2016)æ¨å‡º1.0çš„releaseç‰ˆæœ¬ï¼Œç›®å‰Githubä¸Šæ›´æ–°é€Ÿåº¦å¾ˆå¿«. è™½ç„¶Spring Cloudæ—¶é—´æœ€çŸ­, ä½†æ˜¯ç›¸æ¯”Dubboç­‰RPCæ¡†æ¶, Spring Cloudæä¾›çš„å…¨å¥—çš„åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆã€‚spring cloud ä¸ºå¼€å‘è€…æä¾›äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ï¼ŒæœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œè·¯ç”±ï¼Œå¾®ä»£ç†ï¼Œæ§åˆ¶æ€»çº¿ï¼Œä¸€æ¬¡æ€§tokenï¼Œå…¨å±€çï¼Œleaderé€‰ä¸¾ï¼Œåˆ†å¸ƒå¼sessionï¼Œé›†ç¾¤çŠ¶æ€ï¼‰ä¸­å¿«é€Ÿæ„å»ºçš„å·¥å…·ï¼Œä½¿ç”¨Spring Cloudçš„å¼€å‘è€…å¯ä»¥å¿«é€Ÿçš„å¯åŠ¨æœåŠ¡æˆ–æ„å»ºåº”ç”¨ï¼å®ƒä»¬å°†åœ¨ä»»ä½•åˆ†å¸ƒå¼ç¯å¢ƒä¸­å·¥ä½œï¼ŒåŒ…æ‹¬å¼€å‘äººå‘˜è‡ªå·±çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œè£¸ç‰©ç†æœºçš„æ•°æ®ä¸­å¿ƒï¼Œå’ŒåƒCloud Foundryäº‘ç®¡ç†å¹³å°ã€‚åœ¨æœªæ¥å¼•é¢†è¿™å¾®æœåŠ¡æ¶æ„çš„å‘å±•ï¼Œæä¾›ä¸šç•Œæ ‡å‡†çš„ä¸€å¥—å¾®æœåŠ¡æ¶æ„è§£å†³æ–¹æ¡ˆã€‚ ä»€ä¹ˆæ˜¯Spring Cloudï¼Ÿ Spring Cloudæ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ–°çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä»Šå¹´(2016)æ‰æ¨å‡º1.0çš„releaseç‰ˆæœ¬. è™½ç„¶Spring Cloudæ—¶é—´æœ€çŸ­, ä½†æ˜¯ç›¸æ¯”Dubboç­‰RPCæ¡†æ¶, Spring Cloudæä¾›çš„å…¨å¥—çš„åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆã€‚spring cloud ä¸ºå¼€å‘è€…æä¾›äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ï¼ŒæœåŠ¡å‘ç°ï¼Œç†”æ–­ï¼Œè·¯ç”±ï¼Œå¾®ä»£ç†ï¼Œæ§åˆ¶æ€»çº¿ï¼Œä¸€æ¬¡æ€§tokenï¼Œå…¨å±…çï¼Œleaderé€‰ä¸¾ï¼Œåˆ†å¸ƒå¼sessionï¼Œé›†ç¾¤çŠ¶æ€ï¼‰ä¸­å¿«é€Ÿæ„å»ºçš„å·¥å…·ï¼Œä½¿ç”¨Spring Cloudçš„å¼€å‘è€…å¯ä»¥å¿«é€Ÿçš„å¯åŠ¨æœåŠ¡æˆ–æ„å»ºåº”ç”¨ï¼å®ƒä»¬å°†åœ¨ä»»ä½•åˆ†å¸ƒå¼ç¯å¢ƒä¸­å·¥ä½œï¼ŒåŒ…æ‹¬å¼€å‘äººå‘˜è‡ªå·±çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œè£¸ç‰©ç†æœºçš„æ•°æ®ä¸­å¿ƒï¼Œå’ŒåƒCloud Foundryäº‘ç®¡ç†å¹³å°ã€‚ä¸‹é¢æ˜¯å®˜æ–¹å¯¹Spring Cloudå®šä¹‰å’Œè§£é‡Šã€‚ Spring Cloud provides tools for developers to quickly build some of the common patterns in distributed systems (e.g. configuration management, service discovery, circuit breakers, intelligent routing, micro-proxy, control bus, one-time tokens, global locks, leadership election, distributed sessions, cluster state). Coordination of distributed systems leads to boiler plate patterns, and using Spring Cloud developers can quickly stand up services and applications that implement those patterns. They will work well in any distributed environment, including the developerâ€™s own laptop, bare metal data centres, and managed platforms such as Cloud Foundry. Spring Cloudä¸»è¦é¡¹ç›® Spring Cloud ä¾§é‡äºæä¾›è‰¯å¥½çš„å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä»¥ä¾¿æ”¯æŒå…¸å‹çš„å¼€å‘åœºæ™¯å’Œæ‰©å±•æ”¯æŒã€‚ä¸‹é¢ä¸»è¦Spring Cloudé¡¹ç›®åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­çš„ä¸»è¦å­é¡¹ç›®ï¼Œå…·ä½“çš„å­é¡¹ç›®æºç åˆ†æï¼Œä»¥åŠå®ç°ç»†èŠ‚ï¼Œå°†ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä»‹ç»ã€‚ Spring Cloud Configâ€”é…ç½®ä¸­å¿ƒ Spring Cloud Configå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šçš„é…ç½®ä¸­å¿ƒ - æŠŠåº”ç”¨åŸæœ¬æ”¾åœ¨æœ¬åœ°æ–‡ä»¶çš„é…ç½®æŠ½å–å‡ºæ¥æ”¾åœ¨ä¸­å¿ƒæœåŠ¡å™¨ï¼Œä»è€Œèƒ½å¤Ÿæä¾›æ›´å¥½çš„ç®¡ç†ã€å‘å¸ƒã€‚ åœ¨RPCæœåŠ¡æ²»ç†æ¡†æ¶ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šå¼€å‘ä¸€ä¸ªé…ç½®ä¸­å¿ƒå’ŒZKé…åˆä½¿ç”¨ï¼Œç”¨äºç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ä¸­çš„é…ç½®ä¿¡æ¯ã€‚æ¯”å¦‚ç†”æ–­çš„é˜€å€¼ï¼Œè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ç­‰ã€‚ Spring Cloud Netflixâ€“æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡å‘ç°ï¼ŒLB Spring Cloud Netflixé€šè¿‡Eureka Serverå®ç°æœåŠ¡æ³¨å†Œä¸­å¿ƒ(åŒ…æ‹¬æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°)ï¼Œé€šè¿‡Ribbonå®ç°è½¯è´Ÿè½½å‡è¡¡(load balance,ç®€ç§°LB) åœ¨RPCæ¡†æ¶ä¸­ï¼Œä¾‹å¦‚ï¼šdubboXï¼ŒHSFï¼ŒOSP(å”¯å“ä¼šçš„RPCæ¡†æ¶)ç­‰RPCæ¡†æ¶ï¼Œéƒ½ä¼šé€šè¿‡ZKç­‰å®ç°æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°ã€‚å½“æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå°†æœåŠ¡çš„IPåœ°å€ï¼Œç«¯å£ï¼ŒæœåŠ¡å‘½åï¼Œç‰ˆæœ¬å·ç­‰ä¿¡æ¯æ³¨å†Œåˆ°ZKä¸­ï¼ŒåŒæ—¶ZK Nodeä¼šç›‘å¬å˜åŒ–ï¼Œæ¥æ”¶æœ€æ–°çš„æœåŠ¡æ³¨å†Œä¿¡æ¯åˆ°clientç«¯æˆ–Proxyç«¯ã€‚è‡³äºLBï¼Œéƒ½ä¼šæœ‰è‡ªå·±çš„å®ç°ç®—æ³•ï¼Œç†”æ–­ç­‰éƒ½æœ‰è‡ªå·±çš„å®ç°æ–¹å¼ã€‚ Hystrix ç†”æ–­ï¼ŒåŒ…å«åœ¨æœåŠ¡æ²»ç†ä¸­ã€‚ Spring Cloud Sleuth Spring Cloud Sleuthä¸ºSpring Cloudæä¾›äº†åˆ†å¸ƒå¼è¿½è¸ªæ–¹æ¡ˆã€‚å…¨é“¾è·¯ç›‘æ§ç³»ç»Ÿã€‚ APMï¼ˆApplication Performance Monitorï¼‰è¿™ä¸ªé¢†åŸŸæœ€è¿‘å¼‚å¸¸ç«çƒ­ã€‚å›½å¤–è¯¥é¢†åŸŸçŸ¥åå…¬å¸åŒ…æ‹¬New Relicï¼ŒAppdynamicsï¼ŒSplunkã€‚å…¶ä¸­New Relicå·²ç»æˆåŠŸIPOï¼Œä¼°å€¼è¶…è¿‡20äº¿ç¾å…ƒã€‚ ï¼‘ï¼å›½å†…å¤–çš„ä¸ªå¤§äº’è”ç½‘å…¬å¸ä¹Ÿéƒ½æœ‰ç±»ä¼¼å¤§åé¼é¼çš„APMäº§å“ï¼Œä¾‹å¦‚æ·˜å®é¹°çœ¼Eagle Eyesï¼Œç‚¹è¯„çš„CATï¼Œå¾®åšçš„Watchmanï¼Œtwitterçš„Zipkinã€‚ä»–ä»¬çš„äº§å“è™½æœªåƒä¸“ä¸šAPMå…¬å¸çš„äº§å“è¿™æ ·åŠŸèƒ½å¼ºå¤§ï¼Œä½†ç»“åˆå„è‡ªå…¬å¸çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œè¿™äº›äº§å“åœ¨æ”¯æ’‘ä¸šåŠ¡ç³»ç»Ÿçš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢ï¼Œå‘æŒ¥äº†æ˜¾è‘—çš„ä½œç”¨ã€‚ ï¼’ï¼ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å¤§å‹äº’è”ç½‘å…¬å¸çš„åå°ä¸šåŠ¡ç³»ç»Ÿç”±ä¼—å¤šåˆ†å¸ƒå¼ç»„ä»¶æ„æˆï¼Œè¿™äº›ç»„ä»¶ç”±webç±»å‹ç»„ä»¶ï¼ŒRPCæœåŠ¡åŒ–ç±»å‹ç»„ä»¶ï¼Œç¼“å­˜ç»„ä»¶ï¼Œæ¶ˆæ¯ç»„ä»¶å’Œæ•°æ®åº“ç»„ä»¶ã€‚ä¸€ä¸ªé€šè¿‡æµè§ˆå™¨æˆ–ç§»åŠ¨å®¢æˆ·ç«¯çš„å‰ç«¯è¯·æ±‚åˆ°è¾¾åå°ç³»ç»Ÿåï¼Œä¼šç»è¿‡å¾ˆå¤šä¸ªä¸šåŠ¡ç»„ä»¶å’Œç³»ç»Ÿç»„ä»¶ï¼Œå¹¶ä¸”ç•™ä¸‹è¶³è¿¹å’Œç›¸å…³æ—¥å¿—ä¿¡æ¯ã€‚ä½†è¿™äº›åˆ†æ•£åœ¨æ¯ä¸ªä¸šåŠ¡ç»„ä»¶å’Œä¸»æœºä¸‹çš„æ—¥å¿—ä¿¡æ¯ä¸åˆ©äºé—®é¢˜æ’æŸ¥å’Œå®šä½é—®é¢˜çš„Root Causeã€‚è¿™ç§ç›‘æ§åœºæ™¯æ­£æ˜¯åº”ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿçš„ç”¨æ­¦ä¹‹åœ°ï¼Œåº”ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿæ”¶é›†ï¼Œæ±‡æ€»å¹¶åˆ†ææ—¥å¿—ä¿¡æ¯è¾¾åˆ°æœ‰æ•ˆç›‘æ§ç³»ç»Ÿæ€§èƒ½å’Œé—®é¢˜çš„æ•ˆæœï¼ ï¼“ï¼åœ¨å”¯å“ä¼šä½“ç³»ä¸­ï¼ŒMercuryæä¾›çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š å®šä½æ…¢è°ƒç”¨ï¼šåŒ…æ‹¬æ…¢WebæœåŠ¡ï¼ˆåŒ…æ‹¬Restful WebæœåŠ¡ï¼‰ï¼Œæ…¢OSPæœåŠ¡ï¼Œæ…¢SQL å®šä½é”™è¯¯ï¼šåŒ…æ‹¬4XXï¼Œ5XXï¼ŒOSP Error å®šä½å¼‚å¸¸ï¼šåŒ…æ‹¬Error Exceptionï¼ŒFatal Exception å±•ç°ä¾èµ–å’Œæ‹“æ‰‘ï¼šåŸŸæ‹“æ‰‘ï¼ŒæœåŠ¡æ‹“æ‰‘ï¼Œtraceæ‹“æ‰‘ Traceè°ƒç”¨é“¾ï¼šå°†ç«¯åˆ°ç«¯çš„è°ƒç”¨ï¼Œä»¥åŠé™„åŠ åœ¨è¿™æ¬¡è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¼‚å¸¸æ—¥å¿—ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªè°ƒç”¨ç‚¹çš„è€—æ—¶éƒ½å‘ˆç°ç»™ç”¨æˆ· åº”ç”¨å‘Šè­¦ï¼šæ ¹æ®è¿ç»´è®¾å®šçš„å‘Šè­¦è§„åˆ™ï¼Œæ‰«ææŒ‡æ ‡æ•°æ®ï¼Œå¦‚è¿åå‘Šè­¦è§„åˆ™ï¼Œåˆ™å°†å‘Šè­¦ä¿¡æ¯ä¸ŠæŠ¥åˆ°å”¯å“ä¼šä¸­å¤®å‘Šè­¦å¹³å° dubboä¸Spring Cloudçš„æ¯”è¾ƒ 1.dubboå‡ºè‡ªäºé˜¿é‡Œï¼ŒSpring cloudå‡ºè‡ªäºSpringç¤¾åŒº,åŸºäºSpring bootæä¾›ä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚dubboæˆ–è€…dubboxæ˜¯RPCæ¡† æ¶ï¼ŒåŠŸèƒ½æ˜¯Spring CloudåŠŸèƒ½çš„ä¸€ä¸ªå­é›†ã€‚ 2.dubboæ˜¯RPCæœåŠ¡æ²»ç†æ¡†æ¶ï¼Œå’ŒSpring Cloudä¸€æ ·å…·å¤‡æœåŠ¡æ³¨å†Œã€å‘ç°ã€è·¯ç”±ã€è´Ÿè½½å‡è¡¡ç­‰èƒ½åŠ›ã€‚ä½†æ˜¯æ²¡æœ‰é…ç½®ä¸­å¿ƒï¼Œå®Œæ•´çš„å¥½ç”¨å…¨é“¾è·¯ç›‘ æ§ï¼Œéœ€è¦é‡‡ç”¨å¼€æºçš„è§£å†³æ–¹æ¡ˆå®šåˆ¶æˆ–è€…è‡ªç ”ã€‚Spring cloudçš„é…ç½®ä¸­å¿ƒï¼Œå…¨é“¾è·¯ç›‘æ§ç­‰ç»„ä»¶ã€‚ä»ç›®å‰æ¥çœ‹ï¼ŒSpring Cloudå›½å†…ä¸­å°å‹ä¼ä¸šç”¨çš„æ¯”è¾ƒå¤šï¼Œå¤§å‹ä¼ä¸šå¯èƒ½éœ€è¦å¯¹å…¶éœ€è¦çš„ç»„ä»¶è¿›è¡Œå®šåˆ¶åŒ–å¤„ç†ã€‚ 3.Spring cloudåŸºäºæ³¨è§£çš„æœåŠ¡å‘ç°ï¼ŒæœåŠ¡æ²»ç†ç­‰åŠŸèƒ½å…·æœ‰ä»£ç ä¾µå…¥æ€§ï¼Œdubboæ²¡æœ‰ä»£ç ä¾µå…¥æ€§ï¼Œä¸šåŠ¡å¼€å‘äººå‘˜ä¸éœ€è¦é€šè¿‡æ³¨è§£çš„æ–¹å¼å»å…³æ³¨æ¡†æ¶çº§åˆ«çš„å¤„ç†ã€‚ä»ä¸­é—´ä»¶æˆ–è€…åšåŸºç¡€æ¶æ„çš„è§’åº¦æ¥çœ‹ï¼Œå…¶å®æœåŠ¡æ²»ç†ç­‰åŠŸèƒ½å¯¹æ™®é€šçš„ä¸šåŠ¡ç¨‹åºå‘˜åº”è¯¥æ˜¯é€æ˜çš„ï¼Œä¸šåŠ¡ç¨‹åºå‘˜ä¸éœ€è¦å…³æ³¨æœåŠ¡æ²»ç†æ¡†æ¶çš„ä½¿ç”¨ï¼Œä¸“æ³¨äºä¸šåŠ¡ä»£ç å³å¯ã€‚ å› æ­¤å¤§å‹ä¼ä¸šå¯èƒ½éœ€è¦å¯¹Spring cloudè¿›è¡Œå®šåˆ¶åŒ–å¤„ç†ã€‚æ›´å¤šæ¯”è¾ƒä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„è¿æ¥ã€‚","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"}]},{"title":"Jdkçš„ä¸‡èƒ½é…ç½®","slug":"java/jdk-install","date":"2016-10-15T13:00:00.000Z","updated":"2019-01-13T05:24:31.229Z","comments":true,"path":"java/jdk-install/","link":"","permalink":"http://xujin.org/java/jdk-install/","excerpt":"javaæ˜¯é€šè¿‡javaè™šæ‹Ÿæœºæ¥è§£é‡Šè¿è¡Œçš„,ä¹Ÿå°±æ˜¯é€šè¿‡javaå‘½ä»¤; javacç¼–è¯‘ç”Ÿæˆçš„.classæ–‡ä»¶å°±æ˜¯è™šæ‹Ÿæœºè¦æ‰§è¡Œçš„ä»£ç , ç§°ä¹‹ä¸ºå­—èŠ‚ç (bytecode),è™šæ‹Ÿæœºé€šè¿‡classloaderæ¥è£…è½½è¿™äº›å­—èŠ‚ç ,ä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„ç±».è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜,classloaderä»å“ªé‡ŒçŸ¥é“javaæœ¬èº«çš„ç±»åº“åŠç”¨æˆ·è‡ªå·±çš„ç±»åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢?æˆ–è€…æœ‰ç€ç¼ºçœå€¼(å½“å‰è·¯å¾„).æˆ–è€…è¦æœ‰ä¸€ä¸ªç”¨æˆ·æŒ‡å®šçš„å˜é‡æ¥è¡¨æ˜, è¿™ä¸ªå˜é‡å°±æ˜¯ç±»è·¯å¾„(classpath),æˆ–è€…åœ¨è¿è¡Œçš„æ—¶å€™ä¼ å‚æ•°ç»™è™šæ‹Ÿæœº.é€šè¿‡è¿™æ®µæ–‡å­—ï¼Œä½ å°±çŸ¥é“ï¼Œä¸ºä»€ä¹ˆjavacç¼–è¯‘é€šè¿‡äº†ï¼Œä½†æ˜¯javaå‘½ä»¤å´å‡ºé”™(ç±»å®šä¹‰æ²¡æ‰¾åˆ°)çš„åŸå› äº†ã€‚å°±æ˜¯ç¯å¢ƒå˜é‡classpath(ç±»è·¯å¾„)æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼Œä½¿å¾—JAVAè™šæ‹Ÿæœºçš„classloaderæ— æ³•æ‰¾åˆ°ç±»æ¥æ‰§è¡Œç›®æ ‡ç¨‹åº","text":"javaæ˜¯é€šè¿‡javaè™šæ‹Ÿæœºæ¥è§£é‡Šè¿è¡Œçš„,ä¹Ÿå°±æ˜¯é€šè¿‡javaå‘½ä»¤; javacç¼–è¯‘ç”Ÿæˆçš„.classæ–‡ä»¶å°±æ˜¯è™šæ‹Ÿæœºè¦æ‰§è¡Œçš„ä»£ç , ç§°ä¹‹ä¸ºå­—èŠ‚ç (bytecode),è™šæ‹Ÿæœºé€šè¿‡classloaderæ¥è£…è½½è¿™äº›å­—èŠ‚ç ,ä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„ç±».è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜,classloaderä»å“ªé‡ŒçŸ¥é“javaæœ¬èº«çš„ç±»åº“åŠç”¨æˆ·è‡ªå·±çš„ç±»åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢?æˆ–è€…æœ‰ç€ç¼ºçœå€¼(å½“å‰è·¯å¾„).æˆ–è€…è¦æœ‰ä¸€ä¸ªç”¨æˆ·æŒ‡å®šçš„å˜é‡æ¥è¡¨æ˜, è¿™ä¸ªå˜é‡å°±æ˜¯ç±»è·¯å¾„(classpath),æˆ–è€…åœ¨è¿è¡Œçš„æ—¶å€™ä¼ å‚æ•°ç»™è™šæ‹Ÿæœº.é€šè¿‡è¿™æ®µæ–‡å­—ï¼Œä½ å°±çŸ¥é“ï¼Œä¸ºä»€ä¹ˆjavacç¼–è¯‘é€šè¿‡äº†ï¼Œä½†æ˜¯javaå‘½ä»¤å´å‡ºé”™(ç±»å®šä¹‰æ²¡æ‰¾åˆ°)çš„åŸå› äº†ã€‚å°±æ˜¯ç¯å¢ƒå˜é‡classpath(ç±»è·¯å¾„)æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼Œä½¿å¾—JAVAè™šæ‹Ÿæœºçš„classloaderæ— æ³•æ‰¾åˆ°ç±»æ¥æ‰§è¡Œç›®æ ‡ç¨‹åº å¿«é€Ÿé…ç½®1.æ–°å»ºç³»ç»Ÿå˜é‡JAVA_HOMEå˜é‡(JAVA_HOMEæŒ‡æ˜JDKå®‰è£…è·¯å¾„ã€‚) E:\\development\\Java\\Java8\\jdk1.8.0_73 2.åœ¨ç³»ç»Ÿå˜é‡ä¸­çš„pathä¸­æ·»åŠ (Pathä½¿å¾—ç³»ç»Ÿå¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹è¯†åˆ«javaå‘½ä»¤ã€‚) ;%JAVA_HOME%\\bin;%JAVA_HOME%\\jre\\bin; 3ã€æ–°å»ºç³»ç»Ÿå˜é‡CLASSPATH(CLASSPATHä¸ºjavaåŠ è½½ç±»(class or lib)è·¯å¾„ï¼Œåªæœ‰ç±»åœ¨classpathä¸­ï¼Œjavaå‘½ä»¤æ‰èƒ½è¯†åˆ«.) è®¾å®šå€¼ä¸ºï¼š.;%JAVA_HOME%\\lib;%JAVA_HOME%\\lib\\tools.jar æ³¨æ„ ä¸€å®šè¦åŠ â€œ.â€ï¼Œâ€œ.â€ä»£è¡¨å½“å‰ç›®å½•ï¼Œå³å¯åˆ°å¤„å»ºç«‹.javaæ–‡ä»¶ï¼Œjava classéƒ½èƒ½æ‰¾åˆ°å¹¶ç¼–è¯‘è¿è¡Œç”¨æˆ·çš„.javaæ–‡ä»¶ã€‚ 4.è¿›å…¥dosçª—å£è¿è¡Œâ€œjava â€“versionâ€ å¦‚æœæ˜¾ç¤ºä¸‹é¢å†…å®¹åˆ™æˆåŠŸã€‚","categories":[{"name":"java","slug":"java","permalink":"http://xujin.org/categories/java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"Jdk","slug":"Jdk","permalink":"http://xujin.org/tags/Jdk/"}]},{"title":"å…³äºSpringCloudä¸­å›½ç¤¾åŒºä»¥åŠå›½å†…ä½¿ç”¨æƒ…å†µ","slug":"sc/springcloud","date":"2016-10-03T06:00:00.000Z","updated":"2019-01-12T04:32:01.781Z","comments":true,"path":"sc/springcloud/","link":"","permalink":"http://xujin.org/sc/springcloud/","excerpt":"Spring Cloudä¸­å›½ç¤¾åŒºèµ·æº å…¶å®å½“Spring Cloudé¡¹ç›®åˆšåœ¨githubä¸Šå‡ºç°çš„æ—¶å€™ï¼Œæˆ‘å°±ä¸€ç›´åœ¨å…³æ³¨å…¶é¡¹ç›®å‘å±•ï¼Œåˆ°äº†2015å¹´8æœˆï¼Œç”±äºä¸ªäººå…´è¶£ç ”ç©¶Spring Cloudé¡¹ç›®ï¼Œç”±äºå›½å†…ç›¸å…³æ–‡æ¡£è¾ƒå°‘ï¼Œå½“æ—¶å°±æƒ³å»ºç«‹ä¸€ä¸ªä¸­å›½ç¤¾åŒºï¼Œäºæ˜¯å°±å…ˆæŠŠåŸŸåæ³¨å†Œäº†ï¼Œé€‰ä¸­åŸŸåä¸ºspringcloud.cnã€‚ ä¸ºä»€ä¹ˆè¦å‘èµ·Spring Cloudä¸­å›½ç¤¾åŒº Spring Cloudå‘å±•åˆ°2016å¹´ï¼Œå›½å†…å…³æ³¨çš„äººè¶Šæ¥è¶Šå¤šï¼Œä½†æ˜¯ç›¸åº”å­¦ä¹ äº¤æµçš„å¹³å°å’Œææ–™æ¯”è¾ƒåˆ†æ•£ï¼Œä¸åˆ©äºå­¦ä¹ äº¤æµï¼Œå› æ­¤Spring Cloudä¸­å›½ç¤¾åŒºåº”è¿è€Œç”Ÿã€‚ Spring Cloudä¸­å›½ç¤¾åŒºæ˜¯å›½å†…é¦–ä¸ªSpring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„çš„äº¤æµç¤¾åŒºã€‚æˆ‘ä»¬è‡´åŠ›äºä¸ºSpring Bootæˆ–Spring CloudæŠ€æœ¯äººå‘˜æä¾›åˆ†äº«å’Œäº¤æµçš„å¹³å°ï¼Œæ¨åŠ¨Spring Cloudåœ¨ä¸­å›½çš„æ™®åŠå’Œåº”ç”¨ã€‚ æ¬¢è¿CTOã€æ¶æ„å¸ˆã€å¼€å‘è€…ç­‰ï¼Œåœ¨è¿™é‡Œå­¦ä¹ ä¸äº¤æµä½¿ç”¨Spring Cloudçš„å®æˆ˜ç»éªŒã€‚ ç›®å‰QQç¾¤äººæ•°:7000+,å¾®ä¿¡ç¾¤:2000+. æ‰«æä¸‹é¢äºŒç»´ç æˆ–è€…å¾®ä¿¡æœç´¢SpringCloudï¼Œå…³æ³¨ç¤¾åŒºå…¬ä¼—å· Spring Cloudä¸­å›½ç¤¾åŒºQQç¾¤â‘ :415028731 Spring cloudä¸­å›½ç¤¾åŒºQQç¾¤â‘¡:530321604 Spring Cloudä¸­å›½ç¤¾åŒºå®˜ç½‘:http://springcloud.cn Spring Cloudä¸­å›½ç¤¾åŒºè®ºå›:http://springcloud.cn Spring Cloudä¸­å›½ç¤¾åŒºæ–‡æ¡£:http://docs.springcloud.cn spring cloudç›®å‰å›½å†…ä½¿ç”¨æƒ…å†µ ä¸­å›½è”é€šå­å…¬å¸http://flp.baidu.com/feedland/video/?entry=box_searchbox_feed&amp;id=144115189637730162&amp;from=timeline&amp;isappinstalled=0","text":"Spring Cloudä¸­å›½ç¤¾åŒºèµ·æº å…¶å®å½“Spring Cloudé¡¹ç›®åˆšåœ¨githubä¸Šå‡ºç°çš„æ—¶å€™ï¼Œæˆ‘å°±ä¸€ç›´åœ¨å…³æ³¨å…¶é¡¹ç›®å‘å±•ï¼Œåˆ°äº†2015å¹´8æœˆï¼Œç”±äºä¸ªäººå…´è¶£ç ”ç©¶Spring Cloudé¡¹ç›®ï¼Œç”±äºå›½å†…ç›¸å…³æ–‡æ¡£è¾ƒå°‘ï¼Œå½“æ—¶å°±æƒ³å»ºç«‹ä¸€ä¸ªä¸­å›½ç¤¾åŒºï¼Œäºæ˜¯å°±å…ˆæŠŠåŸŸåæ³¨å†Œäº†ï¼Œé€‰ä¸­åŸŸåä¸ºspringcloud.cnã€‚ ä¸ºä»€ä¹ˆè¦å‘èµ·Spring Cloudä¸­å›½ç¤¾åŒº Spring Cloudå‘å±•åˆ°2016å¹´ï¼Œå›½å†…å…³æ³¨çš„äººè¶Šæ¥è¶Šå¤šï¼Œä½†æ˜¯ç›¸åº”å­¦ä¹ äº¤æµçš„å¹³å°å’Œææ–™æ¯”è¾ƒåˆ†æ•£ï¼Œä¸åˆ©äºå­¦ä¹ äº¤æµï¼Œå› æ­¤Spring Cloudä¸­å›½ç¤¾åŒºåº”è¿è€Œç”Ÿã€‚ Spring Cloudä¸­å›½ç¤¾åŒºæ˜¯å›½å†…é¦–ä¸ªSpring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„çš„äº¤æµç¤¾åŒºã€‚æˆ‘ä»¬è‡´åŠ›äºä¸ºSpring Bootæˆ–Spring CloudæŠ€æœ¯äººå‘˜æä¾›åˆ†äº«å’Œäº¤æµçš„å¹³å°ï¼Œæ¨åŠ¨Spring Cloudåœ¨ä¸­å›½çš„æ™®åŠå’Œåº”ç”¨ã€‚ æ¬¢è¿CTOã€æ¶æ„å¸ˆã€å¼€å‘è€…ç­‰ï¼Œåœ¨è¿™é‡Œå­¦ä¹ ä¸äº¤æµä½¿ç”¨Spring Cloudçš„å®æˆ˜ç»éªŒã€‚ ç›®å‰QQç¾¤äººæ•°:7000+,å¾®ä¿¡ç¾¤:2000+. æ‰«æä¸‹é¢äºŒç»´ç æˆ–è€…å¾®ä¿¡æœç´¢SpringCloudï¼Œå…³æ³¨ç¤¾åŒºå…¬ä¼—å· Spring Cloudä¸­å›½ç¤¾åŒºQQç¾¤â‘ :415028731 Spring cloudä¸­å›½ç¤¾åŒºQQç¾¤â‘¡:530321604 Spring Cloudä¸­å›½ç¤¾åŒºå®˜ç½‘:http://springcloud.cn Spring Cloudä¸­å›½ç¤¾åŒºè®ºå›:http://springcloud.cn Spring Cloudä¸­å›½ç¤¾åŒºæ–‡æ¡£:http://docs.springcloud.cn spring cloudç›®å‰å›½å†…ä½¿ç”¨æƒ…å†µ ä¸­å›½è”é€šå­å…¬å¸http://flp.baidu.com/feedland/video/?entry=box_searchbox_feed&amp;id=144115189637730162&amp;from=timeline&amp;isappinstalled=0 ä¸Šæµ·ç±³ä¹ˆé‡‘æœ æŒ‡ç‚¹æ— é™ï¼ˆåŒ—äº¬ï¼‰ç§‘æŠ€æœ‰é™å…¬å¸ æ˜“ä¿è½¯ä»¶ ç›®å‰åœ¨å®šåˆ¶å¼€å‘ä¸­ http://www.ebaotech.com/cn/ å¹¿å·ç®€æ³•ç½‘ç»œ æ·±åœ³ç¿äº‘æ™ºåˆç§‘æŠ€æœ‰é™å…¬å¸ æŒç»­äº¤ä»˜äº§å“åŸºäºSpring Cloudç ”å‘ http://www.wise2c.com çŒªå…«æˆ’ç½‘ ä¸Šæµ·äº‘é¦–ç§‘æŠ€æœ‰é™å…¬å¸ åä¸º æ•´åˆnettyè¿›æ¥ç”¨rpc åŒ…æ‹¬nerflixé‚£å¥—ä¸œè¥¿ éœ€è¦æ³¨æ„çš„æ˜¯sleuth traceidçš„ä¼ é€’éœ€è¦è‡ªå·±å†™ã€‚tpsåœ¨ç‰©ç†æœºä¸Šèƒ½çªç ´20w ä¸œè½¯ å—äº¬äº‘å¸æˆ¿ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ å››ä¼—äº’è”(åŒ—äº¬)ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ æ·±åœ³æ‘©ä»¤æŠ€æœ¯ç§‘æŠ€æœ‰é™å…¬å¸ å¹¿å·ä¸‡è¡¨ç½‘ è§†è§‰ä¸­å›½ ä¸Šæµ·ç§¦è‹ä¿¡æ¯ç§‘æŠ€æœ‰é™å…¬å¸-ä¹°å•ä¾  çˆ±æ²¹ç§‘æŠ€(å¤§è¿)æœ‰é™å…¬å¸çˆ±æ²¹ç§‘æŠ€åŸºäºSpringCloudçš„å¾®æœåŠ¡å®è·µ å¹¿å‘é“¶è¡Œ å–è´§éƒ(http://www.51mhl.com/ï¼‰ æ‹æ‹è´· ç”˜è‚ƒç”µä¿¡ æ–°æµªå•†å“éƒ¨ æ˜¥ç§‹èˆªç©º å†°é‰´ç§‘æŠ€ ä¸‡è¾¾ç½‘ç»œç§‘æŠ€é›†å›¢-å…±äº«å•†ä¸šå¹³å°-å…±äº«ä¾›åº”é“¾ä¸­å¿ƒ ç½‘æ˜“ä¹å¾—æŠ€æœ¯å›¢é˜Ÿ é¥¿äº†ä¹ˆæŸæŠ€æœ¯å›¢é˜Ÿ é«˜é˜³æ·è¿…ä¿¡æ¯ç§‘æŠ€â€“è¯è´¹ä¸­å¿ƒä¸šåŠ¡å¹³å°â€“å‡­è¯æŸ¥è¯¢åŠæ”¶å•ç³»ç»Ÿæ•°æ®åœ¨ç»Ÿè®¡ä¹‹ä¸­ï¼Œä¼šä¸€ç›´æŒç»­æ›´æ–°ï¼Œæ•¬è¯·æœŸå¾…ï¼ æèµ ç¤¾åŒºå‘å±•æèµ ç¤¾åŒº å¦‚æœä½ è§‰å¾—ï¼ŒSpring Cloudä¸­å›½ç¤¾åŒºè¿˜å¯ä»¥ï¼Œä¸ºäº†æ›´å¥½çš„å‘å±•ï¼Œä½ å¯ä»¥æèµ ç¤¾åŒºï¼Œç‚¹å‡»ä¸‹é¢çš„æ‰“èµæèµ ï¼Œæèµ çš„é’±å°†ç”¨äºç¤¾åŒºå‘å±•å’Œçº¿ä¸‹meeting upã€‚","categories":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/categories/Spring-Cloud/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://xujin.org/tags/Spring-Cloud/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ€»ç»“ä¹‹çº¿ç¨‹é—´çš„é€šä¿¡","slug":"bf/bf-thread-singal","date":"2016-08-09T13:00:00.000Z","updated":"2019-01-13T05:27:11.224Z","comments":true,"path":"bf/bf-thread-singal/","link":"","permalink":"http://xujin.org/bf/bf-thread-singal/","excerpt":"æ‘˜è¦:ä½¿ç”¨wait/notifyæ–¹æ³•å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚waitå’Œnotifyå¿…é¡»é…åˆsynchronizedå…³é”®å­—ä½¿ç”¨ï¼Œwaitæ–¹æ³•é‡Šæ”¾é”ï¼Œnotifyæ–¹æ³•ä¸é‡Šæ”¾é”ã€‚ çº¿ç¨‹é—´é€šä¿¡æ¦‚å¿µ çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­ç‹¬ç«‹çš„ä¸ªä½“ï¼Œä½†è¿™äº›ä¸ªä½“å¦‚æœä¸ç»è¿‡ç‰¹æ®Šçš„å¤„ç†å°±ä¸èƒ½æˆä¸ºä¸€ä¸ªæ•´ä½“ï¼Œçº¿ç¨‹é—´çš„é€šä¿¡å°±æˆä¸ºæ•´ä½“çš„å¿…ç”¨æ–¹å¼ä¹‹ä¸€ã€‚å½“çº¿ç¨‹å­˜åœ¨é€šä¿¡æŒ‡æŒ¥ï¼Œç³»ç»Ÿé—´çš„äº¤äº’ä¼šæ›´åŠ å¼ºå¤§ï¼Œåœ¨æé«˜CPUåˆ©ç”¨ç‡çš„åŒæ—¶è¿˜ä¼šä½¿å¼€å‘äººå‘˜å¯¹çº¿ç¨‹ä»»åŠ¡åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­è¿›è¡Œæœ‰æ•ˆçš„æŠŠæ§ä¸ç›‘ç£ã€‚ wait/notifyå®ç°çº¿ç¨‹é€šä¿¡ ä½¿ç”¨wait/notifyæ–¹æ³•å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚æ³¨æ„è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯Objectçš„ç±»æ–¹æ³•ï¼Œæ¢å¥è¯è¯´Javaä¸ºæ‰€æœ‰çš„å¯¹è±¡æä¾›äº†è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ã€‚ 1.waitå’Œnotifyå¿…é¡»é…åˆsynchronizedå…³é”®å­—ä½¿ç”¨ 2.waitæ–¹æ³•é‡Šæ”¾é”ï¼Œnotifyæ–¹æ³•ä¸é‡Šæ”¾é”ã€‚","text":"æ‘˜è¦:ä½¿ç”¨wait/notifyæ–¹æ³•å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚waitå’Œnotifyå¿…é¡»é…åˆsynchronizedå…³é”®å­—ä½¿ç”¨ï¼Œwaitæ–¹æ³•é‡Šæ”¾é”ï¼Œnotifyæ–¹æ³•ä¸é‡Šæ”¾é”ã€‚ çº¿ç¨‹é—´é€šä¿¡æ¦‚å¿µ çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­ç‹¬ç«‹çš„ä¸ªä½“ï¼Œä½†è¿™äº›ä¸ªä½“å¦‚æœä¸ç»è¿‡ç‰¹æ®Šçš„å¤„ç†å°±ä¸èƒ½æˆä¸ºä¸€ä¸ªæ•´ä½“ï¼Œçº¿ç¨‹é—´çš„é€šä¿¡å°±æˆä¸ºæ•´ä½“çš„å¿…ç”¨æ–¹å¼ä¹‹ä¸€ã€‚å½“çº¿ç¨‹å­˜åœ¨é€šä¿¡æŒ‡æŒ¥ï¼Œç³»ç»Ÿé—´çš„äº¤äº’ä¼šæ›´åŠ å¼ºå¤§ï¼Œåœ¨æé«˜CPUåˆ©ç”¨ç‡çš„åŒæ—¶è¿˜ä¼šä½¿å¼€å‘äººå‘˜å¯¹çº¿ç¨‹ä»»åŠ¡åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­è¿›è¡Œæœ‰æ•ˆçš„æŠŠæ§ä¸ç›‘ç£ã€‚ wait/notifyå®ç°çº¿ç¨‹é€šä¿¡ ä½¿ç”¨wait/notifyæ–¹æ³•å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚æ³¨æ„è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯Objectçš„ç±»æ–¹æ³•ï¼Œæ¢å¥è¯è¯´Javaä¸ºæ‰€æœ‰çš„å¯¹è±¡æä¾›äº†è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ã€‚ 1.waitå’Œnotifyå¿…é¡»é…åˆsynchronizedå…³é”®å­—ä½¿ç”¨ 2.waitæ–¹æ³•é‡Šæ”¾é”ï¼Œnotifyæ–¹æ³•ä¸é‡Šæ”¾é”ã€‚ æœ€åŸå§‹çº¿ç¨‹é—´é€šä¿¡ä»£ç å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼Œt1,t2ä¸¤ä¸ªçº¿ç¨‹ï¼Œt1çº¿ç¨‹ä¸€ç›´å¾ªç¯addï¼Œt2çº¿ç¨‹ä¸€ç›´å¾ªç¯ï¼Œå½“t1çº¿ç¨‹æŠŠlistçš„sizeå˜ä¸º5çš„æ—¶å€™ï¼Œt2çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸åœæ­¢ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import java.util.ArrayList;import java.util.List;/** * * @author xujin * */public class ListAdd1 &#123; private volatile static List&lt;String&gt; list = new ArrayList(); public void add() &#123; list.add(\"test....\"); &#125; public int size() &#123; return list.size(); &#125; public static void main(String[] args) &#123; final ListAdd1 list1 = new ListAdd1(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; for (int i = 0; i &lt; 10; i++) &#123; list1.add(); System.out .println(\"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ..\"); Thread.sleep(500); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; while (true) &#123; if (list1.size() == 5) &#123; System.out.println(\"å½“å‰çº¿ç¨‹æ”¶åˆ°é€šçŸ¥ï¼š\" + Thread.currentThread().getName() + \" list size = 5 çº¿ç¨‹åœæ­¢..\"); throw new RuntimeException(); &#125; &#125; &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125;&#125; waitå’Œnotifyå®ç°çº¿ç¨‹é—´é€šä¿¡ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970import java.util.ArrayList;import java.util.List;/** * @author xujin * */public class ListAdd2 &#123; private volatile static List list = new ArrayList(); public void add() &#123; list.add(\"test.......\"); &#125; public int size() &#123; return list.size(); &#125; public static void main(String[] args) &#123; final ListAdd2 list2 = new ListAdd2(); final Object lock = new Object(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; synchronized (lock) &#123; System.out.println(\"t1å¯åŠ¨..\"); for (int i = 0; i &lt; 10; i++) &#123; list2.add(); System.out.println( \"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ..\"); Thread.sleep(500); if (list2.size() == 5) &#123; System.out.println(\"å·²ç»å‘å‡ºé€šçŸ¥..\"); lock.notify(); &#125; &#125; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; synchronized (lock) &#123; System.out.println(\"t2å¯åŠ¨..\"); if (list2.size() != 5) &#123; try &#123; //t2çº¿ç¨‹ï¼Œæ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯sizeä¸ç­‰äº5,æ‰€ä»¥lock.wait(),é‡Šæ”¾äº†é”ï¼Œç„¶åt1å¾—åˆ°t2é‡Šæ”¾çš„é”ã€‚ System.out.println(\"size() != 5,t2 waité‡Šæ”¾é”ï¼..\"); lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(\"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ”¶åˆ°é€šçŸ¥çº¿ç¨‹åœæ­¢..\"); throw new RuntimeException(); &#125; &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125;&#125; è¿è¡Œç»“æœåˆ†æå¦‚ä¸‹: é€šè¿‡ä¸Šé¢çš„è¿è¡Œç»“æœåˆ†æï¼Œå¯ä»¥çœ‹å‡ºçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå› ä¸ºæŒæœ‰é”çš„é—®é¢˜ï¼Œä½¿ç”¨waitã€notifyçº¿ç¨‹é—´é€šä¿¡ï¼Œæ²¡æ³•åšåˆ°å®æ—¶é€šä¿¡ã€‚ ä½¿ç”¨java.util.concurrentä¸‹çš„CountDownLatchå®ç°å®æ—¶é€šä¿¡ç¤ºä¾‹ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import java.util.ArrayList;import java.util.List;import java.util.concurrent.CountDownLatch;/** * @author xujin * */public class ListAdd3 &#123; private volatile static List list = new ArrayList(); public void add() &#123; list.add(\"test.......\"); &#125; public int size() &#123; return list.size(); &#125; public static void main(String[] args) &#123; final ListAdd3 list2 = new ListAdd3(); // final Object lock = new Object(); final CountDownLatch countDownLatch = new CountDownLatch(1); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; // synchronized (lock) &#123; System.out.println(\"t1å¯åŠ¨..\"); for (int i = 0; i &lt; 10; i++) &#123; list2.add(); System.out.println( \"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ..\"); Thread.sleep(500); if (list2.size() == 5) &#123; System.out.println(\"å·²ç»å‘å‡ºé€šçŸ¥..\"); // lock.notify(); countDownLatch.countDown(); &#125; &#125; // &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; // synchronized (lock) &#123; System.out.println(\"t2å¯åŠ¨..\"); if (list2.size() != 5) &#123; try &#123; // lock.wait(); countDownLatch.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println( \"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ”¶åˆ°é€šçŸ¥çº¿ç¨‹åœæ­¢..\"); throw new RuntimeException(); &#125; // &#125; &#125;, \"t2\"); t2.start(); t1.start(); &#125;&#125; countDownLatch.countDown();ç›¸å½“äºlock.notify()ï¼›countDownLatch.await()ç›¸å½“äºlock.wait(); å¦‚æœfinal CountDownLatch countDownLatch = new CountDownLatch(2);éœ€è¦countDownLatch.countDown()ä¸¤æ¬¡å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678910111213141516171819202122232425262728final ListAdd3 list2 = new ListAdd3(); // final Object lock = new Object(); final CountDownLatch countDownLatch = new CountDownLatch(2); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; // synchronized (lock) &#123; System.out.println(\"t1å¯åŠ¨..\"); for (int i = 0; i &lt; 10; i++) &#123; list2.add(); System.out.println( \"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \"æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ..\"); Thread.sleep(500); if (list2.size() == 5) &#123; System.out.println(\"å·²ç»å‘å‡ºé€šçŸ¥..\"); // lock.notify(); countDownLatch.countDown(); countDownLatch.countDown(); &#125; &#125; // &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t1\"); ä½¿ç”¨wait/notifyæ¨¡æ‹ŸQueue BlockingQueueï¼šé¡¾åæ€ä¹‰é˜»å¡é˜Ÿåˆ—ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”æ”¯æŒé˜»å¡çš„æœºåˆ¶ï¼Œé˜»å¡çš„æ”¾å…¥å’Œå¾—åˆ°æ•°æ®ã€‚æˆ‘ä»¬è¦å®ç°LinkedBlockingQueueä¸‹é¢ä¸¤ä¸ªç®€å•çš„æ–¹æ³•putå’Œgetå’Œtakeã€‚ put(aObject):æŠŠä¸€ä¸ªå¯¹è±¡aobjectåŠ åˆ°BlockingQueueé‡Œï¼Œå¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´ï¼Œåˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ï¼Œç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­ã€‚ takeï¼šå–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡ï¼Œè‹¥BlockingQueueä¸ºç©ºï¼Œé˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°BlockingQueueæœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.atomic.AtomicInteger;/** * ä½¿ç”¨wait/notifyæ¨¡æ‹ŸQueue * @author xujin * */public class ImitateQueue &#123; // æ‰¿è½½å…ƒç´ çš„é›†åˆ private final LinkedList&lt;Object&gt; list = new LinkedList&lt;Object&gt;(); // è®¡æ•°å™¨è¿›è¡Œè®¡æ•° private final AtomicInteger count = new AtomicInteger(0); // åˆ¶å®šå…ƒç´ çš„ä¸Šé™å’Œä¸‹é™ private final int maxSize; private final int minSize = 0; // åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ç”¨äºåŠ é” private final Object lock = new Object(); public ImitateQueue(int maxSize) &#123; this.maxSize = maxSize; &#125; // æŠŠä¸€ä¸ªå¯¹è±¡aobjectåŠ åˆ°BlockingQueueé‡Œï¼Œå¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´ï¼Œåˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ï¼Œç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­å¢åŠ  public void put(Object obj) &#123; synchronized (lock) &#123; while (count.get() == maxSize) &#123; try &#123; // å½“é˜Ÿåˆ—ä¸­æ•°æ®å¡æ»¡ï¼Œçº¿ç¨‹ç­‰å¾… lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; list.add(obj); // è®¡æ•°å™¨è‡ªå¢ count.getAndIncrement(); System.out.println(\" å…ƒç´  \" + obj + \" è¢«æ·»åŠ  \"); // å”¤é†’ä¹‹å‰ç­‰å¾…é˜»å¡çš„takeæ–¹æ³•çº¿ç¨‹å–æ•°æ® lock.notify(); &#125; &#125; // å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡ï¼Œè‹¥BlockingQueueä¸ºç©ºï¼Œé˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°BlockingQueueæœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥ public Object take() &#123; Object temp = null; synchronized (lock) &#123; while (count.get() == minSize) &#123; try &#123; // å½“é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œå–å®Œï¼Œè¯¥çº¿ç¨‹ç­‰å¾… lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // è®¡æ•°å™¨é€’å‡ count.getAndDecrement(); // å–å‡ºå…ƒç´  temp = list.removeFirst(); System.out.println(\" å…ƒç´  \" + temp + \" è¢«æ¶ˆè´¹ \"); // å”¤é†’ä¹‹å‰é˜»å¡çš„putæ–¹æ³•æŠŠå…ƒç´ æ”¾è¿›å» lock.notify(); &#125; return temp; &#125; public int size() &#123; return count.get(); &#125; public static void main(String[] args) throws Exception &#123; final ImitateQueue m = new ImitateQueue(5); m.put(\"a\"); m.put(\"b\"); m.put(\"c\"); m.put(\"d\"); m.put(\"e\"); System.out.println(\"å½“å‰å…ƒç´ ä¸ªæ•°ï¼š\" + m.size()); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; m.put(\"h\"); m.put(\"i\"); &#125; &#125;, \"t1\"); t1.start(); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Object t1 = m.take(); System.out.println(\"è¢«å–èµ°çš„å…ƒç´ ä¸ºï¼š\" + t1); Thread.sleep(1000); Object t2 = m.take(); System.out.println(\"è¢«å–èµ°çš„å…ƒç´ ä¸ºï¼š\" + t2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, \"t2\"); // ä¼‘çœ 2ç§’é’Ÿ TimeUnit.SECONDS.sleep(2); t2.start(); &#125;&#125; ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹123456789101112 å…ƒç´  a è¢«æ·»åŠ  å…ƒç´  b è¢«æ·»åŠ  å…ƒç´  c è¢«æ·»åŠ  å…ƒç´  d è¢«æ·»åŠ  å…ƒç´  e è¢«æ·»åŠ  å½“å‰å…ƒç´ ä¸ªæ•°ï¼š5 å…ƒç´  a è¢«æ¶ˆè´¹ è¢«å–èµ°çš„å…ƒç´ ä¸ºï¼ša å…ƒç´  h è¢«æ·»åŠ  å…ƒç´  b è¢«æ¶ˆè´¹ è¢«å–èµ°çš„å…ƒç´ ä¸ºï¼šb å…ƒç´  i è¢«æ·»åŠ ","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ€»ç»“ä¹‹volatile","slug":"bf/bf-volatile","date":"2016-08-08T13:00:00.000Z","updated":"2019-01-13T05:25:56.893Z","comments":true,"path":"bf/bf-volatile/","link":"","permalink":"http://xujin.org/bf/bf-volatile/","excerpt":"æ‘˜è¦:æœ¬èŠ‚ä¸»è¦ä»‹ç»äº† volatileå…³é”®å­—çš„ä½œç”¨æ˜¯ä½¿å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹é—´å¯è§,ä½†æ˜¯ä¸å…·æœ‰åŸå­æ€§ï¼Œä»¥åŠvolatileçš„è¿è¡Œå†…å­˜ä»‹ç»ã€‚ åœ¨javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€å—å·¥ä½œå†…å­˜åŒºï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸»å†…å­˜ä¸­çš„å˜é‡å€¼çš„æ‹·è´ã€‚å½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå®ƒåœ¨è‡ªå·±çš„å·¥ä½œåŒºå†…å­˜ä¸­æ“ä½œè¿™äº›å˜é‡ã€‚ä¸ºäº†å­˜å–ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä¸€ä¸ªçº¿ç¨‹é€šå¸¸ä¼šå…ˆè·å–é”å®šå¹¶æ¸…é™¤å®ƒçš„å†…å­˜å·¥ä½œåŒºï¼ŒæŠŠè¿™äº›å…±äº«å˜é‡ä»æ‰€æœ‰çº¿ç¨‹çš„å…±äº«å†…å­˜ä¸­æ­£ç¡®çš„è£…å…¥åˆ°å®ƒè‡ªå·±æ‰€åœ¨çš„å·¥ä½œå†…å­˜ä¸­ï¼Œå½“çº¿ç¨‹è§£é”æ—¶ï¼Œä¿è¯è¯¥å·¥ä½œå†…å­˜ä¸­å˜é‡çš„å€¼å†™å›åˆ°å…±äº«å†…å­˜ä¸­ã€‚","text":"æ‘˜è¦:æœ¬èŠ‚ä¸»è¦ä»‹ç»äº† volatileå…³é”®å­—çš„ä½œç”¨æ˜¯ä½¿å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹é—´å¯è§,ä½†æ˜¯ä¸å…·æœ‰åŸå­æ€§ï¼Œä»¥åŠvolatileçš„è¿è¡Œå†…å­˜ä»‹ç»ã€‚ åœ¨javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€å—å·¥ä½œå†…å­˜åŒºï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸»å†…å­˜ä¸­çš„å˜é‡å€¼çš„æ‹·è´ã€‚å½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå®ƒåœ¨è‡ªå·±çš„å·¥ä½œåŒºå†…å­˜ä¸­æ“ä½œè¿™äº›å˜é‡ã€‚ä¸ºäº†å­˜å–ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä¸€ä¸ªçº¿ç¨‹é€šå¸¸ä¼šå…ˆè·å–é”å®šå¹¶æ¸…é™¤å®ƒçš„å†…å­˜å·¥ä½œåŒºï¼ŒæŠŠè¿™äº›å…±äº«å˜é‡ä»æ‰€æœ‰çº¿ç¨‹çš„å…±äº«å†…å­˜ä¸­æ­£ç¡®çš„è£…å…¥åˆ°å®ƒè‡ªå·±æ‰€åœ¨çš„å·¥ä½œå†…å­˜ä¸­ï¼Œå½“çº¿ç¨‹è§£é”æ—¶ï¼Œä¿è¯è¯¥å·¥ä½œå†…å­˜ä¸­å˜é‡çš„å€¼å†™å›åˆ°å…±äº«å†…å­˜ä¸­ã€‚ volatileçš„ä½œç”¨å°±æ˜¯å¼ºåˆ¶çº¿ç¨‹åˆ°ä¸»å†…å­˜(å…±äº«å†…å­˜)é‡Œå»è¯»å–å˜é‡ï¼Œè€Œä¸å»çº¿ç¨‹å·¥ä½œåŒºå†…å­˜é‡Œå»è¯»å–ï¼Œä»è€Œå®ç°äº†å¤šä¸ªçº¿ç¨‹é—´çš„å˜é‡å¯è§ï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„å¯è§æ€§ã€‚ volatileæ¦‚å¿µvolatileæ¦‚å¿µ-å…·æœ‰å¯è§æ€§ volatileå…³é”®å­—çš„ä½œç”¨æ˜¯ä½¿å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹é—´å¯è§ã€‚ ä»£ç ç¤ºä¾‹å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå½“isRunningæ²¡æœ‰è¢«volatileå…³é”®å­—ä¿®é¥°çš„æ—¶å€™ï¼Œç¨‹åºä¸€ç›´å¾ªç¯ï¼Œçº¿ç¨‹ä¸ä¼šç»“æŸã€‚123456789101112131415161718192021222324252627public class RunThread extends Thread &#123; // isRunningæ²¡æœ‰è¢«volatileå…³é”®å­—ä¿®é¥° private boolean isRunning = true;//â‘  private void setRunning(boolean isRunning) &#123; this.isRunning = isRunning; &#125; public void run() &#123; System.out.println(\"å¼€å§‹è¿›å…¥runæ–¹æ³•..\"); while (isRunning == true) &#123; // ä¸€ç›´å¾ªç¯........ &#125; System.out.println(\"whileå¾ªç¯ç»“æŸ,çº¿ç¨‹åœæ­¢\"); &#125; public static void main(String[] args) throws InterruptedException &#123; RunThread rt = new RunThread(); rt.start(); Thread.sleep(3000); rt.setRunning(false); System.out.println(\"isRunningçš„å€¼å·²ç»è¢«è®¾ç½®äº†false\"); Thread.sleep(1000); System.out.println(rt.isRunning); &#125;&#125; å½“æŠŠä¸Šè¿°ä»£ç çš„â‘ å¤„ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹æ—¶:1private volatile boolean isRunning = true; è¿è¡Œç»“æœæ˜¯isRunningä¿®æ”¹ä¸ºfalseä¹‹åï¼Œçº¿ç¨‹è¯»å–åˆ°isRunning = falseï¼Œä»è€Œçº¿ç¨‹ç»“æŸwhileå¾ªç¯ï¼Œçº¿ç¨‹é€€å‡º1234å¼€å§‹è¿›å…¥runæ–¹æ³•..isRunningçš„å€¼å·²ç»è¢«è®¾ç½®äº†falsewhileå¾ªç¯ç»“æŸ,çº¿ç¨‹åœæ­¢false ç¤ºä¾‹ä»£ç çº¿ç¨‹æ“ä½œå†…å­˜ç®€å›¾ å°ç»“ åœ¨javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€å—å·¥ä½œå†…å­˜åŒºï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸»å†…å­˜ä¸­çš„å˜é‡å€¼å¾—æ‹·è´ã€‚å½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå®ƒåœ¨è‡ªå·±çš„å·¥ä½œåŒºå†…å­˜ä¸­æ“ä½œè¿™äº›å˜é‡ã€‚ä¸ºäº†å­˜å–ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä¸€ä¸ªçº¿ç¨‹é€šå¸¸ä¼šå…ˆè·å–é”å®šå¹¶æ¸…é™¤å®ƒçš„å†…å­˜å·¥ä½œåŒºï¼ŒæŠŠè¿™äº›å…±äº«å˜é‡ä»æ‰€æœ‰çº¿ç¨‹çš„å…±äº«å†…å­˜ä¸­æ­£ç¡®çš„è£…å…¥åˆ°å®ƒè‡ªå·±æ‰€åœ¨çš„å·¥ä½œå†…å­˜ä¸­ï¼Œå½“çº¿ç¨‹è§£é”æ—¶ï¼Œä¿è¯è¯¥å·¥ä½œå†…å­˜ä¸­å˜é‡çš„å€¼å†™å›åˆ°å…±äº«å†…å­˜ä¸­ã€‚ ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œæœ‰ä½¿ç”¨(use)ï¼Œèµ‹å€¼(assign),è£…è½½(load),å­˜å‚¨(store),é”å®š(lock),è§£é”(unlock)ã€‚è€Œä¸»å†…å­˜å¯ä»¥æ‰§è¡Œçš„æ“ä½œæœ‰è¯»(read),å†™(write),é”å®š(lock),è§£é”ï¼ˆunlock)ï¼Œæ¯ä¸ªæ“ä½œéƒ½æ˜¯åŸå­çš„ã€‚ volatileçš„ä½œç”¨å°±æ˜¯å¼ºåˆ¶çº¿ç¨‹åˆ°ä¸»å†…å­˜(å…±äº«å†…å­˜)é‡Œå»è¯»å–å˜é‡ï¼Œè€Œä¸å»çº¿ç¨‹å·¥ä½œåŒºå†…å­˜é‡Œå»è¯»å–ï¼Œä»è€Œå®ç°äº†å¤šä¸ªçº¿ç¨‹é—´çš„å˜é‡å¯è§ï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„å¯è§æ€§ã€‚ volatile-ä¸å…·æœ‰åŸå­æ€§ volatileå…³é”®å­—è™½ç„¶æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸å…·å¤‡åŒæ­¥æ€§ï¼Œä¹Ÿå°±æ˜¯åŸå­æ€§ï¼Œå¯ä»¥ç®—å¾—ä¸Šä¸€ä¸ªè½»é‡çº§åˆ«çš„synchronized,æ€§èƒ½è¦æ¯”synchronizedå¼ºå¾ˆå¤šï¼Œä¸ä¼šé€ æˆé˜»å¡(åœ¨å¾ˆå¤šå¼€æºæ¡†æ¶ï¼Œæ¯”å¦‚Nettyçš„åº•å±‚ä»£ç å°±å¤§é‡çš„ä½¿ç”¨volatileï¼Œç”±æ­¤å¯è§Nettyçš„æ€§èƒ½éå¸¸ä¸é”™),ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œvolatileç”¨äºåªé’ˆå¯¹äºå¤šä¸ªçº¿ç¨‹å¯è§çš„å˜é‡æ“ä½œï¼Œå¹¶ä¸èƒ½æ›¿ä»£synchronizedçš„åŒæ­¥åŠŸèƒ½ã€‚ ç¤ºä¾‹ä»£ç 112345678910111213141516171819202122232425public class VolatileNoAtomic extends Thread &#123; private static volatile int count; private static void addCount() &#123; for (int i = 0; i &lt; 1000; i++) &#123; count++; &#125; System.out.println(count); &#125; public void run() &#123; addCount(); &#125; public static void main(String[] args) &#123; VolatileNoAtomic[] arr = new VolatileNoAtomic[100]; for (int i = 0; i &lt; 10; i++) &#123; arr[i] = new VolatileNoAtomic(); &#125; for (int i = 0; i &lt; 10; i++) &#123; arr[i].start(); &#125; &#125;&#125; è¿è¡Œç»“æœï¼Œéšæœºå› ä¸ºvolatileæ²¡æœ‰åŸå­æ€§ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰“å°ç»“æœä¸æ˜¯10000 ç¤ºä¾‹ä»£ç 2123456789101112131415161718192021222324252627public class VolatileNoAtomic extends Thread &#123; private static AtomicInteger count = new AtomicInteger(0); private static void addCount() &#123; for (int i = 0; i &lt; 1000; i++) &#123; count.incrementAndGet(); &#125; System.out.println(count); &#125; public void run() &#123; addCount(); &#125; public static void main(String[] args) &#123; VolatileNoAtomic[] arr = new VolatileNoAtomic[100]; for (int i = 0; i &lt; 10; i++) &#123; arr[i] = new VolatileNoAtomic(); &#125; for (int i = 0; i &lt; 10; i++) &#123; arr[i].start(); &#125; &#125;&#125; è¿è¡Œæœ€ç»ˆæ‰“å°ç»“æœæ˜¯:10000 å°ç»“:volatileå…³é”®å­—åªæœ‰å¯è§æ€§ï¼Œæ²¡æœ‰åŸå­æ€§ã€‚è¦å®ç°åŸå­æ€§å»ºè®®ä½¿ç”¨atomicç±»çš„ç³»åˆ—å¯¹è±¡ï¼Œæ”¯æŒåŸå­æ€§æ“ä½œã€‚ æ³¨æ„atomicç±»åªä¿è¯æœ¬èº«æ–¹æ³•çš„åŸå­æ€§ï¼Œå¹¶ä¸ä¿è¯å¤šæ¬¡æ“ä½œçš„åŸå­æ€§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package org.xujin.multithread.sync007;import java.util.ArrayList;import java.util.List;import java.util.concurrent.atomic.AtomicInteger;/** * @author xujin */public class AtomicUse &#123; private static AtomicInteger count = new AtomicInteger(0); // å¤šä¸ªaddAndGetåœ¨ä¸€ä¸ªæ–¹æ³•å†…æ˜¯éåŸå­æ€§çš„ï¼Œéœ€è¦åŠ synchronizedè¿›è¡Œä¿®é¥°ï¼Œä¿è¯4ä¸ªaddAndGetæ•´ä½“åŸå­æ€§ /** synchronized */ public synchronized int multiAdd() &#123; try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; count.addAndGet(1); count.addAndGet(2); count.addAndGet(3); count.addAndGet(4); // +10,æ‰§è¡Œåˆ°è¿™é‡Œç›¸å½“äºåŠ 10-&gt;1+2+3+4=10ï¼Œ return count.get(); &#125; public static void main(String[] args) &#123; final AtomicUse au = new AtomicUse(); List&lt;Thread&gt; ts = new ArrayList&lt;Thread&gt;(); for (int i = 0; i &lt; 100; i++) &#123; ts.add(new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(au.multiAdd()); &#125; &#125;)); &#125; for (Thread t : ts) &#123; t.start(); &#125; &#125;&#125;","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ€»ç»“ä¹‹synchronizedç»†èŠ‚é—®é¢˜","slug":"bf/bf-synchronized","date":"2016-07-26T13:00:00.000Z","updated":"2019-01-13T05:26:20.871Z","comments":true,"path":"bf/bf-synchronized/","link":"","permalink":"http://xujin.org/bf/bf-synchronized/","excerpt":"æ‘˜è¦:æœ¬èŠ‚ä¸»è¦ä»‹ç»äº†å¹¶å‘ç¼–ç¨‹ä¸‹æ€ä¹ˆé¿å…æ•°æ®è„è¯»å’Œä»€ä¹ˆæ˜¯synchronizedçš„å¯é‡å…¥é”ï¼Œsynchronizedçš„å¯é‡å…¥é”çš„å‡ ç§ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä»¥åŠä¸€äº›ç»†èŠ‚çš„synchronizedä½¿ç”¨é—®é¢˜å’Œsynchronizedå¸¸è§ä»£ç å—ç¤ºä¾‹Codeå¯ä»¥ç›´æ¥Copyè¿è¡Œã€‚ è„è¯»ä»€ä¹ˆæ˜¯è„è¯» å¯¹äºå¯¹è±¡çš„åŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ç¨‹åºï¼Œä¸€å®šè¦è€ƒè™‘é—®é¢˜çš„æ•´ä½“æ€§ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é”™è¯¯ï¼Œæœ€ç»å…¸çš„é”™è¯¯å°±æ˜¯è„è¯»(DirtyRead)ã€‚ ç¤ºä¾‹Codeä¸šåŠ¡æ•´ä½“éœ€è¦ä½¿ç”¨å®Œæ•´çš„synchronizedï¼Œä¿æŒä¸šåŠ¡çš„åŸå­æ€§ã€‚","text":"æ‘˜è¦:æœ¬èŠ‚ä¸»è¦ä»‹ç»äº†å¹¶å‘ç¼–ç¨‹ä¸‹æ€ä¹ˆé¿å…æ•°æ®è„è¯»å’Œä»€ä¹ˆæ˜¯synchronizedçš„å¯é‡å…¥é”ï¼Œsynchronizedçš„å¯é‡å…¥é”çš„å‡ ç§ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä»¥åŠä¸€äº›ç»†èŠ‚çš„synchronizedä½¿ç”¨é—®é¢˜å’Œsynchronizedå¸¸è§ä»£ç å—ç¤ºä¾‹Codeå¯ä»¥ç›´æ¥Copyè¿è¡Œã€‚ è„è¯»ä»€ä¹ˆæ˜¯è„è¯» å¯¹äºå¯¹è±¡çš„åŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ç¨‹åºï¼Œä¸€å®šè¦è€ƒè™‘é—®é¢˜çš„æ•´ä½“æ€§ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é”™è¯¯ï¼Œæœ€ç»å…¸çš„é”™è¯¯å°±æ˜¯è„è¯»(DirtyRead)ã€‚ ç¤ºä¾‹Codeä¸šåŠ¡æ•´ä½“éœ€è¦ä½¿ç”¨å®Œæ•´çš„synchronizedï¼Œä¿æŒä¸šåŠ¡çš„åŸå­æ€§ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * ä¸šåŠ¡æ•´ä½“éœ€è¦ä½¿ç”¨å®Œæ•´çš„synchronizedï¼Œä¿æŒä¸šåŠ¡çš„åŸå­æ€§ã€‚ * * @author xujin * */public class DirtyRead &#123; private String username = \"xujin\"; private String password = \"123\";&lt;!--more--&gt; public synchronized void setValue(String username, String password) &#123; this.username = username; try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; this.password = password; System.out.println(\"setValueæœ€ç»ˆç»“æœï¼šusername = \" + username + \" , password = \" + password); &#125; //â‘ è¿™é‡ŒgetValueæ²¡æœ‰åŠ synchronizedä¿®é¥° public void getValue() &#123; System.out.println(\"getValueæ–¹æ³•å¾—åˆ°ï¼šusername = \" + this.username + \" , password = \" + this.password); &#125; public static void main(String[] args) throws Exception &#123; final DirtyRead dr = new DirtyRead(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; dr.setValue(\"å¼ ä¸‰\", \"456\"); &#125; &#125;); t1.start(); Thread.sleep(1000); dr.getValue(); &#125;&#125; ä¸Šé¢çš„Codeä¸­ï¼ŒgetValueæ²¡æœ‰åŠ synchronizedä¿®é¥°ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹,å‡ºç°è„è¯»12getValueæ–¹æ³•å¾—åˆ°ï¼šusername = å¼ ä¸‰ , password = 123setValueæœ€ç»ˆç»“æœï¼šusername = å¼ ä¸‰ , password = 456 åªéœ€åœ¨getValueåŠ synchronizedä¿®é¥°ï¼Œå¦‚ä¸‹:123public synchronized void getValue() &#123; System.out.println(\"getValueæ–¹æ³•å¾—åˆ°ï¼šusername = \" + this.username + \" , password = \" + this.password);&#125; è¿è¡Œç»“æœå¦‚ä¸‹,æ²¡æœ‰é€ æˆæ•°æ®è„è¯»12setValueæœ€ç»ˆç»“æœï¼šusername = å¼ ä¸‰ , password = 456getValueæ–¹æ³•å¾—åˆ°ï¼šusername = å¼ ä¸‰ , password = 456 å°ç»“ åœ¨æˆ‘ä»¬å¯¹å¯¹è±¡ä¸­çš„ä¸€ä¸ªæ–¹æ³•åŠ é”çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸šåŠ¡çš„æˆ–ç¨‹åºçš„æ•´ä½“æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸ºç¨‹åºä¸­çš„setå’Œgetæ–¹æ³•åŒæ—¶åŠ é”synchronizedåŒæ­¥å…³é”®å­—ï¼Œä¿è¯ä¸šåŠ¡çš„(serviceå±‚)çš„åŸå­æ€§ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®é”™è¯¯ï¼Œè„è¯»ã€‚ synchronizedçš„é‡å…¥ä»€ä¹ˆæ˜¯synchronizedçš„é‡å…¥é” synchronized,å®ƒæ‹¥æœ‰å¼ºåˆ¶åŸå­æ€§çš„å†…ç½®é”æœºåˆ¶,æ˜¯ä¸€ä¸ªé‡å…¥é”,æ‰€ä»¥åœ¨ä½¿ç”¨synchronizedæ—¶,å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”åå†æ¬¡è¯·æ±‚æ­¤å¯¹è±¡é”,å¯ä»¥å†æ¬¡å¾—åˆ°è¯¥å¯¹è±¡é”,å°±æ˜¯è¯´åœ¨ä¸€ä¸ªsynchronizedæ–¹æ³•/å—çš„å†…éƒ¨è°ƒç”¨æœ¬ç±»çš„å…¶ä»–synchronizedæ–¹æ³•/å—æ—¶ï¼Œæ˜¯æ°¸è¿œå¯ä»¥æ‹¿åˆ°é”ã€‚ å½“çº¿ç¨‹è¯·æ±‚ä¸€ä¸ªç”±å…¶å®ƒçº¿ç¨‹æŒæœ‰çš„å¯¹è±¡é”æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡ï¼Œè€Œå½“çº¿ç¨‹è¯·æ±‚ç”±è‡ªå·±æŒæœ‰çš„å¯¹è±¡é”æ—¶ï¼Œå¦‚æœè¯¥é”æ˜¯é‡å…¥é”,è¯·æ±‚å°±ä¼šæˆåŠŸ,å¦åˆ™é˜»å¡. ç®€å•çš„è¯´:å…³é”®å­—synchronizedå…·æœ‰é”é‡å…¥çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½¿ç”¨synchronizedæ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”çš„é”åï¼Œå†æ¬¡è¯·æ±‚æ­¤å¯¹è±¡æ—¶å¯ä»¥å†æ¬¡å¾—åˆ°è¯¥å¯¹è±¡å¯¹åº”çš„é”ã€‚ åµŒå¥—è°ƒç”¨å…³ç³»synchronizedçš„é‡å…¥åµŒå¥—è°ƒç”¨å…³ç³»synchronizedçš„é‡å…¥ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸‹é¢æ˜¯method1ï¼Œmethod2ï¼Œmethod3éƒ½è¢«synchronizedä¿®é¥°ï¼Œè°ƒç”¨å…³ç³»method1â€“&gt;method2â€“&gt;method3,ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚1234567891011121314151617181920212223242526272829303132/** * synchronizedçš„é‡å…¥ * * @author xujin * */public class SyncReenTrant &#123; public synchronized void method1() &#123; System.out.println(\"method1..\"); method2(); &#125; public synchronized void method2() &#123; System.out.println(\"method2..\"); method3(); &#125; public synchronized void method3() &#123; System.out.println(\"method3..\"); &#125; public static void main(String[] args) &#123; final SyncReenTrant sd = new SyncReenTrant(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; sd.method1(); &#125; &#125;); t1.start(); &#125; è¿è¡Œç»“æœå¦‚ä¸‹:123method1..method2..method3.. ç»§æ‰¿å…³ç³»çš„synchronizedçš„é‡å…¥ç®€å• Code1ï¼š123456789101112131415161718192021222324252627public class Son extends Father &#123; public synchronized void doSomething() &#123; System.out.println(&quot;child.doSomething()&quot;); // è°ƒç”¨è‡ªå·±ç±»ä¸­å…¶ä»–çš„synchronizedæ–¹æ³• doAnotherThing(); &#125; private synchronized void doAnotherThing() &#123; // è°ƒç”¨çˆ¶ç±»çš„synchronizedæ–¹æ³• super.doSomething(); System.out.println(&quot;child.doAnotherThing()&quot;); &#125; public static void main(String[] args) &#123; Son child = new Son(); child.doSomething(); &#125;&#125;class Father &#123; public synchronized void doSomething() &#123; System.out.println(&quot;father.doSomething()&quot;); &#125;&#125; è¿è¡Œç»“æœ:123child.doSomething()father.doSomething()child.doAnotherThing() è¿™é‡Œçš„å¯¹è±¡é”åªæœ‰ä¸€ä¸ª,å°±æ˜¯childå¯¹è±¡çš„é”,å½“æ‰§è¡Œchild.doSomethingæ—¶ï¼Œè¯¥çº¿ç¨‹è·å¾—childå¯¹è±¡çš„é”ï¼Œåœ¨doSomethingæ–¹æ³•å†…æ‰§è¡ŒdoAnotherThingæ—¶å†æ¬¡è¯·æ±‚childå¯¹è±¡çš„é”ï¼Œå› ä¸ºsynchronizedæ˜¯é‡å…¥é”ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°è¯¥é”ï¼Œç»§ç»­åœ¨doAnotherThingé‡Œæ‰§è¡Œçˆ¶ç±»çš„doSomethingæ–¹æ³•æ—¶ç¬¬ä¸‰æ¬¡è¯·æ±‚childå¯¹è±¡çš„é”ï¼ŒåŒç†å¯å¾—åˆ°ï¼Œå¦‚æœä¸æ˜¯é‡å…¥é”çš„è¯ï¼Œé‚£è¿™åé¢è¿™ä¸¤æ¬¡è¯·æ±‚é”å°†ä¼šè¢«ä¸€ç›´é˜»å¡ï¼Œä»è€Œå¯¼è‡´æ­»é”ã€‚ æ‰€ä»¥åœ¨Javaå†…éƒ¨ï¼ŒåŒä¸€çº¿ç¨‹åœ¨è°ƒç”¨è‡ªå·±ç±»ä¸­å…¶ä»–synchronizedæ–¹æ³•/å—æˆ–è°ƒç”¨çˆ¶ç±»çš„synchronizedæ–¹æ³•/å—éƒ½ä¸ä¼šé˜»ç¢è¯¥çº¿ç¨‹çš„æ‰§è¡Œï¼Œå°±æ˜¯è¯´åŒä¸€çº¿ç¨‹å¯¹åŒä¸€ä¸ªå¯¹è±¡é”æ˜¯å¯é‡å…¥çš„ï¼Œè€Œä¸”åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åŒä¸€æŠŠé”å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¤šæ¬¡é‡å…¥ã€‚å› ä¸ºjavaçº¿ç¨‹æ˜¯åŸºäºâ€œæ¯çº¿ç¨‹ï¼ˆper-threadï¼‰â€ï¼Œè€Œä¸æ˜¯åŸºäºâ€œæ¯è°ƒç”¨ï¼ˆper-invocationï¼‰â€çš„ï¼ˆjavaä¸­çº¿ç¨‹è·å¾—å¯¹è±¡é”çš„æ“ä½œæ˜¯ä»¥æ¯çº¿ç¨‹ä¸ºç²’åº¦çš„ï¼Œper-invocationäº’æ–¥ä½“è·å¾—å¯¹è±¡é”çš„æ“ä½œæ˜¯ä»¥æ¯è°ƒç”¨ä½œä¸ºç²’åº¦çš„ï¼‰ æˆ‘ä»¬å†æ¥çœ‹çœ‹é‡å…¥é”æ˜¯æ€ä¹ˆå®ç°å¯é‡å…¥æ€§çš„ï¼Œå…¶å®ç°æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªé”å…³è”ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è€…å’Œè®¡æ•°å™¨ï¼Œå½“è®¡æ•°å™¨ä¸º0æ—¶è¡¨ç¤ºè¯¥é”æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆä»»ä½•çº¿ç¨‹éƒ½å¯èƒ½è·å¾—è¯¥é”è€Œè°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼›å½“æŸä¸€çº¿ç¨‹è¯·æ±‚æˆåŠŸåï¼ŒJVMä¼šè®°ä¸‹é”çš„æŒæœ‰çº¿ç¨‹ï¼Œå¹¶ä¸”å°†è®¡æ•°å™¨ç½®ä¸º1ï¼›æ­¤æ—¶å…¶å®ƒçº¿ç¨‹è¯·æ±‚è¯¥é”ï¼Œåˆ™å¿…é¡»ç­‰å¾…ï¼›è€Œè¯¥æŒæœ‰é”çš„çº¿ç¨‹å¦‚æœå†æ¬¡è¯·æ±‚è¿™ä¸ªé”ï¼Œå°±å¯ä»¥å†æ¬¡æ‹¿åˆ°è¿™ä¸ªé”ï¼ŒåŒæ—¶è®¡æ•°å™¨ä¼šé€’å¢ï¼›å½“çº¿ç¨‹é€€å‡ºåŒæ­¥ä»£ç å—æ—¶ï¼Œè®¡æ•°å™¨ä¼šé€’å‡ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º0ï¼Œåˆ™é‡Šæ”¾è¯¥é”ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class SyncExtends &#123; // çˆ¶ç±» static class Father &#123; public int i = 10; public synchronized void operationSup() &#123; try &#123; i--; System.out.println(\"Father print i = \" + i); Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; // å­ç±»ç»§æ‰¿çˆ¶ç±» static class Son extends Father &#123; public synchronized void operationSub() &#123; try &#123; while (i &gt; 0) &#123; i--; System.out.println(\"Son print i = \" + i); Thread.sleep(100); this.operationSup(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; Son sub = new Son(); sub.operationSub(); &#125; &#125;); t1.start(); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹:12345678910Son print i = 9Father print i = 8Son print i = 7Father print i = 6Son print i = 5Father print i = 4Son print i = 3Father print i = 2Son print i = 1Father print i = 0 å‚è€ƒæ–‡ç« :http://blog.csdn.net/aigoogle/article/details/29893667 synchronizedå¸¸è§ä»£ç å— synchronizedå¯ä»¥ä½¿ç”¨ä»»æ„çš„Objectè¿›è¡ŒåŠ é”ï¼Œ ä½¿ç”¨synchronizedä»£ç å—åŠ é”,æ¯”è¾ƒçµæ´»ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public class ObjectLock &#123; public void method1() &#123; // å¯¹thiså½“å‰ObjectLockå®ä¾‹å¯¹è±¡åŠ é” synchronized (this) &#123; try &#123; System.out.println(\"do method1..\"); Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public void method2() &#123; // å¯¹ObjectLockç±»åŠ é” synchronized (ObjectLock.class) &#123; try &#123; System.out.println(\"do method2..\"); Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; // ä»»ä½•å¯¹è±¡é” private Object anyObjectlock = new Object(); public void method3() &#123; synchronized (anyObjectlock) &#123; try &#123; System.out.println(\"do method3..\"); Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; final ObjectLock objLock = new ObjectLock(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; objLock.method1(); &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; objLock.method2(); &#125; &#125;); Thread t3 = new Thread(new Runnable() &#123; @Override public void run() &#123; objLock.method3(); &#125; &#125;); t1.start(); t2.start(); t3.start(); &#125;&#125; 2.ä½¿ç”¨synchronizedå£°æ˜çš„æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ˜¯æœ‰å¼Šç«¯çš„ï¼Œæ¯”å¦‚Açº¿ç¨‹è°ƒç”¨åŒæ­¥çš„æ–¹æ³•æ‰§è¡Œä¸€ä¸ªå¾ˆé•¿æ—¶é—´çš„ä»»åŠ¡,é‚£ä¹ˆBçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…å¾ˆé•¿çš„æ—¶é—´æ‰å¯ä»¥æ‰§è¡Œï¼Œè¿™æ ·æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨synchronizeçš„å»ä¼˜åŒ–ä»£ç æ‰§è¡Œæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„å‡å°é”çš„ç²’åº¦ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public class Optimize &#123; public void doLongTimeTask() &#123; try &#123; System.out.println(\"å½“å‰çº¿ç¨‹å¼€å§‹ï¼š\" + Thread.currentThread().getName() + \", æ­£åœ¨æ‰§è¡Œä¸€ä¸ªè¾ƒé•¿æ—¶é—´çš„ä¸šåŠ¡æ“ä½œï¼Œå…¶å†…å®¹ä¸éœ€è¦åŒæ­¥\"); Thread.sleep(2000); // ä½¿ç”¨synchronizedä»£ç å—å‡å°é”çš„ç²’åº¦ï¼Œæé«˜æ€§èƒ½ synchronized (this) &#123; System.out.println(\"å½“å‰çº¿ç¨‹ï¼š\" + Thread.currentThread().getName() + \", æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œå¯¹å…¶åŒæ­¥å˜é‡è¿›è¡Œæ“ä½œ\"); Thread.sleep(1000); &#125; System.out.println(\"å½“å‰çº¿ç¨‹ç»“æŸï¼š\" + Thread.currentThread().getName() + \", æ‰§è¡Œå®Œæ¯•\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; final Optimize otz = new Optimize(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; otz.doLongTimeTask(); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; otz.doLongTimeTask(); &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125;&#125; æ‰§è¡Œç»“æœ: 123456å½“å‰çº¿ç¨‹å¼€å§‹ï¼št1, æ­£åœ¨æ‰§è¡Œä¸€ä¸ªè¾ƒé•¿æ—¶é—´çš„ä¸šåŠ¡æ“ä½œï¼Œå…¶å†…å®¹ä¸éœ€è¦åŒæ­¥å½“å‰çº¿ç¨‹å¼€å§‹ï¼št2, æ­£åœ¨æ‰§è¡Œä¸€ä¸ªè¾ƒé•¿æ—¶é—´çš„ä¸šåŠ¡æ“ä½œï¼Œå…¶å†…å®¹ä¸éœ€è¦åŒæ­¥å½“å‰çº¿ç¨‹ï¼št2, æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œå¯¹å…¶åŒæ­¥å˜é‡è¿›è¡Œæ“ä½œå½“å‰çº¿ç¨‹ç»“æŸï¼št2, æ‰§è¡Œå®Œæ¯•å½“å‰çº¿ç¨‹ï¼št1, æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œå¯¹å…¶åŒæ­¥å˜é‡è¿›è¡Œæ“ä½œå½“å‰çº¿ç¨‹ç»“æŸï¼št1, æ‰§è¡Œå®Œæ¯• 3.æ³¨æ„å°±æ˜¯ä¸è¦ä½¿ç”¨Stringçš„å¸¸é‡åŠ é”ï¼Œä¼šå‡ºç°æ­»å¾ªç¯é—®é¢˜ã€‚ synchronizedä»£ç å—å¯¹å­—ç¬¦ä¸²çš„é”ï¼Œæ³¨æ„Stringå¸¸é‡æ± çš„ç¼“å­˜åŠŸèƒ½,ç¤ºä¾‹ä»£ç å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435public class StringLock &#123; public void method() &#123; synchronized (\"å­—ç¬¦ä¸²å¸¸é‡\") &#123; try &#123; while(true)&#123; System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"å¼€å§‹\"); Thread.sleep(1000); System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"ç»“æŸ\"); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; final StringLock stringLock = new StringLock(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; stringLock.method(); &#125; &#125;,\"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; stringLock.method(); &#125; &#125;,\"t2\"); t1.start(); t2.start(); &#125;&#125; æç¤º:è¿è¡Œç»“æœæ˜¯:t1çº¿ç¨‹ä¸€ç›´æ­»å¾ªç¯ã€‚t2çº¿ç¨‹ä¸æ‰§è¡Œã€‚ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç ,t1å’Œt2çº¿ç¨‹äº¤æ›¿æ‰§è¡Œ 1234567891011121314public void method() &#123; //æŠŠsynchronized (\"å­—ç¬¦ä¸²å¸¸é‡\") ä¿®æ”¹ä¸ºsynchronized (new String(\"å­—ç¬¦ä¸²å¸¸é‡\")) synchronized (new String(\"å­—ç¬¦ä¸²å¸¸é‡\")) &#123; try &#123; while (true) &#123; System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"å¼€å§‹\"); Thread.sleep(1000); System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"ç»“æŸ\"); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; 4.é”å¯¹è±¡çš„æ”¹å˜é—®é¢˜: å½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”çš„æ—¶å€™ï¼Œè¦æ³¨æ„å¯¹è±¡æœ¬èº«å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé‚£ä¹ˆæŒæœ‰çš„é”å°±ä¸åŒã€‚å¦‚æœå¯¹è±¡æœ¬èº«ä¸å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆä¾ç„¶æ˜¯åŒæ­¥çš„ï¼Œå³ä½¿æ˜¯å¯¹è±¡çš„å±æ€§å‘ç”Ÿäº†å˜åŒ–ã€‚ 4.1 ç¤ºä¾‹ä»£ç 1:å¯¹è±¡æœ¬èº«å‘ç”Ÿå˜åŒ–çš„æ—¶å€™,é‚£ä¹ˆå¯¹è±¡æŒæœ‰çš„é”å°±å‘ç”Ÿå˜åŒ– 12345678910111213141516171819202122232425262728293031323334353637383940414243public class ChangeLock &#123; private String lock = \"lock\"; private void method() &#123; synchronized (lock) &#123; try &#123; System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"å¼€å§‹\"); // è¿™é‡ŒæŠŠé”çš„å†…å®¹æ”¹å˜äº†ï¼Œå› æ­¤t1,t2çº¿ç¨‹åŸºæœ¬åŒæ—¶è¿›æ¥ï¼Œè€Œä¸æ˜¯t1ä¼‘çœ 2ç§’åï¼Œt2è¿›æ¥ lock = \"change lock\"; Thread.sleep(2000); System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \"ç»“æŸ\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; final ChangeLock changeLock = new ChangeLock(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; changeLock.method(); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; changeLock.method(); &#125; &#125;, \"t2\"); t1.start(); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; t2.start(); &#125;&#125; 4.2 ç¤ºä¾‹ä»£ç 2:åŒä¸€å¯¹è±¡å±æ€§çš„ä¿®æ”¹ä¸ä¼šå½±å“é”çš„æƒ…å†µ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public class ModifyLock &#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public synchronized void changeAttributte(String name, int age) &#123; try &#123; System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \" å¼€å§‹\"); this.setName(name); this.setAge(age); System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \" ä¿®æ”¹å¯¹è±¡å†…å®¹ä¸ºï¼š \" + this.getName() + \", \" + this.getAge()); Thread.sleep(2000); System.out.println(\"å½“å‰çº¿ç¨‹ : \" + Thread.currentThread().getName() + \" ç»“æŸ\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; final ModifyLock modifyLock = new ModifyLock(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; modifyLock.changeAttributte(\"è®¸è¿›\", 25); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; modifyLock.changeAttributte(\"æå››X\", 21); &#125; &#125;, \"t2\"); t1.start(); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; t2.start(); &#125;&#125; è¿è¡Œç»“æœ: 123456å½“å‰çº¿ç¨‹ : t1 å¼€å§‹å½“å‰çº¿ç¨‹ : t1 ä¿®æ”¹å¯¹è±¡å†…å®¹ä¸ºï¼š è®¸è¿›, 25å½“å‰çº¿ç¨‹ : t1 ç»“æŸå½“å‰çº¿ç¨‹ : t2 å¼€å§‹å½“å‰çº¿ç¨‹ : t2 ä¿®æ”¹å¯¹è±¡å†…å®¹ä¸ºï¼š æå››X, 21å½“å‰çº¿ç¨‹ : t2 ç»“æŸ","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ€»ç»“ä¹‹å¤šçº¿ç¨‹åŸºç¡€","slug":"bf/bf-multithread","date":"2016-07-21T13:00:00.000Z","updated":"2019-01-13T05:26:46.838Z","comments":true,"path":"bf/bf-multithread/","link":"","permalink":"http://xujin.org/bf/bf-multithread/","excerpt":"çº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨æ¦‚å¿µ å½“å¤šä¸ªçº¿ç¨‹è®¿é—®è®¿é—®æŸä¸€ä¸ªç±»(å¯¹è±¡æˆ–æ–¹æ³•)æ—¶ï¼Œè¿™ä¸ªç±»æˆ–å¯¹è±¡æˆ–æ–¹æ³•å§‹ç»ˆèƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºæˆ–æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªç±»(å¯¹è±¡æˆ–æ–¹æ³•)å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ synchronizedï¼šå¯ä»¥åœ¨ä»»æ„çš„å¯¹è±¡åŠæ–¹æ³•ä¸ŠåŠ é”ï¼Œè€ŒåŠ é”çš„è¿™æ®µä»£ç ç§°ä¹‹ä¸ºäº’æ–¥åŒºæˆ–è€…ä¸´ç•ŒåŒºã€‚ä»£ç ç¤ºä¾‹è¯´æ˜1è¿è¡Œmainæ–¹æ³•ï¼Œmainæ–¹æ³•é‡Œæœ‰5ä¸ªçº¿ç¨‹t1åˆ°t5ï¼ŒåŒä¸€æ—¶é—´å¯åŠ¨å»è®¿é—®MyThreadç±»çš„Runæ–¹æ³•ã€‚","text":"çº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨æ¦‚å¿µ å½“å¤šä¸ªçº¿ç¨‹è®¿é—®è®¿é—®æŸä¸€ä¸ªç±»(å¯¹è±¡æˆ–æ–¹æ³•)æ—¶ï¼Œè¿™ä¸ªç±»æˆ–å¯¹è±¡æˆ–æ–¹æ³•å§‹ç»ˆèƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºæˆ–æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªç±»(å¯¹è±¡æˆ–æ–¹æ³•)å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ synchronizedï¼šå¯ä»¥åœ¨ä»»æ„çš„å¯¹è±¡åŠæ–¹æ³•ä¸ŠåŠ é”ï¼Œè€ŒåŠ é”çš„è¿™æ®µä»£ç ç§°ä¹‹ä¸ºäº’æ–¥åŒºæˆ–è€…ä¸´ç•ŒåŒºã€‚ä»£ç ç¤ºä¾‹è¯´æ˜1è¿è¡Œmainæ–¹æ³•ï¼Œmainæ–¹æ³•é‡Œæœ‰5ä¸ªçº¿ç¨‹t1åˆ°t5ï¼ŒåŒä¸€æ—¶é—´å¯åŠ¨å»è®¿é—®MyThreadç±»çš„Runæ–¹æ³•ã€‚ ä¸åŠ synchronizedå…³é”®å­—ä¿®é¥°run()æ–¹æ³•çš„ä»£ç 1234567891011121314151617181920212223242526272829package org.xujin.multithread;public class MyThread extends Thread &#123; private int count = 5; public void run() &#123; count--; System.out.println(this.currentThread().getName() + \" count = \" + count); &#125; public static void main(String[] args) &#123; /** * åˆ†æï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®myThreadçš„runæ–¹æ³•æ—¶ï¼Œä»¥æ’é˜Ÿçš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼ˆè¿™é‡Œæ’å¯¹æ˜¯æŒ‰ç…§CPUåˆ†é…çš„å…ˆåé¡ºåºè€Œå®šçš„ï¼‰ï¼Œ ä¸€ä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œsynchronizedä¿®é¥°çš„æ–¹æ³•é‡Œçš„ä»£ç ï¼š 1 å°è¯•è·å¾—é” 2 * å¦‚æœæ‹¿åˆ°é”ï¼Œæ‰§è¡Œsynchronizedä»£ç ä½“å†…å®¹ï¼›æ‹¿ä¸åˆ°é”ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šä¸æ–­çš„å°è¯•è·å¾—è¿™æŠŠé”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ï¼Œ è€Œä¸”æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶å»ç«äº‰è¿™æŠŠé”ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä¼šæœ‰é”ç«äº‰çš„é—®é¢˜ï¼‰ */ MyThread myThread = new MyThread(); Thread t1 = new Thread(myThread, \"t1\"); Thread t2 = new Thread(myThread, \"t2\"); Thread t3 = new Thread(myThread, \"t3\"); Thread t4 = new Thread(myThread, \"t4\"); Thread t5 = new Thread(myThread, \"t5\"); t1.start(); t2.start(); t3.start(); t4.start(); t5.start(); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œæ²¡æœ‰å‡ºç°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ,æ‰“å°å‡ºæ¥çš„çº¿ç¨‹åæ˜¯æ— åºçš„ countå€¼ä¹Ÿæ²¡æŒ‰æ­£å¸¸â€“ï¼Œè¿è¡Œå¤šæ¬¡ä¸èƒ½ä¿è¯countæ‰“å°çš„å€¼æ¯æ¬¡ä¸€è‡´ï¼Œå› æ­¤å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚12345t1 count = 2t2 count = 2t5 count = 0t3 count = 2t4 count = 1 ä»£ç ç¤ºä¾‹è¯´æ˜2 å½“æˆ‘ä»¬åŠ ä¸Šsynchronizedå…³é”®å­—ä¿®é¥°run()æ–¹æ³•åï¼Œä»£ç å¦‚ä¸‹ã€‚ 123456789101112131415161718192021222324252627public class MyThread extends Thread &#123; private int count = 5; public synchronized void run() &#123; count--; System.out.println(this.currentThread().getName() + \" count = \" + count); &#125; public static void main(String[] args) &#123; /** * åˆ†æï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®myThreadçš„runæ–¹æ³•æ—¶ï¼Œä»¥æ’é˜Ÿçš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼ˆè¿™é‡Œæ’å¯¹æ˜¯æŒ‰ç…§CPUåˆ†é…çš„å…ˆåé¡ºåºè€Œå®šçš„ï¼‰ï¼Œ ä¸€ä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œsynchronizedä¿®é¥°çš„æ–¹æ³•é‡Œçš„ä»£ç ï¼š 1 å°è¯•è·å¾—é” 2 * å¦‚æœæ‹¿åˆ°é”ï¼Œæ‰§è¡Œsynchronizedä»£ç ä½“å†…å®¹ï¼›æ‹¿ä¸åˆ°é”ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šä¸æ–­çš„å°è¯•è·å¾—è¿™æŠŠé”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ï¼Œ è€Œä¸”æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶å»ç«äº‰è¿™æŠŠé”ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä¼šæœ‰é”ç«äº‰çš„é—®é¢˜ï¼‰ */ MyThread myThread = new MyThread(); Thread t1 = new Thread(myThread, \"t1\"); Thread t2 = new Thread(myThread, \"t2\"); Thread t3 = new Thread(myThread, \"t3\"); Thread t4 = new Thread(myThread, \"t4\"); Thread t5 = new Thread(myThread, \"t5\"); t1.start(); t2.start(); t3.start(); t4.start(); t5.start(); &#125;&#125; åŠ ä¸Šsynchronizedè¿è¡Œç»“æœå¦‚ä¸‹ï¼Œçº¿ç¨‹åæ— åºï¼Œæ— è®ºä½ æ‰§è¡Œå¤šå°‘æ¬¡ç¨‹åºï¼Œcountâ€“çš„å€¼éƒ½æ˜¯æ˜¾ç¤ºæˆ‘ä»¬æƒ³è¦çš„æ­£ç¡®ç»“æœã€‚ 12345t1 count = 4t3 count = 3t4 count = 2t5 count = 1t2 count = 0 å°ç»“ å½“å¤šä¸ªçº¿ç¨‹è®¿é—®Mythreadçš„runæ–¹æ³•æ—¶ï¼Œä»¥æ’é˜Ÿçš„æ–¹å¼è¿›è¡Œå¤„ç†(æ’é˜Ÿçš„æ–¹å¼æ˜¯æŒ‰ç…§CPUåˆ†é…çš„é¥¿å…ˆåé¡ºåºè€Œå®šçš„)ï¼Œä¸€ä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œsynchronizedä¿®é¥°çš„æ–¹æ³•é‡Œçš„ä»£ç ï¼Œé¦–å…ˆå°è¯•è·å¾—é”ï¼Œå¦‚æœæ‹¿åˆ°é”ï¼Œæ‰§è¡Œsynchronizedä¸­ä»£ç ä½“å†…å®¹;æ‹¿ä¸åˆ°é”ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šä¸æ–­çš„å°è¯•è·å¾—è¿™æŠŠé”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ï¼Œè€Œä¸”æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶å»ç«äº‰è¿™æŠŠé”ï¼Œä¹Ÿå°±æ˜¯ä¼šæœ‰ç«äº‰é”çš„é—®é¢˜ã€‚ å¤šä¸ªçº¿ç¨‹å¤šä¸ªé”å¤šä¸ªçº¿ç¨‹å¤šä¸ªé”:å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥æ‹¿åˆ°è‡ªå·±æŒ‡å®šçš„é”ï¼Œåˆ†åˆ«è·å¾—é”ä¹‹åï¼Œæ‰§è¡Œsynchronizedæ–¹æ³•ä½“çš„å†…å®¹ã€‚ ä»£ç ç¤ºä¾‹è¯´æ˜1 ä¸¤ä¸ªçº¿ç¨‹t1,t2åˆ†åˆ«ä¾æ¬¡startï¼Œè®¿é—®ä¸¤ä¸ªå¯¹è±¡çš„synchronizedä¿®é¥°çš„printNumæ–¹æ³•ï¼ŒCodeå¦‚ä¸‹:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * å…³é”®å­—synchronizedå–å¾—çš„é”éƒ½æ˜¯å¯¹è±¡é”ï¼Œè€Œä¸æ˜¯æŠŠä¸€æ®µä»£ç ï¼ˆæ–¹æ³•ï¼‰å½“åšé”ï¼Œ * æ‰€ä»¥ä»£ç ä¸­å“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œsynchronizedå…³é”®å­—çš„æ–¹æ³•ï¼Œå“ªä¸ªçº¿ç¨‹å°±æŒæœ‰è¯¥æ–¹æ³•æ‰€å±å¯¹è±¡çš„é”ï¼ˆLockï¼‰ï¼Œ * * åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ synchronizedå…³é”®å­—ï¼Œè¡¨ç¤ºé”å®š.classç±»ï¼Œç±»ä¸€çº§åˆ«çš„é”ï¼ˆç‹¬å .classç±»ï¼‰ã€‚ * @author xujin * */public class MultiThread &#123; private int num = 0; public synchronized void printNum(String tag) &#123; try &#123; if (tag.equals(\"a\")) &#123; num = 100; System.out.println(\"tag a, set num over!\"); Thread.sleep(1000); &#125; else &#123; num = 200; System.out.println(\"tag b, set num over!\"); &#125; System.out.println(\"tag \" + tag + \", num = \" + num); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // æ³¨æ„è§‚å¯Ÿrunæ–¹æ³•è¾“å‡ºé¡ºåº public static void main(String[] args) &#123; // ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ final MultiThread m1 = new MultiThread(); final MultiThread m2 = new MultiThread(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; m1.printNum(\"a\"); &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; m2.printNum(\"b\"); &#125; &#125;); t1.start(); t2.start(); &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹:1234tag a, set num over!tag b, set num over!tag b, num = 200tag a, num = 100 å…³é”®å­—synchronizedå–å¾—çš„é”éƒ½æ˜¯å¯¹è±¡é”ï¼Œè€Œä¸æ˜¯æŠŠä¸€æ®µä»£ç ï¼ˆæ–¹æ³•ï¼‰å½“åšé”ï¼Œæ‰€ä»¥ä»£ç ä¸­å“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œsynchronizedå…³é”®å­—çš„æ–¹æ³•ï¼Œå“ªä¸ªçº¿ç¨‹å°±æŒæœ‰è¯¥æ–¹æ³•æ‰€å±å¯¹è±¡çš„é”ï¼ˆLockï¼‰ ä»£ç ç¤ºä¾‹è¯´æ˜2 åœ¨é™æ€æ–¹æ³•ä¸ŠprintNumï¼ˆï¼‰åŠ ä¸€ä¸ªsynchronizedå…³é”®å­—ä¿®é¥°çš„è¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹è°ƒç”¨printNum()è·å¾—é”ï¼Œå°±æ˜¯è¿™ä¸ªç±»çº§åˆ«çš„é”ã€‚è¿™æ˜¯æ—¶å€™æ— è®ºä½ å®ä¾‹åŒ–å‡ºå¤šå°‘ä¸ªå¯¹è±¡m1,m2éƒ½æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œä»£ç Demoå¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class MultiThread &#123; // â‘¡ä¿®æ”¹ä¸ºstaticå…³é”®å­—ä¿®é¥° private static int num = 0; // â‘ ä¿®æ”¹ä¸ºstaticä¿®é¥°è¯¥æ–¹æ³• public static synchronized void printNum(String tag) &#123; try &#123; if (tag.equals(\"a\")) &#123; num = 100; System.out.println(\"tag a, set num over!\"); Thread.sleep(1000); &#125; else &#123; num = 200; System.out.println(\"tag b, set num over!\"); &#125; System.out.println(\"tag \" + tag + \", num = \" + num); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // æ³¨æ„è§‚å¯Ÿrunæ–¹æ³•è¾“å‡ºé¡ºåº public static void main(String[] args) &#123; // ä¿©ä¸ªä¸åŒçš„å¯¹è±¡ final MultiThread m1 = new MultiThread(); final MultiThread m2 = new MultiThread(); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; m1.printNum(\"a\"); &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; m2.printNum(\"b\"); &#125; &#125;); t1.start(); t2.start(); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹,å¯ä»¥çœ‹å‡ºt1æ‰§è¡Œå®Œäº†ï¼Œç„¶åæ‰§è¡Œt2,ä»–ä»¬ä¹‹é—´æœ‰ä¸€ä¸ªé¡ºåº1234tag a, set num over!tag a, num = 100tag b, set num over!tag b, num = 200 å¤šä¸ªçº¿ç¨‹å¤šä¸ªé”å°ç»“ å…³é”®å­—synchronizedå–å¾—çš„é”éƒ½æ˜¯å¯¹è±¡é”ï¼Œè€Œä¸æ˜¯æŠŠä¸€æ®µä»£ç æˆ–æ–¹æ³•å½“åšé”ï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­ä»£ç ä¸­çš„å“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œsynchronizedå…³é”®å­—çš„æ–¹æ³•ï¼Œå“ªä¸ªçº¿ç¨‹å°±æŒæœ‰è¯¥æ–¹æ³•å¯¹è±¡çš„é”ï¼Œä¹Ÿå°±æ˜¯Lock,ä¸¤ä¸ªå¯¹è±¡ï¼Œçº¿ç¨‹è·å¾—çš„å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„é”ï¼Œä»–ä»¬äº’ä¸å½±å“ã€‚ æœ‰ä¸€ç§æƒ…å†µåˆ™æ˜¯ç›¸åŒçš„é”ï¼Œå³åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ synchronizedå…³é”®å­—ï¼Œè¡¨ç¤ºé”å®š.classç±»ï¼Œç±»ä¸€çº§åˆ«çš„é”ç‹¬å .classç±»ã€‚ å¯¹è±¡é”çš„åŒæ­¥å’Œå¼‚æ­¥é”åŒæ­¥å’Œå¼‚æ­¥çš„æ¦‚å¿µ åŒæ­¥-synchronized åŒæ­¥çš„æ¦‚å¿µå°±æ˜¯å…±äº«ï¼Œéœ€è¦è®°ä½å…±äº«è¿™ä¸ªæ¦‚å¿µï¼Œå¦‚æœä¸æ˜¯å…±äº«çš„èµ„æºï¼Œå°±æ²¡æœ‰å¿…è¦åŒæ­¥ã€‚ å¼‚æ­¥-asynchronized å¼‚æ­¥æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´ä¸å—ä»»ä½•çº¦åˆ¶ï¼Œç±»ä¼¼äºhttpä¸­çš„Ajaxè¯·æ±‚ã€‚ åŒæ­¥çš„ç›®çš„å°±æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œå…¶å®å¯¹äºçº¿ç¨‹å®‰å…¨æ¥è¯´ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ï¼Œå¯è§æ€§ã€‚ ä»£ç ç¤ºä¾‹11234567891011121314151617181920212223242526272829303132333435363738394041424344public class TestObject &#123; /** synchronized */ public synchronized void method1() &#123; try &#123; System.out.println(Thread.currentThread().getName()); //ä¼‘çœ 4ç§’ Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public void method2() &#123; System.out.println(Thread.currentThread().getName()); &#125; public static void main(String[] args) &#123; final TestObject mo = new TestObject(); /** * åˆ†æï¼š t1çº¿ç¨‹å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¯ä»¥ä»¥å¼‚æ­¥çš„æ–¹å¼è°ƒç”¨å¯¹è±¡ä¸­çš„ésynchronizedä¿®é¥°çš„æ–¹æ³• * t1çº¿ç¨‹å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨å¯¹è±¡ä¸­çš„åŒæ­¥ï¼ˆsynchronizedï¼‰æ–¹æ³•åˆ™éœ€ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥ */ Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; mo.method1(); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; mo.method2(); &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå› ä¸ºt1,t2ä¸¤ä¸ªçº¿ç¨‹è®¿é—®TestObjectå¯¹è±¡çš„moçš„method1ï¼Œmethod2æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ç›´æ¥æ‰“å‡ºã€‚12t2t1 åˆ†æï¼š t1çº¿ç¨‹è‹¥å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¯ä»¥ä»¥å¼‚æ­¥çš„æ–¹å¼è°ƒç”¨å¯¹è±¡ä¸­çš„ésynchronizedä¿®é¥°çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯å¼‚æ­¥ã€‚ ä»£ç ç¤ºä¾‹2æŠŠä¸Šé¢ä»£ç ä¸­çš„method2ï¼Œä¹ŸåŠ ä¸Šsynchronizedå»ä¿®é¥°ï¼Œä»£ç å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344public class TestObject &#123; public synchronized void method1() &#123; try &#123; System.out.println(Thread.currentThread().getName()); Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; /** åŠ ä¸Šsynchronizedä¿®é¥°method2 */ public synchronized void method2() &#123; System.out.println(Thread.currentThread().getName()); &#125; public static void main(String[] args) &#123; final TestObject mo = new TestObject(); /** * åˆ†æï¼š t1çº¿ç¨‹å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¯ä»¥ä»¥å¼‚æ­¥çš„æ–¹å¼è°ƒç”¨å¯¹è±¡ä¸­çš„ésynchronizedä¿®é¥°çš„æ–¹æ³• * t1çº¿ç¨‹å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨å¯¹è±¡ä¸­çš„åŒæ­¥ï¼ˆsynchronizedï¼‰æ–¹æ³•åˆ™éœ€ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥ */ Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; mo.method1(); &#125; &#125;, \"t1\"); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; mo.method2(); &#125; &#125;, \"t2\"); t1.start(); t2.start(); &#125;&#125; æ‰“å°ç»“æœå¦‚ä¸‹,ç”±äºCPUéšæœºåˆ†é…ï¼Œè‹¥t1çº¿ç¨‹å…ˆæ‰§è¡Œï¼Œå…ˆæ‰“å°t1,ç„¶åt1çº¿ç¨‹å…ˆä¼‘çœ 4sï¼Œåé‡Šæ”¾äº†Lockï¼Œç„¶åæ‰“å°t2ã€‚12t1t2 t1çº¿ç¨‹å…ˆæŒæœ‰TestObjectå¯¹è±¡çš„Locké”ï¼Œt2çº¿ç¨‹å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨å¯¹è±¡ä¸­çš„åŒæ­¥ï¼ˆsynchronizedï¼‰æ–¹æ³•åˆ™éœ€ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥","categories":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/categories/å¹¶å‘ç¼–ç¨‹/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"http://xujin.org/tags/å¹¶å‘ç¼–ç¨‹/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xujin.org/tags/å¤šçº¿ç¨‹/"}]},{"title":"Bean Mappingä¹‹Orikaçš„é¡¹ç›®è¿ç”¨","slug":"venus/venus-orika","date":"2016-07-09T06:00:00.000Z","updated":"2019-01-13T05:40:11.187Z","comments":true,"path":"venus/venus-orika/","link":"","permalink":"http://xujin.org/venus/venus-orika/","excerpt":"å‰è¨€ åœ¨JavaEEå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæŠŠæŒä¹…å±‚çš„å®ä½“å¯¹è±¡copyç»™VOï¼ŒBOç­‰ï¼Œç”¨äºå¿«é€Ÿå°†æŒä¹…å±‚ä¸­çš„å¯¹è±¡é‡Šæ”¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½†å¾ˆå¤šæ—¶å€™BOï¼ŒVOå’ŒEntityçš„ç»“æ„éƒ½æ˜¯ç±»ä¼¼çš„ã€‚åˆšå¼€å§‹é€šè¿‡å†™å¾ˆå¤šå†—é•¿çš„b.setF1(a.getF1())è¿™æ ·çš„ä»£ç æ¥å®ç°å¯¹è±¡çš„Copyï¼Œåæ¥é€æ¸å»¶ä¼¸å‡ºSpring BeanUtilsï¼Œ CgLib BeanCopier, Apache BeanUtils, Dozerç­‰å¿«é€Ÿå®ä½“æ˜ å°„å·¥å…·jarã€‚æ€§èƒ½å¯¹æ¯”å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« :http://www.cnblogs.com/kaka/archive/2013/03/06/2945514.html","text":"å‰è¨€ åœ¨JavaEEå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæŠŠæŒä¹…å±‚çš„å®ä½“å¯¹è±¡copyç»™VOï¼ŒBOç­‰ï¼Œç”¨äºå¿«é€Ÿå°†æŒä¹…å±‚ä¸­çš„å¯¹è±¡é‡Šæ”¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½†å¾ˆå¤šæ—¶å€™BOï¼ŒVOå’ŒEntityçš„ç»“æ„éƒ½æ˜¯ç±»ä¼¼çš„ã€‚åˆšå¼€å§‹é€šè¿‡å†™å¾ˆå¤šå†—é•¿çš„b.setF1(a.getF1())è¿™æ ·çš„ä»£ç æ¥å®ç°å¯¹è±¡çš„Copyï¼Œåæ¥é€æ¸å»¶ä¼¸å‡ºSpring BeanUtilsï¼Œ CgLib BeanCopier, Apache BeanUtils, Dozerç­‰å¿«é€Ÿå®ä½“æ˜ å°„å·¥å…·jarã€‚æ€§èƒ½å¯¹æ¯”å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« :http://www.cnblogs.com/kaka/archive/2013/03/06/2945514.html orika-mapperå¿«é€Ÿé«˜æ•ˆæ˜ å°„æ¡†æ¶ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å‹æ˜ å°„ï¼Ÿ å¤šæ¬¡æ¨¡å‹, å¯ä»¥ä¿è¯å†…éƒ¨å®ä½“ä¸è¢«ç›´æ¥æš´éœ², ä¹Ÿå¯ä½¿å¾—æ¥å£å±‚æ¨¡å‹æ›´ä¸ºç‹¬ç«‹, è§£è€¦å®ä½“å±‚æ¨¡å‹ã€‚Bean Mappingç”¨äºå¿«é€Ÿï¼Œé«˜æ€§èƒ½çš„å¯¹ä¸¤ä¸ªPOJOå¯¹è±¡åšæ•°æ®åŒå‘æ˜ å°„ã€‚ Orkiaçš„è®¾è®¡æ€è·¯github:https://github.com/orika-mapper/orikadoc:http://orika-mapper.github.io/orika-docs/ Orikaä½¿ç”¨javaassistæå‰ç”Ÿæˆæ‹·è´ä»£ç  ä¼˜åŠ¿ï¼šé¿å…ä½¿ç”¨åå°„å’Œå¤šæ¬¡è¯»å–æ˜ å°„è§„åˆ™ï¼Œæ€§èƒ½é«˜å†…å­˜æ¶ˆè€—ä½ Orika çš„è®¾è®¡æ€è·¯å°±æ˜¯é¢„å…ˆé€šè¿‡javaassist æŠŠJava Bean ä¹‹é—´çš„æ˜ å°„å…³ç³»ä¸€æ¬¡æ€§ç”Ÿæˆç›®æ ‡æ‹·è´æ–¹æ³•ä»£ç ã€‚ è¿™æ ·å°±å¯ä»¥é¿å…åœ¨Bean æ˜ å°„ç¯èŠ‚ä¸€æ¬¡æ¬¡çš„è¯»å–æ˜ å°„è§„åˆ™ã€‚ è¿™å°±æ˜¯Orika æ€§èƒ½æå‡çš„åŸå› ã€‚ç†è®ºä¸Šä»¥ç”Ÿæˆçš„ç›®æ ‡Java ä»£ç æ¥è¿è¡Œæ˜ å°„æ˜¯æ‹·è´æ¨¡å¼æ‰€èƒ½å–åˆ°æ€§èƒ½æœ€å¤§å€¼çš„æ–¹æ³•ã€‚ é€šè¿‡è‡ªå®šä¹‰æ³¨è§£çš„æ–¹å¼ï¼ŒOrikaä¸Springæ¡†æ¶æ•´åˆ(åœ¨è¿™é‡Œä¸æè¿°æ˜¯å¦‚ä½•è‡ªå®šä¹‰æ•´åˆä½¿ç”¨)ï¼Œè¾¾åˆ°é«˜æ€§èƒ½çš„æ¨¡å‹æ˜ å°„ï¼Œæ”¯æŒæ— é…ç½®æ˜ å°„ï¼Œæ”¯æŒå¤æ‚æ˜ å°„ï¼Œæ”¯æŒè‡ªå®šä¹‰ç±»å‹è½¬æ¢ã€‚ åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å¦‚ä¸‹: åœ¨applicationContext.xmlæ–‡ä»¶ä¸­ï¼Œé…ç½®Modelçš„é€šé…ç¬¦æ‰«æåŒ…è·¯å¾„ 123 &lt;bean id=\"orikaBeanMapper\" class=\"com.xxxxx.xxxxx.core.beans.mapping.orika.OrikaBeanMapper\"&gt; &lt;property name=\"basePackage\" value=\"com.xxxxx.financing.model.**\"&gt;&lt;/property&gt;&lt;/bean&gt; åœ¨éœ€è¦copyçš„åœ°æ–¹ä¾èµ–æ³¨å…¥ 1234 @Autowiredprivate BeanMapper beanMapper; beanMapper.map(financingAccountModel, FinancingAccount.class) entityä¸Šæ³¨è§£é…ç½®å¦‚ä¸‹ï¼Œæ­¤å¤„çœç•¥get setæ–¹æ³•ã€‚ 123456789 @MapClass(value=\"com.xxx.financing.database.model.FinancingAccountModel\")public class FinancingAccount &#123; private Long id; private String userId; private String userName; &#125;","categories":[{"name":"venus","slug":"venus","permalink":"http://xujin.org/categories/venus/"}],"tags":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"Venus Framework","slug":"Venus-Framework","permalink":"http://xujin.org/tags/Venus-Framework/"}]},{"title":"åœ¨STSæˆ–eclipseä¸­å®‰è£…Lombokå¹¶ä½¿ç”¨","slug":"ex/lombok","date":"2016-01-03T06:00:00.000Z","updated":"2019-01-13T05:19:55.635Z","comments":true,"path":"ex/lombok/","link":"","permalink":"http://xujin.org/ex/lombok/","excerpt":"lombok æä¾›äº†ç®€å•çš„æ³¨è§£çš„å½¢å¼æ¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¶ˆé™¤ä¸€äº›å¿…é¡»æœ‰ä½†æ˜¾å¾—å¾ˆè‡ƒè‚¿çš„ java ä»£ç ã€‚ç‰¹åˆ«æ˜¯ç›¸å¯¹äº POJOï¼Œä½¿ç”¨ç›¸åº”çš„æ³¨è§£å¯ä»¥ç®€åŒ–æ•´ä¸ªä»£ç ã€‚lombok çš„å®˜æ–¹ç½‘å€ï¼šhttp://projectlombok.org/ ,ä»å®˜ç½‘ä¸‹è½½","text":"lombok æä¾›äº†ç®€å•çš„æ³¨è§£çš„å½¢å¼æ¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¶ˆé™¤ä¸€äº›å¿…é¡»æœ‰ä½†æ˜¾å¾—å¾ˆè‡ƒè‚¿çš„ java ä»£ç ã€‚ç‰¹åˆ«æ˜¯ç›¸å¯¹äº POJOï¼Œä½¿ç”¨ç›¸åº”çš„æ³¨è§£å¯ä»¥ç®€åŒ–æ•´ä¸ªä»£ç ã€‚lombok çš„å®˜æ–¹ç½‘å€ï¼šhttp://projectlombok.org/ ,ä»å®˜ç½‘ä¸‹è½½ ä¸€.å®‰è£…lombok 1.åœ¨STSä¸­å®‰è£…lombok â‘ æ‰¾åˆ°lombok.jarï¼Œæ‰§è¡Œå‘½ä»¤: D:\\devtools&gt;java -jar lombok.jaræˆ–è€…ç›´æ¥åŒå‡»lombok.jar â‘¡ç¡®è®¤å®ŒSTSçš„å®‰è£…è·¯å¾„åï¼Œç‚¹å‡»install/updateæŒ‰é’®ï¼Œå³å¯å®‰è£…å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º â‘¢å®‰è£…å®Œæˆä¹‹åï¼Œè¯·ç¡®è®¤eclipseå®‰è£…è·¯å¾„ä¸‹æ˜¯å¦å¤šäº†ä¸€ä¸ªlombok.jaråŒ…ï¼Œå¹¶ä¸”å…¶ é…ç½®æ–‡ä»¶STS.ini(eclipseæ‰“å¼€eclipse.iniï¼‰ä¸­æ˜¯å¦ æ·»åŠ äº†å¦‚ä¸‹å†…å®¹: -javaagent:lombok.jar -Xbootclasspath/a:lombok.jar å¦‚æœä¸Šé¢çš„ç­”æ¡ˆå‡ä¸ºtrueï¼Œé‚£ä¹ˆæ­å–œä½ å·²ç»å®‰è£…æˆåŠŸï¼Œå¦åˆ™å°†ç¼ºå°‘çš„éƒ¨åˆ†æ·»åŠ åˆ°ç›¸åº”çš„ä½ç½®å³å¯ äºŒ.æµ‹è¯•å®‰è£…lombokæ˜¯å¦æˆåŠŸåˆ›å»ºä¸€ä¸ªJavaç±»ï¼Œå¦‚ä¸‹ï¼Œå°è¯•ä½¿ç”¨ä¸‹é¢ 1234567@Datapublic class User &#123; private String id; private String name; private String userId; private String password; &#125;","categories":[{"name":"tools","slug":"tools","permalink":"http://xujin.org/categories/tools/"}],"tags":[{"name":"Lombok","slug":"Lombok","permalink":"http://xujin.org/tags/Lombok/"}]},{"title":"äº‘è®¡ç®—Saasçš„ç®€å•æè¿°ä»¥åŠå¤šç§Ÿæˆ·å®ç°å’ŒSaaséƒ¨ç½²å›¾","slug":"saas/saas","date":"2015-11-28T06:00:00.000Z","updated":"2019-01-13T05:37:13.960Z","comments":true,"path":"saas/saas/","link":"","permalink":"http://xujin.org/saas/saas/","excerpt":"ä¸€.SAASæ¦‚è¿°ä¸æ¦‚å¿µ1.1 Saasæ¦‚è¿° ä¼ ç»Ÿè½¯ä»¶å¼€å‘æ¨¡å¼æ˜¯è½¯ä»¶å³äº§å“ï¼Œä½†æ˜¯äº‘è®¡ç®—Saasæ˜¯è½¯ä»¶å³æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è½¯ä»¶å°±åƒä½¿ç”¨æœåŠ¡ä¸€æ ·ã€‚SaaSçš„åº”ç”¨è¶Šæ¥è¶Šæµè¡Œäº†ï¼Œå®ƒä½œä¸ºè¶Šæ¥è¶Šå¤šçš„å…¬æœ‰äº‘æä¾›åŸºç¡€çš„åº”ç”¨å¹³å°æœåŠ¡ï¼Œæœ‰æ•ˆå‡å°‘ä¸­å°ä¼ä¸šçš„å‰æœŸæŠ•å…¥åŠè¿è¥æˆæœ¬ï¼Œä½¿å¾—ä¸­å°ä¼ä¸šåœ¨æˆç«‹å‘å±•è¿‡ç¨‹ä¸­ï¼ŒæŠŠæ›´å¤šçš„ç²¾åŠ›æŠ•å…¥äºå‘å±•ä¸šåŠ¡ï¼Œæ›´å¤šçš„ä¿¡æ¯åŒ–ç®¡ç†ä¸ç”¨å…³æ³¨ã€‚","text":"ä¸€.SAASæ¦‚è¿°ä¸æ¦‚å¿µ1.1 Saasæ¦‚è¿° ä¼ ç»Ÿè½¯ä»¶å¼€å‘æ¨¡å¼æ˜¯è½¯ä»¶å³äº§å“ï¼Œä½†æ˜¯äº‘è®¡ç®—Saasæ˜¯è½¯ä»¶å³æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è½¯ä»¶å°±åƒä½¿ç”¨æœåŠ¡ä¸€æ ·ã€‚SaaSçš„åº”ç”¨è¶Šæ¥è¶Šæµè¡Œäº†ï¼Œå®ƒä½œä¸ºè¶Šæ¥è¶Šå¤šçš„å…¬æœ‰äº‘æä¾›åŸºç¡€çš„åº”ç”¨å¹³å°æœåŠ¡ï¼Œæœ‰æ•ˆå‡å°‘ä¸­å°ä¼ä¸šçš„å‰æœŸæŠ•å…¥åŠè¿è¥æˆæœ¬ï¼Œä½¿å¾—ä¸­å°ä¼ä¸šåœ¨æˆç«‹å‘å±•è¿‡ç¨‹ä¸­ï¼ŒæŠŠæ›´å¤šçš„ç²¾åŠ›æŠ•å…¥äºå‘å±•ä¸šåŠ¡ï¼Œæ›´å¤šçš„ä¿¡æ¯åŒ–ç®¡ç†ä¸ç”¨å…³æ³¨ã€‚ ä»ä»¥å‰ä¸­å°ä¼ä¸šä½¿ç”¨åï¼Œä¸­å¤§å‹ä¼ä¸šæ…¢æ…¢ä¹Ÿæ¥å—è¿™ç§æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯å¾®ä¿¡çš„æµè¡Œåï¼Œå¾ˆå¤šä¸­å¤§å‹ä¼ä¸šä¹ŸæŠŠå¯ä»¥å¯¹å¤–çš„æˆ–æˆæƒå¯¹å¤–çš„ä¿¡æ¯ï¼Œé€šè¿‡è‡ªèº«å»ºè®¾çš„å¹³å°æˆ–ç¬¬ä¸‰æ–¹çš„SaaSå¹³å°å‘å¸ƒå‡ºæ¥ï¼Œå€ŸåŠ©å¾®ä¿¡çš„ç¤¾åŒºæœ‹å‹åœˆï¼Œæœ‰æ•ˆæ‰©å±•ä¸šåŠ¡åŠç»´æŠ¤å®¢æˆ·å…³ç³»ã€‚å»ºè®¾åŠç»´æŠ¤è¿™ç§ç¬¬ä¸‰æ–¹çš„å¹³å°ï¼Œæ˜¯ä¼ä¸šå¿…é¡»è¦è€ƒè™‘çš„ï¼Œåƒä¼ ç»Ÿçš„å¾ˆå¤šå¼€å‘å•†ï¼Œå€ŸåŠ©è‡ªèº«çš„å¼€å‘åŠå®¢æˆ·èµ„æºï¼Œæ­£åœ¨æ‰“é€ è‡ªå·±è¡Œä¸šå†…çš„SaaSåº”ç”¨å¹³å°ã€‚è€Œå¤§å‹ä¼ä¸šï¼Œåˆ™è€ƒè™‘å¦‚ä½•é€šè¿‡Saasåº”ç”¨ç»Ÿä¸€è§„èŒƒå…¶ä¸‹çš„åˆ†å…¬å¸æˆ–éƒ¨é—¨çš„ä¸šåŠ¡ç®¡ç†ï¼Œå¸Œæœ›è¾¾åˆ°ä¸šåŠ¡å¯åˆ†æˆ–æ±‡ã€‚ åœ¨è®¾è®¡åŠè¯´æ˜SaaSå¹³å°çš„å®ç°æ–¹æ¡ˆæ—¶ï¼Œ 1.2 SaaSçš„å‡ ä¸ªé‡è¦çš„æ¦‚å¿µæˆ‘ä»¬å…ˆæ¥è¯´æ˜ä¸€ä¸‹ä»¥ä¸‹çš„æ¦‚å¿µï¼š ç§Ÿæˆ·ï¼šè¡¨ç¤ºSaaSçš„ä¸€ä¸ªç‹¬ç«‹æ³•äººç»„ç»‡ï¼Œå¦‚ä¼ä¸šã€å•ä½å’Œå›¢ä½“ç­‰ã€‚ç§Ÿæˆ·åœ¨ç³»ç»Ÿä¸­è¡¨ç°ä¸ºä¸€ä¸ªæ³¨å†Œæœºæ„ç»„ç»‡ã€‚ ç§Ÿæˆ·ç”¨æˆ·ï¼šæ¯ä¸ªç§Ÿæˆ·ä¸‹é¢æœ‰è‹¥å¹²ç”¨æˆ·ï¼Œç”¨æˆ·æ˜¯å®é™…ä½¿ç”¨ç³»ç»Ÿçš„äººã€‚ ç§Ÿæˆ·ç”¨æˆ·ç»„ï¼šæ¯ä¸ªç§Ÿæˆ·ä¼šå¯¹å…¶ä¸‹é¢çš„ç”¨æˆ·è¿›è¡Œåˆ†ç»„ç®¡ç† äºŒ.å¤šç§Ÿæˆ·çš„å®ç°å¤šç§Ÿæˆ·æœ€ä¸»è¦çš„å°±æ˜¯æ•°æ®çš„éš”ç¦»ä¸å…±äº«ï¼Œæ•°æ®éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œå…±äº«ç¨‹åº¦è¶Šä½ã€‚åœ¨ä»¥å¾€å®æ–½è¿‡çš„é¡¹ç›®ä¸­ï¼ŒåŒæ ·æœ‰SaaSçš„ä¸šåŠ¡æ‰©å±•éœ€æ±‚ï¼Œç»†èŠ‚å„æœ‰ä¸åŒï¼Œä½†å®ç°æ–¹å¼æ€»ä½“è€Œè¨€å¯ä»¥å½’çº³ä¸ºä¸‹é¢ä¸¤å¤§ç±»ï¼š 1.ç‹¬ç«‹Schema,å³æ¯ä¸ªç§Ÿæˆ·å•ç‹¬ä¸€å¥—æ•°æ®åº“ ä¼˜ç‚¹æ˜¯:æ•°æ®éš”ç¦»çº§åˆ«ç›¸å¯¹é«˜ï¼Œå¯¹äºæ•°æ®çš„å®‰å…¨æ€§å¾ˆå¥½ã€‚ ç¼ºç‚¹æ˜¯ï¼šæ•°æ®éš”ç¦»çº§åˆ«ç›¸å¯¹é«˜ï¼Œæµªè´¹èµ„æºã€‚æ¯”å¦‚ï¼šå¯¹äºæ³¨å†Œä½¿ç”¨çš„ç”¨æˆ·æ¥è¯´ï¼Œé€šè¿‡æ•°æ®åº“éš”ç¦»å°±æµªè´¹èµ„æºã€‚ 2.å…±äº«Schemaã€é€šè¿‡ç§Ÿæˆ·åŒºåˆ†æ•°æ®ï¼Œæ‰€æœ‰ç§Ÿæˆ·å…±äº«æ•°æ® ç¼ºç‚¹æ˜¯ï¼šæ•°æ®éš”ç¦»çº§åˆ«ç›¸å¯¹ä½ï¼Œæ•°æ®å®‰å…¨æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯è¿™ç§éš”ç¦»æ–¹å¼é€‚åˆåŸºç¡€çš„å…¬å…±çš„æ•°æ®éš”ç¦»ã€‚ ä¸‰.SaaSçš„éƒ¨ç½²æ¨¡å¼ å¦‚å›¾æ‰€ç¤ºï¼ŒSaasç»Ÿä¸€è®¿é—®æœåŠ¡å™¨ä¸ºç»Ÿä¸€ç®¡ç†å…¥å£ï¼Œä¸»è¦ç”¨äºå¯¹Saasæ•´ä¸ªç³»ç»Ÿçš„è¿è¥ç®¡ç†ï¼Œæ¯”å¦‚è®¡è´¹ï¼ŒSaasåº”ç”¨è´­ä¹°ç­‰ç­‰ã€‚ Saasä¸­å¤®æ•°æ®åº“ï¼Œè®°å½•ç€å¤šç»„æˆ·ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç§Ÿæˆ·ç™»é™†æ—¶ï¼ŒSaasç»Ÿä¸€è®¿é—®æœåŠ¡å™¨éªŒè¯checkä¹‹åï¼Œé€šè¿‡åŠ¨æ€æ•°æ®åˆ‡æ¢ï¼Œåˆ‡æ¢åˆ°ç§Ÿæˆ· å¯¹åº”çš„Saasåº”ç”¨ä¸Šå»ã€‚ æ‰€æœ‰ç§Ÿæˆ·çš„è®¿é—®ç»Ÿä¸€åœ°å€ ç§Ÿæˆ·è¦ä½¿ç”¨å¹³å°ï¼Œå…ˆéœ€è¦ç»Ÿä¸€æ³¨å†Œï¼Œæ³¨å†Œä¿¡æ¯å­˜æ”¾åœ¨ä¸­å¤®æ•°æ®åº“ï¼Œç”±å¹³å°çš„ç®¡å‘˜è¿›è¡Œç»Ÿä¸€å®¡æ‰¹ç®¡ç†å‘˜æ ¹æ®çš„ç§Ÿæˆ·çš„ç”¨æˆ·çš„ä½¿ç”¨è§„æ¨¡åŠæ•°æ®é‡ï¼Œé€‰æ‹©æ˜¯å…±äº«æ•°æ®åº“è¿˜æ˜¯ç‹¬ç«‹æ•°æ®åº“ï¼ŒåŒæ—¶æ ¹æ®åº”ç”¨çš„è®¿é—®é‡ï¼Œæ˜¯å¦æ‰©å±•å¤šå°åº”ç”¨æœåŠ¡å™¨ ç›®å‰åœ¨æµè¡Œçš„å¼€å‘è¯­è¨€ä¸­ï¼Œè¦å®ç°è¿™äº›ä¸šåŠ¡ç§Ÿç”¨åŠä¸šåŠ¡æ‰©å±•ï¼Œç›®å‰å‡æ— æ ‡å‡†åŒ–çš„å¼€å‘æ¨¡å¼ï¼Œä»…æœ‰ä¸€äº›å¤§å‹çš„è½¯ä»¶å‚å•†ä¸Šä½œäº†ä¸€äº›äº‘åº”ç”¨çš„å¼€å‘ï¼Œä½†ä»–ä»¬éƒ½ä¸ä¼šå…¬å¼€è¿™äº›å¼€å‘æ¨¡å¼çš„æºä»£ç ã€‚å› æ­¤å¯¹äºä¸€äº›æƒ³å®ç°ç±»ä¼¼ä¸šåŠ¡çš„ä¼ä¸šæˆ–è½¯ä»¶å‚å•†ï¼Œåªèƒ½è‡ªèº«è¿›è¡Œç ”å‘ã€‚ æ ¹æ®ç›®å‰JAVAæµè¡Œçš„è½»é‡çº§æ¡†æ¶è¿›è¡Œå°è£…åŠæ‰©å±•ï¼Œæ‰“é€ é€‚åˆä¸­å›½å›½æƒ…çš„SAASåº”ç”¨å¼€å‘å¹³å°ã€‚è€Œå›½å†…ç›®å‰æ›´å¤šçš„æ˜¯ç§æœ‰äº‘çš„å»ºè®¾ï¼Œå…¬æœ‰äº‘åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šæµè¡Œï¼Œä¹Ÿæ…¢æ…¢è¢«å¾ˆå¤šä¸­å¤§å‹ä¼ä¸šæ¥å—ã€‚å› æ­¤é€šå¸¸ä¼šé€‰æ‹©ä¸¤ç§æ–¹æ¡ˆæ··åˆæ¥å®ç°SaaSåº”ç”¨ï¼Œå³å…±äº«æ•°æ®åº“ä¸ç‹¬ç«‹æ•°æ®åº“ã€‚è€Œå®¢æˆ·åœ¨å®æ–½æ—¶ï¼Œå¯æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ï¼Œè¿›è¡Œé…ç½®ä½¿ç”¨ã€‚ å¦‚ï¼šé›†å›¢éœ€è¦ä¸Šä¸€å¥—CRMï¼Œå³å¯é€‰æ‹©å…±äº«æ•°æ®åº“ï¼Œå› ä¸ºé›†å›¢å†…çš„CRMæ•°æ®éœ€è¦å…±äº«åŠç»Ÿä¸€ç®¡ç†ã€‚è€ŒæŸæ”¿åºœéƒ¨é—¨éœ€è¦ä¸Šä¸€å¥—è¡Œæ”¿å®¡æ‰¹ç³»ç»Ÿï¼Œå…¶å„ä¸ªå­çº§éƒ¨é—¨æ•°æ®éœ€è¦å•ç‹¬åˆ†å‰²å¹¶ä¸å¯è®¿é—®ï¼Œå¹¶ä¸”æœ‰è‡ªèº«çš„ä¸ªæ€§åŒ–è¦æ±‚ï¼Œè¿™æ—¶å»ºè®®é‡‡ç”¨ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼","categories":[{"name":"äº‘è®¡ç®—Saas","slug":"äº‘è®¡ç®—Saas","permalink":"http://xujin.org/categories/äº‘è®¡ç®—Saas/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"},{"name":"äº‘è®¡ç®—SaaS","slug":"äº‘è®¡ç®—SaaS","permalink":"http://xujin.org/tags/äº‘è®¡ç®—SaaS/"}]},{"title":"CloudStackä¸­äº‘ä¸»æœºçš„UTCæ—¶é—´è½¬ä¸ºæœ¬åœ°æ—¶é—´","slug":"ex/cs-utc","date":"2015-04-06T06:00:00.000Z","updated":"2019-01-13T05:18:27.682Z","comments":true,"path":"ex/cs-utc/","link":"","permalink":"http://xujin.org/ex/cs-utc/","excerpt":"CloudStack UTCæ—¶é—´å¤„ç† CloudStacké¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¶é—´æ˜¯UTCæ—¶é—´ï¼Œå…·ä½“ä»€ä¹ˆæ˜¯UTCæ—¶é—´å¤§å®¶å¯ä»¥ç™¾åº¦ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ—¶é—´æ˜¯æ­£å¸¸çš„æ—¶é—´ï¼Œæ‰€ä»¥åœ¨å›½æ³°å›å®‰å¼€å‘æµ‹è¯•äº‘ä¸­ï¼ŒåŒæ­¥èµ„æºç®¡ç†ä¸­è™šæ‹Ÿæœºçš„åŒæ­¥ç®¡ç†ï¼Œéœ€è¦å¯¹è™šæ‹Ÿæœºçš„æ—¶é—´æ ¼å¼åŒ–è¿›è¡Œè½¬æ¢ã€‚å·¥å…·ç±»å¦‚ä¸‹ï¼Œå…³é”®æ˜¯æ—¶é—´æ ¼å¼çš„é—®é¢˜ï¼Œæ—¶é—´æ ¼å¼ä¸ºyyyy-MM-ddâ€™Tâ€™HH:mm:ss+SSSSã€‚","text":"CloudStack UTCæ—¶é—´å¤„ç† CloudStacké¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¶é—´æ˜¯UTCæ—¶é—´ï¼Œå…·ä½“ä»€ä¹ˆæ˜¯UTCæ—¶é—´å¤§å®¶å¯ä»¥ç™¾åº¦ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ—¶é—´æ˜¯æ­£å¸¸çš„æ—¶é—´ï¼Œæ‰€ä»¥åœ¨å›½æ³°å›å®‰å¼€å‘æµ‹è¯•äº‘ä¸­ï¼ŒåŒæ­¥èµ„æºç®¡ç†ä¸­è™šæ‹Ÿæœºçš„åŒæ­¥ç®¡ç†ï¼Œéœ€è¦å¯¹è™šæ‹Ÿæœºçš„æ—¶é—´æ ¼å¼åŒ–è¿›è¡Œè½¬æ¢ã€‚å·¥å…·ç±»å¦‚ä¸‹ï¼Œå…³é”®æ˜¯æ—¶é—´æ ¼å¼çš„é—®é¢˜ï¼Œæ—¶é—´æ ¼å¼ä¸ºyyyy-MM-ddâ€™Tâ€™HH:mm:ss+SSSSã€‚ å·¥å…·ç±»â‘ 12345678910111213public static Date utc2LocalDate(String utcTime) &#123; String utcTimePatten = \"yyyy-MM-dd'T'HH:mm:ss+SSSS\"; SimpleDateFormat sdf = new SimpleDateFormat(utcTimePatten); Date dt = null; try &#123; dt = sdf.parse(utcTime); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; return dt; &#125; å·¥å…·ç±»â‘¡12345678910111213141516171819202122232425262728293031323334353637383940 public class TestUtc &#123; public static void main(String args[]) &#123; try &#123; String ts = \"2015-04-22T15:58:54+0800\"; System.out.println(\"ts = \" + ts); ts = ts.replace(\"Z\", \" UTC\"); System.out.println(\"ts = \" + ts); SimpleDateFormat sdf = new SimpleDateFormat( \"yyyy-MM-dd'T'HH:mm:ss+SSSS\"); Date dt = sdf.parse(ts); TimeZone tz = sdf.getTimeZone(); Calendar c = sdf.getCalendar(); System.out.println(\"Display name: \" + tz.getDisplayName()); System.out.println(getString(c)); &#125; catch (ParseException pe) &#123; System.out.println(\"Error offset: \" + pe.getErrorOffset()); pe.printStackTrace(); &#125; &#125; private static String getString(Calendar c) &#123; StringBuffer result = new StringBuffer(); result.append(c.get(Calendar.YEAR)); result.append(\"-\"); result.append((c.get(Calendar.MONTH) + 1)); result.append(\"-\"); result.append(c.get(Calendar.DAY_OF_MONTH)); result.append(\" \"); result.append(c.get(Calendar.HOUR_OF_DAY)); result.append(\":\"); result.append(c.get(Calendar.MINUTE)); result.append(\":\"); result.append(c.get(Calendar.SECOND)); return result.toString(); &#125; &#125; æµ‹è¯•ç±»1234567891011121314151617 public class TestUtcTime &#123; /** * * @param args * @return void */ public static void main(String[] args) &#123; String ts = \"2015-04-22T15:58:54+0800\"; Date date = new Date(); System.out.println(date); System.out.println(DateUtil.utc2LocalDate(ts)); &#125; &#125;","categories":[{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/categories/é¡¹ç›®ç»éªŒ/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://xujin.org/tags/Java/"},{"name":"é¡¹ç›®ç»éªŒ","slug":"é¡¹ç›®ç»éªŒ","permalink":"http://xujin.org/tags/é¡¹ç›®ç»éªŒ/"}]}]}