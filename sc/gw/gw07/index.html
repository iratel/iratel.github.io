<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>Spring Cloud Gateway中的GatewayFilter和GlobalFilter | 许进沉思录-专注于互联网与中间件基础架构技术研究</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="摘要:本文主要介绍了什么是GatewayFilter和GlobalFilter，以及区别和联系。然后介绍如何在Spring Cloud Gateway中自定义使用GatewayFilter和GlobalFilter。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud Gateway中的GatewayFilter和GlobalFilter">
<meta property="og:url" content="http://xujin.org/sc/gw/gw07/index.html">
<meta property="og:site_name" content="许进沉思录-专注于互联网与中间件基础架构技术研究">
<meta property="og:description" content="摘要:本文主要介绍了什么是GatewayFilter和GlobalFilter，以及区别和联系。然后介绍如何在Spring Cloud Gateway中自定义使用GatewayFilter和GlobalFilter。">
<meta property="og:image" content="http://springcloud-new.oss-cn-shenzhen.aliyuncs.com/91ce199f4af8f4bd9576aace65940253.jpeg?Expires=1842749245&OSSAccessKeyId=LTAI57F52hRuWq3h&Signature=Is0KT0QAVXkPS20EdSPvDqmlxmc%3D">
<meta property="og:image" content="http://springcloud-new.oss-cn-shenzhen.aliyuncs.com/86509f882391c3a20d2f32778dd1c2e9.jpeg?Expires=1842749511&OSSAccessKeyId=LTAI57F52hRuWq3h&Signature=lAd7U0lj4WZ0HMWF9SpbfKJ4aR8%3D">
<meta property="og:updated_time" content="2018-11-03T05:01:05.364Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Cloud Gateway中的GatewayFilter和GlobalFilter">
<meta name="twitter:description" content="摘要:本文主要介绍了什么是GatewayFilter和GlobalFilter，以及区别和联系。然后介绍如何在Spring Cloud Gateway中自定义使用GatewayFilter和GlobalFilter。">
<meta name="twitter:image" content="http://springcloud-new.oss-cn-shenzhen.aliyuncs.com/91ce199f4af8f4bd9576aace65940253.jpeg?Expires=1842749245&OSSAccessKeyId=LTAI57F52hRuWq3h&Signature=Is0KT0QAVXkPS20EdSPvDqmlxmc%3D">
    

    
        <link rel="alternate" href="atom.xml" title="许进沉思录-专注于互联网与中间件基础架构技术研究" type="application/atom+xml" />
    

    
        <link rel="icon" href="/css/images/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
    
    
    


    <script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysVsthGI"></script>
</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">沉思录</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/about">关于我</a>
                
                    <a class="main-nav-link" href="http://springcloud.cn">社区</a>
                
                    <a class="main-nav-link" href="http://halo.xujin.org">Halo</a>
                
                    <a class="main-nav-link" href="http://venusplus.cn">Venus+</a>
                
                    <a class="main-nav-link" href="http://xujin.org/sc/springcloud/">关于社区</a>
                
                    <a class="main-nav-link" href="http://xujin.org/md">工具</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于我</a></td>
                
                    <td><a class="main-nav-link" href="http://springcloud.cn">社区</a></td>
                
                    <td><a class="main-nav-link" href="http://halo.xujin.org">Halo</a></td>
                
                    <td><a class="main-nav-link" href="http://venusplus.cn">Venus+</a></td>
                
                    <td><a class="main-nav-link" href="http://xujin.org/sc/springcloud/">关于社区</a></td>
                
                    <td><a class="main-nav-link" href="http://xujin.org/md">工具</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <!--
       <marquee direction="right" scrollamount="20">
       <img src="/css/images/dog.gif"  alt="Right marquee direction">
       </marquee>
       -->
        <div class="outer">
            
                

<aside id="profile" >
    <div class="inner profile-inner anim-fade-in" >
     <a  target="_blank" href="https://github.com/softwareking"><img style="float:left;width:120px;" src="/css/images/forkme_left_darkblue_121621.png" alt="Fork me on GitHub" data-canonical-src="/css/images/forkme_left_darkblue_121621.png"></a>
        <div class="base-info profile-block">
            <!--<img id="avatar" src="/css/images/avatar.png" />-->
            <div class="ape"></div>
            <h2 id="name">玹霖</h2>
            <h3 id="title" style="margin: 1.6em 0em">Spring Cloud中国社区创始人，入职于阿里,曾入职于唯品会中间件,业余主要研究Spring Cloud。</h3>
            <span id="location"><i class="fa fa-map-marker"></i>上海, 中国</span>
            <a title=" 关于我 " id="follow" target="_blank" href="http://xujin.org/about/">关于我</a>
        </div>
         
        <div class="article-info profile-block">
            <div class="article-info-block">
                <span id="tNum"> 78 </span>
                <span>文章</span>
            </div>
            <div class="article-info-block">
                <span id="tagNum">44</span>
                <span>标签</span>
            </div>
        </div>

        <!--
        <div class="profile-block social-links">
            <table>
                <tbody><tr>
                    
                    <td width="30%">曾就职:</td>
                    <td width="70%" style=“text-align:left;”>
                       
                        <img  style=" width:66px;height:40px;" alt="VIP.com 唯品会" src="/css/images/vip.png">

                        <img  style="width:33px;height:34px;" alt="饿了么" src="http://m.c.lnkd.licdn.com/mpr/mpr/shrinknp_100_100/AAEAAQAAAAAAAAdIAAAAJDNmOTA2YTM1LWYzNWYtNGIzMS1iZmIyLTE0YzJiNDQ3NmQzOQ.png">

                    </td>
                    
                </tr>
            </tbody></table>
        </div>
          -->
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/softwareking" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://git.oschina.net/softwareking" target="_blank" title="git" class=tooltip>
                            <i class="fa fa-git"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://www.linkedin.com/in/xujins" target="_blank" title="linkedin" class=tooltip>
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://weibo.com/softwaremi" target="_blank" title="weibo" class=tooltip>
                            <i class="fa fa-weibo"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://xujin.org/css/images/weixin.jpg" target="_blank" title="wechat" class=tooltip>
                            <i class="fa fa-wechat"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/sitemap.xml" target="_blank" title="sitemap" class=tooltip>
                            <i class="fa fa-sitemap"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        


         <!--
         <div class="profile-block social-links">
            <table>
                <tbody><tr>
                    
                    
                    <td>
                        <a href="https://www.jianshu.com/u/d19536b0189b" target="_blank" title="简书" class="tooltip">
                            <i class="fa fa-简书"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://github.com/hansonwang99" target="_blank" title="gayhub" class="tooltip">
                            <i class="fa fa-gayhub"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/css/images/wechat_qrcode.jpg" target="_blank" title="wx" class="tooltip">
                            <i class="fa fa-wx"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://my.oschina.net/hansonwang99" target="_blank" title="开源中国" class="tooltip">
                            <i class="fa fa-开源中国"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://juejin.im/user/59551ecdf265da6c2518cd5c" target="_blank" title="掘金" class="tooltip">
                            <i class="fa fa-掘金"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://segmentfault.com/u/hansonwang99" target="_blank" title="segmentfault" class="tooltip">
                            <i class="fa fa-segmentfault"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://blog.csdn.net/wangshuaiwsws95" target="_blank" title="csdn" class="tooltip">
                            <i class="fa fa-csdn"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://weibo.com/2089758405/profile?topnav=1&amp;wvr=6&amp;is_all=1#1520088582985" target="_blank" title="新浪微博" class="tooltip">
                            <i class="fa fa-新浪微博"></i>
                        </a>
                    </td>
                    
                </tr>
            </tbody></table>
        </div>
         -->
        
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=52 src="https://music.163.com/outchain/player?type=0&id=494247762&auto=0&height=32"></iframe>
        
    </div>
</aside>

            
            <section id="main">
            <article id="post-sc/gw/gw07" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <script>
function pr() {
    var R = document.getElementById("sidebar");
    var L = document.getElementById("main");
    if (R.className == "sidebar") {
        document.getElementById('sidebar').style.display = "none";
        document.getElementById('profile').style.width = "21%";
        document.getElementById("main").style.width = "75%";
        document.getElementById('myTop').style.display = "inline";
        R.className="sidebarH"
    } else {
        document.getElementById('sidebar').style.display = "inline";
        document.getElementById("main").style.width = "52.307692307692314%";
        R.className = "sidebar";
        document.getElementById('myTop').style.display = "none";
        
    }
}

</script>
    <div id="single-meta">
       <ul>
       <li id="yudus" class="r-hide"><a href="javascript:pr()" onclick="javascript:this.innerHTML=(this.innerHTML=='开启阅读模式'?'关闭阅读模式':'开启阅读模式');">开启阅读模式</a></li>
       </ul>
    </div>
  <script type="text/javascript">
        // borwserRedirect
        (function browserRedirect(){
            var sUserAgent = navigator.userAgent.toLowerCase();
            var bIsIpad = sUserAgent.match(/ipad/i) == 'ipad';
            var bIsIphone = sUserAgent.match(/iphone os/i) == 'iphone os';
            var bIsMidp = sUserAgent.match(/midp/i) == 'midp';
            var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == 'rv:1.2.3.4';
            var bIsUc = sUserAgent.match(/ucweb/i) == 'web';
            var bIsUcw = sUserAgent.match(/ucweb/i) == "ucweb"; 
            var bIsCE = sUserAgent.match(/windows ce/i) == 'windows ce';
            var bIsAndroid = sUserAgent.match(/android/i) == "android"; 
            var bIsWM = sUserAgent.match(/windows mobile/i) == 'windows mobile';
            if(bIsIpad || bIsIphone || bIsMidp || bIsUc7 || bIsUc || bIsCE || bIsWM||bIsUcw||bIsAndroid){
                 document.getElementById("single-meta").style.display = "none";
                  document.getElementById("toc").style.display = "none";
                  document.getElementById("show-toc-btn").style.display = "none";
            }
        })();
</script>

        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Spring Cloud Gateway中的GatewayFilter和GlobalFilter
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/sc/gw/gw07/">
            <time datetime="2018-05-26T06:00:00.000Z" itemprop="datePublished">2018-05-26</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Spring-Cloud-Gateway/">Spring Cloud Gateway</a>
    </div>

                         <div class="article-category" style="text-transform: none;">
    	<i class="fa fa-user"></i>
        
           许进
        
</div>
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Spring-Cloud-Gateway/">Spring Cloud Gateway</a>
    </div>

                        <span id="busuanzi_container_page_pv">
                         阅读<span id="busuanzi_value_page_pv"></span>次
                        </span>
                    </div>
                
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
              
              <p class="show-toc-btn" id="show-toc-btn" onclick="showToc();" style="display:none">
              <span class="btn-bg"></span>
              <span class="btn-text">文章导航</span>
              </p>

            <div id="toc" class="toc-article">
               <span id="toc-close" class="toc-close" title="隐藏导航" onclick="showBtn();">×</span>
                <strong class="toc-title">文章目录</strong>
                   
                     <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Spring-Cloud-gateway的Filter"><span class="toc-text">1. Spring Cloud gateway的Filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-GatewayFilter与GlobalFilter的区别"><span class="toc-text">1.1 GatewayFilter与GlobalFilter的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-本文代码地址"><span class="toc-text">1.2 本文代码地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-GatewayFilter和GlobalFilter"><span class="toc-text">2. GatewayFilter和GlobalFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-GatewayFilter"><span class="toc-text">2.1 GatewayFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-什么是GatewayFilter"><span class="toc-text">2.1.1 什么是GatewayFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2-自定义GatewayFilter-Custom-GatewayFilter"><span class="toc-text">2.1.2 自定义GatewayFilter(Custom GatewayFilter)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Gateway-Filter与RouteLocator绑定使用"><span class="toc-text">2.1.3 Gateway Filter与RouteLocator绑定使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-测试如下"><span class="toc-text">2.1.4 测试如下:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-GlobalFilter"><span class="toc-text">2.2 GlobalFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-什么是GlobalFilter"><span class="toc-text">2.2.1 什么是GlobalFilter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-自定义全局过滤器-Custom-GlobalFilter"><span class="toc-text">2.2.2 自定义全局过滤器(Custom GlobalFilter)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试"><span class="toc-text">测试</span></a></li></ol></li></ol></li></ol>
                   
                   
            </div>

                <script type="text/javascript">
        function showToc(){
            document.getElementById("toc").style.display = "block";
            document.getElementById("show-toc-btn").style.display = "none";
           
            };
        function showBtn(){
            document.getElementById("toc").style.display = "none";
            document.getElementById("show-toc-btn").style.display = "block";
            };
       </script>

            
            <p><strong>摘要</strong>:本文主要介绍了什么是GatewayFilter和GlobalFilter，以及区别和联系。然后介绍如何在Spring Cloud Gateway中自定义使用GatewayFilter和GlobalFilter。</p>
<a id="more"></a>
<h2 id="1-Spring-Cloud-gateway的Filter"><a href="#1-Spring-Cloud-gateway的Filter" class="headerlink" title="1. Spring Cloud gateway的Filter"></a>1. Spring Cloud gateway的Filter</h2><p>Spring Cloud gateway中的Filter从接口实现上分为两种一种是GatewayFilter，另外一种是GlobalFilter。</p>
<h2 id="1-1-GatewayFilter与GlobalFilter的区别"><a href="#1-1-GatewayFilter与GlobalFilter的区别" class="headerlink" title="1.1 GatewayFilter与GlobalFilter的区别"></a>1.1 GatewayFilter与GlobalFilter的区别</h2><p>区别用英语可以总结如下:<br>At a high level global filters are applied to all routes, while a gateway filter will be applied to an individual route(s)</p>
<blockquote>
<p>在一个高的角度来看，Global filters会被应用到所有的路由上，而Gateway filter将应用到<code>单个路由</code>上或者<code>一个分组的路由</code>上。在下面的案例中将会进行说明。</p>
</blockquote>
<h2 id="1-2-本文代码地址"><a href="#1-2-本文代码地址" class="headerlink" title="1.2 本文代码地址"></a>1.2 本文代码地址</h2><blockquote>
<p><a href="https://github.com/SoftwareKing/sc-gateway/tree/master/ch2" target="_blank" rel="external">https://github.com/SoftwareKing/sc-gateway/tree/master/ch2</a></p>
</blockquote>
<h2 id="2-GatewayFilter和GlobalFilter"><a href="#2-GatewayFilter和GlobalFilter" class="headerlink" title="2. GatewayFilter和GlobalFilter"></a>2. GatewayFilter和GlobalFilter</h2><h3 id="2-1-GatewayFilter"><a href="#2-1-GatewayFilter" class="headerlink" title="2.1 GatewayFilter"></a>2.1 GatewayFilter</h3><h4 id="2-1-1-什么是GatewayFilter"><a href="#2-1-1-什么是GatewayFilter" class="headerlink" title="2.1.1 什么是GatewayFilter"></a>2.1.1 什么是GatewayFilter</h4><p>Contract for interception-style, chained processing of Web requests that may be used to implement cross-cutting, application-agnostic requirements such<br> as security, timeouts, and others. Specific to a Gateway Copied from WebFilter</p>
<blockquote>
<p>GatewayFilter是从WebFilter中Copy过来的，相当于一个Filter过滤器，可以对访问的URL过滤横切处理，应用场景比如超时，安全等。</p>
</blockquote>
<p>从Spring Cloud Gateway的源码中如下所示，可以看出GatewayFilter的使用场景:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Contract for interception-style, chained processing of Web requests that may</div><div class="line"> * be used to implement cross-cutting, application-agnostic requirements such</div><div class="line"> * as security, timeouts, and others. Specific to a Gateway</div><div class="line"> *</div><div class="line"> * Copied from WebFilter</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Rossen Stoyanchev</div><div class="line"> * <span class="doctag">@since</span> 5.0</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GatewayFilter</span> <span class="keyword">extends</span> <span class="title">ShortcutConfigurable</span> </span>&#123;</div><div class="line"></div><div class="line">	String NAME_KEY = <span class="string">"name"</span>;</div><div class="line">	String VALUE_KEY = <span class="string">"value"</span>;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Process the Web request and (optionally) delegate to the next</div><div class="line">	 * &#123;<span class="doctag">@code</span> WebFilter&#125; through the given &#123;<span class="doctag">@link</span> GatewayFilterChain&#125;.</div><div class="line">	 * <span class="doctag">@param</span> exchange the current server exchange</div><div class="line">	 * <span class="doctag">@param</span> chain provides a way to delegate to the next filter</div><div class="line">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; to indicate when request processing is complete</div><div class="line">	 */</div><div class="line">	<span class="function">Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>GatewayFilter和GlobalFilter两个接口中定义的方法一样都是Mono<void> filter(ServerWebExchange exchange, GatewayFilterChain chain)，唯一的区别就是GatewayFilter继承了ShortcutConfigurable，GlobalFilter没有任何继承。</void></p>
</blockquote>
<h5 id="2-1-2-自定义GatewayFilter-Custom-GatewayFilter"><a href="#2-1-2-自定义GatewayFilter-Custom-GatewayFilter" class="headerlink" title="2.1.2 自定义GatewayFilter(Custom GatewayFilter)"></a>2.1.2 自定义GatewayFilter(Custom GatewayFilter)</h5><p>如org.xujin.sc.filter.CustomFilter代码所示，通过自定义GatewayFilter对路由转发的处理时长统计。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.xujin.sc.filter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</div><div class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilter;</div><div class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</div><div class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</div><div class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</div><div class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 统计某个或者某种路由的的处理时长</div><div class="line"> * <span class="doctag">@author</span> xujin</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomFilter</span> <span class="keyword">implements</span> <span class="title">GatewayFilter</span>, <span class="title">Ordered</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log log = LogFactory.getLog(GatewayFilter.class);</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String COUNT_Start_TIME = <span class="string">"countStartTime"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</div><div class="line">        exchange.getAttributes().put(COUNT_Start_TIME, System.currentTimeMillis());</div><div class="line">        <span class="keyword">return</span> chain.filter(exchange).then(</div><div class="line">                Mono.fromRunnable(() -&gt; &#123;</div><div class="line">                    Long startTime = exchange.getAttribute(COUNT_Start_TIME);</div><div class="line">                    Long endTime=(System.currentTimeMillis() - startTime);</div><div class="line">                    <span class="keyword">if</span> (startTime != <span class="keyword">null</span>) &#123;</div><div class="line">                        log.info(exchange.getRequest().getURI().getRawPath() + <span class="string">": "</span> + endTime + <span class="string">"ms"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Ordered.LOWEST_PRECEDENCE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-1-3-Gateway-Filter与RouteLocator绑定使用"><a href="#2-1-3-Gateway-Filter与RouteLocator绑定使用" class="headerlink" title="2.1.3 Gateway Filter与RouteLocator绑定使用"></a>2.1.3 Gateway Filter与RouteLocator绑定使用</h4><p>在org.xujin.sc.GatewayServerApplication中customerRouteLocator如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayServerApplication</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> builder.routes()</div><div class="line">                .route(r -&gt; r.path(<span class="string">"/test/prefix/**"</span>)</div><div class="line">                        .filters(f -&gt; f.stripPrefix(<span class="number">2</span>)</div><div class="line">                                .filter(<span class="keyword">new</span> CustomFilter())</div><div class="line">                                .addResponseHeader(<span class="string">"X-Response-test"</span>, <span class="string">"test"</span>))</div><div class="line">                        .uri(<span class="string">"lb://SC-CONSUMER"</span>)</div><div class="line">                        .order(<span class="number">0</span>)</div><div class="line">                        .id(<span class="string">"test_consumer_service"</span>)</div><div class="line">                )</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication.run(GatewayServerApplication.class, args);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>r.path(“/test/prefix/**”)表示自定义了访问前缀，在真正的Gateway进行路由转发的时候，会用过f.stripPrefix(2)把前缀去掉。</p>
<blockquote>
<p>使用场景:可以把对外暴露的URL通过加前缀分组打标。</p>
</blockquote>
</li>
<li><p>filter(new CustomFilter()</p>
<blockquote>
<p>filter(new CustomFilter()，表示把自定义的Filter加到Filter链里面执行，注意一点是自定义GlobalFilter不需要加进去。</p>
</blockquote>
</li>
<li><p>uri(“lb://SC-CONSUMER”)</p>
<blockquote>
<p>uri(“lb://SC-CONSUMER”)表示Spring Cloud Gateway对spring.application.name等于sc-consumer源服务应用中的URL进行协议适配转发。</p>
</blockquote>
</li>
</ol>
<h4 id="2-1-4-测试如下"><a href="#2-1-4-测试如下" class="headerlink" title="2.1.4 测试如下:"></a>2.1.4 测试如下:</h4><p>1.访问<a href="http://localhost:9000/SC-CONSUMER/hello/xujin" target="_blank" rel="external">http://localhost:9000/SC-CONSUMER/hello/xujin</a> 能正常访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping   : Route matched: CompositeDiscoveryClient_SC-CONSUMER</div><div class="line">2018-05-27 09:58:07.905 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping   : Mapping [Exchange: GET http://localhost:9000/SC-CONSUMER/hello/xujin] to Route&#123;id=&apos;CompositeDiscoveryClient_SC-CONSUMER&apos;, uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$337/1295338046@f2ff0c8, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$717/1168359877@1f74a2b, order=1&#125;]&#125;</div><div class="line">2018-05-27 09:58:07.905 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.handler.FilteringWebHandler      : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@f5bf288&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.RewritePathGatewayFilterFactory$$Lambda$717/1168359877@1f74a2b, order=1&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@26c77f54&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@4c38cd16&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@2c1d57bc&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@6e9a0bea&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@7ddcb0dc&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@3e856100&#125;, order=2147483647&#125;]</div></pre></td></tr></table></figure>
<blockquote>
<p>从上面的控制台打印日志可以看出，没有打印出该URL对应的耗时。</p>
</blockquote>
<p>2.加上URL前缀/test/prefix/访问，测试URL为<br><a href="http://localhost:9000/test/prefix/hello/testCustomFilter/xujin" target="_blank" rel="external">http://localhost:9000/test/prefix/hello/testCustomFilter/xujin</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2018-05-27 10:01:56.057 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.h.RoutePredicateHandlerMapping   : Mapping [Exchange: GET http://localhost:9000/test/prefix/hello/testCustomFilter/xujin] to Route&#123;id=&apos;test_consumer_service&apos;, uri=lb://SC-CONSUMER, order=0, predicate=org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$337/1295338046@6dbaa72e, gatewayFilters=[OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.StripPrefixGatewayFilterFactory$$Lambda$340/1149217113@41fb2078, order=0&#125;, org.xujin.sc.filter.CustomFilter@281885a3, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.AddResponseHeaderGatewayFilterFactory$$Lambda$342/1099925775@4705cae6, order=0&#125;]&#125;</div><div class="line">2018-05-27 10:01:56.057 DEBUG 31658 --- [ctor-http-nio-2] o.s.c.g.handler.FilteringWebHandler      : Sorted gatewayFilterFactories: [OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@f5bf288&#125;, order=-1&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.StripPrefixGatewayFilterFactory$$Lambda$340/1149217113@41fb2078, order=0&#125;, OrderedGatewayFilter&#123;delegate=org.springframework.cloud.gateway.filter.factory.AddResponseHeaderGatewayFilterFactory$$Lambda$342/1099925775@4705cae6, order=0&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@26c77f54&#125;, order=10000&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@4c38cd16&#125;, order=10100&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@2c1d57bc&#125;, order=2147483637&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@6e9a0bea&#125;, order=2147483646&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.NettyRoutingFilter@7ddcb0dc&#125;, order=2147483647&#125;, OrderedGatewayFilter&#123;delegate=GatewayFilterAdapter&#123;delegate=org.springframework.cloud.gateway.filter.ForwardRoutingFilter@3e856100&#125;, order=2147483647&#125;, org.xujin.sc.filter.CustomFilter@281885a3]</div><div class="line">2018-05-27 10:02:00.347  INFO 31658 --- [ctor-http-nio-8] o.s.cloud.gateway.filter.GatewayFilter   : /hello/testCustomFilter/xujin: 859ms</div></pre></td></tr></table></figure>
<blockquote>
<p>如上日志可以看到/hello/testCustomFilter/xujin: 859ms，Gateway转发的时候去掉了前缀。</p>
</blockquote>
<h3 id="2-2-GlobalFilter"><a href="#2-2-GlobalFilter" class="headerlink" title="2.2 GlobalFilter"></a>2.2 GlobalFilter</h3><h4 id="2-2-1-什么是GlobalFilter"><a href="#2-2-1-什么是GlobalFilter" class="headerlink" title="2.2.1 什么是GlobalFilter"></a>2.2.1 什么是GlobalFilter</h4><blockquote>
<p>The GlobalFilter interface has the same signature as GatewayFilter. These are special filters that are conditionally applied to all routes. (This interface and usage are subject to change in future milestones).</p>
</blockquote>
<p>Spring Cloud gateway定义了GlobalFilter的接口让我们去自定义实现自己的的GlobalFilter。GlobalFilter是一个全局的Filter，作用于所有的路由。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GlobalFilter</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Process the Web request and (optionally) delegate to the next</div><div class="line">	 * &#123;<span class="doctag">@code</span> WebFilter&#125; through the given &#123;<span class="doctag">@link</span> GatewayFilterChain&#125;.</div><div class="line">	 * <span class="doctag">@param</span> exchange the current server exchange</div><div class="line">	 * <span class="doctag">@param</span> chain provides a way to delegate to the next filter</div><div class="line">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; to indicate when request processing is complete</div><div class="line">	 */</div><div class="line">	<span class="function">Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-2-自定义全局过滤器-Custom-GlobalFilter"><a href="#2-2-2-自定义全局过滤器-Custom-GlobalFilter" class="headerlink" title="2.2.2 自定义全局过滤器(Custom GlobalFilter)"></a>2.2.2 自定义全局过滤器(Custom GlobalFilter)</h4><p>在这里简单定义AuthSignatureFilter实现<code>GlobalFilter</code>，使用场景就是Gateway对请求的URL校验权限，判断请求的URL是否是合法请求。通过从ServerWebExchange获取请求上下文中authToken对应的值，进行判null处理，其它的check逻辑可以自定定制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.xujin.sc.filter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</div><div class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</div><div class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</div><div class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 调用鉴权</div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthSignatureFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</div><div class="line">        String token = exchange.getRequest().getQueryParams().getFirst(<span class="string">"authToken"</span>);</div><div class="line">        <span class="keyword">if</span> (token == <span class="keyword">null</span> || token.isEmpty()) &#123;</div><div class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</div><div class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> chain.filter(exchange);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> -<span class="number">200</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>GlobalFilter写完了，那问题来了？如何让其在Gateway中运行生效，有两种方式一种直接加<code>@Component</code>注解，另外一种可以在 Spring Config 中配置这个 Bean如下所示:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> AuthSignatureFilter <span class="title">authSignatureFilter</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> AuthSignatureFilter();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>1.访问<a href="http://localhost:9000/test/prefix/hello/testCustomFilter/xujin" target="_blank" rel="external">http://localhost:9000/test/prefix/hello/testCustomFilter/xujin</a> 如下所示由于authToken为空401返回.</p>
<p><img src="http://springcloud-new.oss-cn-shenzhen.aliyuncs.com/91ce199f4af8f4bd9576aace65940253.jpeg?Expires=1842749245&amp;OSSAccessKeyId=LTAI57F52hRuWq3h&amp;Signature=Is0KT0QAVXkPS20EdSPvDqmlxmc%3D" alt=""></p>
<p>2.访问<a href="http://localhost:9000/test/prefix/hello/testCustomFilter/xujin?authToken=asdasdsddasadsadsadsdadsewew32rg" target="_blank" rel="external">http://localhost:9000/test/prefix/hello/testCustomFilter/xujin?authToken=asdasdsddasadsadsadsdadsewew32rg</a></p>
<p><img src="http://springcloud-new.oss-cn-shenzhen.aliyuncs.com/86509f882391c3a20d2f32778dd1c2e9.jpeg?Expires=1842749511&amp;OSSAccessKeyId=LTAI57F52hRuWq3h&amp;Signature=lAd7U0lj4WZ0HMWF9SpbfKJ4aR8%3D" alt=""></p>

            
<! -- 添加版权信息 -->
<div class="article-footer-copyright">
<i class="fa fa-lightbulb-o"></i>
本文由<b><a href="/index.html" target="_blank" title="许进">许进</a></b>创作和发表,采用<a href="http://creativecommons.org/licenses/by/3.0/cn" target="_blank" rel="external">CC BY 3.0 CN协议</a> 进行许可。转载请注明作者及出处,本文作者为<b><a href="/index.html" target="_blank" title="许进">许进</a></b>,本文标题为<b><a href="/sc/gw/gw07/" target="_blank" title="Spring Cloud Gateway中的GatewayFilter和GlobalFilter">Spring Cloud Gateway中的GatewayFilter和GlobalFilter</a></b>
本文链接为<b><a href="/sc/gw/gw07/" target="_blank" title="Spring Cloud Gateway中的GatewayFilter和GlobalFilter">http://xujin.org/sc/gw/gw07/</a></b>
</div>
<! -- 添加版权信息 --> 
                     



            <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div>如果您觉得文章不错,可以打赏我喝一杯咖啡！</div>
  <button id="rewardButton" ,="" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}" style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onmouseout="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; color: rgb(255, 255, 255); font-weight: 400; font-style: normal; font-variant: normal; font-stretch: normal; font-size: 35px; line-height: 75px; font-family: microsofty; background: rgb(236, 96, 0);">赏</span>
  </button>
  <div id="QR" style="display: none;">
    
      <div id="wechat" style="display: inline-block">
        <a href="/images/wx.jpg" class="fancybox" rel="group"><img id="wechat_qr" src="/images/wx.jpg"  style="width: 200px; max-width: 100%; display: inline-block"></a>
        <p>微信打赏</p>
         <a href="/images/zfb.png" class="fancybox" rel="group"><img id="wechat_qr" src="/images/zfb.png" style="width: 200px; max-width: 100%; display: inline-block"></a>
        <p>支付宝打赏</p>
      </div>
    
    
  </div>
</div>
            <div id="cyEmoji" role="cylabs" data-use="emoji"></div>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
        
    </div>
    
        
<nav id="article-nav">
    
        <a href="/sc/gw/gw08/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Spring Cloud Gateway中的权重路由
                
            </div>
        </a>
    
    
        <a href="/sc/gw/gw06/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Spring Cloud Gateway只有Pre和POST两种类型的Filter</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
<div style="text-align:center">
  <div id="cyReward" role="cylabs" data-use="reward"></div>
  <script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysVsthGI"></script>
</div>

<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="sc/gw/gw07/"> </div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cysVsthGI'; 
var conf = 'prod_7dbdff942e7e5d96c854bb7c8ca9f65d'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) { 
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

    
    </section>


            </section>
            
                <aside id="sidebar" class="sidebar">
   
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">本站公告</h3>
        <div class="widget">
             <div class="textwidget" style="background-color: #f5f5f5; color: #a86767;border-radius: 21px;box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);padding: 15px;">
                   <div style="text-align:center">
                    <span id="busuanzi_container_site_uv">
          您好，您是<span class="foot-count" id="busuanzi_value_site_uv"></span>位访客
 </span>

 <div class="time" style="color:#f95b39"> 
   <script type="text/javascript">
today=new Date();
var day; var date; var hello;
hour=new Date().getHours()
if(hour < 6)hello='  凌晨好! '
else if(hour < 9)hello=' 早上好! '
else if(hour < 12)hello=' 上午好! '
else if(hour < 14)hello=' 中午好! '
else if(hour < 17)hello=' 下午好! '
else if(hour < 19)hello=' 傍晚好! '
else if(hour < 22)hello=' 晚上好! '
else {hello='夜深了! '}
var webUrl = webUrl;
document.write(' '+hello);
</script> 
   <span id="localtime"> <script type="text/javascript">
　today=new Date(); var tdate,tday, x,year; var x = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五","星期六");
　　var MSIE=navigator.userAgent.indexOf("MSIE");
　　if(MSIE != -1)
　　 year =(today.getFullYear());
　　else
　　 year = (today.getYear()+1900);
　　tdate= year+ "年" + (today.getMonth() + 1 ) + "月" + today.getDate() + "日" + " " + x[today.getDay()];
　　document.write(tdate); 
//-->
</script> </span> 
  </div> 
  
                    <img src="/images/re/fm.png" width="200px" height="263px"></br>
                    <a href="http://xujin.org/re/01/" style="color:#FF920B">●书籍概述</a>
                    <a href="http://product.dangdang.com/25348282.html" style="color:#FF920B">●当当购买</a>
                    <a href="https://item.jd.com/12447280.html" style="color:#FF920B">●京东购买</a>
                    <p><img src="/images/wxh.png" width="150px" height="150px" /><br /> 微信扫码加我微信<br /></p> 
                    <p>【Tel:18616365668 QQ:2508203324】</p>
                    <p>【Spring Cloud中国QQ群①:<a href="#">415028731(已满）</a>】</p>
                    <p>【Spring Cloud中国QQ群②:<a href="#">530321604(已满）</a>】</p>
                    <p>【Spring Cloud中国QQ群③:<a href="#">643970587(未满）</a>】</p>
                    <p>【Spring Cloud中国QQ群④:<a href="#">666903087(未满）</a>】</p>
                    <p>加我微信Software_King或者扫描二维码，拉入Spring Cloud中国社区微信群</p><br>
                    <p>系列文章<br /> 
                    <a href="http://xujin.org/categories/%E8%B7%9F%E6%88%91%E5%AD%A6Spring-Cloud/" style="color: #FF920B">●《跟我学Spring Cloud》</a><br /> 
                    <a href="http://xujin.org/tags/Spring-Cloud-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="color:#FF920B">●《Spring Cloud源码分析》</a></p> 
                    <a href="http://xujin.org/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="color:#FF920B">●《并发编程》</a></p> 
                    <p>微信公众号：搜索"xujin"或扫描下面的二维码：<br /> <img src="/images/wxgzh.png" width="150px" height="150px" /></p> 
                   </div> 
            </div> 
               
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Eureka-Server/">Eureka Server</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Janus网关/">Janus网关</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Moss/">Moss</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Boot/">Spring Boot</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud-Eureka/">Spring Cloud Eureka</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud-Gateway/">Spring Cloud Gateway</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud-Sleuth/">Spring Cloud Sleuth</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Venus-Boot/">Venus Boot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dincos/">dincos</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/venus/">venus</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/中间件/">中间件</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/云计算Saas/">云计算Saas</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码片/">代码片</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/并发编程/">并发编程</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/沉思录/">沉思录</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/社区/">社区</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/跟我学Spring-Cloud/">跟我学Spring Cloud</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/重新定义/">重新定义</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目经验/">项目经验</a><span class="category-list-count">11</span></li></ul>
        </div>
    </div>

    
        
<div class="widget-wrap">
  <h3 class="widget-title">最近评论</h3>
	<div class="widget">
		<!-- div标签放在页面需要展示的位置  -->
<div id="cyReping" role="cylabs" data-use="reping"></div>
<!-- 如果页面已有畅言的评论框，以下代码放在评论框代码的后面，来读取评论框的配置，否则需在div标签或代码中配置sid、cid(分类id) -->
<!-- 如果页面同时使用多个实验室项目，以下代码只需要引入一次，只配置上面的div标签即可 -->
<!-- 如需修改默认配置，请到changyan.sohu.com后台进行配置 -->
<script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/??lib/jquery.js,changyan.labs.js?appid=cysVsthGI"></script>
	</div>
  </div>

    
        
<div class="widget-wrap">
  <h3 class="widget-title">热评文章</h3>
	<div class="widget">
      <div id="cyHotnews" role="cylabs" data-use="hotnews"></div>
     <script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/??lib/jquery.js,changyan.labs.js?appid=cysVsthGI"></script>
	</div>
  </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Eureka/" style="font-size: 10px;">Eureka</a> <a href="/tags/Eureka-Server/" style="font-size: 10px;">Eureka Server</a> <a href="/tags/Java/" style="font-size: 17.5px;">Java</a> <a href="/tags/Jdk/" style="font-size: 12.5px;">Jdk</a> <a href="/tags/Lombok/" style="font-size: 10px;">Lombok</a> <a href="/tags/Moss/" style="font-size: 10px;">Moss</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/Naocs/" style="font-size: 10px;">Naocs</a> <a href="/tags/Spring-Boot/" style="font-size: 11.25px;">Spring Boot</a> <a href="/tags/Spring-Cloud/" style="font-size: 17.5px;">Spring Cloud</a> <a href="/tags/Spring-Cloud-Config/" style="font-size: 10px;">Spring Cloud Config</a> <a href="/tags/Spring-Cloud-Eureka/" style="font-size: 16.25px;">Spring Cloud Eureka</a> <a href="/tags/Spring-Cloud-Fegin/" style="font-size: 10px;">Spring Cloud Fegin</a> <a href="/tags/Spring-Cloud-Feign/" style="font-size: 10px;">Spring Cloud Feign</a> <a href="/tags/Spring-Cloud-Gateway/" style="font-size: 18.75px;">Spring Cloud Gateway</a> <a href="/tags/Spring-Cloud-Netflix/" style="font-size: 10px;">Spring Cloud Netflix</a> <a href="/tags/Spring-Cloud-Ribbon/" style="font-size: 10px;">Spring Cloud Ribbon</a> <a href="/tags/Spring-Cloud-Sleuth/" style="font-size: 10px;">Spring Cloud Sleuth</a> <a href="/tags/Spring-Cloud-Zuul/" style="font-size: 13.75px;">Spring Cloud Zuul</a> <a href="/tags/Spring-Cloud-源码分析/" style="font-size: 15px;">Spring Cloud 源码分析</a> <a href="/tags/Spring-Cloud自研组件/" style="font-size: 10px;">Spring Cloud自研组件</a> <a href="/tags/Venus-Boot/" style="font-size: 10px;">Venus Boot</a> <a href="/tags/Venus-Framework/" style="font-size: 10px;">Venus Framework</a> <a href="/tags/dincos/" style="font-size: 10px;">dincos</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/http2/" style="font-size: 10px;">http2</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/云计算SaaS/" style="font-size: 10px;">云计算SaaS</a> <a href="/tags/代码片/" style="font-size: 10px;">代码片</a> <a href="/tags/代码生成器/" style="font-size: 10px;">代码生成器</a> <a href="/tags/全链路监控/" style="font-size: 10px;">全链路监控</a> <a href="/tags/基础架构/" style="font-size: 10px;">基础架构</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/实践分享/" style="font-size: 10px;">实践分享</a> <a href="/tags/并发编程/" style="font-size: 15px;">并发编程</a> <a href="/tags/开发工具/" style="font-size: 10px;">开发工具</a> <a href="/tags/微服务/" style="font-size: 10px;">微服务</a> <a href="/tags/数据库连接池/" style="font-size: 10px;">数据库连接池</a> <a href="/tags/沉思录/" style="font-size: 10px;">沉思录</a> <a href="/tags/网关中间件/" style="font-size: 11.25px;">网关中间件</a> <a href="/tags/重新定义/" style="font-size: 10px;">重新定义</a> <a href="/tags/项目经验/" style="font-size: 20px;">项目经验</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.xujin.org">许进|沉思录</a>
                    </li>
                
                    <li>
                        <a href="http://springcloud.cn">Spring Cloud中国社区</a>
                    </li>
                
                    <li>
                        <a href="http://www.cnblogs.com/ACMer/">我的博客园</a>
                    </li>
                
                    <li>
                        <a href="http://blog.sina.com.cn/softwaremi">新浪博客</a>
                    </li>
                
                    <li>
                        <a href="http://blog.chingzhu.com/">朱清博客</a>
                    </li>
                
                    <li>
                        <a href="http://tietang.wang/">铁汤博客</a>
                    </li>
                
                    <li>
                        <a href="http://blog.csdn.net/forezp">方志朋的博客</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
          <div id="myTop" style="left: auto; right: 5px; position: fixed; top: auto; bottom: 10px; z-index: 2147483643; overflow: hidden; display: none; opacity: 1;">
<a onmouseover="this.style.backgroundPosition='-96px 0';" onmouseout="this.style.backgroundPosition='-64px 0';" href="#" title="回到顶部" onclick="UJIAN.backTop();return false;" style="margin-left: 3px; display: block; float: right; outline: none 0px; text-indent: -9999em; width: 32px; height: 32px; background: url(/css/images/2.png) -64px 0px no-repeat scroll transparent;">回到顶部</a>
</div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy;2019 许进<br>
            <a href="http://www.miibeian.gov.cn/" target="_blank">滇ICP备14007546号</a>
            Powered by <a href="http://blog.xujin.org" target="_blank">许进</a>. 
        </div>
        <span id="busuanzi_container_site_pv">
         访问量<span class="foot-count" id="busuanzi_value_site_pv"></span>次
         </span>
         <span class="foot-count" id="showDays"></span>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



 <script>
        var birthDay = new Date('1/20/2015 18:34:23');
        setInterval(function() {
            var now = new Date();
            var num_1 = 1000 * 60 * 60 * 24;
            var num_2 = 1000 * 60 * 60;
            var duration = now.getTime() - birthDay.getTime();
            var total = Math.floor(duration / num_1);
            var hour = Math.floor((duration % num_1) / num_2);
            var minute = Math.floor(((duration % num_1) % num_2) / (1000 * 60));
            var second = Math.floor((((duration % num_1) % num_2) % (1000 * 60)) / 1000);
            document.getElementById("showDays").innerHTML = "本站已运行" + total + "天" + hour + '时' + minute + '分' + second + '秒';
        }, 1000);
    </script>
        

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>