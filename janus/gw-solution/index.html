<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>å¾®æœåŠ¡ç½‘å…³è§£å†³æ–¹æ¡ˆè°ƒç ”å’Œä½¿ç”¨æ€»ç»“ | è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="HaloğŸ’«"><meta name="designer" content="minfive"><meta name="keywords" content="è®¸è¿›|Spring Cloud,ä¸­é—´ä»¶ï¼ŒåŸºç¡€æ¶æ„ï¼Œwww.xujin.org,xujin.org,-è®¸è¿›æ²‰æ€å½•,Venus+,äº‘é¦–ç§‘æŠ€æœ‰é™å…¬å¸,äº‘è®¡ç®—ï¼Œå¤§æ•°æ®ï¼Œç‰©è”ç½‘ï¼ŒSoftware_kingçš„åšå®¢,äº‘è®¡ç®—Saasï¼Œäº‘è®¡ç®—Paasï¼Œäº‘è®¡ç®—Iaas Hadoopï¼Œå¤§æ•°æ®ï¼ŒJavaEEï¼ŒJavaï¼Œç‰©è”ç½‘ï¼ŒHadoopï¼Œ NoSQLï¼ŒMongoDB,Spring, Hibernate,Struts2,Shiro,Spring Security Activiti,JBPM"><meta name="description" content="Spring Cloudä¸­å›½ç¤¾åŒºåˆ›å§‹äººï¼Œå…¥èŒäºé˜¿é‡Œ,æ›¾å…¥èŒäºå”¯å“ä¼šä¸­é—´ä»¶,ä¸šä½™ä¸»è¦ç ”ç©¶Spring Cloudã€‚ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä½œè€…"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://xujin.org/janus/gw-solution/index.html"><link rel="icon" type="image/png" href="null" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c54bda95ff8b34e8be2edd1d138812c1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-117331438-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-117331438-1")</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loading-small.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶" alt="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"><img src="http://xujin.org/css/images/logo.png" alt="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="é¦–é¡µ" title="é¦–é¡µ">é¦–é¡µ</a></li><li class="nav__item"><a href="/archives" alt="å½’æ¡£" title="å½’æ¡£">å½’æ¡£</a></li><li class="nav__item"><a href="/about" alt="å…³äº" title="å…³äº">å…³äº</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><header class="post__info"><h1 class="post__title">å¾®æœåŠ¡ç½‘å…³è§£å†³æ–¹æ¡ˆè°ƒç ”å’Œä½¿ç”¨æ€»ç»“</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="http://xujin.org/">è®¸è¿›</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2017-07-29</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/ç½‘å…³ä¸­é—´ä»¶/">ç½‘å…³ä¸­é—´ä»¶</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>æ¬¡</li></ul></div></div></header><div class="post__content"><h2 id="ä¸€-ä»€ä¹ˆæ˜¯ç½‘å…³"><a href="#ä¸€-ä»€ä¹ˆæ˜¯ç½‘å…³" class="headerlink" title="ä¸€.ä»€ä¹ˆæ˜¯ç½‘å…³"></a>ä¸€.ä»€ä¹ˆæ˜¯ç½‘å…³</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯ç½‘å…³"><a href="#1-1-ä»€ä¹ˆæ˜¯ç½‘å…³" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ç½‘å…³"></a>1.1 ä»€ä¹ˆæ˜¯ç½‘å…³</h3><p>API Gatewayï¼ˆAPIGW / API ç½‘å…³ï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œä¸Šçš„ä¸€ä¸ªé¢å‘APIçš„ã€ä¸²è¡Œé›†ä¸­å¼çš„å¼ºç®¡æ§æœåŠ¡ï¼Œè¿™é‡Œçš„è¾¹ç•Œæ˜¯ä¼ä¸šITç³»ç»Ÿçš„è¾¹ç•Œï¼Œå¯ä»¥ç†è§£ä¸º<code>ä¼ä¸šçº§åº”ç”¨é˜²ç«å¢™</code>ï¼Œä¸»è¦èµ·åˆ°<code>éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿçš„ä½œç”¨</code>ã€‚åœ¨å¾®æœåŠ¡æ¦‚å¿µçš„æµè¡Œä¹‹å‰ï¼ŒAPIç½‘å…³å°±å·²ç»è¯ç”Ÿäº†ï¼Œä¾‹å¦‚é“¶è¡Œã€è¯åˆ¸ç­‰é¢†åŸŸå¸¸è§çš„å‰ç½®æœºç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯è§£å†³è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ç­‰é—®é¢˜çš„ã€‚</p><a id="more"></a><p>APIç½‘å…³çš„æµè¡Œï¼Œæºäºè¿‘å‡ å¹´æ¥ï¼Œç§»åŠ¨åº”ç”¨ä¸ä¼ä¸šé—´äº’è”éœ€æ±‚çš„å…´èµ·ã€‚ç§»åŠ¨åº”ç”¨ã€ä¼ä¸šäº’è”ï¼Œä½¿å¾—åå°æœåŠ¡æ”¯æŒçš„å¯¹è±¡ï¼Œä»ä»¥å‰å•ä¸€çš„Webåº”ç”¨ï¼Œæ‰©å±•åˆ°å¤šç§ä½¿ç”¨åœºæ™¯ï¼Œä¸”æ¯ç§ä½¿ç”¨åœºæ™¯å¯¹åå°æœåŠ¡çš„è¦æ±‚éƒ½ä¸å°½ç›¸åŒã€‚è¿™ä¸ä»…å¢åŠ äº†åå°æœåŠ¡çš„å“åº”é‡ï¼Œè¿˜å¢åŠ äº†åå°æœåŠ¡çš„å¤æ‚æ€§ã€‚<code>éšç€å¾®æœåŠ¡æ¶æ„æ¦‚å¿µçš„æå‡ºï¼ŒAPIç½‘å…³æˆä¸ºäº†å¾®æœåŠ¡æ¶æ„çš„ä¸€ä¸ªæ ‡é…ç»„ä»¶</code>ã€‚</p><h3 id="1-2-ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½"><a href="#1-2-ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½" class="headerlink" title="1.2 ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½"></a>1.2 ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½</h3><p><img src="/images/sc-study/gwf.png" width="650px" height="450px"></p><blockquote><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šç½‘å…³è¯¥å…·å¤‡çš„æœ€åŸºæœ¬çš„å››å¤§åŠŸèƒ½:ç»Ÿä¸€æ¥å…¥ï¼Œæµé‡ç®¡æ§ï¼Œåè®®é€‚é…è½¬å‘ï¼Œå®‰å…¨é˜²æŠ¤ã€‚</p></blockquote><h2 id="äºŒ-ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ"><a href="#äºŒ-ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒ.ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ"></a>äºŒ.ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ</h2><h3 id="2-1-Nginx-Lua"><a href="#2-1-Nginx-Lua" class="headerlink" title="2.1 Nginx+ Lua"></a>2.1 Nginx+ Lua</h3><p>Nginxæ˜¯ç”±IgorSysoevä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹å¼€å‘çš„ï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚Ngnixä¸€æ–¹é¢å¯ä»¥åšåå‘ä»£ç†ï¼Œå¦å¤–ä¸€æ–¹é¢åšå¯ä»¥åšé™æ€èµ„æºæœåŠ¡å™¨ã€‚</p><blockquote><p>ä½†æ˜¯å‡†ç¡®çš„æ¥è¯´ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ç§æ–¹æ¡ˆä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç½‘å…³ï¼Œè€Œä¸”å³ä½¿è‡ªç ”ç½‘å…³çš„ç›®æ ‡ä¹Ÿæ˜¯å¹²æ‰Ngnixã€‚</p></blockquote><h3 id="2-2-Kong"><a href="#2-2-Kong" class="headerlink" title="2.2 Kong"></a>2.2 Kong</h3><p>Kongæ˜¯Mashapeæä¾›çš„ä¸€æ¬¾APIç®¡ç†è½¯ä»¶ï¼Œå®ƒæœ¬èº«æ˜¯åŸºäºNgnix+luaçš„ï¼Œä½†æ¯”nginxæä¾›äº†æ›´ç®€å•çš„é…ç½®æ–¹å¼ï¼Œæ•°æ®é‡‡ç”¨äº† ApacheCassandra/PostgreSQLå­˜å‚¨ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›ä¼˜ç§€çš„æ’ä»¶ï¼Œæ¯”å¦‚éªŒè¯ï¼Œæ—¥å¿—ï¼Œè°ƒç”¨é¢‘æ¬¡é™åˆ¶ç­‰ã€‚<br>Kongçš„ä¸€ä¸ªéå¸¸è¯±äººçš„åœ°æ–¹å°±æ˜¯æä¾›äº†å¤§é‡çš„æ’ä»¶æ¥æ‰©å±•åº”ç”¨ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„æ’ä»¶å¯ä»¥ä¸ºæœåŠ¡æä¾›å„ç§å¢å¼ºçš„åŠŸèƒ½ã€‚Kongé»˜è®¤æ’ä»¶æ’ä»¶åŒ…æ‹¬ï¼š</p><ul><li>èº«ä»½è®¤è¯ï¼šKongæä¾›äº†Basic Authenticationã€Key authenticationã€OAuth2.0authenticationã€HMAC authenticationã€JWTã€LDAP authenticationè®¤è¯å®ç°ã€‚</li><li>å®‰å…¨ï¼šACLï¼ˆè®¿é—®æ§åˆ¶ï¼‰ã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ã€åŠ¨æ€SSLã€IPé™åˆ¶ã€çˆ¬è™«æ£€æµ‹å®ç°ã€‚</li><li>æµé‡æ§åˆ¶ï¼šè¯·æ±‚é™æµï¼ˆåŸºäºè¯·æ±‚è®¡æ•°é™æµï¼‰ã€ä¸Šæ¸¸å“åº”é™æµï¼ˆæ ¹æ®upstreamå“åº”è®¡æ•°é™æµï¼‰ã€è¯·æ±‚å¤§å°é™åˆ¶ã€‚é™æµæ”¯æŒæœ¬åœ°ã€Rediså’Œé›†ç¾¤é™æµæ¨¡å¼ã€‚</li><li>åˆ†æç›‘æ§ï¼šGalileoï¼ˆè®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®ï¼Œå®ç°APIåˆ†æï¼‰ã€Datadogï¼ˆè®°å½•API Metricå¦‚è¯·æ±‚æ¬¡æ•°ã€è¯·æ±‚å¤§å°ã€å“åº”çŠ¶æ€å’Œå»¶è¿Ÿï¼Œå¯è§†åŒ–API Metricï¼‰ã€Runscopeï¼ˆè®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®ï¼Œå®ç°APIæ€§èƒ½æµ‹è¯•å’Œç›‘æ§ï¼‰ã€‚</li><li>è½¬æ¢ï¼šè¯·æ±‚è½¬æ¢ã€å“åº”è½¬æ¢</li></ul><blockquote><p>ä¼˜ç‚¹:Kongæœ¬èº«ä¹Ÿæ˜¯åŸºäºNginxçš„ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¸Šéƒ½æ²¡æœ‰é—®é¢˜ã€‚Kongä½œä¸ºä¸€æ¬¾å•†ä¸šè½¯ä»¶ï¼Œåœ¨Nginxä¸Šåšäº†å¾ˆæ‰©å±•å·¥ä½œï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šä»˜è´¹çš„å•†ä¸šæ’ä»¶ã€‚Kongæœ¬èº«ä¹Ÿæœ‰ä»˜è´¹çš„ä¼ä¸šç‰ˆï¼Œå…¶ä¸­åŒ…æ‹¬æŠ€æœ¯æ”¯æŒã€ä½¿ç”¨åŸ¹è®­æœåŠ¡ä»¥åŠAPI åˆ†ææ’ä»¶ã€‚</p></blockquote><hr><blockquote><p>ç¼ºç‚¹:Kongçš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨Spring Cloudï¼ŒKongå¦‚ä½•ç»“åˆç›®å‰å·²æœ‰çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Ÿ</p></blockquote><h3 id="2-3-Spring-Cloud-Zuul"><a href="#2-3-Spring-Cloud-Zuul" class="headerlink" title="2.3 Spring Cloud Zuul"></a>2.3 Spring Cloud Zuul</h3><p>Zuul æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€ä¸ªAPIç½‘å…³ç»„ä»¶ï¼ŒSpring Cloudå¯¹å…¶è¿›è¡ŒäºŒæ¬¡åŸºäºSpring Bootçš„æ³¨è§£å¼å°è£…åšåˆ°å¼€ç®±å³ç”¨ã€‚ç›®å‰æ¥è¯´ï¼Œç»“åˆSring Cloudæä¾›çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Œå¯ä»¥åšåˆ°è¯·æ±‚è½¬å‘ï¼Œæ ¹æ®é…ç½®çš„æˆ–è€…é»˜è®¤çš„è·¯ç”±è§„åˆ™è¿›è¡Œè·¯ç”±å’ŒLoad Balanceï¼Œé›†æˆHystrixã€‚è¯¦ç»†å¯ä»¥å‚è€ƒ<a href="http://xujin.org/sc/sc-zuul-01/">Spring Cloud Zuulçš„URLè½¬å‘å’Œè·¯ç”±è§„åˆ™</a>ã€‚</p><p>Spring Cloud Zuulå¤„ç†æ¯ä¸ªè¯·æ±‚çš„æ–¹å¼æ˜¯é’ˆå¯¹æ¯ä¸ªè¯·æ±‚æ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚PSï¼Œæ ¹æ®ç»Ÿè®¡æ•°æ®ç›®å‰Zuulæœ€å¤šèƒ½è¾¾åˆ°ï¼ˆ1000-2000)QPSã€‚ä½¿ç”¨è¿‡Nettyçš„éƒ½çŸ¥é“ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨Boosç»„å’Œworkç»„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ‰€æœ‰è¯·æ±‚ä¼šè¢«æ”¾åˆ°å¤„ç†é˜Ÿåˆ—ä¸­ï¼Œä»çº¿ç¨‹æ± ä¸­é€‰å–ç©ºé—²çº¿ç¨‹æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚</p><p>Spring Cloud Zuuléœ€è¦åšä¸€äº›ç°åº¦ï¼Œé™çº§ï¼Œæ ‡ç­¾è·¯ç”±ï¼Œé™æµï¼ŒWAFå°ç¦ï¼Œéœ€è¦è‡ªå®šä¹‰Filterå»æˆ–è€…åšä¸€äº›å®šåˆ¶åŒ–å®ç°ã€‚è¯¦ç»†æ–‡ç« å¯ä»¥å‚è€ƒ<a href="http://xujin.org/sc/sc-ribbon-demoted/">åœ¨Spring Cloudä¸­å®ç°é™çº§ä¹‹æƒé‡è·¯ç”±å’Œæ ‡ç­¾è·¯ç”±</a></p><blockquote><p>è™½ç„¶å¯ä»¥é€šè¿‡è‡ªå®šä¹‰Filterå®ç°ï¼Œæˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºZuulæœ¬èº«çš„è®¾è®¡å’ŒåŸºäº<code>å•çº¿ç¨‹çš„æ¥æ”¶è¯·æ±‚å’Œè½¬å‘å¤„ç†</code>ï¼Œåœ¨æˆ‘çœ‹æ¥ç›®å‰æ¥çœ‹Zuul å°±æ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œéšç€Zuul2ä¸€ç›´è·³ç¥¨ï¼ŒSpring Cloudæ¨å‡ºè‡ªå·±çš„Spring Cloud Gateway.</p></blockquote><p><a href="https://spencergibb.netlify.com/preso/detroit-cf-api-gateway-2017-03/#/" target="_blank" rel="noopener">The API Gateway is Dead! Long Live the API Gateway!</a></p><blockquote><p>å¤§æ„:Zuulå·²æ­»ï¼ŒSpring Cloud Gatewayæ°¸ç”Ÿã€‚</p></blockquote><h3 id="2-4-Spring-Cloud-Gateway"><a href="#2-4-Spring-Cloud-Gateway" class="headerlink" title="2.4 Spring Cloud Gateway"></a>2.4 Spring Cloud Gateway</h3><p>A Gateway built on Spring Framework 5.0 and Spring Boot 2.0 providing routing and moreã€‚</p><blockquote><p>Spring Cloud Gatewayæ˜¯åŸºäºSpring æ¡†æ¶5.0ç‰ˆæœ¬å’ŒSpring Boot 2.0çš„ç‰ˆæœ¬æ„å»ºï¼Œæä¾›è·¯ç”±ç­‰åŠŸèƒ½ã€‚</p></blockquote><p>Spring Cloud GateWayå…·æœ‰ä»¥ä¸‹ç‰¹å¾</p><ul><li>Java 8/Spring 5/Boot 2</li><li>WebFlux/Reactor</li><li>HTTP/2 and Websockets</li><li>Finchley Release Train (Q4 2017)</li></ul><blockquote><p>ç”±äºSpring 5.0æ”¯æŒNettyï¼ŒHttp2ï¼Œè€ŒSpring Boot 2.0æ”¯æŒSpring 5.0ï¼Œå› æ­¤Spring Cloud Gatewayæ”¯æŒNettyå’ŒHttp2é¡ºç†æˆç« ã€‚è‡³äº2017å¹´Q4å­£åº¦æ˜¯å¦å‘å¸ƒå®Œæ•´çš„Spring Cloud Gatewayæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼Œ<code>ä½†æ˜¯è‡³äºæœ€ç»ˆè½åœ°çœ‹æœ€ç»ˆä½¿ç”¨æƒ…å†µ</code>ã€‚</p></blockquote><p>è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒï¼š<a href="http://xujin.org/sc/sc-gateway/">Spring Cloud Gatewayç¦»å¼€å­µåŒ–å™¨çš„å˜åŒ–</a></p><h3 id="2-5-Kong-Zuulçš„ç½‘å…³æ–¹æ¡ˆ"><a href="#2-5-Kong-Zuulçš„ç½‘å…³æ–¹æ¡ˆ" class="headerlink" title="2.5 Kong+Zuulçš„ç½‘å…³æ–¹æ¡ˆ"></a>2.5 Kong+Zuulçš„ç½‘å…³æ–¹æ¡ˆ</h3><p><img src="/images/sc-study/kzuul.png" width="650px" height="450px"></p><blockquote><p>å¦‚ä¸Šå›¾æ‰€ç¤º:Kong+Zuulå®ç°çš„ç½‘å…³æ–¹æ¡ˆï¼Œåœ¨åŠ ä¸Šé˜¿é‡Œäº‘çš„SLBï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯å¤šäº†å¥½å‡ å±‚ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå‘æŒ¥Kong+Spring Cloud Zuulå„è‡ªçš„ä¼˜ç‚¹å½¢æˆâ€œèšåˆç½‘å…³â€ã€‚ä¸ªäººä¸å»ºè®®è¿™æ ·ä½¿ç”¨ç½‘å…³ï¼Œå› æ­¤è‡ªç ”ç½‘å…³ä¸­é—´ä»¶ï¼Œæ˜¾å¾—å°¤å…¶é‡è¦ã€‚</p></blockquote><h2 id="ä¸‰-åŸºäºSpring-Cloud-Zuulæ„å»ºç½‘å…³"><a href="#ä¸‰-åŸºäºSpring-Cloud-Zuulæ„å»ºç½‘å…³" class="headerlink" title="ä¸‰.åŸºäºSpring Cloud Zuulæ„å»ºç½‘å…³"></a>ä¸‰.åŸºäºSpring Cloud Zuulæ„å»ºç½‘å…³</h2><p>ç”¨Spring Cloud Zuulæ„å»ºç½‘å…³å…¶å®ç›¸å½“é¸¡è‚‹ï¼Œæ¯”å¦‚åŠ¨æ€Filterï¼Œæ¯”å¦‚æ ‡ç­¾è·¯ç”±ï¼Œé™çº§ï¼Œæ¯”å¦‚åŠ¨æ€Filterï¼Œæ¯”å¦‚å¸¦ç®¡æ§å®¡è®¡æµç¨‹ï¼Œæ˜“æ“ä½œçš„UIç•Œé¢ç­‰ã€‚</p><p>zuulæ˜¯netfixçš„api ç½‘å…³ï¼Œä¸»è¦ç‰¹è‰²æœ‰ï¼šfilterçš„PRPE(pre,route,post,error)æ¨¡å‹ã€groovyçš„fitleræœºåˆ¶ï¼Œå…¶ä¸­spring cloudå¯¹å…¶æœ‰æ¯”è¾ƒå¥½çš„æ‰©å±•ï¼Œä½†æ˜¯spring cloudå¯¹å…¶çš„æ‰©å±•æ„Ÿè§‰ä¸æ˜¯å¾ˆå®Œç¾ï¼Œå­˜åœ¨è·¯ç”±è§„åˆ™æ— æ³•åªèƒ½æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥å­˜å‚¨ï¼Œè€Œæ— æ³•åŠ¨æ€é…ç½®çš„ç›®çš„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªäººå†™äº†ä¸€ä¸ªstarteræ’ä»¶æ¥è§£å†³è·¯ç”±è§„åˆ™é…ç½®åˆ°Cassandraçš„é—®é¢˜ï¼Œè¯¦ç»†è¯·çœ‹ï¼š<a href="https://github.com/jmnarloch/zuul-route-cassandra-spring-cloud-starter" target="_blank" rel="noopener">å°†è·¯ç”±è§„åˆ™é…ç½®åˆ°KVåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»ŸCassandra</a></p><h3 id="3-1-å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶"><a href="#3-1-å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶" class="headerlink" title="3.1 å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶"></a>3.1 å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶</h3><p>è¿™é‡Œä¸»è¦æ˜¯åšäº†æµæ§åŠåè®®è½¬åŒ–çš„å·¥ä½œï¼Œè¿™é‡Œä¸»è¦æ˜¯http-&gt;grpcçš„è½¬æ¢ï¼›<br>LimitAccessFilterï¼šåˆ©ç”¨redisä»¤ç‰Œæ¡¶ç®—æ³•è¿›è¡Œæµæ§<br>GrpcRemoteRouteFilterï¼šhttpè½¬åŒ–ä¸ºgrpcçš„åè®®è½¬æ¢</p><h3 id="3-2-è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°"><a href="#3-2-è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°" class="headerlink" title="3.2  è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°"></a>3.2 è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°</h3><p>å®ç°åŠ¨æ€è·¯ç”±æœ‰ä¸¤ç§å®ç°æ–¹å¼:<br>1.ç¬¬ä¸€æ˜¯DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–,æ¨èæ˜¯ï¼ŒSpring Cloudæ•´åˆGRPCï¼ŒRESTåè®®é€‚é…è½¬å‘ä¸ºå†…éƒ¨GRPCæœåŠ¡æ—¶é‡‡ç”¨æ­¤ç§æ–¹æ³•æ‰©å±•ä¿®æ”¹ã€‚</p><p>2.ç¬¬äºŒæ˜¯å®ç°äº†RefreshableRouteLocatoræ¥å£ï¼Œèƒ½å¤Ÿå®ç°åŠ¨æ€åˆ·æ–°ï¼Œå¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/u013815546/article/details/68944039" target="_blank" rel="noopener"> spring cloud ZuulåŠ¨æ€è·¯ç”±</a></p><h4 id="3-2-1-åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ"><a href="#3-2-1-åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ" class="headerlink" title="3.2.1 åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ"></a>3.2.1 åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ</h4><p>ä¸ºä»€ä¹ˆè¦åŸºäºäº‹ä»¶æ›´æ–°ï¼ŒåŸç†å¦‚ä¸‹æ‰€ç¤ºï¼š<br>åœ¨org.springframework.cloud.netflix.zuul.ZuulConfiguration.javaä¸­228-250è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123; ZuulProperties.class &#125;)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(ZuulServlet.class)</span><br><span class="line"><span class="comment">// Make sure to get the ServerProperties from the same place as a normal web app would</span></span><br><span class="line"><span class="meta">@Import</span>(ServerPropertiesAutoConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZuulConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//zuulçš„é…ç½®ä¿¡æ¯,å¯¹åº”äº†application.propertiesæˆ–ymlä¸­çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">protected</span> ZuulProperties zuulProperties;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">protected</span> ServerProperties server;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">private</span> ErrorController errorController;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> HasFeatures <span class="title">zuulFeature</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> HasFeatures.namedFeature(<span class="string">"Zuul (Simple)"</span>, ZuulConfiguration.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span>(RouteLocator.class)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> RouteLocator <span class="title">routeLocator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	   <span class="comment">//é»˜è®¤é…ç½®çš„å®ç°æ˜¯SimpleRouteLocator.class</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleRouteLocator(<span class="keyword">this</span>.server.getServletPrefix(),</span><br><span class="line">				<span class="keyword">this</span>.zuulProperties);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ZuulController <span class="title">zuulController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ZuulController();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ZuulHandlerMapping <span class="title">zuulHandlerMapping</span><span class="params">(RouteLocator routes)</span> </span>&#123;</span><br><span class="line">		ZuulHandlerMapping mapping = <span class="keyword">new</span> ZuulHandlerMapping(routes, zuulController());</span><br><span class="line">		mapping.setErrorController(<span class="keyword">this</span>.errorController);</span><br><span class="line">		<span class="keyword">return</span> mapping;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ³¨å†Œäº†ä¸€ä¸ªè·¯ç”±åˆ·æ–°ç›‘å¬å™¨ï¼Œé»˜è®¤å®ç°æ˜¯ZuulRefreshListener.class</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ApplicationListener&lt;ApplicationEvent&gt; <span class="title">zuulRefreshRoutesListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ZuulRefreshListener();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"zuulServlet"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">zuulServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ServletRegistrationBean servlet = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> ZuulServlet(),</span><br><span class="line">				<span class="keyword">this</span>.zuulProperties.getServletPattern());</span><br><span class="line">		<span class="comment">// The whole point of exposing this servlet is to provide a route that doesn't</span></span><br><span class="line">		<span class="comment">// buffer requests.</span></span><br><span class="line">		servlet.addInitParameter(<span class="string">"buffer-requests"</span>, <span class="string">"false"</span>);</span><br><span class="line">		<span class="keyword">return</span> servlet;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// pre filters</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServletDetectionFilter <span class="title">servletDetectionFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ServletDetectionFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> FormBodyWrapperFilter <span class="title">formBodyWrapperFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> FormBodyWrapperFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DebugFilter <span class="title">debugFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DebugFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Servlet30WrapperFilter <span class="title">servlet30WrapperFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Servlet30WrapperFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// post filters</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SendResponseFilter <span class="title">sendResponseFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SendResponseFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SendErrorFilter <span class="title">sendErrorFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SendErrorFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SendForwardFilter <span class="title">sendForwardFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SendForwardFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZuulFilterConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Autowired</span></span><br><span class="line">		<span class="keyword">private</span> Map&lt;String, ZuulFilter&gt; filters;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> ZuulFilterInitializer <span class="title">zuulFilterInitializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ZuulFilterInitializer(<span class="keyword">this</span>.filters);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZuulRefreshListener</span></span></span><br><span class="line"><span class="class">			<span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Autowired</span></span><br><span class="line">		<span class="keyword">private</span> ZuulHandlerMapping zuulHandlerMapping;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> HeartbeatMonitor heartbeatMonitor = <span class="keyword">new</span> HeartbeatMonitor();</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (event <span class="keyword">instanceof</span> ContextRefreshedEvent</span><br><span class="line">					|| event <span class="keyword">instanceof</span> RefreshScopeRefreshedEvent</span><br><span class="line">					|| event <span class="keyword">instanceof</span> RoutesRefreshedEvent) &#123;</span><br><span class="line">				<span class="keyword">this</span>.zuulHandlerMapping.setDirty(<span class="keyword">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> HeartbeatEvent) &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>.heartbeatMonitor.update(((HeartbeatEvent) event).getValue())) &#123;</span><br><span class="line">					<span class="keyword">this</span>.zuulHandlerMapping.setDirty(<span class="keyword">true</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚ä¸Šæ‰€ç¤º,å½“ä½¿ç”¨ApplicationEventPublisherå‘é€çš„Eventä¸ºContextRefreshedEventï¼ŒRefreshScopeRefreshedEventï¼ŒRoutesRefreshedEventæ‰ä¼šé€šçŸ¥Zuulå»åˆ·æ–°è·¯ç”±ã€‚</p></blockquote><h3 id="3-3-åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator"><a href="#3-3-åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator" class="headerlink" title="3.3 åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator"></a>3.3 åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator</h3><h4 id="3-3-1-å¤„ç†æ€è·¯"><a href="#3-3-1-å¤„ç†æ€è·¯" class="headerlink" title="3.3.1 å¤„ç†æ€è·¯"></a>3.3.1 å¤„ç†æ€è·¯</h4><p>æ­¤æ’ä»¶é’ˆå¯¹çš„spring cloud zuulç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œå› æ­¤éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œå°†è·¯ç”±é…ç½®å¯ä»¥é…ç½®åˆ°mysqlè¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¯¦ç»†è¯·çœ‹<a href="https://github.com/linking12/saluki/tree/develop/saluki-gateway/src/main/java/com/quancheng/saluki/gateway/zuul" target="_blank" rel="noopener">Zuulçš„æ”¹åŠ¨ç‚¹</a>ã€‚</p><h4 id="3-3-2-å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–"><a href="#3-3-2-å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–" class="headerlink" title="3.3.2 å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–"></a>3.3.2 å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–</h4><p>å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–ï¼Œè¯¥ç±»çš„ä½œç”¨å°±æ˜¯ä»ymlæˆ–å±æ€§æ–‡ä»¶ä¸­è¯»å–è·¯ç”±è§„åˆ™ï¼›<br>å…·ä½“å‚çœ‹æºç org.springframework.cloud.netflix.zuul.filters.discovery.DiscoveryClientRouteLocatorï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼Œå°±ä¸åšå¤šä½™è§£é‡Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> LinkedHashMap&lt;String, ZuulRoute&gt; <span class="title">locateRoutes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		LinkedHashMap&lt;String, ZuulRoute&gt; routesMap = <span class="keyword">new</span> LinkedHashMap&lt;String, ZuulRoute&gt;();</span><br><span class="line">		routesMap.putAll(<span class="keyword">super</span>.locateRoutes());</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.discovery != <span class="keyword">null</span>) &#123;</span><br><span class="line">			Map&lt;String, ZuulRoute&gt; staticServices = <span class="keyword">new</span> LinkedHashMap&lt;String, ZuulRoute&gt;();</span><br><span class="line">			<span class="keyword">for</span> (ZuulRoute route : routesMap.values()) &#123;</span><br><span class="line">				String serviceId = route.getServiceId();</span><br><span class="line">				<span class="keyword">if</span> (serviceId == <span class="keyword">null</span>) &#123;</span><br><span class="line">					serviceId = route.getId();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (serviceId != <span class="keyword">null</span>) &#123;</span><br><span class="line">					staticServices.put(serviceId, route);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Add routes for discovery services by default</span></span><br><span class="line">			List&lt;String&gt; services = <span class="keyword">this</span>.discovery.getServices();</span><br><span class="line">			String[] ignored = <span class="keyword">this</span>.properties.getIgnoredServices()</span><br><span class="line">					.toArray(<span class="keyword">new</span> String[<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">for</span> (String serviceId : services) &#123;</span><br><span class="line">				<span class="comment">// Ignore specifically ignored services and those that were manually</span></span><br><span class="line">				<span class="comment">// configured</span></span><br><span class="line">				String key = <span class="string">"/"</span> + mapRouteToService(serviceId) + <span class="string">"/**"</span>;</span><br><span class="line">				<span class="keyword">if</span> (staticServices.containsKey(serviceId)</span><br><span class="line">						&amp;&amp; staticServices.get(serviceId).getUrl() == <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="comment">// Explicitly configured with no URL, cannot be ignored</span></span><br><span class="line">					<span class="comment">// all static routes are already in routesMap</span></span><br><span class="line">					<span class="comment">// Update location using serviceId if location is null</span></span><br><span class="line">					ZuulRoute staticRoute = staticServices.get(serviceId);</span><br><span class="line">					<span class="keyword">if</span> (!StringUtils.hasText(staticRoute.getLocation())) &#123;</span><br><span class="line">						staticRoute.setLocation(serviceId);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (!PatternMatchUtils.simpleMatch(ignored, serviceId)</span><br><span class="line">						&amp;&amp; !routesMap.containsKey(key)) &#123;</span><br><span class="line">					<span class="comment">// Not ignored</span></span><br><span class="line">					routesMap.put(key, <span class="keyword">new</span> ZuulRoute(key, serviceId));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (routesMap.get(DEFAULT_ROUTE) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			ZuulRoute defaultRoute = routesMap.get(DEFAULT_ROUTE);</span><br><span class="line">			<span class="comment">// Move the defaultServiceId to the end</span></span><br><span class="line">			routesMap.remove(DEFAULT_ROUTE);</span><br><span class="line">			routesMap.put(DEFAULT_ROUTE, defaultRoute);</span><br><span class="line">		&#125;</span><br><span class="line">		LinkedHashMap&lt;String, ZuulRoute&gt; values = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (Entry&lt;String, ZuulRoute&gt; entry : routesMap.entrySet()) &#123;</span><br><span class="line">			String path = entry.getKey();</span><br><span class="line">			<span class="comment">// Prepend with slash if not already present.</span></span><br><span class="line">			<span class="keyword">if</span> (!path.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">				path = <span class="string">"/"</span> + path;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.properties.getPrefix())) &#123;</span><br><span class="line">				path = <span class="keyword">this</span>.properties.getPrefix() + path;</span><br><span class="line">				<span class="keyword">if</span> (!path.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">					path = <span class="string">"/"</span> + path;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			values.put(path, entry.getValue());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> values;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-3-ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥"><a href="#3-3-3-ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥" class="headerlink" title="3.3.3 ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥"></a>3.3.3 ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥</h4><p>æ•°æ®å˜æ›´å¯¹ç½‘å…³çš„ç¨³å®šæ€§æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å½“å¯¹è·¯ç”±ä¿¡æ¯è¿›è¡ŒCRUDæ“ä½œä¹‹åï¼Œéœ€è¦Spring Cloud Zuulé‡æ–°åˆ·æ–°è·¯ç”±è§„åˆ™ï¼Œå®ç°æ–¹å¼é€šè¿‡springçš„eventæ¥å®ç°ã€‚</p><p>1.å®ç°åŸºäºApplicationEventPublisherAwareçš„äº‹ä»¶ç”Ÿäº§è€…çš„ä»£ç ç‰‡æ®µ<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ApplicationEventPublisher publisher;</span><br><span class="line">publisher.publishEvent(<span class="keyword">new</span> InstanceRegisteredEvent&lt;&gt;(<span class="keyword">this</span>, <span class="keyword">this</span>.environment));</span><br></pre></td></tr></table></figure><p></p><p>2.Spring Cloud netflixå†…éƒ¨çš„äº‹ä»¶æ¶ˆè´¹è€…</p><p>org.springframework.cloud.netflix.zuul.RoutesRefreshedEvent</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"serial"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoutesRefreshedEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> RouteLocator locator;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RoutesRefreshedEvent</span><span class="params">(RouteLocator locator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(locator);</span><br><span class="line">		<span class="keyword">this</span>.locator = locator;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RouteLocator <span class="title">getLocator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.locator;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››-åŸºäºSpring-Cloud-Gatewayæ„å»ºç½‘å…³"><a href="#å››-åŸºäºSpring-Cloud-Gatewayæ„å»ºç½‘å…³" class="headerlink" title="å››.åŸºäºSpring Cloud Gatewayæ„å»ºç½‘å…³"></a>å››.åŸºäºSpring Cloud Gatewayæ„å»ºç½‘å…³</h2><p>ç”±äºSpring Cloud Gateway<code>æœªå®Œå…¨æˆç†Ÿï¼Œè€Œä¸”æ€§èƒ½ï¼Œç¨³å®šæ€§ç­‰ï¼Œç°åœ¨æ— ä»è€ƒè¯ï¼Œæ²¡æœ‰ä½¿ç”¨æ¡ˆä¾‹</code>ï¼ŒåŸºäºSpring Cloud Gatewayæ–¹æ¡ˆæ„å»ºè‡ªå·±çš„<code>ç½‘å…³é£é™©æ¯”è¾ƒå¤§</code>ï¼Œè€Œä¸”<code>PSä¸çŸ¥é“åˆ°å¹´åº•æ˜¯å¦æˆç†Ÿå¯ç”¨</code>ã€‚æ•…åœ¨è¿™é‡Œä¸åšè¿‡å¤šè¯´æ˜ã€‚</p><h2 id="äº”-åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶"><a href="#äº”-åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶" class="headerlink" title="äº”.åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶"></a>äº”.åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶</h2><h3 id="5-1-æ¶æ„å›¾"><a href="#5-1-æ¶æ„å›¾" class="headerlink" title="5.1 æ¶æ„å›¾"></a>5.1 æ¶æ„å›¾</h3><p>å¯ä»¥å‚è€ƒæ¶æ„å›¾å¦‚ä¸‹:</p><p><img src="/images/sc-study/janus.jpg" width="650px" height="450px"></p><h3 id="5-2-è®¾è®¡åŸåˆ™"><a href="#5-2-è®¾è®¡åŸåˆ™" class="headerlink" title="5.2 è®¾è®¡åŸåˆ™"></a>5.2 è®¾è®¡åŸåˆ™</h3><ul><li>1.æ¯ä¸ªFilteråŸºäºè´£ä»»é“¾ï¼Œåªåšä¸“ä¸€çš„ä¸€ä»¶äº‹</li><li>2.æ¯ä¸ªFilteræœ‰å„è‡ªç‹¬ç«‹çš„æ•°æ®</li><li>3.æŸè€—æ€§èƒ½çš„Filteré¡ºåºå¾€åæ”¾</li><li>4.å¯åŠ¨è¯»å–é…ç½®é¡ºåºï¼Œå…ˆè¿œç«¯ï¼Œè‹¥è¿œç«¯å¤±è´¥ï¼Œåˆ™è¯»å–æœ¬åœ°ã€‚</li><li>5.é›†ç¾¤ç½‘å…³ï¼Œè¦æ³¨æ„æ•°æ®çš„diffå’Œç°åº¦</li><li>6.å°½é‡åšåˆ°å’ŒæœåŠ¡æ²»ç†æ¡†æ¶è§£è€¦ï¼Œæ˜“äºæ¥å…¥ï¼Œæ˜“äºå‡çº§</li></ul><h2 id="å…­-å‚è€ƒæ–‡ç« "><a href="#å…­-å‚è€ƒæ–‡ç« " class="headerlink" title="å…­.å‚è€ƒæ–‡ç« "></a>å…­.å‚è€ƒæ–‡ç« </h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660395381&amp;idx=1&amp;sn=00105c0f314d11a2b0af45ab36ba0f15&amp;chksm=f7424b93c035c285d34dc14612776bdbaf11f1dad0870ef90c6583c11f7ddb9362969bcdea21&amp;mpshare=1&amp;scene=1&amp;srcid=0619kwX5g5unylbYd3bYkamn&amp;key=0e40aeace6ff4dc8f60a65c5953db788ebd3507c1f0004d1aea8d483f87a477b019b87d66b9cd4a9d070b96ffd8d5176481ffa2b9650e0060d9d5af32967349cc29c69f4913e36ddfe46ddecc3c2ae78&amp;ascene=0&amp;uin=MTA0OTU5MTMyMw%3D%3D&amp;devicetype=iMac+MacBookPro13%2C3+OSX+OSX+10.12.4+build(16E195" target="_blank" rel="noopener">ä¼ä¸šçº§APIç½‘å…³çš„è®¾è®¡</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzQ2NTY0OA==&amp;mid=2650797020&amp;idx=1&amp;sn=48bb5a4e232a3680c8890ccb7e581b0a&amp;chksm=88562e83bf21a7950cdac1680498d433a042f219568add78d8d45eb39c30f8a8a3f7588e39df&amp;mpshare=1&amp;scene=2&amp;srcid=0724Gz8kWjZo0w6tt5tsk8iA&amp;key=48d1218a6e2970b0689b0057ebaebd1a4e0c207fca0dd6786dc9f5a8f0b90f21def29eb79324454150e230aa7207732a361e382880923c7883822bbbdce43140ac9b246e7b47fb313429d51aaf493400&amp;ascene=0&amp;uin=MTA0OTU5MTMyMw%3D%3D&amp;devicetype=iMac+MacBookPro13%2C3+OSX+OSX+10.12.4+build(16E195" target="_blank" rel="noopener">å¾®æœåŠ¡ä¸API ç½‘å…³ï¼ˆä¸Šï¼‰: ä¸ºä»€ä¹ˆéœ€è¦APIç½‘å…³ï¼Ÿ</a><br><a href="http://blog.csdn.net/u013815546/article/details/68944039" target="_blank" rel="noopener">http://blog.csdn.net/u013815546/article/details/68944039</a><br><a href="https://segmentfault.com/a/1190000009191419" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009191419</a></p><div class="post-announce">æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæœ¬æ–‡ç”± <a href="http://xujin.org">è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶</a> ç‰ˆæƒæ‰€æœ‰ã€‚å¦‚è‹¥è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼šè®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶ï¼ˆ<a href="http://xujin.org/janus/gw-solution/">http://xujin.org/janus/gw-solution/</a>ï¼‰</div><div class="post__prevs"><div class="post__prev"><a href="/java/hm01/" title="æ·±å…¥ç†è§£HashMapä¸Šç¯‡"><i class="iconfont icon-prev"></i>æ·±å…¥ç†è§£HashMapä¸Šç¯‡</a></div><div class="post__prev post__prev--right"><a href="/sc/sc-gw/" title="ã€ŠSpring Cloudä¸­å›½ç¤¾åŒºä¸Šæµ·ç½‘å…³ä¸“é¢˜ä¼šè®®ã€‹">ã€ŠSpring Cloudä¸­å›½ç¤¾åŒºä¸Šæµ·ç½‘å…³ä¸“é¢˜ä¼šè®®ã€‹<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><div id="toc" class="toc-article"><h3 class="block__title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€-ä»€ä¹ˆæ˜¯ç½‘å…³"><span class="toc-text">ä¸€.ä»€ä¹ˆæ˜¯ç½‘å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-ä»€ä¹ˆæ˜¯ç½‘å…³"><span class="toc-text">1.1 ä»€ä¹ˆæ˜¯ç½‘å…³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½"><span class="toc-text">1.2 ç½‘å…³åº”è¯¥å…·æœ‰çš„åŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒ-ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ"><span class="toc-text">äºŒ.ç›®å‰ç½‘å…³è§£å†³æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Nginx-Lua"><span class="toc-text">2.1 Nginx+ Lua</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Kong"><span class="toc-text">2.2 Kong</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Spring-Cloud-Zuul"><span class="toc-text">2.3 Spring Cloud Zuul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Spring-Cloud-Gateway"><span class="toc-text">2.4 Spring Cloud Gateway</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Kong-Zuulçš„ç½‘å…³æ–¹æ¡ˆ"><span class="toc-text">2.5 Kong+Zuulçš„ç½‘å…³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸‰-åŸºäºSpring-Cloud-Zuulæ„å»ºç½‘å…³"><span class="toc-text">ä¸‰.åŸºäºSpring Cloud Zuulæ„å»ºç½‘å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶"><span class="toc-text">3.1 å®šä¹‰è‡ªå·±çš„Filteræœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°"><span class="toc-text">3.2 è·¯ç”±æ•°æ®å˜æ›´åŸºäºäº‹ä»¶é€šçŸ¥è·¯ç”±è§„åˆ™åˆ·æ–°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ"><span class="toc-text">3.2.1 åŸºäºäº‹ä»¶æ›´æ–°æºç åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator"><span class="toc-text">3.3 åŸºäºäº‹ä»¶æ›´æ–°å®ç°æ–¹å¼å¤„ç†æ–¹å¼-DiscoveryClientRouteLocator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-å¤„ç†æ€è·¯"><span class="toc-text">3.3.1 å¤„ç†æ€è·¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–"><span class="toc-text">3.3.2 å¯¹DiscoveryClientRouteLocatorçš„é‡æ–°è¦†ç›–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥"><span class="toc-text">3.3.3 ç”Ÿäº§è€…äº§ç”Ÿäº‹ä»¶é€šçŸ¥</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å››-åŸºäºSpring-Cloud-Gatewayæ„å»ºç½‘å…³"><span class="toc-text">å››.åŸºäºSpring Cloud Gatewayæ„å»ºç½‘å…³</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äº”-åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶"><span class="toc-text">äº”.åŸºäºNettyè‡ªç ”ç½‘å…³ä¸­é—´ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-æ¶æ„å›¾"><span class="toc-text">5.1 æ¶æ„å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-è®¾è®¡åŸåˆ™"><span class="toc-text">5.2 è®¾è®¡åŸåˆ™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…­-å‚è€ƒæ–‡ç« "><span class="toc-text">å…­.å‚è€ƒæ–‡ç« </span></a></li></ol></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">å…³äº</h3><div class="item__content"><p class="item__text">è½¯ä»¶ä¸–ç•Œå°±æ˜¯æ¨¡æ‹Ÿå®¢è§‚ä¸–ç•Œï¼Œéœ€æ±‚åˆ†æï¼ŒæŠ€æœ¯é©±åŠ¨ï¼Œä»è€Œæ”¹å˜ä¸–ç•Œ!</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shang Hai, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>Software_King@@qq.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/img/wx.jpg" alt="logo" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"></div><div class="footer-top__item"><h3 class="item__title">å‹æƒ…é“¾æ¥</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://www.xujin.org" title="è®¸è¿›|æ²‰æ€å½•" target="_blank">è®¸è¿›|æ²‰æ€å½•</a></li><li class="list-item"><a href="http://springcloud.cn" title="Spring Cloudä¸­å›½ç¤¾åŒº" target="_blank">Spring Cloudä¸­å›½ç¤¾åŒº</a></li><li class="list-item"><a href="http://www.cnblogs.com/ACMer/" title="æˆ‘çš„åšå®¢å›­" target="_blank">æˆ‘çš„åšå®¢å›­</a></li><li class="list-item"><a href="http://blog.sina.com.cn/softwaremi" title="æ–°æµªåšå®¢" target="_blank">æ–°æµªåšå®¢</a></li><li class="list-item"><a href="http://blog.chingzhu.com/" title="æœ±æ¸…åšå®¢" target="_blank">æœ±æ¸…åšå®¢</a></li><li class="list-item"><a href="http://tietang.wang/" title="é“æ±¤åšå®¢" target="_blank">é“æ±¤åšå®¢</a></li><li class="list-item"><a href="http://blog.csdn.net/forezp" title="æ–¹å¿—æœ‹çš„åšå®¢" target="_blank">æ–¹å¿—æœ‹çš„åšå®¢</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">Powered by <a href="http://xujin.org/" target="_blank">Halo</a>, Made by <a href="https://github.com/softwareking" target="_blank">HaloğŸ’«</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/softwareking" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="linkedin"><i class="iconfont icon-in"></i></a></li><li class="social-network__item"><a href="mailto:softwareking@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li></ul><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span>ğŸ€<span class="post-count">105.1k</span> </span><span>| </span><span id="busuanzi_container_site_uv" style="display:inline">ğŸ‘½<span id="busuanzi_value_site_uv">1000000</span><span></span></span><span class="footer-separator"> | </span><span id="busuanzi_container_site_pv" style="display:inline">ğŸŒ€<span id="busuanzi_value_site_pv">1000000</span><span></span></span></div></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["ç½‘å…³ä¸­é—´ä»¶"],gitalk=new Gitalk({clientID:"322a00ea1ee28f04ba14",clientSecret:"01916d619a774e744b5e7b73bf4faa3d14b53bcc",repo:"italk",owner:"SoftwareKing",admin:["SoftwareKing"],labels:tags,id:new Date(1501308e6).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>