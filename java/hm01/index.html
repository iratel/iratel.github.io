<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>æ·±å…¥ç†è§£HashMapä¸Šç¯‡ | è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="HaloğŸ’«"><meta name="designer" content="minfive"><meta name="keywords" content="è®¸è¿›|Spring Cloud,ä¸­é—´ä»¶ï¼ŒåŸºç¡€æ¶æ„ï¼Œwww.xujin.org,xujin.org,-è®¸è¿›æ²‰æ€å½•,Venus+,äº‘é¦–ç§‘æŠ€æœ‰é™å…¬å¸,äº‘è®¡ç®—ï¼Œå¤§æ•°æ®ï¼Œç‰©è”ç½‘ï¼ŒSoftware_kingçš„åšå®¢,äº‘è®¡ç®—Saasï¼Œäº‘è®¡ç®—Paasï¼Œäº‘è®¡ç®—Iaas Hadoopï¼Œå¤§æ•°æ®ï¼ŒJavaEEï¼ŒJavaï¼Œç‰©è”ç½‘ï¼ŒHadoopï¼Œ NoSQLï¼ŒMongoDB,Spring, Hibernate,Struts2,Shiro,Spring Security Activiti,JBPM"><meta name="description" content="Spring Cloudä¸­å›½ç¤¾åŒºåˆ›å§‹äººï¼Œå…¥èŒäºé˜¿é‡Œ,æ›¾å…¥èŒäºå”¯å“ä¼šä¸­é—´ä»¶,ä¸šä½™ä¸»è¦ç ”ç©¶Spring Cloudã€‚ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä½œè€…"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://xujin.org/java/hm01/index.html"><link rel="icon" type="image/png" href="null" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c54bda95ff8b34e8be2edd1d138812c1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-117331438-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-117331438-1")</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loading-small.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶" alt="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"><img src="http://xujin.org/css/images/logo.png" alt="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="é¦–é¡µ" title="é¦–é¡µ">é¦–é¡µ</a></li><li class="nav__item"><a href="/archives" alt="å½’æ¡£" title="å½’æ¡£">å½’æ¡£</a></li><li class="nav__item"><a href="/about" alt="å…³äº" title="å…³äº">å…³äº</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><header class="post__info"><h1 class="post__title">æ·±å…¥ç†è§£HashMapä¸Šç¯‡</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="http://xujin.org/">è®¸è¿›</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2017-07-10</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/Java/">Java</a></li><li class="mark__item"><a href="/tags/Jdk/">Jdk</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>æ¬¡</li></ul></div></div></header><div class="post__content"><p><strong>å‰è¨€</strong>: HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ€è¿‘åˆšå¥½æœ‰æ—¶é—´ï¼Œåˆšå¥½æŠŠHashMapç›¸å…³çš„å†…å®¹å’Œä¹‹å‰åšå”¯å“ä¼šç½‘å…³çš„ä¸€äº›ç»éªŒæ•´ç†ä¸€ä¸‹ã€‚</p><h2 id="ä¸€-HashMapçš„æ¦‚è¿°"><a href="#ä¸€-HashMapçš„æ¦‚è¿°" class="headerlink" title="ä¸€.HashMapçš„æ¦‚è¿°"></a>ä¸€.HashMapçš„æ¦‚è¿°</h2><h3 id="1-1-HashMapçš„æ•°æ®ç»“æ„"><a href="#1-1-HashMapçš„æ•°æ®ç»“æ„" class="headerlink" title="1.1 HashMapçš„æ•°æ®ç»“æ„"></a>1.1 HashMapçš„æ•°æ®ç»“æ„</h3><p>HashMapçš„å†…å­˜ç»“æ„å’ŒåŸç†ï¼Œä»¥åŠçº¿ç¨‹å®‰å…¨éƒ½æ˜¯é¢è¯•çš„çƒ­ç‚¹é—®é¢˜ã€‚Javaä¸­çš„æ•°æ®ç»“æ„åŸºæœ¬å¯ä»¥ç”¨æ•°ç»„+é“¾è¡¨çš„è§£å†³ã€‚</p><ul><li>æ•°ç»„çš„ä¼˜ç¼ºç‚¹:é€šè¿‡ä¸‹æ ‡ç´¢å¼•æ–¹ä¾¿æŸ¥æ‰¾ï¼Œä½†æ˜¯åœ¨æ•°ç»„ä¸­æ’å…¥æˆ–åˆ é™¤ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒå›°éš¾ã€‚</li><li>é“¾è¡¨çš„ä¼˜ç¼ºç‚¹:ç”±äºåœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ éœ€è¦ä»¥éå†é“¾è¡¨çš„æ–¹å¼å»æŸ¥æ‰¾ï¼Œè€Œæ’å…¥ï¼Œåˆ é™¤å¿«é€Ÿã€‚å› æ­¤é“¾è¡¨é€‚åˆ<code>å¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ï¼Œä¸åˆ©äºæŸ¥æ‰¾</code>ã€‚</li></ul><a id="more"></a><p>è€ŒHashMapå°±æ˜¯ç»¼åˆäº†ä¸Šè¿°çš„ä¸¤ç§æ•°æ®ç»“æ„çš„ä¼˜ç‚¹ï¼ŒHashMapç”±<code>Entryæ•°ç»„+é“¾è¡¨ç»„æˆ</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/images/java/hashmap01.png" width="650px" height="450px"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°HashMapæ˜¯<code>ç”±Entryæ•°ç»„+é“¾è¡¨</code>ç»„æˆçš„ï¼Œä¸€ä¸ªé•¿åº¦ä¸º16çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ å­˜å‚¨çš„æ˜¯ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚é‚£ä¹ˆè¿™äº›å…ƒç´ æ˜¯æŒ‰ç…§ä»€ä¹ˆæ ·çš„è§„åˆ™å­˜å‚¨åˆ°æ•°ç»„ä¸­å‘¢ã€‚ä¸€èˆ¬æƒ…å†µæ˜¯é€šè¿‡<code>hash(key)%len</code>è·å¾—ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ çš„keyçš„å“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°ã€‚æ¯”å¦‚ä¸Šè¿°å“ˆå¸Œè¡¨ä¸­ï¼Œ12%16=12,28%16=12,108%16=12,140%16=12ã€‚æ‰€ä»¥<code>12ã€28ã€108</code>ä»¥åŠ140éƒ½å­˜å‚¨åœ¨æ•°ç»„ä¸‹æ ‡ä¸º<code>12</code>çš„ä½ç½®ã€‚</p><h3 id="1-2-HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜"><a href="#1-2-HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜" class="headerlink" title="1.2 HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜"></a>1.2 HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜</h3><h4 id="1-2-1-HashMap-putæ–¹æ³•å®ç°"><a href="#1-2-1-HashMap-putæ–¹æ³•å®ç°" class="headerlink" title="1.2.1 HashMap putæ–¹æ³•å®ç°"></a>1.2.1 HashMap putæ–¹æ³•å®ç°</h4><p>1.é¦–å…ˆHashMapé‡Œé¢å®ç°ä¸€ä¸ªé™æ€å†…éƒ¨ç±»<code>Entry</code>ï¼Œå…¶é‡è¦çš„å±æ€§æœ‰ <code>key , value, next</code>ï¼Œä»å±æ€§key,valueæˆ‘ä»¬å°±èƒ½å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥Entryå°±æ˜¯<code>HashMapé”®å€¼å¯¹å®ç°çš„ä¸€ä¸ªåŸºç¡€bean</code>ï¼Œæˆ‘ä»¬ä¸Šé¢è¯´åˆ°HashMapçš„åŸºç¡€å°±æ˜¯ä¸€ä¸ªçº¿æ€§æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯Entry[]ï¼ŒMapé‡Œé¢çš„å†…å®¹éƒ½ä¿å­˜åœ¨Entry[]é‡Œé¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> K key;<span class="comment">//Key-valueç»“æ„çš„key</span></span><br><span class="line">      V value;<span class="comment">//å­˜å‚¨å€¼</span></span><br><span class="line">      Entry&lt;K,V&gt; next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> hash;<span class="comment">//å“ˆå¸Œå€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.æ—¢ç„¶æ˜¯çº¿æ€§æ•°ç»„ï¼Œä¸ºä»€ä¹ˆèƒ½éšæœºå­˜å–ï¼Ÿè¿™é‡ŒHashMapç”¨äº†ä¸€ä¸ªå°ç®—æ³•ï¼Œå¤§è‡´æ˜¯è¿™æ ·å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­˜å‚¨æ—¶:</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªhashCodeæ–¹æ³•è¿™é‡Œä¸è¯¦è¿°,åªè¦ç†è§£æ¯ä¸ªkeyçš„hashæ˜¯ä¸€ä¸ªå›ºå®šçš„intå€¼</span></span><br><span class="line"><span class="keyword">int</span> hash = key.hashCode();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> index = hash % Entry[].length;</span><br><span class="line"></span><br><span class="line">Entry[index] = value;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å–å€¼æ—¶:</span></span><br><span class="line"><span class="keyword">int</span> hash = key.hashCode();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> index = hash % Entry[].length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Entry[index];</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘ä»¬è½»æ¾çš„ç†è§£äº†HashMapé€šè¿‡é”®å€¼å¯¹å®ç°å­˜å–çš„åŸºæœ¬åŸç†</p><p>3.ç–‘é—®ï¼šå¦‚æœä¸¤ä¸ªkeyé€šè¿‡hash%Entry[].lengthå¾—åˆ°çš„indexç›¸åŒï¼Œä¼šä¸ä¼šæœ‰è¦†ç›–çš„å±é™©ï¼Ÿ</p><p>ã€€ã€€è¿™é‡ŒHashMapé‡Œé¢ç”¨åˆ°é“¾å¼æ•°æ®ç»“æ„çš„ä¸€ä¸ªæ¦‚å¿µã€‚ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡Entryç±»é‡Œé¢æœ‰ä¸€ä¸ªnextå±æ€§ï¼Œä½œç”¨æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªEntryã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹Aè¿›æ¥ï¼Œé€šè¿‡è®¡ç®—å…¶keyçš„hashå¾—åˆ°çš„index=0ï¼Œè®°åš:Entry[0] = Aã€‚ä¸€ä¼šååˆè¿›æ¥ä¸€ä¸ªé”®å€¼å¯¹Bï¼Œé€šè¿‡è®¡ç®—å…¶indexä¹Ÿç­‰äº0ï¼Œç°åœ¨æ€ä¹ˆåŠï¼ŸHashMapä¼šè¿™æ ·åš:B.next = A,Entry[0] = B,å¦‚æœåˆè¿›æ¥C,indexä¹Ÿç­‰äº0,é‚£ä¹ˆC.next = B,Entry[0] = Cï¼›è¿™æ ·æˆ‘ä»¬å‘ç°index=0çš„åœ°æ–¹å…¶å®å­˜å–äº†A,B,Cä¸‰ä¸ªé”®å€¼å¯¹,ä»–ä»¬é€šè¿‡nextè¿™ä¸ªå±æ€§é“¾æ¥åœ¨ä¸€èµ·ã€‚æ‰€ä»¥ç–‘é—®ä¸ç”¨æ‹…å¿ƒã€‚ä¹Ÿå°±æ˜¯è¯´æ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯æœ€åæ’å…¥çš„å…ƒç´ ã€‚åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒHashMapçš„å¤§è‡´å®ç°ï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»æ¸…æ¥šäº†ã€‚</p><p>ã€€ã€€å½“ç„¶HashMapé‡Œé¢ä¹ŸåŒ…å«ä¸€äº›ä¼˜åŒ–æ–¹é¢çš„å®ç°ï¼Œè¿™é‡Œä¹Ÿè¯´ä¸€ä¸‹ã€‚æ¯”å¦‚ï¼šEntry[]çš„é•¿åº¦ä¸€å®šåï¼Œéšç€mapé‡Œé¢æ•°æ®çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åŒä¸€ä¸ªindexçš„é“¾å°±ä¼šå¾ˆé•¿ï¼Œä¼šä¸ä¼šå½±å“æ€§èƒ½ï¼ŸHashMapé‡Œé¢è®¾ç½®ä¸€ä¸ªå› ç´ ï¼ˆä¹Ÿç§°ä¸ºå› å­ï¼‰ï¼Œéšç€mapçš„sizeè¶Šæ¥è¶Šå¤§ï¼ŒEntry[]ä¼šä»¥ä¸€å®šçš„è§„åˆ™åŠ é•¿é•¿åº¦ã€‚ ã€€ã€€ ã€€ã€€</p><h2 id="äºŒ-HashMapéçº¿ç¨‹å®‰å…¨"><a href="#äºŒ-HashMapéçº¿ç¨‹å®‰å…¨" class="headerlink" title="äºŒ.HashMapéçº¿ç¨‹å®‰å…¨"></a>äºŒ.HashMapéçº¿ç¨‹å®‰å…¨</h2><h3 id="2-1-HashMapè¿›è¡ŒPutæ“ä½œ"><a href="#2-1-HashMapè¿›è¡ŒPutæ“ä½œ" class="headerlink" title="2.1 HashMapè¿›è¡ŒPutæ“ä½œ"></a>2.1 HashMapè¿›è¡ŒPutæ“ä½œ</h3><h4 id="2-1-1-Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ"><a href="#2-1-1-Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ" class="headerlink" title="2.1.1 Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ"></a>2.1.1 Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ</h4><p>putæ“ä½œä¸»è¦æ˜¯åˆ¤ç©ºï¼Œå¯¹keyçš„hashcodeæ‰§è¡Œä¸€æ¬¡HashMapè‡ªå·±çš„å“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°bucketindexä½ç½®ï¼Œè¿˜æœ‰å¯¹é‡å¤keyçš„è¦†ç›–æ“ä½œã€‚</p><p>åœ¨HashMapåšputæ“ä½œçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ä»¥ä¸‹çš„æ–¹æ³•ï¼Œ<code>addEntryå’ŒcreateEntry</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">        <span class="comment">//å¾—åˆ°keyçš„hashcodeï¼ŒåŒæ—¶å†åšä¸€æ¬¡hashæ“ä½œ</span></span><br><span class="line">        <span class="keyword">int</span> hash = hash(key.hashCode());</span><br><span class="line">        <span class="comment">//å¯¹æ•°ç»„é•¿åº¦å–ä½™ï¼Œå†³å®šä¸‹æ ‡ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">          * é¦–å…ˆæ‰¾åˆ°æ•°ç»„ä¸‹æ ‡å¤„çš„é“¾è¡¨ç»“ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">          * åˆ¤æ–­keyå¯¹ä¸€ä¸ªçš„hashå€¼æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°†å…¶æ›¿æ¢ä¸ºæ–°çš„value</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            <span class="comment">//Hashç¢°æ’çš„è§£å†³</span></span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        modCount++;</span><br><span class="line">        addEntry(hash, key, value, i);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¶‰åŠåˆ°çš„å‡ ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">        h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">        <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡å¦‚Açº¿ç¨‹å’ŒBçº¿ç¨‹<code>åŒæ—¶è¿›å…¥addEntry</code>ï¼Œç„¶åè®¡ç®—å‡ºäº†<code>ç›¸åŒçš„å“ˆå¸Œå€¼å¯¹åº”äº†ç›¸åŒçš„æ•°ç»„ä½ç½®</code>ï¼Œå› ä¸ºæ­¤æ—¶è¯¥ä½ç½®è¿˜æ²¡æ•°æ®ï¼Œç„¶åå¯¹<code>åŒä¸€ä¸ªæ•°ç»„ä½ç½®è°ƒç”¨createEntry</code>ï¼Œä¸¤ä¸ªçº¿ç¨‹ä¼šåŒæ—¶å¾—åˆ°ç°åœ¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åAå†™å…¥æ–°çš„å¤´ç»“ç‚¹ä¹‹åï¼ŒBä¹Ÿå†™å…¥æ–°çš„å¤´ç»“ç‚¹ï¼Œé‚£Bçš„å†™å…¥æ“ä½œå°±ä¼šè¦†ç›–Açš„å†™å…¥æ“ä½œé€ æˆAçš„å†™å…¥æ“ä½œä¸¢å¤±ã€‚</p><h4 id="2-1-2-jdk8ä¸­HashMapçš„Putæ“ä½œ"><a href="#2-1-2-jdk8ä¸­HashMapçš„Putæ“ä½œ" class="headerlink" title="2.1.2 jdk8ä¸­HashMapçš„Putæ“ä½œ"></a>2.1.2 jdk8ä¸­HashMapçš„Putæ“ä½œ</h4><p><img src="/images/java/hashmap8.png" width="650px" height="450px"></p><p>â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼›</p><p>â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼›</p><p>â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼›</p><p>â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼›</p><p>â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼›</p><p>â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p><p>JDK1.8HashMapçš„putæ–¹æ³•æºç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// å¯¹keyçš„hashCode()åšhash</span></span><br><span class="line">      <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">     Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">      <span class="comment">// æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º</span></span><br><span class="line">     <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">         n = (tab = resize()).length;</span><br><span class="line">     <span class="comment">// æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† </span></span><br><span class="line">     <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>) </span><br><span class="line">         tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">     <span class="keyword">else</span> &#123;</span><br><span class="line">         Node&lt;K,V&gt; e; K k;</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value</span></span><br><span class="line">         <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">             ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">             e = p;</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">             e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨</span></span><br><span class="line">         <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                 <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                     p.next = newNode(hash, key,value,<span class="keyword">null</span>);</span><br><span class="line">                        <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></span><br><span class="line">                     <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st  </span></span><br><span class="line">                         treeifyBin(tab, hash);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                    <span class="comment">// keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</span></span><br><span class="line">                 <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                     ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) </span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                 p = e;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">             V oldValue = e.value;</span><br><span class="line">             <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                 e.value = value;</span><br><span class="line">             afterNodeAccess(e);</span><br><span class="line">             <span class="keyword">return</span> oldValue;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     ++modCount;</span><br><span class="line">     <span class="comment">// æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹</span></span><br><span class="line">     <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">         resize();</span><br><span class="line">     afterNodeInsertion(evict);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-HashMapè¿›è¡ŒGetæ“ä½œ"><a href="#2-2-HashMapè¿›è¡ŒGetæ“ä½œ" class="headerlink" title="2.2 HashMapè¿›è¡ŒGetæ“ä½œ"></a>2.2 HashMapè¿›è¡ŒGetæ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> getForNullKey();</span><br><span class="line">        <span class="keyword">int</span> hash = hash(key.hashCode());</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">          * å…ˆå®šä½åˆ°æ•°ç»„å…ƒç´ ï¼Œå†éå†è¯¥å…ƒç´ å¤„çš„é“¾è¡¨</span></span><br><span class="line"><span class="comment">          * åˆ¤æ–­çš„æ¡ä»¶æ˜¯keyçš„hashå€¼ç›¸åŒï¼Œå¹¶ä¸”é“¾è¡¨çš„å­˜å‚¨çš„keyå€¼å’Œä¼ å…¥çš„keyå€¼ç›¸åŒ</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];e != <span class="keyword">null</span>;e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹é“¾è¡¨çš„ç»“ç‚¹æ•°æ®ç»“æ„ï¼Œä¿å­˜äº†å››ä¸ªå­—æ®µï¼ŒåŒ…æ‹¬keyï¼Œvalueï¼Œkeyå¯¹åº”çš„hashå€¼ä»¥åŠé“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> K key;<span class="comment">//Key-valueç»“æ„çš„key</span></span><br><span class="line">      V value;<span class="comment">//å­˜å‚¨å€¼</span></span><br><span class="line">      Entry&lt;K,V&gt; next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> hash;<span class="comment">//å“ˆå¸Œå€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-HashMapæ‰©å®¹çš„æ—¶å€™"><a href="#2-3-HashMapæ‰©å®¹çš„æ—¶å€™" class="headerlink" title="2.3 HashMapæ‰©å®¹çš„æ—¶å€™"></a>2.3 HashMapæ‰©å®¹çš„æ—¶å€™</h3><p>æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚</p><p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªaddEntryæ–¹æ³•ä¸­ï¼Œæœ‰ä¸ªæ‰©å®¹çš„æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä¼šæ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„æ•°ç»„ï¼Œç„¶åå¯¹åŸæ•°ç»„çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°è¿›è¡Œè®¡ç®—å’Œå†™å…¥æ–°çš„æ•°ç»„ï¼Œä¹‹åæŒ‡å‘æ–°ç”Ÿæˆçš„æ•°ç»„ã€‚æ¥çœ‹ä¸€ä¸‹æ‰©å®¹çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨æ–°çš„å®¹é‡æ¥ç»™tableæ‰©å®¹  </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;  </span><br><span class="line">    Entry[] oldTable = table; <span class="comment">//å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„ </span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = oldTable.length; <span class="comment">//ä¿å­˜old capacity  </span></span><br><span class="line">    <span class="comment">// å¦‚æœæ—§çš„å®¹é‡å·²ç»æ˜¯ç³»ç»Ÿé»˜è®¤æœ€å¤§å®¹é‡äº†(æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº† )ï¼Œé‚£ä¹ˆå°†é˜ˆå€¼è®¾ç½®æˆæ•´å½¢çš„æœ€å¤§å€¼ï¼Œé€€å‡º ,  </span></span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;  </span><br><span class="line">        threshold = Integer.MAX_VALUE;  </span><br><span class="line">        <span class="keyword">return</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„  </span></span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];  </span><br><span class="line">    <span class="comment">//å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ </span></span><br><span class="line">    transfer(newTable, initHashSeedAsNeeded(newCapacity));  </span><br><span class="line">    <span class="comment">//HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„</span></span><br><span class="line">    table = newTable;  </span><br><span class="line">    <span class="comment">//è®¾ç½®é˜ˆå€¼  </span></span><br><span class="line">    threshold = (<span class="keyword">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œ<code>transfer()</code>æ–¹æ³•å°†<code>åŸæœ‰Entryæ•°ç»„</code>çš„å…ƒç´ <code>æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„</code>é‡Œã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥ï¼Œæ£€æµ‹åˆ°æ€»æ•°é‡è¶…è¿‡é—¨é™å€¼çš„æ—¶å€™å°±ä¼šåŒæ—¶è°ƒç”¨resizeæ“ä½œï¼Œå„è‡ªç”Ÿæˆæ–°çš„æ•°ç»„å¹¶rehashåèµ‹ç»™è¯¥mapåº•å±‚çš„æ•°ç»„tableï¼Œç»“æœæœ€ç»ˆåªæœ‰æœ€åä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆçš„æ–°æ•°ç»„è¢«èµ‹ç»™tableå˜é‡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‡ä¼šä¸¢å¤±ã€‚è€Œä¸”å½“æŸäº›çº¿ç¨‹å·²ç»å®Œæˆèµ‹å€¼è€Œå…¶ä»–çº¿ç¨‹åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå°±ä¼šç”¨å·²ç»è¢«èµ‹å€¼çš„tableä½œä¸ºåŸå§‹æ•°ç»„ï¼Œè¿™æ ·ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥åœ¨æ‰©å®¹æ“ä½œçš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å¹¶å‘çš„é—®é¢˜ã€‚</p><h3 id="2-4-åˆ é™¤æ•°æ®çš„æ—¶å€™"><a href="#2-4-åˆ é™¤æ•°æ®çš„æ—¶å€™" class="headerlink" title="2.4 åˆ é™¤æ•°æ®çš„æ—¶å€™"></a>2.4 åˆ é™¤æ•°æ®çš„æ—¶å€™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤Entryï¼Œè¿”å›å¯¹åº”çš„value  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;  </span><br><span class="line">    Entry&lt;K,V&gt; e = removeEntryForKey(key);  </span><br><span class="line">    <span class="keyword">return</span> (e == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®æŒ‡å®šçš„keyï¼Œåˆ é™¤Entry,å¹¶è¿”å›å¯¹åº”çš„value  </span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">removeEntryForKey</span><span class="params">(Object key)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">int</span> hash = (key == <span class="keyword">null</span>) ? <span class="number">0</span> : hash(key);  </span><br><span class="line">    <span class="keyword">int</span> i = indexFor(hash, table.length);  </span><br><span class="line">    Entry&lt;K,V&gt; prev = table[i];  </span><br><span class="line">    Entry&lt;K,V&gt; e = prev;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (e != <span class="keyword">null</span>) &#123;  </span><br><span class="line">        Entry&lt;K,V&gt; next = e.next;  </span><br><span class="line">        Object k;  </span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp;  </span><br><span class="line">            ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;  </span><br><span class="line">            modCount++;  </span><br><span class="line">            size--;  </span><br><span class="line">            <span class="keyword">if</span> (prev == e) <span class="comment">//å¦‚æœåˆ é™¤çš„æ˜¯tableä¸­çš„ç¬¬ä¸€é¡¹çš„å¼•ç”¨  </span></span><br><span class="line">                table[i] = next;<span class="comment">//ç›´æ¥å°†ç¬¬ä¸€é¡¹ä¸­çš„nextçš„å¼•ç”¨å­˜å…¥table[i]ä¸­  </span></span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">                prev.next = next; <span class="comment">//å¦åˆ™å°†table[i]ä¸­å½“å‰Entryçš„å‰ä¸€ä¸ªEntryä¸­çš„nextç½®ä¸ºå½“å‰Entryçš„next  </span></span><br><span class="line">            e.recordRemoval(<span class="keyword">this</span>);  </span><br><span class="line">            <span class="keyword">return</span> e;  </span><br><span class="line">        &#125;  </span><br><span class="line">        prev = e;  </span><br><span class="line">        e = next;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> e;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ é™¤è¿™ä¸€å—å¯èƒ½ä¼šå‡ºç°ä¸¤ç§çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¬¬ä¸€ç§æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­å¾—åˆ°äº†æŒ‡å®šçš„æ•°ç»„ä½ç½®iå¹¶è¿›å…¥äº†å¾ªç¯ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨åŒæ ·çš„ä½ç½®å·²ç»åˆ æ‰äº†iä½ç½®çš„é‚£ä¸ªæ•°æ®äº†ï¼Œç„¶åç¬¬ä¸€ä¸ªçº¿ç¨‹é‚£è¾¹å°±æ²¡äº†ã€‚ä½†æ˜¯åˆ é™¤çš„è¯ï¼Œæ²¡äº†å€’é—®é¢˜ä¸å¤§ã€‚<br>ã€€ã€€å†çœ‹å¦ä¸€ç§æƒ…å†µï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªæ•°ç»„ä½ç½®çš„æ—¶å€™ï¼Œä¹Ÿéƒ½ä¼šå…ˆå–å¾—ç°åœ¨çŠ¶æ€ä¸‹è¯¥ä½ç½®å­˜å‚¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åå„è‡ªå»è¿›è¡Œè®¡ç®—æ“ä½œï¼Œä¹‹åå†æŠŠç»“æœå†™ä¼šåˆ°è¯¥æ•°ç»„ä½ç½®å»ï¼Œå…¶å®å†™å›çš„æ—¶å€™å¯èƒ½å…¶ä»–çš„çº¿ç¨‹å·²ç»å°±æŠŠè¿™ä¸ªä½ç½®ç»™ä¿®æ”¹è¿‡äº†ï¼Œå°±ä¼šè¦†ç›–å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹ã€‚ ã€€ã€€</p><blockquote><p>æ€»ä¹‹HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘çš„åœºåˆä½¿ç”¨çš„è¯ï¼Œè¦ç”¨Collections.synchronizedMapè¿›è¡ŒåŒ…è£…ä¸€ä¸‹ã€‚</p></blockquote><h2 id="ä¸‰-å‚è€ƒæ–‡ç« "><a href="#ä¸‰-å‚è€ƒæ–‡ç« " class="headerlink" title="ä¸‰.å‚è€ƒæ–‡ç« "></a>ä¸‰.å‚è€ƒæ–‡ç« </h2><p><a href="https://zhuanlan.zhihu.com/p/21673805" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21673805</a><br><a href="http://www.importnew.com/7099.html" target="_blank" rel="noopener">http://www.importnew.com/7099.html</a><br><a href="http://www.admin10000.com/document/3322.html" target="_blank" rel="noopener">http://www.admin10000.com/document/3322.html</a><br><a href="http://www.cnblogs.com/chenssy/p/3521565.html" target="_blank" rel="noopener">http://www.cnblogs.com/chenssy/p/3521565.html</a></p><div class="post-announce">æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæœ¬æ–‡ç”± <a href="http://xujin.org">è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶</a> ç‰ˆæƒæ‰€æœ‰ã€‚å¦‚è‹¥è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼šè®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶ï¼ˆ<a href="http://xujin.org/java/hm01/">http://xujin.org/java/hm01/</a>ï¼‰</div><div class="post__prevs"><div class="post__prev"><a href="/sc/sc-gateway/" title="Spring Cloud Gatewayç¦»å¼€å­µåŒ–å™¨çš„å˜åŒ–"><i class="iconfont icon-prev"></i>Spring Cloud Gatewayç¦»å¼€å­µåŒ–å™¨çš„å˜åŒ–</a></div><div class="post__prev post__prev--right"><a href="/janus/gw-solution/" title="å¾®æœåŠ¡ç½‘å…³è§£å†³æ–¹æ¡ˆè°ƒç ”å’Œä½¿ç”¨æ€»ç»“">å¾®æœåŠ¡ç½‘å…³è§£å†³æ–¹æ¡ˆè°ƒç ”å’Œä½¿ç”¨æ€»ç»“<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><div id="toc" class="toc-article"><h3 class="block__title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€-HashMapçš„æ¦‚è¿°"><span class="toc-text">ä¸€.HashMapçš„æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-HashMapçš„æ•°æ®ç»“æ„"><span class="toc-text">1.1 HashMapçš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜"><span class="toc-text">1.2 HashMapçš„å­˜å–å®ç°ç®€å•è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-HashMap-putæ–¹æ³•å®ç°"><span class="toc-text">1.2.1 HashMap putæ–¹æ³•å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒ-HashMapéçº¿ç¨‹å®‰å…¨"><span class="toc-text">äºŒ.HashMapéçº¿ç¨‹å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-HashMapè¿›è¡ŒPutæ“ä½œ"><span class="toc-text">2.1 HashMapè¿›è¡ŒPutæ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ"><span class="toc-text">2.1.1 Jdk8ä»¥ä¸‹HashMapçš„Putæ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-jdk8ä¸­HashMapçš„Putæ“ä½œ"><span class="toc-text">2.1.2 jdk8ä¸­HashMapçš„Putæ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-HashMapè¿›è¡ŒGetæ“ä½œ"><span class="toc-text">2.2 HashMapè¿›è¡ŒGetæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-HashMapæ‰©å®¹çš„æ—¶å€™"><span class="toc-text">2.3 HashMapæ‰©å®¹çš„æ—¶å€™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-åˆ é™¤æ•°æ®çš„æ—¶å€™"><span class="toc-text">2.4 åˆ é™¤æ•°æ®çš„æ—¶å€™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸‰-å‚è€ƒæ–‡ç« "><span class="toc-text">ä¸‰.å‚è€ƒæ–‡ç« </span></a></li></ol></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">å…³äº</h3><div class="item__content"><p class="item__text">è½¯ä»¶ä¸–ç•Œå°±æ˜¯æ¨¡æ‹Ÿå®¢è§‚ä¸–ç•Œï¼Œéœ€æ±‚åˆ†æï¼ŒæŠ€æœ¯é©±åŠ¨ï¼Œä»è€Œæ”¹å˜ä¸–ç•Œ!</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shang Hai, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>Software_King@@qq.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/img/wx.jpg" alt="logo" title="è®¸è¿›æ²‰æ€å½•-ä¸“æ³¨äºäº’è”ç½‘ä¸ä¸­é—´ä»¶åŸºç¡€æ¶æ„æŠ€æœ¯ç ”ç©¶"></div><div class="footer-top__item"><h3 class="item__title">å‹æƒ…é“¾æ¥</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://www.xujin.org" title="è®¸è¿›|æ²‰æ€å½•" target="_blank">è®¸è¿›|æ²‰æ€å½•</a></li><li class="list-item"><a href="http://springcloud.cn" title="Spring Cloudä¸­å›½ç¤¾åŒº" target="_blank">Spring Cloudä¸­å›½ç¤¾åŒº</a></li><li class="list-item"><a href="http://www.cnblogs.com/ACMer/" title="æˆ‘çš„åšå®¢å›­" target="_blank">æˆ‘çš„åšå®¢å›­</a></li><li class="list-item"><a href="http://blog.sina.com.cn/softwaremi" title="æ–°æµªåšå®¢" target="_blank">æ–°æµªåšå®¢</a></li><li class="list-item"><a href="http://blog.chingzhu.com/" title="æœ±æ¸…åšå®¢" target="_blank">æœ±æ¸…åšå®¢</a></li><li class="list-item"><a href="http://tietang.wang/" title="é“æ±¤åšå®¢" target="_blank">é“æ±¤åšå®¢</a></li><li class="list-item"><a href="http://blog.csdn.net/forezp" title="æ–¹å¿—æœ‹çš„åšå®¢" target="_blank">æ–¹å¿—æœ‹çš„åšå®¢</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">Powered by <a href="http://xujin.org/" target="_blank">Halo</a>, Made by <a href="https://github.com/softwareking" target="_blank">HaloğŸ’«</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/softwareking" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="linkedin"><i class="iconfont icon-in"></i></a></li><li class="social-network__item"><a href="mailto:softwareking@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li></ul><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span>ğŸ€<span class="post-count">105.1k</span> </span><span>| </span><span id="busuanzi_container_site_uv" style="display:inline">ğŸ‘½<span id="busuanzi_value_site_uv">1000000</span><span></span></span><span class="footer-separator"> | </span><span id="busuanzi_container_site_pv" style="display:inline">ğŸŒ€<span id="busuanzi_value_site_pv">1000000</span><span></span></span></div></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["Java","Jdk"],gitalk=new Gitalk({clientID:"322a00ea1ee28f04ba14",clientSecret:"01916d619a774e744b5e7b73bf4faa3d14b53bcc",repo:"italk",owner:"SoftwareKing",admin:["SoftwareKing"],labels:tags,id:new Date(14996664e5).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>